function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(n,e)})(e)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _toArray(e){return _arrayWithHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableRest()}function asyncGeneratorStep(e,t,n,r,a,i,o){try{var s=e[i](o),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,a)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){asyncGeneratorStep(i,r,a,o,s,"next",e)}function s(e){asyncGeneratorStep(i,r,a,o,s,"throw",e)}o(void 0)}))}}function _objectDestructuringEmpty(e){if(null==e)throw new TypeError("Cannot destructure undefined")}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(u){a=!0,i=u}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _createForOfIteratorHelper(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _construct(e,t,n){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&_setPrototypeOf(a,n.prototype),a}).apply(null,arguments)}function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=_superPropBase(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,r=_getPrototypeOf(e);if(t){var a=_getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}/*! For license information please see main-es2015.af0b51a79ee306f9ef9e.js.LICENSE.txt */(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{0:function(e,t,n){e.exports=n("zUnb")},"0z79":function(e,t,n){var r=n("AdPF"),a=n("CUme"),i=n("1Mk5"),o=n("Yvos"),s=n("HjK1")("engine.io-client:polling-xhr");function u(){}function c(e){if(a.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,"undefined"!=typeof location){var t="https:"===location.protocol,n=location.port;n||(n=t?443:80),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||n!==e.port,this.xs=e.secure!==t}}function l(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}if(e.exports=c,e.exports.Request=l,o(c,a),c.prototype.supportsBinary=!0,c.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new l(e)},c.prototype.doWrite=function(e,t){var n=this.request({method:"POST",data:e,isBinary:"string"!=typeof e&&void 0!==e}),r=this;n.on("success",t),n.on("error",(function(e){r.onError("xhr post error",e)})),this.sendXhr=n},c.prototype.doPoll=function(){s("xhr poll");var e=this.request(),t=this;e.on("data",(function(e){t.onData(e)})),e.on("error",(function(e){t.onError("xhr poll error",e)})),this.pollXhr=e},i(l.prototype),l.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new r(e),n=this;try{s("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var a in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(a)&&t.setRequestHeader(a,this.extraHeaders[a])}catch(i){}if("POST"===this.method)try{t.setRequestHeader("Content-type",this.isBinary?"application/octet-stream":"text/plain;charset=UTF-8")}catch(i){}try{t.setRequestHeader("Accept","*/*")}catch(i){}"withCredentials"in t&&(t.withCredentials=!0),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){n.onLoad()},t.onerror=function(){n.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{var e=t.getResponseHeader("Content-Type");n.supportsBinary&&"application/octet-stream"===e&&(t.responseType="arraybuffer")}catch(i){}4===t.readyState&&(200===t.status||1223===t.status?n.onLoad():setTimeout((function(){n.onError(t.status)}),0))},s("xhr data %s",this.data),t.send(this.data)}catch(i){return void setTimeout((function(){n.onError(i)}),0)}"undefined"!=typeof document&&(this.index=l.requestsCount++,l.requests[this.index]=this)},l.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},l.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},l.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},l.prototype.cleanup=function(e){if(null!=this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=u:this.xhr.onreadystatechange=u,e)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete l.requests[this.index],this.xhr=null}},l.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(n){}e="application/octet-stream"===t&&this.xhr.response||this.xhr.responseText}catch(n){this.onError(n)}null!=e&&this.onData(e)},l.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},l.prototype.abort=function(){this.cleanup()},l.requestsCount=0,l.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",p);else if("function"==typeof addEventListener){var h="onpagehide"in self?"pagehide":"unload";addEventListener(h,p,!1)}function p(){for(var e in l.requests)l.requests.hasOwnProperty(e)&&l.requests[e].abort()}},1:function(e,t){},"14A5":function(e,t){var n=void 0!==n?n:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,r=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),a=r&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),i=n&&n.prototype.append&&n.prototype.getBlob;function o(e){return e.map((function(e){if(e.buffer instanceof ArrayBuffer){var t=e.buffer;if(e.byteLength!==t.byteLength){var n=new Uint8Array(e.byteLength);n.set(new Uint8Array(t,e.byteOffset,e.byteLength)),t=n.buffer}return t}return e}))}function s(e,t){t=t||{};var r=new n;return o(e).forEach((function(e){r.append(e)})),t.type?r.getBlob(t.type):r.getBlob()}function u(e,t){return new Blob(o(e),t||{})}"undefined"!=typeof Blob&&(s.prototype=Blob.prototype,u.prototype=Blob.prototype),e.exports=r?a?Blob:u:i?s:void 0},"1Mk5":function(e,t,n){function r(e){if(e)return function(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}(e)}e.exports=r,r.prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},r.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var a=0;a<r.length;a++)if((n=r[a])===t||n.fn===t){r.splice(a,1);break}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n)for(var r=0,a=(n=n.slice(0)).length;r<a;++r)n[r].apply(this,t);return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},2:function(e,t){},"2Dig":function(e,t){e.exports=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}},"2pII":function(e,t,n){var r=n("akSB"),a=n("1Mk5"),i=n("HjK1")("engine.io-client:socket"),o=n("7jRU"),s=n("Wm4p"),u=n("Uxeu"),c=n("TypT");function l(e,t){if(!(this instanceof l))return new l(e,t);t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=u(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=u(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=c.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}e.exports=l,l.priorWebsocketSuccess=!1,a(l.prototype),l.protocol=s.protocol,l.Socket=l,l.Transport=n("Gbct"),l.transports=n("akSB"),l.parser=n("Wm4p"),l.prototype.createTransport=function(e){i('creating transport "%s"',e);var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.query);t.EIO=s.protocol,t.transport=e;var n=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new r[e]({query:t,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0,isReactNative:this.isReactNative})},l.prototype.open=function(){var e;if(this.rememberUpgrade&&l.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout((function(){t.emit("error","No transports available")}),0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(n){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},l.prototype.setTransport=function(e){i("setting transport %s",e.name);var t=this;this.transport&&(i("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",(function(){t.onDrain()})).on("packet",(function(e){t.onPacket(e)})).on("error",(function(e){t.onError(e)})).on("close",(function(){t.onClose("transport close")}))},l.prototype.probe=function(e){i('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),n=!1,r=this;function a(){r.onlyBinaryUpgrades&&(n=n||!this.supportsBinary&&r.transport.supportsBinary),n||(i('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",(function(a){if(!n)if("pong"===a.type&&"probe"===a.data){if(i('probe transport "%s" pong',e),r.upgrading=!0,r.emit("upgrading",t),!t)return;l.priorWebsocketSuccess="websocket"===t.name,i('pausing current transport "%s"',r.transport.name),r.transport.pause((function(){n||"closed"!==r.readyState&&(i("changing transport and sending upgrade packet"),p(),r.setTransport(t),t.send([{type:"upgrade"}]),r.emit("upgrade",t),t=null,r.upgrading=!1,r.flush())}))}else{i('probe transport "%s" failed',e);var o=new Error("probe error");o.transport=t.name,r.emit("upgradeError",o)}})))}function o(){n||(n=!0,p(),t.close(),t=null)}function s(n){var a=new Error("probe error: "+n);a.transport=t.name,o(),i('probe transport "%s" failed because of error: %s',e,n),r.emit("upgradeError",a)}function u(){s("transport closed")}function c(){s("socket closed")}function h(e){t&&e.name!==t.name&&(i('"%s" works - aborting "%s"',e.name,t.name),o())}function p(){t.removeListener("open",a),t.removeListener("error",s),t.removeListener("close",u),r.removeListener("close",c),r.removeListener("upgrading",h)}l.priorWebsocketSuccess=!1,t.once("open",a),t.once("error",s),t.once("close",u),this.once("close",c),this.once("upgrading",h),t.open()},l.prototype.onOpen=function(){if(i("socket open"),this.readyState="open",l.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){i("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},l.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(i('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else i('packet received with socket readyState "%s"',this.readyState)},l.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},l.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout((function(){"closed"!==t.readyState&&t.onClose("ping timeout")}),e||t.pingInterval+t.pingTimeout)},l.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout((function(){i("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)}),e.pingInterval)},l.prototype.ping=function(){var e=this;this.sendPacket("ping",(function(){e.emit("ping")}))},l.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},l.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(i("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},l.prototype.write=l.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},l.prototype.sendPacket=function(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var a={type:e,data:t,options:n};this.emit("packetCreate",a),this.writeBuffer.push(a),r&&this.once("flush",r),this.flush()}},l.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?r():t()})):this.upgrading?r():t()}function t(){e.onClose("forced close"),i("socket closing - telling transport to close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),t()}function r(){e.once("upgrade",n),e.once("upgradeError",n)}return this},l.prototype.onError=function(e){i("socket error %j",e),l.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},l.prototype.onClose=function(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(i('socket close with reason: "%s"',e),clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)},l.prototype.filterUpgrades=function(e){for(var t=[],n=0,r=e.length;n<r;n++)~o(this.transports,e[n])&&t.push(e[n]);return t}},"2xqC":function(e,t,n){function r(e){if(e)return function(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}(e)}e.exports=r,r.prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},r.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var a=0;a<r.length;a++)if((n=r[a])===t||n.fn===t){r.splice(a,1);break}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n)for(var r=0,a=(n=n.slice(0)).length;r<a;++r)n[r].apply(this,t);return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},3:function(e,t){},4:function(e,t){},5:function(e,t){},6:function(e,t){},"6C75":function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},"7jRU":function(e,t){var n=[].indexOf;e.exports=function(e,t){if(n)return e.indexOf(t);for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}},AdPF:function(e,t,n){var r=n("yeub");e.exports=function(e){var t=e.xdomain,n=e.xscheme,a=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||r))return new XMLHttpRequest}catch(i){}try{if("undefined"!=typeof XDomainRequest&&!n&&a)return new XDomainRequest}catch(i){}if(!t)try{return new(self[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(i){}}},Aplp:function(e,t,n){"use strict";var r,a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),i={},o=0,s=0;function u(e){var t="";do{t=a[e%64]+t,e=Math.floor(e/64)}while(e>0);return t}function c(){var e=u(+new Date);return e!==r?(o=0,r=e):e+"."+u(o++)}for(;s<64;s++)i[a[s]]=s;c.encode=u,c.decode=function(e){var t=0;for(s=0;s<e.length;s++)t=64*t+i[e.charAt(s)];return t},e.exports=c},B9Yq:function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},C2QD:function(e,t){function n(e){this.ms=(e=e||{}).min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=n,n.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(e){this.ms=e},n.prototype.setMax=function(e){this.max=e},n.prototype.setJitter=function(e){this.jitter=e}},CIKq:function(e,t,n){var r,a,i=n("Gbct"),o=n("Wm4p"),s=n("TypT"),u=n("Yvos"),c=n("Aplp"),l=n("HjK1")("engine.io-client:websocket");if("undefined"!=typeof WebSocket)r=WebSocket;else if("undefined"!=typeof self)r=self.WebSocket||self.MozWebSocket;else try{a=n(1)}catch(d){}var h=r||a;function p(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=r&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(h=a),i.call(this,e)}e.exports=p,u(p,i),p.prototype.name="websocket",p.prototype.supportsBinary=!0,p.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?t?new h(e,t):new h(e):new h(e,t,n)}catch(r){return this.emit("error",r)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},p.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},p.prototype.write=function(e){var t=this;this.writable=!1;for(var n=e.length,r=0,a=n;r<a;r++)!function(e){o.encodePacket(e,t.supportsBinary,(function(r){if(!t.usingBrowserWebSocket){var a={};e.options&&(a.compress=e.options.compress),t.perMessageDeflate&&("string"==typeof r?Buffer.byteLength(r):r.length)<t.perMessageDeflate.threshold&&(a.compress=!1)}try{t.usingBrowserWebSocket?t.ws.send(r):t.ws.send(r,a)}catch(d){l("websocket closed before onclose event")}--n||(t.emit("flush"),setTimeout((function(){t.writable=!0,t.emit("drain")}),0))}))}(e[r])},p.prototype.onClose=function(){i.prototype.onClose.call(this)},p.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},p.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||(e.b64=1),(e=s.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},p.prototype.check=function(){return!(!h||"__initialize"in h&&this.name===p.prototype.name)}},CUme:function(e,t,n){var r=n("Gbct"),a=n("TypT"),i=n("Wm4p"),o=n("Yvos"),s=n("Aplp"),u=n("HjK1")("engine.io-client:polling");e.exports=l;var c=null!=new(n("AdPF"))({xdomain:!1}).responseType;function l(e){c&&!(e&&e.forceBase64)||(this.supportsBinary=!1),r.call(this,e)}o(l,r),l.prototype.name="polling",l.prototype.doOpen=function(){this.poll()},l.prototype.pause=function(e){var t=this;function n(){u("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(u("we are currently polling - waiting to pause"),r++,this.once("pollComplete",(function(){u("pre-pause polling complete"),--r||n()}))),this.writable||(u("we are currently writing - waiting to pause"),r++,this.once("drain",(function(){u("pre-pause writing complete"),--r||n()})))}else n()},l.prototype.poll=function(){u("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},l.prototype.onData=function(e){var t=this;u("polling got data %s",e),i.decodePayload(e,this.socket.binaryType,(function(e,n,r){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():u('ignoring poll - transport state "%s"',this.readyState))},l.prototype.doClose=function(){var e=this;function t(){u("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(u("transport open - closing"),t()):(u("transport not open - deferring close"),this.once("open",t))},l.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};i.encodePayload(e,this.supportsBinary,(function(e){t.doWrite(e,n)}))},l.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=s()),this.supportsBinary||e.sid||(e.b64=1),e=a.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e}},Cl5A:function(e,t,n){var r=n("CUme"),a=n("Yvos");e.exports=l;var i,o=/\n/g,s=/\\n/g;function u(){}function c(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}}function l(e){if(r.call(this,e),this.query=this.query||{},!i){var t=c();i=t.___eio=t.___eio||[]}this.index=i.length;var n=this;i.push((function(e){n.onData(e)})),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",(function(){n.script&&(n.script.onerror=u)}),!1)}a(l,r),l.prototype.supportsBinary=!1,l.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),r.prototype.doClose.call(this)},l.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)}),100)},l.prototype.doWrite=function(e,t){var n=this;if(!this.form){var r,a=document.createElement("form"),i=document.createElement("textarea"),u=this.iframeId="eio_iframe_"+this.index;a.className="socketio",a.style.position="absolute",a.style.top="-1000px",a.style.left="-1000px",a.target=u,a.method="POST",a.setAttribute("accept-charset","utf-8"),i.name="d",a.appendChild(i),document.body.appendChild(a),this.form=a,this.area=i}function c(){l(),t()}function l(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(e){n.onError("jsonp polling iframe removal error",e)}try{r=document.createElement('<iframe src="javascript:0" name="'+n.iframeId+'">')}catch(e){(r=document.createElement("iframe")).name=n.iframeId,r.src="javascript:0"}r.id=n.iframeId,n.form.appendChild(r),n.iframe=r}this.form.action=this.uri(),l(),e=e.replace(s,"\\\n"),this.area.value=e.replace(o,"\\n");try{this.form.submit()}catch(h){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&c()}:this.iframe.onload=c}},EhIR:function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function u(e,t){var n=new o(e),r=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return u}).call(t,n,t,a))||(a.exports=r):this.alea=u}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},FGiv:function(e,t){var n=1e3,r=6e4,a=36e5,i=24*a;function o(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,t){t=t||{};var s,u=typeof e;if("string"===u&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var o=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"days":case"day":case"d":return o*i;case"hours":case"hour":case"hrs":case"hr":case"h":return o*a;case"minutes":case"minute":case"mins":case"min":case"m":return o*r;case"seconds":case"second":case"secs":case"sec":case"s":return o*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(e);if("number"===u&&!1===isNaN(e))return t.long?o(s=e,i,"day")||o(s,a,"hour")||o(s,r,"minute")||o(s,n,"second")||s+" ms":function(e){return e>=i?Math.round(e/i)+"d":e>=a?Math.round(e/a)+"h":e>=r?Math.round(e/r)+"m":e>=n?Math.round(e/n)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},Gbct:function(e,t,n){var r=n("Wm4p"),a=n("1Mk5");function i(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.isReactNative=e.isReactNative,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}e.exports=i,a(i.prototype),i.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},i.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},i.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},i.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},i.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},i.prototype.onData=function(e){var t=r.decodePacket(e,this.socket.binaryType);this.onPacket(t)},i.prototype.onPacket=function(e){this.emit("packet",e)},i.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},HjK1:function(e,t,n){function r(){var e;try{e=t.storage.debug}catch(n){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e}(t=e.exports=n("lhf0")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),n){var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var a=0,i=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(a++,"%c"===e&&(i=a))})),e.splice(i,0,r)}},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(n){}},t.load=r,t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},t.enable(r())},KFGy:function(e,t,n){var r=n("Uwu7"),a=n("2xqC"),i=n("kSER"),o=n("2Dig"),s=n("QN7Q"),u=n("x7D4")("socket.io-client:socket"),c=n("TypT"),l=n("WLGk");e.exports=d;var h={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},p=a.prototype.emit;function d(e,t,n){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}a(d.prototype),d.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[o(e,"open",s(this,"onopen")),o(e,"packet",s(this,"onpacket")),o(e,"close",s(this,"onclose"))]}},d.prototype.open=d.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting")),this},d.prototype.send=function(){var e=i(arguments);return e.unshift("message"),this.emit.apply(this,e),this},d.prototype.emit=function(e){if(h.hasOwnProperty(e))return p.apply(this,arguments),this;var t=i(arguments),n={type:(void 0!==this.flags.binary?this.flags.binary:l(t))?r.BINARY_EVENT:r.EVENT,data:t,options:{}};return n.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(u("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),n.id=this.ids++),this.connected?this.packet(n):this.sendBuffer.push(n),this.flags={},this},d.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},d.prototype.onopen=function(){if(u("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"==typeof this.query?c.encode(this.query):this.query;u("sending connect packet with query %s",e),this.packet({type:r.CONNECT,query:e})}else this.packet({type:r.CONNECT})},d.prototype.onclose=function(e){u("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},d.prototype.onpacket=function(e){if(e.nsp===this.nsp||e.type===r.ERROR&&"/"===e.nsp)switch(e.type){case r.CONNECT:this.onconnect();break;case r.EVENT:case r.BINARY_EVENT:this.onevent(e);break;case r.ACK:case r.BINARY_ACK:this.onack(e);break;case r.DISCONNECT:this.ondisconnect();break;case r.ERROR:this.emit("error",e.data)}},d.prototype.onevent=function(e){var t=e.data||[];u("emitting event %j",t),null!=e.id&&(u("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?p.apply(this,t):this.receiveBuffer.push(t)},d.prototype.ack=function(e){var t=this,n=!1;return function(){if(!n){n=!0;var a=i(arguments);u("sending ack %j",a),t.packet({type:l(a)?r.BINARY_ACK:r.ACK,id:e,data:a})}}},d.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(u("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):u("bad ack %s",e.id)},d.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},d.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)p.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},d.prototype.ondisconnect=function(){u("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},d.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},d.prototype.close=d.prototype.disconnect=function(){return this.connected&&(u("performing disconnect (%s)",this.nsp),this.packet({type:r.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},d.prototype.compress=function(e){return this.flags.compress=e,this},d.prototype.binary=function(e){return this.flags.binary=e,this}},Njrz:function(e,t,n){var r=n("luTP"),a=n("qGlh"),i=Object.prototype.toString,o="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===i.call(Blob),s="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===i.call(File);t.deconstructPacket=function(e){var t=[],n=e;return n.data=function e(t,n){if(!t)return t;if(a(t)){var i={_placeholder:!0,num:n.length};return n.push(t),i}if(r(t)){for(var o=new Array(t.length),s=0;s<t.length;s++)o[s]=e(t[s],n);return o}if("object"==typeof t&&!(t instanceof Date)){for(var u in o={},t)o[u]=e(t[u],n);return o}return t}(e.data,t),n.attachments=t.length,{packet:n,buffers:t}},t.reconstructPacket=function(e,t){return e.data=function e(t,n){if(!t)return t;if(t&&t._placeholder)return n[t.num];if(r(t))for(var a=0;a<t.length;a++)t[a]=e(t[a],n);else if("object"==typeof t)for(var i in t)t[i]=e(t[i],n);return t}(e.data,t),e.attachments=void 0,e},t.removeBlobs=function(e,t){var n=0,i=e;!function e(u,c,l){if(!u)return u;if(o&&u instanceof Blob||s&&u instanceof File){n++;var h=new FileReader;h.onload=function(){l?l[c]=this.result:i=this.result,--n||t(i)},h.readAsArrayBuffer(u)}else if(r(u))for(var p=0;p<u.length;p++)e(u[p],p,u);else if("object"==typeof u&&!a(u))for(var d in u)e(u[d],d,u)}(i),n||t(i)}},PDX0:function(e,t){(function(t){e.exports=t}).call(this,{})},Q80o:function(e,t,n){function r(e){var n;function r(){if(r.enabled){var e=r,a=+new Date,i=a-(n||a);e.diff=i,e.prev=n,e.curr=a,n=a;for(var o=new Array(arguments.length),s=0;s<o.length;s++)o[s]=arguments[s];o[0]=t.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var u=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,(function(n,r){if("%%"===n)return n;u++;var a=t.formatters[r];return"function"==typeof a&&(n=a.call(e,o[u]),o.splice(u,1),u--),n})),t.formatArgs.call(e,o);var c=r.log||t.log||console.log.bind(console);c.apply(e,o)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),r.destroy=a,"function"==typeof t.init&&t.init(r),t.instances.push(r),r}function a(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),a=r.length;for(n=0;n<a;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var i=t.instances[n];i.enabled=t.enabled(i.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n("FGiv"),t.instances=[],t.names=[],t.skips=[],t.formatters={}},QN7Q:function(e,t){var n=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var r=n.call(arguments,2);return function(){return t.apply(e,r.concat(n.call(arguments)))}}},TypT:function(e,t){t.encode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},t.decode=function(e){for(var t={},n=e.split("&"),r=0,a=n.length;r<a;r++){var i=n[r].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}},Uwu7:function(e,t,n){var r=n("x7D4")("socket.io-parser"),a=n("2xqC"),i=n("Njrz"),o=n("luTP"),s=n("qGlh");function u(){}t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=u,t.Decoder=h;var c=t.ERROR+'"encode error"';function l(e){var n=""+e.type;if(t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(n+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(n+=e.nsp+","),null!=e.id&&(n+=e.id),null!=e.data){var a=function(e){try{return JSON.stringify(e)}catch(t){return!1}}(e.data);if(!1===a)return c;n+=a}return r("encoded %j as %s",e,n),n}function h(){this.reconstructor=null}function p(e){this.reconPack=e,this.buffers=[]}function d(e){return{type:t.ERROR,data:"parser error: "+e}}u.prototype.encode=function(e,n){r("encoding packet %j",e),t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type?function(e,t){i.removeBlobs(e,(function(e){var n=i.deconstructPacket(e),r=l(n.packet),a=n.buffers;a.unshift(r),t(a)}))}(e,n):n([l(e)])},a(h.prototype),h.prototype.add=function(e){var n;if("string"==typeof e)n=function(e){var n=0,a={type:Number(e.charAt(0))};if(null==t.types[a.type])return d("unknown packet type "+a.type);if(t.BINARY_EVENT===a.type||t.BINARY_ACK===a.type){for(var i="";"-"!==e.charAt(++n)&&(i+=e.charAt(n),n!=e.length););if(i!=Number(i)||"-"!==e.charAt(n))throw new Error("Illegal attachments");a.attachments=Number(i)}if("/"===e.charAt(n+1))for(a.nsp="";++n&&","!==(u=e.charAt(n))&&(a.nsp+=u,n!==e.length););else a.nsp="/";var s=e.charAt(n+1);if(""!==s&&Number(s)==s){for(a.id="";++n;){var u;if(null==(u=e.charAt(n))||Number(u)!=u){--n;break}if(a.id+=e.charAt(n),n===e.length)break}a.id=Number(a.id)}if(e.charAt(++n)){var c=function(e){try{return JSON.parse(e)}catch(t){return!1}}(e.substr(n));if(!1===c||a.type!==t.ERROR&&!o(c))return d("invalid payload");a.data=c}return r("decoded %s as %j",e,a),a}(e),t.BINARY_EVENT===n.type||t.BINARY_ACK===n.type?(this.reconstructor=new p(n),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",n)):this.emit("decoded",n);else{if(!s(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(n=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",n))}},h.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},p.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=i.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},p.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},Uxeu:function(e,t){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,a=e.indexOf("["),i=e.indexOf("]");-1!=a&&-1!=i&&(e=e.substring(0,a)+e.substring(a,i).replace(/:/g,";")+e.substring(i,e.length));for(var o=n.exec(e||""),s={},u=14;u--;)s[r[u]]=o[u]||"";return-1!=a&&-1!=i&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s}},WLGk:function(e,t,n){var r=n("6C75"),a=Object.prototype.toString,i="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===a.call(Blob),o="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===a.call(File);e.exports=function e(t){if(!t||"object"!=typeof t)return!1;if(r(t)){for(var n=0,a=t.length;n<a;n++)if(e(t[n]))return!0;return!1}if("function"==typeof Buffer&&Buffer.isBuffer&&Buffer.isBuffer(t)||"function"==typeof ArrayBuffer&&t instanceof ArrayBuffer||i&&t instanceof Blob||o&&t instanceof File)return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return e(t.toJSON(),!0);for(var s in t)if(Object.prototype.hasOwnProperty.call(t,s)&&e(t[s]))return!0;return!1}},Wm4p:function(e,t,n){var r,a=n("dkv/"),i=n("WLGk"),o=n("ypnn"),s=n("zMFY"),u=n("oIG/");"undefined"!=typeof ArrayBuffer&&(r=n("g5Dd"));var c="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),l="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),h=c||l;t.protocol=3;var p=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},d=a(p),f={type:"error",data:"parser error"},m=n("14A5");function v(e,t,n){for(var r=new Array(e.length),a=s(e.length,n),i=function(e,n,a){t(n,(function(t,n){r[e]=n,a(t,r)}))},o=0;o<e.length;o++)i(o,e[o],a)}t.encodePacket=function(e,n,r,a){"function"==typeof n&&(a=n,n=!1),"function"==typeof r&&(a=r,r=null);var i=void 0===e.data?void 0:e.data.buffer||e.data;if("undefined"!=typeof ArrayBuffer&&i instanceof ArrayBuffer)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var a=e.data,i=new Uint8Array(a),o=new Uint8Array(1+a.byteLength);o[0]=p[e.type];for(var s=0;s<i.length;s++)o[s+1]=i[s];return r(o.buffer)}(e,n,a);if(void 0!==m&&i instanceof m)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);if(h)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var a=new FileReader;return a.onload=function(){t.encodePacket({type:e.type,data:a.result},n,!0,r)},a.readAsArrayBuffer(e.data)}(e,n,r);var a=new Uint8Array(1);return a[0]=p[e.type],r(new m([a.buffer,e.data]))}(e,n,a);if(i&&i.base64)return function(e,n){return n("b"+t.packets[e.type]+e.data.data)}(e,a);var o=p[e.type];return void 0!==e.data&&(o+=r?u.encode(String(e.data),{strict:!1}):String(e.data)),a(""+o)},t.encodeBase64Packet=function(e,n){var r,a="b"+t.packets[e.type];if(void 0!==m&&e.data instanceof m){var i=new FileReader;return i.onload=function(){var e=i.result.split(",")[1];n(a+e)},i.readAsDataURL(e.data)}try{r=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(c){for(var o=new Uint8Array(e.data),s=new Array(o.length),u=0;u<o.length;u++)s[u]=o[u];r=String.fromCharCode.apply(null,s)}return a+=btoa(r),n(a)},t.decodePacket=function(e,n,r){if(void 0===e)return f;if("string"==typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),n);if(r&&!1===(e=function(e){try{e=u.decode(e,{strict:!1})}catch(t){return!1}return e}(e)))return f;var a=e.charAt(0);return Number(a)==a&&d[a]?e.length>1?{type:d[a],data:e.substring(1)}:{type:d[a]}:f}a=new Uint8Array(e)[0];var i=o(e,1);return m&&"blob"===n&&(i=new m([i])),{type:d[a],data:i}},t.decodeBase64Packet=function(e,t){var n=d[e.charAt(0)];if(!r)return{type:n,data:{base64:!0,data:e.substr(1)}};var a=r.decode(e.substr(1));return"blob"===t&&m&&(a=new m([a])),{type:n,data:a}},t.encodePayload=function(e,n,r){"function"==typeof n&&(r=n,n=null);var a=i(e);return n&&a?m&&!h?t.encodePayloadAsBlob(e,r):t.encodePayloadAsArrayBuffer(e,r):e.length?void v(e,(function(e,r){t.encodePacket(e,!!a&&n,!1,(function(e){r(null,function(e){return e.length+":"+e}(e))}))}),(function(e,t){return r(t.join(""))})):r("0:")},t.decodePayload=function(e,n,r){if("string"!=typeof e)return t.decodePayloadAsBinary(e,n,r);var a;if("function"==typeof n&&(r=n,n=null),""===e)return r(f,0,1);for(var i,o,s="",u=0,c=e.length;u<c;u++){var l=e.charAt(u);if(":"===l){if(""===s||s!=(i=Number(s)))return r(f,0,1);if(s!=(o=e.substr(u+1,i)).length)return r(f,0,1);if(o.length){if(a=t.decodePacket(o,n,!1),f.type===a.type&&f.data===a.data)return r(f,0,1);if(!1===r(a,u+i,c))return}u+=i,s=""}else s+=l}return""!==s?r(f,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,n){if(!e.length)return n(new ArrayBuffer(0));v(e,(function(e,n){t.encodePacket(e,!0,!0,(function(e){return n(null,e)}))}),(function(e,t){var r=t.reduce((function(e,t){var n;return e+(n="string"==typeof t?t.length:t.byteLength).toString().length+n+2}),0),a=new Uint8Array(r),i=0;return t.forEach((function(e){var t="string"==typeof e,n=e;if(t){for(var r=new Uint8Array(e.length),o=0;o<e.length;o++)r[o]=e.charCodeAt(o);n=r.buffer}a[i++]=t?0:1;var s=n.byteLength.toString();for(o=0;o<s.length;o++)a[i++]=parseInt(s[o]);for(a[i++]=255,r=new Uint8Array(n),o=0;o<r.length;o++)a[i++]=r[o]})),n(a.buffer)}))},t.encodePayloadAsBlob=function(e,n){v(e,(function(e,n){t.encodePacket(e,!0,!0,(function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var r=new Uint8Array(e.length),a=0;a<e.length;a++)r[a]=e.charCodeAt(a);e=r.buffer,t[0]=0}var i=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),o=new Uint8Array(i.length+1);for(a=0;a<i.length;a++)o[a]=parseInt(i[a]);if(o[i.length]=255,m){var s=new m([t.buffer,o.buffer,e]);n(null,s)}}))}),(function(e,t){return n(new m(t))}))},t.decodePayloadAsBinary=function(e,n,r){"function"==typeof n&&(r=n,n=null);for(var a=e,i=[];a.byteLength>0;){for(var s=new Uint8Array(a),u=0===s[0],c="",l=1;255!==s[l];l++){if(c.length>310)return r(f,0,1);c+=s[l]}a=o(a,2+c.length),c=parseInt(c);var h=o(a,0,c);if(u)try{h=String.fromCharCode.apply(null,new Uint8Array(h))}catch(m){var p=new Uint8Array(h);for(h="",l=0;l<p.length;l++)h+=String.fromCharCode(p[l])}i.push(h),a=o(a,c)}var d=i.length;i.forEach((function(e,a){r(t.decodePacket(e,n,!0),a,d)}))}},YSVl:function(e,t,n){var r=n("EhIR"),a=n("uDiL"),i=n("pJ6O"),o=n("yuCN"),s=n("euyF"),u=n("ie1u"),c=n("pJ3+");c.alea=r,c.xor128=a,c.xorwow=i,c.xorshift7=o,c.xor4096=s,c.tychei=u,e.exports=c},YuTi:function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},Yvos:function(e,t){e.exports=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},akSB:function(e,t,n){var r=n("AdPF"),a=n("0z79"),i=n("Cl5A"),o=n("CIKq");t.polling=function(e){var t=!1,n=!1,o=!1!==e.jsonp;if("undefined"!=typeof location){var s="https:"===location.protocol,u=location.port;u||(u=s?443:80),t=e.hostname!==location.hostname||u!==e.port,n=e.secure!==s}if(e.xdomain=t,e.xscheme=n,"open"in new r(e)&&!e.forceJSONP)return new a(e);if(!o)throw new Error("JSONP disabled");return new i(e)},t.websocket=o},"dkv/":function(e,t){e.exports=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var r in e)n.call(e,r)&&t.push(r);return t}},eOtv:function(e,t,n){var r=n("lKxJ"),a=n("KFGy"),i=n("2xqC"),o=n("Uwu7"),s=n("2Dig"),u=n("QN7Q"),c=n("x7D4")("socket.io-client:manager"),l=n("7jRU"),h=n("C2QD"),p=Object.prototype.hasOwnProperty;function d(e,t){if(!(this instanceof d))return new d(e,t);e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new h({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=t.parser||o;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}e.exports=d,d.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)p.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},d.prototype.updateSocketIds=function(){for(var e in this.nsps)p.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},d.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},i(d.prototype),d.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},d.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},d.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},d.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},d.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},d.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},d.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},d.prototype.open=d.prototype.connect=function(e,t){if(c("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;c("opening %s",this.uri),this.engine=r(this.uri,this.opts);var n=this.engine,a=this;this.readyState="opening",this.skipReconnect=!1;var i=s(n,"open",(function(){a.onopen(),e&&e()})),o=s(n,"error",(function(t){if(c("connect_error"),a.cleanup(),a.readyState="closed",a.emitAll("connect_error",t),e){var n=new Error("Connection error");n.data=t,e(n)}else a.maybeReconnectOnOpen()}));if(!1!==this._timeout){var u=this._timeout;c("connect attempt will timeout after %d",u);var l=setTimeout((function(){c("connect attempt timed out after %d",u),i.destroy(),n.close(),n.emit("error","timeout"),a.emitAll("connect_timeout",u)}),u);this.subs.push({destroy:function(){clearTimeout(l)}})}return this.subs.push(i),this.subs.push(o),this},d.prototype.onopen=function(){c("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(s(e,"data",u(this,"ondata"))),this.subs.push(s(e,"ping",u(this,"onping"))),this.subs.push(s(e,"pong",u(this,"onpong"))),this.subs.push(s(e,"error",u(this,"onerror"))),this.subs.push(s(e,"close",u(this,"onclose"))),this.subs.push(s(this.decoder,"decoded",u(this,"ondecoded")))},d.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},d.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},d.prototype.ondata=function(e){this.decoder.add(e)},d.prototype.ondecoded=function(e){this.emit("packet",e)},d.prototype.onerror=function(e){c("error",e),this.emitAll("error",e)},d.prototype.socket=function(e,t){var n=this.nsps[e];if(!n){n=new a(this,e,t),this.nsps[e]=n;var r=this;n.on("connecting",i),n.on("connect",(function(){n.id=r.generateId(e)})),this.autoConnect&&i()}function i(){~l(r.connecting,n)||r.connecting.push(n)}return n},d.prototype.destroy=function(e){var t=l(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},d.prototype.packet=function(e){c("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,(function(n){for(var r=0;r<n.length;r++)t.engine.write(n[r],e.options);t.encoding=!1,t.processPacketQueue()})))},d.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},d.prototype.cleanup=function(){c("cleanup");for(var e=this.subs.length,t=0;t<e;t++)this.subs.shift().destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},d.prototype.close=d.prototype.disconnect=function(){c("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},d.prototype.onclose=function(e){c("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},d.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)c("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();c("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout((function(){e.skipReconnect||(c("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open((function(t){t?(c("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(c("reconnect success"),e.onreconnect())})))}),t);this.subs.push({destroy:function(){clearTimeout(n)}})}},d.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},euyF:function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n=a[i]=(n^=n>>>15)^(e^=e>>>12),t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,i=-32;i<u;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(a=0==(n=s[127&i]^=r+(o=o+1640531527|0))?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,s[a]=(r^=r>>>15)^(n^=n>>>12);e.w=o,e.X=s,e.i=a}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.X&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return u}).call(t,n,t,a))||(a.exports=r):this.xor4096=u}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},g5Dd:function(e,t){!function(){"use strict";for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),r=0;r<e.length;r++)n[e.charCodeAt(r)]=r;t.encode=function(t){var n,r=new Uint8Array(t),a=r.length,i="";for(n=0;n<a;n+=3)i+=e[r[n]>>2],i+=e[(3&r[n])<<4|r[n+1]>>4],i+=e[(15&r[n+1])<<2|r[n+2]>>6],i+=e[63&r[n+2]];return a%3==2?i=i.substring(0,i.length-1)+"=":a%3==1&&(i=i.substring(0,i.length-2)+"=="),i},t.decode=function(e){var t,r,a,i,o,s=.75*e.length,u=e.length,c=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var l=new ArrayBuffer(s),h=new Uint8Array(l);for(t=0;t<u;t+=4)r=n[e.charCodeAt(t)],a=n[e.charCodeAt(t+1)],i=n[e.charCodeAt(t+2)],o=n[e.charCodeAt(t+3)],h[c++]=r<<2|a>>4,h[c++]=(15&a)<<4|i>>2,h[c++]=(3&i)<<6|63&o;return l}}()},gFX4:function(e,t,n){var r=n("zJ60"),a=n("Uwu7"),i=n("eOtv"),o=n("x7D4")("socket.io-client");e.exports=t=u;var s=t.managers={};function u(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,a=r(e),u=a.source,c=a.id;return t.forceNew||t["force new connection"]||!1===t.multiplex||s[c]&&a.path in s[c].nsps?(o("ignoring socket cache for %s",u),n=i(u,t)):(s[c]||(o("new io instance for %s",u),s[c]=i(u,t)),n=s[c]),a.query&&!t.query&&(t.query=a.query),n.socket(a.path,t)}t.protocol=a.protocol,t.connect=u,t.Manager=n("eOtv"),t.Socket=n("KFGy")},ie1u:function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return u}).call(t,n,t,a))||(a.exports=r):this.tychei=u}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},kSER:function(e,t){e.exports=function(e,t){for(var n=[],r=(t=t||0)||0;r<e.length;r++)n[r-t]=e[r];return n}},lKxJ:function(e,t,n){e.exports=n("2pII"),e.exports.parser=n("Wm4p")},lhf0:function(e,t,n){function r(e){var n;function r(){if(r.enabled){var e=r,a=+new Date,i=a-(n||a);e.diff=i,e.prev=n,e.curr=a,n=a;for(var o=new Array(arguments.length),s=0;s<o.length;s++)o[s]=arguments[s];o[0]=t.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var u=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,(function(n,r){if("%%"===n)return n;u++;var a=t.formatters[r];return"function"==typeof a&&(n=a.call(e,o[u]),o.splice(u,1),u--),n})),t.formatArgs.call(e,o);var c=r.log||t.log||console.log.bind(console);c.apply(e,o)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),r.destroy=a,"function"==typeof t.init&&t.init(r),t.instances.push(r),r}function a(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),a=r.length;for(n=0;n<a;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var i=t.instances[n];i.enabled=t.enabled(i.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n("FGiv"),t.instances=[],t.names=[],t.skips=[],t.formatters={}},luTP:function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},"oIG/":function(e,t){var n,r,a,i=String.fromCharCode;function o(e){for(var t,n,r=[],a=0,i=e.length;a<i;)(t=e.charCodeAt(a++))>=55296&&t<=56319&&a<i?56320==(64512&(n=e.charCodeAt(a++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),a--):r.push(t);return r}function s(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function u(e,t){return i(e>>t&63|128)}function c(e,t){if(0==(4294967168&e))return i(e);var n="";return 0==(4294965248&e)?n=i(e>>6&31|192):0==(4294901760&e)?(s(e,t)||(e=65533),n=i(e>>12&15|224),n+=u(e,6)):0==(4292870144&e)&&(n=i(e>>18&7|240),n+=u(e,12),n+=u(e,6)),n+i(63&e|128)}function l(){if(a>=r)throw Error("Invalid byte index");var e=255&n[a];if(a++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function h(e){var t,i;if(a>r)throw Error("Invalid byte index");if(a==r)return!1;if(t=255&n[a],a++,0==(128&t))return t;if(192==(224&t)){if((i=(31&t)<<6|l())>=128)return i;throw Error("Invalid continuation byte")}if(224==(240&t)){if((i=(15&t)<<12|l()<<6|l())>=2048)return s(i,e)?i:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(i=(7&t)<<18|l()<<12|l()<<6|l())>=65536&&i<=1114111)return i;throw Error("Invalid UTF-8 detected")}e.exports={version:"2.1.2",encode:function(e,t){for(var n=!1!==(t=t||{}).strict,r=o(e),a=r.length,i=-1,s="";++i<a;)s+=c(r[i],n);return s},decode:function(e,t){var s=!1!==(t=t||{}).strict;n=o(e),r=n.length,a=0;for(var u,c=[];!1!==(u=h(s));)c.push(u);return function(e){for(var t,n=e.length,r=-1,a="";++r<n;)(t=e[r])>65535&&(a+=i((t-=65536)>>>10&1023|55296),t=56320|1023&t),a+=i(t);return a}(c)}}},"pJ3+":function(e,t,n){var r;!function(a,i){var o,s=this,u=i.pow(256,6),c=i.pow(2,52),l=2*c;function h(e,t,n){var r=[],h=f(function e(t,n){var r,a=[],i=typeof t;if(n&&"object"==i)for(r in t)try{a.push(e(t[r],n-1))}catch(o){}return a.length?a:"string"==i?t:t+"\0"}((t=1==t?{entropy:!0}:t||{}).entropy?[e,m(a)]:null==e?function(){try{var e;return o&&(e=o.randomBytes)?e=e(256):(e=new Uint8Array(256),(s.crypto||s.msCrypto).getRandomValues(e)),m(e)}catch(r){var t=s.navigator,n=t&&t.plugins;return[+new Date,s,n,s.screen,m(a)]}}():e,3),r),v=new p(r),g=function(){for(var e=v.g(6),t=u,n=0;e<c;)e=256*(e+n),t*=256,n=v.g(1);for(;e>=l;)e/=2,t/=2,n>>>=1;return(e+n)/t};return g.int32=function(){return 0|v.g(4)},g.quick=function(){return v.g(4)/4294967296},g.double=g,f(m(v.S),a),(t.pass||n||function(e,t,n,r){return r&&(r.S&&d(r,v),e.state=function(){return d(v,{})}),n?(i.random=e,t):e})(g,h,"global"in t?t.global:this==i,t.state)}function p(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);a<256;)o[a]=a++;for(a=0;a<256;a++)o[a]=o[i=255&i+e[a%n]+(t=o[a])],o[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,o=r.S;e--;)t=o[a=255&a+1],n=256*n+o[255&(o[a]=o[i=255&i+t])+(o[i]=t)];return r.i=a,r.j=i,n})(256)}function d(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function f(e,t){for(var n,r=e+"",a=0;a<r.length;)t[255&a]=255&(n^=19*t[255&a])+r.charCodeAt(a++);return m(t)}function m(e){return String.fromCharCode.apply(0,e)}if(i.seedrandom=h,f(i.random(),a),e.exports){e.exports=h;try{o=n(4)}catch(v){}}else void 0===(r=(function(){return h}).call(t,n,t,e))||(e.exports=r)}([],Math)},pJ6O:function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return u}).call(t,n,t,a))||(a.exports=r):this.xorwow=u}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},qGlh:function(e,t){e.exports=function(e){return n&&Buffer.isBuffer(e)||r&&(e instanceof ArrayBuffer||function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer}(e))};var n="function"==typeof Buffer&&"function"==typeof Buffer.isBuffer,r="function"==typeof ArrayBuffer},uDiL:function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return u}).call(t,n,t,a))||(a.exports=r):this.xor128=u}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},x7D4:function(e,t,n){function r(){var e;try{e=t.storage.debug}catch(n){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e}(t=e.exports=n("Q80o")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),n){var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var a=0,i=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(a++,"%c"===e&&(i=a))})),e.splice(i,0,r)}},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(n){}},t.load=r,t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},t.enable(r())},yeub:function(e,t){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(n){e.exports=!1}},ypnn:function(e,t){e.exports=function(e,t,n){var r=e.byteLength;if(t=t||0,n=n||r,e.slice)return e.slice(t,n);if(t<0&&(t+=r),n<0&&(n+=r),n>r&&(n=r),t>=r||t>=n||0===r)return new ArrayBuffer(0);for(var a=new Uint8Array(e),i=new Uint8Array(n-t),o=t,s=0;o<n;o++,s++)i[s]=a[o];return i.buffer}},yuCN:function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],r[a]=n^=(e^=e<<13)^e<<9,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n&&(r[7]=-1),e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.x&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return u}).call(t,n,t,a))||(a.exports=r):this.xorshift7=u}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},zJ60:function(e,t,n){var r=n("Uxeu"),a=n("x7D4")("socket.io-client:url");e.exports=function(e,t){var n=e;t=t||"undefined"!=typeof location&&location,null==e&&(e=t.protocol+"//"+t.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(a("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),a("parse %s",e),n=r(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";var i=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+i+":"+n.port,n.href=n.protocol+"://"+i+(t&&t.port===n.port?"":":"+n.port),n}},zMFY:function(e,t){function n(){}e.exports=function(e,t,r){var a=!1;return r=r||n,i.count=e,0===e?t():i;function i(e,n){if(i.count<=0)throw new Error("after called too many times");--i.count,e?(a=!0,t(e),t=r):0!==i.count||a||t(null,n)}}},zUnb:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"createScalarValue",(function(){return mg})),n.d(r,"toTypedArray",(function(){return vg})),n.d(r,"now",(function(){return gg})),n.d(r,"fetch",(function(){return yg})),n.d(r,"encodeString",(function(){return bg})),n.d(r,"decodeString",(function(){return kg})),n.d(r,"shuffle",(function(){return od})),n.d(r,"clamp",(function(){return sd})),n.d(r,"nearestLargerEven",(function(){return ud})),n.d(r,"sum",(function(){return cd})),n.d(r,"randUniform",(function(){return ld})),n.d(r,"distSquared",(function(){return hd})),n.d(r,"assert",(function(){return pd})),n.d(r,"assertShapesMatch",(function(){return dd})),n.d(r,"assertNonNull",(function(){return fd})),n.d(r,"flatten",(function(){return md})),n.d(r,"sizeFromShape",(function(){return vd})),n.d(r,"isScalarShape",(function(){return gd})),n.d(r,"arraysEqual",(function(){return yd})),n.d(r,"isInt",(function(){return bd})),n.d(r,"tanh",(function(){return kd})),n.d(r,"sizeToSquarishShape",(function(){return xd})),n.d(r,"createShuffledIndices",(function(){return wd})),n.d(r,"rightPad",(function(){return Cd})),n.d(r,"repeatedTry",(function(){return _d})),n.d(r,"inferFromImplicitShape",(function(){return Sd})),n.d(r,"parseAxisParam",(function(){return Id})),n.d(r,"squeezeShape",(function(){return Td})),n.d(r,"getTypedArrayFromDType",(function(){return Nd})),n.d(r,"getArrayFromDType",(function(){return Ad})),n.d(r,"checkConversionForErrors",(function(){return Ed})),n.d(r,"isValidDtype",(function(){return Rd})),n.d(r,"hasEncodingLoss",(function(){return Fd})),n.d(r,"isTypedArray",(function(){return Dd})),n.d(r,"bytesPerElement",(function(){return Od})),n.d(r,"bytesFromStringArray",(function(){return Md})),n.d(r,"isString",(function(){return Pd})),n.d(r,"isBoolean",(function(){return Ld})),n.d(r,"isNumber",(function(){return zd})),n.d(r,"inferDtype",(function(){return Bd})),n.d(r,"isFunction",(function(){return Vd})),n.d(r,"nearestDivisor",(function(){return Ud})),n.d(r,"computeStrides",(function(){return Wd})),n.d(r,"toNestedArray",(function(){return Gd})),n.d(r,"makeOnesTypedArray",(function(){return Hd})),n.d(r,"makeZerosTypedArray",(function(){return jd})),n.d(r,"makeZerosNestedTypedArray",(function(){return qd})),n.d(r,"assertNonNegativeIntegerDimensions",(function(){return Kd})),n.d(r,"locToIndex",(function(){return Xd})),n.d(r,"indexToLoc",(function(){return Yd})),n.d(r,"isPromise",(function(){return Zd}));var a={};n.r(a),n.d(a,"makeTypesMatch",(function(){return Og})),n.d(a,"assertTypesMatch",(function(){return Mg})),n.d(a,"isTensorInList",(function(){return Pg})),n.d(a,"getTensorsInContainer",(function(){return Lg}));var i={};n.r(i),n.d(i,"isMobile",(function(){return Gg})),n.d(i,"isBrowser",(function(){return Hg}));var o={};n.r(o),n.d(o,"copyModel",(function(){return Uy})),n.d(o,"listModels",(function(){return Ly})),n.d(o,"moveModel",(function(){return Gy})),n.d(o,"removeModel",(function(){return By})),n.d(o,"browserFiles",(function(){return eb})),n.d(o,"browserHTTPRequest",(function(){return hb})),n.d(o,"concatenateArrayBuffers",(function(){return uy})),n.d(o,"decodeWeights",(function(){return ay})),n.d(o,"encodeWeights",(function(){return ny})),n.d(o,"fromMemory",(function(){return fb})),n.d(o,"getLoadHandlers",(function(){return vy})),n.d(o,"getModelArtifactsInfoForJSON",(function(){return ly})),n.d(o,"getSaveHandlers",(function(){return my})),n.d(o,"http",(function(){return lb})),n.d(o,"isHTTPScheme",(function(){return ub})),n.d(o,"loadWeights",(function(){return ab})),n.d(o,"registerLoadRouter",(function(){return fy})),n.d(o,"registerSaveRouter",(function(){return dy})),n.d(o,"weightsLoaderFactory",(function(){return ob})),n.d(o,"withSaveHandler",(function(){return mb}));var s={};n.r(s),n.d(s,"confusionMatrix",(function(){return kb}));var u={};n.r(u),n.d(u,"toPixels",(function(){return wb})),n.d(u,"fromPixels",(function(){return _b}));var c={};n.r(c),n.d(c,"prepareAndValidate",(function(){return Sb}));var l={};n.r(l),n.d(l,"validateUpdateShape",(function(){return Ib})),n.d(l,"validateInput",(function(){return Tb})),n.d(l,"calculateShapes",(function(){return Nb}));var h={};n.r(h),n.d(h,"assertParamsValid",(function(){return Ab})),n.d(h,"maskToAxes",(function(){return Eb})),n.d(h,"computeOutShape",(function(){return Rb})),n.d(h,"stridesWithElidedDims",(function(){return Fb})),n.d(h,"getNormalizedAxes",(function(){return Mb})),n.d(h,"startIndicesWithElidedDims",(function(){return Pb})),n.d(h,"stopIndicesWithElidedDims",(function(){return Lb})),n.d(h,"stridesForAxis",(function(){return zb})),n.d(h,"startForAxis",(function(){return Bb})),n.d(h,"stopForAxis",(function(){return Vb})),n.d(h,"isSliceContinous",(function(){return Ub})),n.d(h,"computeFlatOffset",(function(){return Wb})),n.d(h,"parseSliceParams",(function(){return Gb})),n.d(h,"sliceInfo",(function(){return Hb}));var p={};n.r(p),n.d(p,"Serializable",(function(){return jb})),n.d(p,"SerializationMap",(function(){return qb})),n.d(p,"registerClass",(function(){return Kb}));var d={};n.r(d),n.d(d,"TEST_EPSILON_FLOAT16",(function(){return Xb})),n.d(d,"expectArraysClose",(function(){return Yb})),n.d(d,"testEpsilon",(function(){return Zb})),n.d(d,"expectPromiseToFail",(function(){return Jb})),n.d(d,"expectArraysEqual",(function(){return $b})),n.d(d,"expectNumbersClose",(function(){return ek})),n.d(d,"expectValuesInRange",(function(){return nk})),n.d(d,"expectArrayBuffersEqual",(function(){return rk})),n.d(d,"encodeStrings",(function(){return ak}));var f={};n.r(f),n.d(f,"conv2d",(function(){return aS})),n.d(f,"depthwiseConv2d",(function(){return sS})),n.d(f,"matMul",(function(){return uS}));var m={};n.r(m),n.d(m,"segOpComputeOptimalWindowSize",(function(){return FI})),n.d(m,"computeOutShape",(function(){return DI})),n.d(m,"collectGatherOpShapeInfo",(function(){return OI}));var v={};n.r(v),n.d(v,"slice_util",(function(){return h})),n.d(v,"upcastType",(function(){return Fg})),n.d(v,"segment_util",(function(){return m})),n.d(v,"castTensor",(function(){return MI})),n.d(v,"reshapeTensor",(function(){return PI})),n.d(v,"fromUint8ToStringArray",(function(){return LI})),n.d(v,"fromStringArrayToUint8",(function(){return zI})),n.d(v,"axesAreInnerMostDims",(function(){return Gw})),n.d(v,"combineLocations",(function(){return Hw})),n.d(v,"computeOutAndReduceShapes",(function(){return jw})),n.d(v,"expandShapeToKeepDim",(function(){return qw})),n.d(v,"assertAxesAreInnerMostDims",(function(){return Kw})),n.d(v,"getAxesPermutation",(function(){return Xw})),n.d(v,"getUndoAxesPermutation",(function(){return Yw})),n.d(v,"getInnerMostAxes",(function(){return Zw})),n.d(v,"getBroadcastDims",(function(){return Zk})),n.d(v,"getReductionAxes",(function(){return Qk})),n.d(v,"assertAndGetBroadcastShape",(function(){return Jk})),n.d(v,"assertParamsConsistent",(function(){return rI})),n.d(v,"computeOutShape",(function(){return aI})),n.d(v,"computeDilation2DInfo",(function(){return vx})),n.d(v,"computePool2DInfo",(function(){return gx})),n.d(v,"computePool3DInfo",(function(){return yx})),n.d(v,"computeConv2DInfo",(function(){return bx})),n.d(v,"computeConv3DInfo",(function(){return kx})),n.d(v,"computeDefaultPad",(function(){return xx})),n.d(v,"tupleValuesAreOne",(function(){return Ix})),n.d(v,"eitherStridesOrDilationsAreOne",(function(){return Tx})),n.d(v,"convertConv2DDataFormat",(function(){return Nx})),n.d(v,"getFusedDyActivation",(function(){return eS})),n.d(v,"getFusedBiasGradient",(function(){return tS})),n.d(v,"applyActivation",(function(){return nS})),n.d(v,"shouldFuse",(function(){return rS})),n.d(v,"PARALLELIZE_THRESHOLD",(function(){return iI})),n.d(v,"computeOptimalWindowSize",(function(){return oI})),n.d(v,"getImageCenter",(function(){return sI})),n.d(v,"getReshaped",(function(){return uI})),n.d(v,"getPermuted",(function(){return cI})),n.d(v,"getReshapedPermuted",(function(){return lI})),n.d(v,"getSliceBeginCoords",(function(){return hI})),n.d(v,"getSliceSize",(function(){return pI})),n.d(v,"prepareAndValidate",(function(){return Sb})),n.d(v,"validateUpdateShape",(function(){return Ib})),n.d(v,"validateInput",(function(){return Tb})),n.d(v,"calculateShapes",(function(){return Nb})),n.d(v,"SELU_SCALEALPHA",(function(){return dI})),n.d(v,"SELU_SCALE",(function(){return fI})),n.d(v,"ERF_P",(function(){return mI})),n.d(v,"ERF_A1",(function(){return vI})),n.d(v,"ERF_A2",(function(){return gI})),n.d(v,"ERF_A3",(function(){return yI})),n.d(v,"ERF_A4",(function(){return bI})),n.d(v,"ERF_A5",(function(){return kI})),n.d(v,"warn",(function(){return xI})),n.d(v,"log",(function(){return wI})),n.d(v,"mergeRealAndImagArrays",(function(){return CI})),n.d(v,"splitRealAndImagArrays",(function(){return _I})),n.d(v,"complexWithEvenIndex",(function(){return SI})),n.d(v,"complexWithOddIndex",(function(){return II})),n.d(v,"getComplexWithIndex",(function(){return TI})),n.d(v,"assignToTypedArray",(function(){return NI})),n.d(v,"exponents",(function(){return AI})),n.d(v,"exponent",(function(){return EI})),n.d(v,"prepareSplitSize",(function(){return RI}));var g={};n.r(g),n.d(g,"nonMaxSuppressionV3Impl",(function(){return kS})),n.d(g,"nonMaxSuppressionV4Impl",(function(){return xS})),n.d(g,"nonMaxSuppressionV5Impl",(function(){return wS})),n.d(g,"whereImpl",(function(){return I_}));var y={};n.r(y),n.d(y,"AdadeltaOptimizer",(function(){return Gk})),n.d(y,"AdagradOptimizer",(function(){return jk})),n.d(y,"AdamOptimizer",(function(){return Xk})),n.d(y,"AdamaxOptimizer",(function(){return ex})),n.d(y,"MomentumOptimizer",(function(){return nx})),n.d(y,"Optimizer",(function(){return Wk})),n.d(y,"RMSPropOptimizer",(function(){return rx})),n.d(y,"SGDOptimizer",(function(){return tx})),n.d(y,"Tensor",(function(){return _g})),n.d(y,"TensorBuffer",(function(){return xg})),n.d(y,"Variable",(function(){return Eg})),n.d(y,"Rank",(function(){return Sg})),n.d(y,"sumOutType",(function(){return Dg})),n.d(y,"upcastType",(function(){return Fg})),n.d(y,"Reduction",(function(){return OS})),n.d(y,"customGrad",(function(){return Bk})),n.d(y,"grad",(function(){return Ok})),n.d(y,"grads",(function(){return Mk})),n.d(y,"valueAndGrad",(function(){return Pk})),n.d(y,"valueAndGrads",(function(){return Lk})),n.d(y,"variableGrads",(function(){return zk})),n.d(y,"Environment",(function(){return Qd})),n.d(y,"env",(function(){return Jd})),n.d(y,"ENV",(function(){return ef})),n.d(y,"version_core",(function(){return ik})),n.d(y,"nextFrame",(function(){return nI})),n.d(y,"browser",(function(){return u})),n.d(y,"io",(function(){return o})),n.d(y,"math",(function(){return s})),n.d(y,"serialization",(function(){return p})),n.d(y,"test_util",(function(){return d})),n.d(y,"util",(function(){return r})),n.d(y,"backend_util",(function(){return v})),n.d(y,"tensor_util",(function(){return a})),n.d(y,"slice_util",(function(){return h})),n.d(y,"gather_util",(function(){return c})),n.d(y,"scatter_util",(function(){return l})),n.d(y,"device_util",(function(){return i})),n.d(y,"kernel_impls",(function(){return g})),n.d(y,"KernelBackend",(function(){return ad})),n.d(y,"DataStorage",(function(){return rd})),n.d(y,"abs",(function(){return Yk})),n.d(y,"acos",(function(){return ax})),n.d(y,"acosh",(function(){return ix})),n.d(y,"add",(function(){return Tk})),n.d(y,"addN",(function(){return ox})),n.d(y,"all",(function(){return sx})),n.d(y,"any",(function(){return ux})),n.d(y,"argMax",(function(){return cx})),n.d(y,"argMin",(function(){return lx})),n.d(y,"asin",(function(){return hx})),n.d(y,"asinh",(function(){return px})),n.d(y,"atan",(function(){return dx})),n.d(y,"atan2",(function(){return fx})),n.d(y,"atanh",(function(){return mx})),n.d(y,"avgPool",(function(){return Ex})),n.d(y,"avgPool3d",(function(){return Rx})),n.d(y,"basicLSTMCell",(function(){return Px})),n.d(y,"batchToSpaceND",(function(){return Lx})),n.d(y,"batchNorm",(function(){return zx})),n.d(y,"batchNorm2d",(function(){return Bx})),n.d(y,"batchNorm3d",(function(){return Vx})),n.d(y,"batchNorm4d",(function(){return Ux})),n.d(y,"bincount",(function(){return Wx})),n.d(y,"broadcastTo",(function(){return Gx})),n.d(y,"buffer",(function(){return Ky})),n.d(y,"cast",(function(){return Xy})),n.d(y,"ceil",(function(){return Hx})),n.d(y,"clipByValue",(function(){return jx})),n.d(y,"clone",(function(){return Yy})),n.d(y,"complex",(function(){return Jg})),n.d(y,"concat",(function(){return Fx})),n.d(y,"concat1d",(function(){return qx})),n.d(y,"concat2d",(function(){return Kx})),n.d(y,"concat3d",(function(){return Xx})),n.d(y,"concat4d",(function(){return Yx})),n.d(y,"conv1d",(function(){return Qx})),n.d(y,"conv2d",(function(){return Zx})),n.d(y,"conv2dTranspose",(function(){return $x})),n.d(y,"conv3d",(function(){return ew})),n.d(y,"conv3dTranspose",(function(){return nw})),n.d(y,"cos",(function(){return rw})),n.d(y,"cosh",(function(){return aw})),n.d(y,"cumsum",(function(){return iw})),n.d(y,"denseBincount",(function(){return ow})),n.d(y,"depthToSpace",(function(){return sw})),n.d(y,"depthwiseConv2d",(function(){return uw})),n.d(y,"diag",(function(){return cw})),n.d(y,"dilation2d",(function(){return lw})),n.d(y,"div",(function(){return Ak})),n.d(y,"divNoNan",(function(){return dw})),n.d(y,"dot",(function(){return fw})),n.d(y,"elu",(function(){return mw})),n.d(y,"equal",(function(){return hw})),n.d(y,"erf",(function(){return vw})),n.d(y,"exp",(function(){return gw})),n.d(y,"expandDims",(function(){return yw})),n.d(y,"expm1",(function(){return bw})),n.d(y,"eye",(function(){return xw})),n.d(y,"fill",(function(){return Hk})),n.d(y,"floor",(function(){return ww})),n.d(y,"floorDiv",(function(){return Nk})),n.d(y,"gather",(function(){return Cw})),n.d(y,"greater",(function(){return _w})),n.d(y,"greaterEqual",(function(){return Sw})),n.d(y,"imag",(function(){return Iw})),n.d(y,"isFinite",(function(){return Tw})),n.d(y,"isInf",(function(){return Nw})),n.d(y,"isNaN",(function(){return Aw})),n.d(y,"leakyRelu",(function(){return Ew})),n.d(y,"less",(function(){return Rw})),n.d(y,"lessEqual",(function(){return Fw})),n.d(y,"linspace",(function(){return Dw})),n.d(y,"localResponseNormalization",(function(){return Ow})),n.d(y,"log",(function(){return Mw})),n.d(y,"log1p",(function(){return Pw})),n.d(y,"logSigmoid",(function(){return Bw})),n.d(y,"logSoftmax",(function(){return Ww})),n.d(y,"logSumExp",(function(){return Qw})),n.d(y,"logicalAnd",(function(){return Jw})),n.d(y,"logicalNot",(function(){return $w})),n.d(y,"logicalOr",(function(){return eC})),n.d(y,"logicalXor",(function(){return tC})),n.d(y,"matMul",(function(){return gb})),n.d(y,"max",(function(){return Vw})),n.d(y,"maxPool",(function(){return nC})),n.d(y,"maxPool3d",(function(){return rC})),n.d(y,"maxPoolWithArgmax",(function(){return aC})),n.d(y,"maximum",(function(){return $k})),n.d(y,"mean",(function(){return iC})),n.d(y,"min",(function(){return oC})),n.d(y,"minimum",(function(){return sC})),n.d(y,"mirrorPad",(function(){return uC})),n.d(y,"mod",(function(){return cC})),n.d(y,"moments",(function(){return lC})),n.d(y,"mul",(function(){return Ek})),n.d(y,"multiRNNCell",(function(){return hC})),n.d(y,"multinomial",(function(){return pC})),n.d(y,"neg",(function(){return Lw})),n.d(y,"notEqual",(function(){return dC})),n.d(y,"oneHot",(function(){return yb})),n.d(y,"ones",(function(){return mC})),n.d(y,"onesLike",(function(){return vC})),n.d(y,"outerProduct",(function(){return gC})),n.d(y,"pad",(function(){return yC})),n.d(y,"pad1d",(function(){return bC})),n.d(y,"pad2d",(function(){return kC})),n.d(y,"pad3d",(function(){return xC})),n.d(y,"pad4d",(function(){return wC})),n.d(y,"pool",(function(){return _C})),n.d(y,"pow",(function(){return qk})),n.d(y,"prelu",(function(){return SC})),n.d(y,"print",(function(){return Zy})),n.d(y,"prod",(function(){return IC})),n.d(y,"rand",(function(){return TC})),n.d(y,"randomGamma",(function(){return FC})),n.d(y,"randomNormal",(function(){return DC})),n.d(y,"randomUniform",(function(){return OC})),n.d(y,"range",(function(){return MC})),n.d(y,"real",(function(){return PC})),n.d(y,"reciprocal",(function(){return LC})),n.d(y,"relu",(function(){return zC})),n.d(y,"relu6",(function(){return BC})),n.d(y,"reshape",(function(){return Ax})),n.d(y,"reverse",(function(){return VC})),n.d(y,"reverse1d",(function(){return UC})),n.d(y,"reverse2d",(function(){return WC})),n.d(y,"reverse3d",(function(){return GC})),n.d(y,"reverse4d",(function(){return HC})),n.d(y,"round",(function(){return jC})),n.d(y,"rsqrt",(function(){return qC})),n.d(y,"scalar",(function(){return Uk})),n.d(y,"selu",(function(){return KC})),n.d(y,"separableConv2d",(function(){return XC})),n.d(y,"setdiff1dAsync",(function(){return YC})),n.d(y,"sigmoid",(function(){return Dx})),n.d(y,"sign",(function(){return ZC})),n.d(y,"sin",(function(){return QC})),n.d(y,"sinh",(function(){return JC})),n.d(y,"slice",(function(){return Ox})),n.d(y,"slice1d",(function(){return $C})),n.d(y,"slice2d",(function(){return e_})),n.d(y,"slice3d",(function(){return t_})),n.d(y,"slice4d",(function(){return n_})),n.d(y,"softmax",(function(){return r_})),n.d(y,"softplus",(function(){return zw})),n.d(y,"spaceToBatchND",(function(){return CC})),n.d(y,"fft",(function(){return a_})),n.d(y,"ifft",(function(){return i_})),n.d(y,"irfft",(function(){return o_})),n.d(y,"rfft",(function(){return u_})),n.d(y,"split",(function(){return s_})),n.d(y,"sqrt",(function(){return Rk})),n.d(y,"square",(function(){return Fk})),n.d(y,"squaredDifference",(function(){return c_})),n.d(y,"squeeze",(function(){return l_})),n.d(y,"stack",(function(){return h_})),n.d(y,"step",(function(){return p_})),n.d(y,"stridedSlice",(function(){return d_})),n.d(y,"sub",(function(){return Kk})),n.d(y,"sum",(function(){return Uw})),n.d(y,"tan",(function(){return f_})),n.d(y,"tanh",(function(){return Mx})),n.d(y,"tensor",(function(){return ey})),n.d(y,"tensor1d",(function(){return m_})),n.d(y,"tensor2d",(function(){return v_})),n.d(y,"tensor3d",(function(){return xb})),n.d(y,"tensor4d",(function(){return g_})),n.d(y,"tensor5d",(function(){return y_})),n.d(y,"tensor6d",(function(){return b_})),n.d(y,"tile",(function(){return kw})),n.d(y,"topk",(function(){return k_})),n.d(y,"truncatedNormal",(function(){return x_})),n.d(y,"unique",(function(){return w_})),n.d(y,"unsortedSegmentSum",(function(){return C_})),n.d(y,"unstack",(function(){return __})),n.d(y,"variable",(function(){return S_})),n.d(y,"where",(function(){return pw})),n.d(y,"whereAsync",(function(){return T_})),n.d(y,"zeros",(function(){return fC})),n.d(y,"zerosLike",(function(){return Dk})),n.d(y,"op",(function(){return Qg})),n.d(y,"OP_SCOPE_SUFFIX",(function(){return Zg})),n.d(y,"image",(function(){return ZS})),n.d(y,"linalg",(function(){return QS})),n.d(y,"losses",(function(){return JS})),n.d(y,"spectral",(function(){return XS})),n.d(y,"fused",(function(){return f})),n.d(y,"signal",(function(){return YS})),n.d(y,"train",(function(){return eI})),n.d(y,"enableProdMode",(function(){return ok})),n.d(y,"enableDebugMode",(function(){return sk})),n.d(y,"disableDeprecationWarnings",(function(){return uk})),n.d(y,"deprecationWarn",(function(){return ck})),n.d(y,"disposeVariables",(function(){return lk})),n.d(y,"engine",(function(){return hk})),n.d(y,"memory",(function(){return pk})),n.d(y,"profile",(function(){return dk})),n.d(y,"tidy",(function(){return fk})),n.d(y,"dispose",(function(){return mk})),n.d(y,"keep",(function(){return vk})),n.d(y,"time",(function(){return gk})),n.d(y,"setBackend",(function(){return yk})),n.d(y,"ready",(function(){return bk})),n.d(y,"getBackend",(function(){return kk})),n.d(y,"removeBackend",(function(){return xk})),n.d(y,"findBackend",(function(){return wk})),n.d(y,"findBackendFactory",(function(){return Ck})),n.d(y,"registerBackend",(function(){return _k})),n.d(y,"backend",(function(){return Sk})),n.d(y,"setPlatform",(function(){return Ik})),n.d(y,"getKernel",(function(){return tg})),n.d(y,"getGradient",(function(){return ng})),n.d(y,"getKernelsForBackend",(function(){return rg})),n.d(y,"registerKernel",(function(){return ag})),n.d(y,"registerGradient",(function(){return ig})),n.d(y,"unregisterKernel",(function(){return og})),n.d(y,"unregisterGradient",(function(){return sg})),n.d(y,"copyRegisteredKernels",(function(){return ug})),n.d(y,"Abs",(function(){return rf})),n.d(y,"Acos",(function(){return af})),n.d(y,"Acosh",(function(){return of})),n.d(y,"Add",(function(){return sf})),n.d(y,"AddN",(function(){return uf})),n.d(y,"All",(function(){return cf})),n.d(y,"Any",(function(){return lf})),n.d(y,"ArgMax",(function(){return hf})),n.d(y,"ArgMin",(function(){return pf})),n.d(y,"Asin",(function(){return df})),n.d(y,"Asinh",(function(){return ff})),n.d(y,"Atan",(function(){return mf})),n.d(y,"Atanh",(function(){return vf})),n.d(y,"Atan2",(function(){return gf})),n.d(y,"AvgPool",(function(){return yf})),n.d(y,"AvgPoolGrad",(function(){return bf})),n.d(y,"AvgPool3D",(function(){return kf})),n.d(y,"AvgPool3DGrad",(function(){return xf})),n.d(y,"BatchMatMul",(function(){return wf})),n.d(y,"BatchToSpaceND",(function(){return Cf})),n.d(y,"Bincount",(function(){return _f})),n.d(y,"BroadcastTo",(function(){return Sf})),n.d(y,"Cast",(function(){return If})),n.d(y,"Ceil",(function(){return Tf})),n.d(y,"ClipByValue",(function(){return Nf})),n.d(y,"Complex",(function(){return Af})),n.d(y,"ComplexAbs",(function(){return Ef})),n.d(y,"Concat",(function(){return Rf})),n.d(y,"Conv2D",(function(){return Ff})),n.d(y,"Conv2DBackpropFilter",(function(){return Df})),n.d(y,"Conv2DBackpropInput",(function(){return Of})),n.d(y,"Conv3D",(function(){return Mf})),n.d(y,"Conv3DBackpropFilterV2",(function(){return Pf})),n.d(y,"Conv3DBackpropInputV2",(function(){return Lf})),n.d(y,"Cos",(function(){return zf})),n.d(y,"Cosh",(function(){return Bf})),n.d(y,"Cumsum",(function(){return Vf})),n.d(y,"CropAndResize",(function(){return Uf})),n.d(y,"DenseBincount",(function(){return Wf})),n.d(y,"DepthToSpace",(function(){return Gf})),n.d(y,"DepthwiseConv2dNative",(function(){return Hf})),n.d(y,"DepthwiseConv2dNativeBackpropFilter",(function(){return jf})),n.d(y,"DepthwiseConv2dNativeBackpropInput",(function(){return qf})),n.d(y,"Diag",(function(){return Kf})),n.d(y,"Dilation2D",(function(){return Xf})),n.d(y,"Dilation2DBackpropInput",(function(){return Yf})),n.d(y,"Dilation2DBackpropFilter",(function(){return Zf})),n.d(y,"RealDiv",(function(){return Qf})),n.d(y,"Elu",(function(){return Jf})),n.d(y,"EluGrad",(function(){return $f})),n.d(y,"Erf",(function(){return em})),n.d(y,"Equal",(function(){return tm})),n.d(y,"Exp",(function(){return nm})),n.d(y,"ExpandDims",(function(){return rm})),n.d(y,"Expm1",(function(){return am})),n.d(y,"FFT",(function(){return im})),n.d(y,"Fill",(function(){return om})),n.d(y,"FlipLeftRight",(function(){return sm})),n.d(y,"Floor",(function(){return um})),n.d(y,"FloorDiv",(function(){return cm})),n.d(y,"FusedBatchNorm",(function(){return lm})),n.d(y,"GatherV2",(function(){return hm})),n.d(y,"GatherNd",(function(){return pm})),n.d(y,"Greater",(function(){return dm})),n.d(y,"GreaterEqual",(function(){return fm})),n.d(y,"Identity",(function(){return mm})),n.d(y,"IFFT",(function(){return vm})),n.d(y,"Imag",(function(){return gm})),n.d(y,"IsFinite",(function(){return ym})),n.d(y,"IsInf",(function(){return bm})),n.d(y,"IsNan",(function(){return km})),n.d(y,"LeakyRelu",(function(){return xm})),n.d(y,"Less",(function(){return wm})),n.d(y,"LessEqual",(function(){return Cm})),n.d(y,"LinSpace",(function(){return _m})),n.d(y,"Log",(function(){return Sm})),n.d(y,"Log1p",(function(){return Im})),n.d(y,"LogicalAnd",(function(){return Tm})),n.d(y,"LogicalNot",(function(){return Nm})),n.d(y,"LogicalOr",(function(){return Am})),n.d(y,"LogSoftmax",(function(){return Em})),n.d(y,"LRN",(function(){return Rm})),n.d(y,"LRNGrad",(function(){return Fm})),n.d(y,"Max",(function(){return Dm})),n.d(y,"Maximum",(function(){return Om})),n.d(y,"MaxPool",(function(){return Mm})),n.d(y,"MaxPoolGrad",(function(){return Pm})),n.d(y,"MaxPool3D",(function(){return Lm})),n.d(y,"MaxPool3DGrad",(function(){return zm})),n.d(y,"MaxPoolWithArgmax",(function(){return Bm})),n.d(y,"Mean",(function(){return Vm})),n.d(y,"Min",(function(){return Um})),n.d(y,"Minimum",(function(){return Wm})),n.d(y,"MirrorPad",(function(){return Gm})),n.d(y,"Mod",(function(){return Hm})),n.d(y,"Multinomial",(function(){return jm})),n.d(y,"Multiply",(function(){return qm})),n.d(y,"Neg",(function(){return Km})),n.d(y,"NotEqual",(function(){return Xm})),n.d(y,"NonMaxSuppressionV3",(function(){return Ym})),n.d(y,"NonMaxSuppressionV4",(function(){return Zm})),n.d(y,"NonMaxSuppressionV5",(function(){return Qm})),n.d(y,"OnesLike",(function(){return Jm})),n.d(y,"OneHot",(function(){return $m})),n.d(y,"Pack",(function(){return ev})),n.d(y,"PadV2",(function(){return tv})),n.d(y,"Pool",(function(){return nv})),n.d(y,"Pow",(function(){return rv})),n.d(y,"Prelu",(function(){return av})),n.d(y,"Prod",(function(){return iv})),n.d(y,"Range",(function(){return ov})),n.d(y,"Real",(function(){return sv})),n.d(y,"Reciprocal",(function(){return uv})),n.d(y,"Relu",(function(){return cv})),n.d(y,"Reshape",(function(){return lv})),n.d(y,"ResizeNearestNeighbor",(function(){return hv})),n.d(y,"ResizeNearestNeighborGrad",(function(){return pv})),n.d(y,"ResizeBilinear",(function(){return dv})),n.d(y,"ResizeBilinearGrad",(function(){return fv})),n.d(y,"Relu6",(function(){return mv})),n.d(y,"Reverse",(function(){return vv})),n.d(y,"Round",(function(){return gv})),n.d(y,"Rsqrt",(function(){return yv})),n.d(y,"ScatterNd",(function(){return bv})),n.d(y,"Select",(function(){return kv})),n.d(y,"Selu",(function(){return xv})),n.d(y,"Slice",(function(){return wv})),n.d(y,"Sin",(function(){return Cv})),n.d(y,"Sinh",(function(){return _v})),n.d(y,"Sign",(function(){return Sv})),n.d(y,"Sigmoid",(function(){return Iv})),n.d(y,"Softplus",(function(){return Tv})),n.d(y,"Sqrt",(function(){return Nv})),n.d(y,"Sum",(function(){return Av})),n.d(y,"SpaceToBatchND",(function(){return Ev})),n.d(y,"SplitV",(function(){return Rv})),n.d(y,"Softmax",(function(){return Fv})),n.d(y,"SquaredDifference",(function(){return Dv})),n.d(y,"Square",(function(){return Ov})),n.d(y,"Sub",(function(){return Mv})),n.d(y,"SparseToDense",(function(){return Pv})),n.d(y,"StridedSlice",(function(){return Lv})),n.d(y,"Tan",(function(){return zv})),n.d(y,"Tanh",(function(){return Bv})),n.d(y,"Tile",(function(){return Vv})),n.d(y,"TopK",(function(){return Uv})),n.d(y,"Transpose",(function(){return Wv})),n.d(y,"Unique",(function(){return Gv})),n.d(y,"Unpack",(function(){return Hv})),n.d(y,"UnsortedSegmentSum",(function(){return jv})),n.d(y,"ZerosLike",(function(){return qv})),n.d(y,"Step",(function(){return Kv})),n.d(y,"FromPixels",(function(){return Xv})),n.d(y,"RotateWithOffset",(function(){return Yv})),n.d(y,"_FusedMatMul",(function(){return Zv})),n.d(y,"FusedConv2D",(function(){return Qv})),n.d(y,"FusedDepthwiseConv2D",(function(){return Jv})),n.d(y,"booleanMaskAsync",(function(){return N_})),n.d(y,"equalStrict",(function(){return A_})),n.d(y,"greaterEqualStrict",(function(){return E_})),n.d(y,"greaterStrict",(function(){return R_})),n.d(y,"lessEqualStrict",(function(){return F_})),n.d(y,"lessStrict",(function(){return D_})),n.d(y,"notEqualStrict",(function(){return O_})),n.d(y,"addStrict",(function(){return M_})),n.d(y,"divStrict",(function(){return P_})),n.d(y,"maximumStrict",(function(){return L_})),n.d(y,"minimumStrict",(function(){return z_})),n.d(y,"modStrict",(function(){return B_})),n.d(y,"mulStrict",(function(){return V_})),n.d(y,"powStrict",(function(){return U_})),n.d(y,"squaredDifferenceStrict",(function(){return W_})),n.d(y,"subStrict",(function(){return G_})),n.d(y,"transpose",(function(){return bb})),n.d(y,"norm",(function(){return H_})),n.d(y,"movingAverage",(function(){return j_})),n.d(y,"scatterND",(function(){return q_})),n.d(y,"sparseToDense",(function(){return K_})),n.d(y,"gatherND",(function(){return X_})),n.d(y,"dropout",(function(){return Y_})),n.d(y,"enclosingPowerOfTwo",(function(){return Z_})),n.d(y,"cosineWindow",(function(){return Q_})),n.d(y,"inTopKAsync",(function(){return J_}));var b={};n.r(b),n.d(b,"json",(function(){return kD}));var k={};n.r(k),n.d(k,"json",(function(){return xD}));var x={};n.r(x),n.d(x,"json",(function(){return wD}));var w={};n.r(w),n.d(w,"json",(function(){return CD}));var C={};n.r(C),n.d(C,"json",(function(){return _D}));var _={};n.r(_),n.d(_,"json",(function(){return SD}));var S={};n.r(S),n.d(S,"json",(function(){return ID}));var I={};n.r(I),n.d(I,"json",(function(){return TD}));var T={};n.r(T),n.d(T,"json",(function(){return ND}));var N={};n.r(N),n.d(N,"json",(function(){return AD}));var A={};n.r(A),n.d(A,"json",(function(){return ED}));var E={};n.r(E),n.d(E,"json",(function(){return RD}));var R={};n.r(R),n.d(R,"json",(function(){return FD}));var F={};n.r(F),n.d(F,"json",(function(){return DD}));var D={};n.r(D),n.d(D,"json",(function(){return OD}));var O={};n.r(O),n.d(O,"json",(function(){return MD}));var M={};n.r(M),n.d(M,"json",(function(){return PD}));var P={};n.r(P),n.d(P,"array",(function(){return YO})),n.d(P,"Dataset",(function(){return KO})),n.d(P,"zip",(function(){return ZO})),n.d(P,"CSVDataset",(function(){return aM})),n.d(P,"TextLineDataset",(function(){return JO})),n.d(P,"csv",(function(){return yM})),n.d(P,"func",(function(){return bM})),n.d(P,"generator",(function(){return kM})),n.d(P,"microphone",(function(){return CM})),n.d(P,"webcam",(function(){return xM})),n.d(P,"FileDataSource",(function(){return vM})),n.d(P,"URLDataSource",(function(){return gM})),n.d(P,"version_data",(function(){return SM}));var L={};function z(e){return"function"==typeof e}n.r(L),n.d(L,"simpleAbsImpl",(function(){return lP})),n.d(L,"addImpl",(function(){return tP})),n.d(L,"bincountImpl",(function(){return KP})),n.d(L,"bincountReduceImpl",(function(){return XP})),n.d(L,"ceilImpl",(function(){return QP})),n.d(L,"expImpl",(function(){return WL})),n.d(L,"expm1Impl",(function(){return KL})),n.d(L,"floorImpl",(function(){return dz})),n.d(L,"gatherV2Impl",(function(){return wz})),n.d(L,"greaterImpl",(function(){return _z})),n.d(L,"lessImpl",(function(){return Lz})),n.d(L,"linSpaceImpl",(function(){return Gz})),n.d(L,"logImpl",(function(){return jz})),n.d(L,"maxImpl",(function(){return oB})),n.d(L,"maximumImpl",(function(){return cB})),n.d(L,"minimumImpl",(function(){return xB})),n.d(L,"multiplyImpl",(function(){return ZL})),n.d(L,"negImpl",(function(){return RB})),n.d(L,"notEqualImpl",(function(){return BB})),n.d(L,"prodImpl",(function(){return JB})),n.d(L,"rangeImpl",(function(){return eV})),n.d(L,"rsqrtImpl",(function(){return pV})),n.d(L,"sliceImpl",(function(){return GP})),n.d(L,"squaredDifferenceImpl",(function(){return BV})),n.d(L,"stridedSliceImpl",(function(){return HV})),n.d(L,"subImpl",(function(){return rz})),n.d(L,"tileImpl",(function(){return YV})),n.d(L,"topKImpl",(function(){return ZV})),n.d(L,"transposeImpl",(function(){return gP})),n.d(L,"uniqueImpl",(function(){return QV}));var B=!1,V={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else B&&console.log("RxJS: Back to a better error behavior. Thank you. <3");B=e},get useDeprecatedSynchronousErrorHandling(){return B}};function U(e){setTimeout((function(){throw e}),0)}var W={closed:!0,next:function(e){},error:function(e){if(V.useDeprecatedSynchronousErrorHandling)throw e;U(e)},complete:function(){}},G=Array.isArray||function(e){return e&&"number"==typeof e.length};function H(e){return null!==e&&"object"==typeof e}var j,q=function(){function e(e){return Error.call(this),this.message=e?"".concat(e.length," errors occurred during unsubscription:\n").concat(e.map((function(e,t){return"".concat(t+1,") ").concat(e.toString())})).join("\n  ")):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),K=((j=function(){function e(t){_classCallCheck(this,e),this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return _createClass(e,[{key:"unsubscribe",value:function(){var t;if(!this.closed){var n=this._parentOrParents,r=this._ctorUnsubscribe,a=this._unsubscribe,i=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(null!==n)for(var o=0;o<n.length;++o)n[o].remove(this);if(z(a)){r&&(this._unsubscribe=void 0);try{a.call(this)}catch(l){t=l instanceof q?X(l.errors):[l]}}if(G(i))for(var s=-1,u=i.length;++s<u;){var c=i[s];if(H(c))try{c.unsubscribe()}catch(l){t=t||[],l instanceof q?t=t.concat(X(l.errors)):t.push(l)}}if(t)throw new q(t)}}},{key:"add",value:function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var r=n;(n=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var a=n._parentOrParents;if(null===a)n._parentOrParents=this;else if(a instanceof e){if(a===this)return n;n._parentOrParents=[a,this]}else{if(-1!==a.indexOf(this))return n;a.push(this)}var i=this._subscriptions;return null===i?this._subscriptions=[n]:i.push(n),n}},{key:"remove",value:function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}}}]),e}()).EMPTY=function(e){return e.closed=!0,e}(new j),j);function X(e){return e.reduce((function(e,t){return e.concat(t instanceof q?t.errors:t)}),[])}var Y="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),Z=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;switch(_classCallCheck(this,n),(i=t.call(this)).syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=W;break;case 1:if(!e){i.destination=W;break}if("object"==typeof e){e instanceof n?(i.syncErrorThrowable=e.syncErrorThrowable,i.destination=e,e.add(_assertThisInitialized(i))):(i.syncErrorThrowable=!0,i.destination=new Q(_assertThisInitialized(i),e));break}default:i.syncErrorThrowable=!0,i.destination=new Q(_assertThisInitialized(i),e,r,a)}return i}return _createClass(n,[{key:Y,value:function(){return this}},{key:"next",value:function(e){this.isStopped||this._next(e)}},{key:"error",value:function(e){this.isStopped||(this.isStopped=!0,this._error(e))}},{key:"complete",value:function(){this.isStopped||(this.isStopped=!0,this._complete())}},{key:"unsubscribe",value:function(){this.closed||(this.isStopped=!0,_get(_getPrototypeOf(n.prototype),"unsubscribe",this).call(this))}},{key:"_next",value:function(e){this.destination.next(e)}},{key:"_error",value:function(e){this.destination.error(e),this.unsubscribe()}},{key:"_complete",value:function(){this.destination.complete(),this.unsubscribe()}},{key:"_unsubscribeAndRecycle",value:function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this}}],[{key:"create",value:function(e,t,r){var a=new n(e,t,r);return a.syncErrorThrowable=!1,a}}]),n}(K),Q=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o,s;_classCallCheck(this,n),(o=t.call(this))._parentSubscriber=e;var u=_assertThisInitialized(o);return z(r)?s=r:r&&(s=r.next,a=r.error,i=r.complete,r!==W&&(z((u=Object.create(r)).unsubscribe)&&o.add(u.unsubscribe.bind(u)),u.unsubscribe=o.unsubscribe.bind(_assertThisInitialized(o)))),o._context=u,o._next=s,o._error=a,o._complete=i,o}return _createClass(n,[{key:"next",value:function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;V.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}},{key:"error",value:function(e){if(!this.isStopped){var t=this._parentSubscriber,n=V.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):U(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;U(e)}}}},{key:"complete",value:function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};V.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}}},{key:"__tryOrUnsub",value:function(e,t){try{e.call(this._context,t)}catch(n){if(this.unsubscribe(),V.useDeprecatedSynchronousErrorHandling)throw n;U(n)}}},{key:"__tryOrSetError",value:function(e,t,n){if(!V.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(r){return V.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=r,e.syncErrorThrown=!0,!0):(U(r),!0)}return!1}},{key:"_unsubscribe",value:function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}]),n}(Z),J="function"==typeof Symbol&&Symbol.observable||"@@observable";function $(e){return e}function ee(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return te(t)}function te(e){return 0===e.length?$:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var ne,re=((ne=function(){function e(t){_classCallCheck(this,e),this._isScalar=!1,t&&(this._subscribe=t)}return _createClass(e,[{key:"lift",value:function(t){var n=new e;return n.source=this,n.operator=t,n}},{key:"subscribe",value:function(e,t,n){var r=this.operator,a=function(e,t,n){if(e){if(e instanceof Z)return e;if(e[Y])return e[Y]()}return e||t||n?new Z(e,t,n):new Z(W)}(e,t,n);if(a.add(r?r.call(a,this.source):this.source||V.useDeprecatedSynchronousErrorHandling&&!a.syncErrorThrowable?this._subscribe(a):this._trySubscribe(a)),V.useDeprecatedSynchronousErrorHandling&&a.syncErrorThrowable&&(a.syncErrorThrowable=!1,a.syncErrorThrown))throw a.syncErrorValue;return a}},{key:"_trySubscribe",value:function(e){try{return this._subscribe(e)}catch(t){V.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),function(e){for(;e;){var t=e,n=t.closed,r=t.destination,a=t.isStopped;if(n||a)return!1;e=r&&r instanceof Z?r:null}return!0}(e)?e.error(t):console.warn(t)}}},{key:"forEach",value:function(e,t){var n=this;return new(t=ae(t))((function(t,r){var a;a=n.subscribe((function(t){try{e(t)}catch(n){r(n),a&&a.unsubscribe()}}),r,t)}))}},{key:"_subscribe",value:function(e){var t=this.source;return t&&t.subscribe(e)}},{key:J,value:function(){return this}},{key:"pipe",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?this:te(t)(this)}},{key:"toPromise",value:function(e){var t=this;return new(e=ae(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))}}]),e}()).create=function(e){return new ne(e)},ne);function ae(e){if(e||(e=V.Promise||Promise),!e)throw new Error("no Promise impl found");return e}var ie,oe=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),se=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this)).subject=e,a.subscriber=r,a.closed=!1,a}return _createClass(n,[{key:"unsubscribe",value:function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}}}]),n}(K),ue=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).destination=e,r}return n}(Z),ce=((ie=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this)).observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return _createClass(n,[{key:Y,value:function(){return new ue(this)}},{key:"lift",value:function(e){var t=new le(this,this);return t.operator=e,t}},{key:"next",value:function(e){if(this.closed)throw new oe;if(!this.isStopped)for(var t=this.observers,n=t.length,r=t.slice(),a=0;a<n;a++)r[a].next(e)}},{key:"error",value:function(e){if(this.closed)throw new oe;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,r=t.slice(),a=0;a<n;a++)r[a].error(e);this.observers.length=0}},{key:"complete",value:function(){if(this.closed)throw new oe;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),r=0;r<t;r++)n[r].complete();this.observers.length=0}},{key:"unsubscribe",value:function(){this.isStopped=!0,this.closed=!0,this.observers=null}},{key:"_trySubscribe",value:function(e){if(this.closed)throw new oe;return _get(_getPrototypeOf(n.prototype),"_trySubscribe",this).call(this,e)}},{key:"_subscribe",value:function(e){if(this.closed)throw new oe;return this.hasError?(e.error(this.thrownError),K.EMPTY):this.isStopped?(e.complete(),K.EMPTY):(this.observers.push(e),new se(this,e))}},{key:"asObservable",value:function(){var e=new re;return e.source=this,e}}]),n}(re)).create=function(e,t){return new le(e,t)},ie),le=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this)).destination=e,a.source=r,a}return _createClass(n,[{key:"next",value:function(e){var t=this.destination;t&&t.next&&t.next(e)}},{key:"error",value:function(e){var t=this.destination;t&&t.error&&this.destination.error(e)}},{key:"complete",value:function(){var e=this.destination;e&&e.complete&&this.destination.complete()}},{key:"_subscribe",value:function(e){return this.source?this.source.subscribe(e):K.EMPTY}}]),n}(ce);function he(e){return e&&"function"==typeof e.schedule}function pe(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new de(e,t))}}var de=function(){function e(t,n){_classCallCheck(this,e),this.project=t,this.thisArg=n}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new fe(e,this.project,this.thisArg))}}]),e}(),fe=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck(this,n),(i=t.call(this,e)).project=r,i.count=0,i.thisArg=a||_assertThisInitialized(i),i}return _createClass(n,[{key:"_next",value:function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(t)}}]),n}(Z),me=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()}};var ve="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",ge=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function ye(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}var be=function(e){if(e&&"function"==typeof e[J])return r=e,function(e){var t=r[J]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if(ge(e))return me(e);if(ye(e))return n=e,function(e){return n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,U),e};if(e&&"function"==typeof e[ve])return t=e,function(e){for(var n=t[ve]();;){var r=void 0;try{r=n.next()}catch(a){return e.error(a),e}if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof n.return&&e.add((function(){n.return&&n.return()})),e};var t,n,r,a=H(e)?"an invalid object":"'".concat(e,"'");throw new TypeError("You provided ".concat(a," where a stream was expected. You can provide an Observable, Promise, Array, or Iterable."))};function ke(e,t){return new re((function(n){var r=new K,a=0;return r.add(t.schedule((function(){a!==e.length?(n.next(e[a++]),n.closed||r.add(this.schedule())):n.complete()}))),r}))}function xe(e,t){return t?function(e,t){if(null!=e){if(function(e){return e&&"function"==typeof e[J]}(e))return function(e,t){return new re((function(n){var r=new K;return r.add(t.schedule((function(){var a=e[J]();r.add(a.subscribe({next:function(e){r.add(t.schedule((function(){return n.next(e)})))},error:function(e){r.add(t.schedule((function(){return n.error(e)})))},complete:function(){r.add(t.schedule((function(){return n.complete()})))}}))}))),r}))}(e,t);if(ye(e))return function(e,t){return new re((function(n){var r=new K;return r.add(t.schedule((function(){return e.then((function(e){r.add(t.schedule((function(){n.next(e),r.add(t.schedule((function(){return n.complete()})))})))}),(function(e){r.add(t.schedule((function(){return n.error(e)})))}))}))),r}))}(e,t);if(ge(e))return ke(e,t);if(function(e){return e&&"function"==typeof e[ve]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new re((function(n){var r,a=new K;return a.add((function(){r&&"function"==typeof r.return&&r.return()})),a.add(t.schedule((function(){r=e[ve](),a.add(t.schedule((function(){if(!n.closed){var e,t;try{var a=r.next();e=a.value,t=a.done}catch(i){return void n.error(i)}t?n.complete():(n.next(e),this.schedule())}})))}))),a}))}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}(e,t):e instanceof re?e:new re(be(e))}var we=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this)).parent=e,r}return _createClass(n,[{key:"_next",value:function(e){this.parent.notifyNext(e)}},{key:"_error",value:function(e){this.parent.notifyError(e),this.unsubscribe()}},{key:"_complete",value:function(){this.parent.notifyComplete(),this.unsubscribe()}}]),n}(Z),Ce=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"notifyNext",value:function(e){this.destination.next(e)}},{key:"notifyError",value:function(e){this.destination.error(e)}},{key:"notifyComplete",value:function(){this.destination.complete()}}]),n}(Z);function _e(e,t){if(!t.closed)return e instanceof re?e.subscribe(t):be(e)(t)}function Se(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.POSITIVE_INFINITY;return"function"==typeof t?function(r){return r.pipe(Se((function(n,r){return xe(e(n,r)).pipe(pe((function(e,a){return t(n,e,r,a)})))}),n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new Ie(e,n))})}var Ie=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.POSITIVE_INFINITY;_classCallCheck(this,e),this.project=t,this.concurrent=n}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new Te(e,this.project,this.concurrent))}}]),e}(),Te=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.POSITIVE_INFINITY;return _classCallCheck(this,n),(a=t.call(this,e)).project=r,a.concurrent=i,a.hasCompleted=!1,a.buffer=[],a.active=0,a.index=0,a}return _createClass(n,[{key:"_next",value:function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}},{key:"_tryNext",value:function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(t)}},{key:"_innerSub",value:function(e){var t=new we(this),n=this.destination;n.add(t);var r=_e(e,t);r!==t&&n.add(r)}},{key:"_complete",value:function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}},{key:"notifyNext",value:function(e){this.destination.next(e)}},{key:"notifyComplete",value:function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}]),n}(Ce);function Ne(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY;return Se($,e)}function Ae(e,t){return t?ke(e,t):new re(me(e))}function Ee(){return function(e){return e.lift(new Fe(e))}}var Re,Fe=function(){function e(t){_classCallCheck(this,e),this.connectable=t}return _createClass(e,[{key:"call",value:function(e,t){var n=this.connectable;n._refCount++;var r=new De(e,n),a=t.subscribe(r);return r.closed||(r.connection=n.connect()),a}}]),e}(),De=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this,e)).connectable=r,a}return _createClass(n,[{key:"_unsubscribe",value:function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var n=this.connection,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null}}]),n}(Z),Oe={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:(Re=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this)).source=e,a.subjectFactory=r,a._refCount=0,a._isComplete=!1,a}return _createClass(n,[{key:"_subscribe",value:function(e){return this.getSubject().subscribe(e)}},{key:"getSubject",value:function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject}},{key:"connect",value:function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new K).add(this.source.subscribe(new Me(this.getSubject(),this))),e.closed&&(this._connection=null,e=K.EMPTY)),e}},{key:"refCount",value:function(){return Ee()(this)}}]),n}(re).prototype)._subscribe},_isComplete:{value:Re._isComplete,writable:!0},getSubject:{value:Re.getSubject},connect:{value:Re.connect},refCount:{value:Re.refCount}},Me=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this,e)).connectable=r,a}return _createClass(n,[{key:"_error",value:function(e){this._unsubscribe(),_get(_getPrototypeOf(n.prototype),"_error",this).call(this,e)}},{key:"_complete",value:function(){this.connectable._isComplete=!0,this._unsubscribe(),_get(_getPrototypeOf(n.prototype),"_complete",this).call(this)}},{key:"_unsubscribe",value:function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}}}]),n}(ue);function Pe(){return new ce}function Le(e,t,n){var r=function(e){return function(){if(e){var t=e.apply(void 0,arguments);for(var n in t)this[n]=t[n]}}}(t);function a(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(this instanceof a)return r.apply(this,t),this;var i=_construct(a,t);return o.annotation=i,o;function o(e,t,n){for(var r=e.hasOwnProperty("__parameters__")?e.__parameters__:Object.defineProperty(e,"__parameters__",{value:[]}).__parameters__;r.length<=n;)r.push(null);return(r[n]=r[n]||[]).push(i),e}}return n&&(a.prototype=Object.create(n.prototype)),a.prototype.ngMetadataName=e,a.annotationCls=a,a}var ze=Le("Inject",(function(e){return{token:e}})),Be=Le("Optional"),Ve=Le("Self"),Ue=Le("SkipSelf"),We=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}({});function Ge(e){for(var t in e)if(e[t]===Ge)return t;throw Error("Could not find renamed property on target object.")}function He(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function je(e){var t=e[qe];return t&&t.token===e?t:null}var qe=Ge({ngInjectableDef:Ge});function Ke(e){if("string"==typeof e)return e;if(e instanceof Array)return"["+e.map(Ke).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return""+e.overriddenName;if(e.name)return""+e.name;var t=e.toString();if(null==t)return""+t;var n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}var Xe=Ge({__forward_ref__:Ge});function Ye(e){return e.__forward_ref__=Ye,e.toString=function(){return Ke(this())},e}function Ze(e){var t=e;return"function"==typeof t&&t.hasOwnProperty(Xe)&&t.__forward_ref__===Ye?t():e}var Qe="undefined"!=typeof globalThis&&globalThis,Je="undefined"!=typeof window&&window,$e="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,et="undefined"!=typeof global&&global,tt=Qe||et||Je||$e,nt=function(){function e(t,n){_classCallCheck(this,e),this._desc=t,this.ngMetadataName="InjectionToken",this.ngInjectableDef=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.ngInjectableDef=He({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}return _createClass(e,[{key:"toString",value:function(){return"InjectionToken "+this._desc}}]),e}(),rt=new nt("INJECTOR",-1),at=new Object,it=/\n/gm,ot=Ge({provide:String,useValue:Ge}),st=void 0;function ut(e){var t=st;return st=e,t}function ct(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:We.Default;return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:We.Default;if(void 0===st)throw new Error("inject() must be called from an injection context");return null===st?function(e,t,n){var r=je(e);if(r&&"root"==r.providedIn)return void 0===r.value?r.value=r.factory():r.value;if(n&We.Optional)return null;throw new Error("Injector: NOT_FOUND [".concat(Ke(e),"]"))}(e,0,t):st.get(e,t&We.Optional?null:void 0,t)}(e,t)}var lt=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:at;if(t===at){var n=new Error("NullInjectorError: No provider for ".concat(Ke(e),"!"));throw n.name="NullInjectorError",n}return t}}]),e}();function ht(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;var a=Ke(t);if(t instanceof Array)a=t.map(Ke).join(" -> ");else if("object"==typeof t){var i=[];for(var o in t)if(t.hasOwnProperty(o)){var s=t[o];i.push(o+":"+("string"==typeof s?JSON.stringify(s):Ke(s)))}a="{".concat(i.join(", "),"}")}return"".concat(n).concat(r?"("+r+")":"","[").concat(a,"]: ").concat(e.replace(it,"\n  "))}var pt=function e(){_classCallCheck(this,e)},dt=function e(){_classCallCheck(this,e)};function ft(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function mt(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}var vt=function(){var e={Emulated:0,Native:1,None:2,ShadowDom:3};return e[e.Emulated]="Emulated",e[e.Native]="Native",e[e.None]="None",e[e.ShadowDom]="ShadowDom",e}(),gt=("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(tt);function yt(e){return e.ngDebugContext}function bt(e){return e.ngOriginalError}function kt(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];e.error.apply(e,n)}var xt=function(){function e(){_classCallCheck(this,e),this._console=console}return _createClass(e,[{key:"handleError",value:function(e){var t=this._findOriginalError(e),n=this._findContext(e),r=function(e){return e.ngErrorLogger||kt}(e);r(this._console,"ERROR",e),t&&r(this._console,"ORIGINAL ERROR",t),n&&r(this._console,"ERROR CONTEXT",n)}},{key:"_findContext",value:function(e){return e?yt(e)?yt(e):this._findContext(bt(e)):null}},{key:"_findOriginalError",value:function(e){for(var t=bt(e);t&&bt(t);)t=bt(t);return t}}]),e}(),wt=!0,Ct=!1;function _t(){return Ct=!0,wt}var St=function(){function e(t){if(_classCallCheck(this,e),this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),this.inertBodyElement=this.inertDocument.body,null==this.inertBodyElement){var n=this.inertDocument.createElement("html");this.inertDocument.appendChild(n),this.inertBodyElement=this.inertDocument.createElement("body"),n.appendChild(this.inertBodyElement)}this.inertBodyElement.innerHTML='<svg><g onload="this.parentNode.remove()"></g></svg>',!this.inertBodyElement.querySelector||this.inertBodyElement.querySelector("svg")?(this.inertBodyElement.innerHTML='<svg><p><style><img src="</style><img src=x onerror=alert(1)//">',this.getInertBodyElement=this.inertBodyElement.querySelector&&this.inertBodyElement.querySelector("svg img")&&function(){try{return!!window.DOMParser}catch(e){return!1}}()?this.getInertBodyElement_DOMParser:this.getInertBodyElement_InertDocument):this.getInertBodyElement=this.getInertBodyElement_XHR}return _createClass(e,[{key:"getInertBodyElement_XHR",value:function(e){e="<body><remove></remove>"+e+"</body>";try{e=encodeURI(e)}catch(r){return null}var t=new XMLHttpRequest;t.responseType="document",t.open("GET","data:text/html;charset=utf-8,"+e,!1),t.send(void 0);var n=t.response.body;return n.removeChild(n.firstChild),n}},{key:"getInertBodyElement_DOMParser",value:function(e){e="<body><remove></remove>"+e+"</body>";try{var t=(new window.DOMParser).parseFromString(e,"text/html").body;return t.removeChild(t.firstChild),t}catch(n){return null}}},{key:"getInertBodyElement_InertDocument",value:function(e){var t=this.inertDocument.createElement("template");return"content"in t?(t.innerHTML=e,t):(this.inertBodyElement.innerHTML=e,this.defaultDoc.documentMode&&this.stripCustomNsAttrs(this.inertBodyElement),this.inertBodyElement)}},{key:"stripCustomNsAttrs",value:function(e){for(var t=e.attributes,n=t.length-1;0<n;n--){var r=t.item(n).name;"xmlns:ns1"!==r&&0!==r.indexOf("ns1:")||e.removeAttribute(r)}for(var a=e.firstChild;a;)a.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(a),a=a.nextSibling}}]),e}(),It=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:/?#]*(?:[/?#]|$))/gi,Tt=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Nt(e){return(e=String(e)).match(It)||e.match(Tt)?e:(_t()&&console.warn("WARNING: sanitizing unsafe URL value ".concat(e," (see http://g.co/ng/security#xss)")),"unsafe:"+e)}function At(e){var t,n={},r=_createForOfIteratorHelper(e.split(","));try{for(r.s();!(t=r.n()).done;){n[t.value]=!0}}catch(a){r.e(a)}finally{r.f()}return n}function Et(){for(var e={},t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var a=0,i=n;a<i.length;a++){var o=i[a];for(var s in o)o.hasOwnProperty(s)&&(e[s]=!0)}return e}var Rt,Ft=At("area,br,col,hr,img,wbr"),Dt=At("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),Ot=At("rp,rt"),Mt=Et(Ot,Dt),Pt=Et(Ft,Et(Dt,At("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Et(Ot,At("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Mt),Lt=At("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),zt=At("srcset"),Bt=Et(Lt,zt,At("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),At("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),Vt=At("script,style,template"),Ut=function(){function e(){_classCallCheck(this,e),this.sanitizedSomething=!1,this.buf=[]}return _createClass(e,[{key:"sanitizeChildren",value:function(e){for(var t=e.firstChild,n=!0;t;)if(t.nodeType===Node.ELEMENT_NODE?n=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,n&&t.firstChild)t=t.firstChild;else for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);var r=this.checkClobberedElement(t,t.nextSibling);if(r){t=r;break}t=this.checkClobberedElement(t,t.parentNode)}return this.buf.join("")}},{key:"startElement",value:function(e){var t=e.nodeName.toLowerCase();if(!Pt.hasOwnProperty(t))return this.sanitizedSomething=!0,!Vt.hasOwnProperty(t);this.buf.push("<"),this.buf.push(t);for(var n,r=e.attributes,a=0;a<r.length;a++){var i=r.item(a),o=i.name,s=o.toLowerCase();if(Bt.hasOwnProperty(s)){var u=i.value;Lt[s]&&(u=Nt(u)),zt[s]&&(n=u,u=(n=String(n)).split(",").map((function(e){return Nt(e.trim())})).join(", ")),this.buf.push(" ",o,'="',Ht(u),'"')}else this.sanitizedSomething=!0}return this.buf.push(">"),!0}},{key:"endElement",value:function(e){var t=e.nodeName.toLowerCase();Pt.hasOwnProperty(t)&&!Ft.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}},{key:"chars",value:function(e){this.buf.push(Ht(e))}},{key:"checkClobberedElement",value:function(e,t){if(t&&(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error("Failed to sanitize html because the element is clobbered: "+e.outerHTML);return t}}]),e}(),Wt=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Gt=/([^\#-~ |!])/g;function Ht(e){return e.replace(/&/g,"&amp;").replace(Wt,(function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"})).replace(Gt,(function(e){return"&#"+e.charCodeAt(0)+";"})).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function jt(e){return"content"in e&&function(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var qt=function(){var e={NONE:0,HTML:1,STYLE:2,SCRIPT:3,URL:4,RESOURCE_URL:5};return e[e.NONE]="NONE",e[e.HTML]="HTML",e[e.STYLE]="STYLE",e[e.SCRIPT]="SCRIPT",e[e.URL]="URL",e[e.RESOURCE_URL]="RESOURCE_URL",e}(),Kt=function e(){_classCallCheck(this,e)},Xt=new RegExp("^([-,.\"'%_!# a-zA-Z0-9]+|(?:(?:matrix|translate|scale|rotate|skew|perspective)(?:X|Y|Z|3d)?|(?:rgb|hsl)a?|(?:repeating-)?(?:linear|radial)-gradient|(?:calc|attr))\\([-0-9.%, #a-zA-Z]+\\))$","g"),Yt=/^url\(([^)]+)\)$/,Zt=/([A-Z])/g;function Qt(e){try{return null!=e?e.toString().slice(0,30):e}catch(t){return"[ERROR] Exception while trying to serialize the value"}}var Jt=function(){var e=function e(){_classCallCheck(this,e)};return e.__NG_ELEMENT_ID__=function(){return $t()},e}(),$t=function(){},en=new nt("The presence of this token marks an injector as being the root injector."),tn=function(e,t,n){return new un(e,t,n)},nn=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"create",value:function(e,t){return Array.isArray(e)?tn(e,t,""):tn(e.providers,e.parent,e.name||"")}}]),e}();return e.THROW_IF_NOT_FOUND=at,e.NULL=new lt,e.ngInjectableDef=He({token:e,providedIn:"any",factory:function(){return ct(rt)}}),e.__NG_ELEMENT_ID__=-1,e}(),rn=function(e){return e},an=[],on=rn,sn=function(){return Array.prototype.slice.call(arguments)},un=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nn.NULL,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck(this,e),this.parent=n,this.source=r;var a=this._records=new Map;a.set(nn,{token:nn,fn:rn,deps:an,value:this,useNew:!1}),a.set(rt,{token:rt,fn:rn,deps:an,value:this,useNew:!1}),function e(t,n){if(n)if((n=Ze(n))instanceof Array)for(var r=0;r<n.length;r++)e(t,n[r]);else{if("function"==typeof n)throw ln("Function/Class not supported",n);if(!n||"object"!=typeof n||!n.provide)throw ln("Unexpected provider",n);var a=Ze(n.provide),i=function(e){var t=function(e){var t=an,n=e.deps;if(n&&n.length){t=[];for(var r=0;r<n.length;r++){var a=6,i=Ze(n[r]);if(i instanceof Array)for(var o=0,s=i;o<s.length;o++){var u=s[o];u instanceof Be||u==Be?a|=1:u instanceof Ue||u==Ue?a&=-3:u instanceof Ve||u==Ve?a&=-5:i=u instanceof ze?u.token:Ze(u)}t.push({token:i,options:a})}}else if(e.useExisting)t=[{token:Ze(e.useExisting),options:6}];else if(!(n||ot in e))throw ln("'deps' required",e);return t}(e),n=rn,r=an,a=!1,i=Ze(e.provide);if(ot in e)r=e.useValue;else if(e.useFactory)n=e.useFactory;else if(e.useExisting);else if(e.useClass)a=!0,n=Ze(e.useClass);else{if("function"!=typeof i)throw ln("StaticProvider does not have [useValue|useFactory|useExisting|useClass] or [provide] is not newable",e);a=!0,n=i}return{deps:t,fn:n,useNew:a,value:r}}(n);if(!0===n.multi){var o=t.get(a);if(o){if(o.fn!==sn)throw cn(a)}else t.set(a,o={token:n.provide,deps:[],useNew:!1,fn:sn,value:an});a=n,o.deps.push({token:a,options:6})}var s=t.get(a);if(s&&s.fn==sn)throw cn(a);t.set(a,i)}}(a,t)}return _createClass(e,[{key:"get",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:We.Default,r=this._records.get(e);try{return function e(t,n,r,a,i,o){try{return function(t,n,r,a,i,o){var s;if(!n||o&We.SkipSelf)o&We.Self||(s=a.get(t,i,We.Default));else{if((s=n.value)==on)throw Error("\u0275Circular dependency");if(s===an){n.value=on;var u=n.useNew,c=n.fn,l=n.deps,h=an;if(l.length){h=[];for(var p=0;p<l.length;p++){var d=l[p],f=d.options,m=2&f?r.get(d.token):void 0;h.push(e(d.token,m,r,m||4&f?a:nn.NULL,1&f?null:nn.THROW_IF_NOT_FOUND,We.Default))}}n.value=s=u?_construct(c,_toConsumableArray(h)):c.apply(void 0,h)}}return s}(t,n,r,a,i,o)}catch(s){throw s instanceof Error||(s=new Error(s)),(s.ngTempTokenPath=s.ngTempTokenPath||[]).unshift(t),n&&n.value==on&&(n.value=an),s}}(e,r,this._records,this.parent,t,n)}catch(a){return function(e,t,n,r){var a=e.ngTempTokenPath;throw t.__source&&a.unshift(t.__source),e.message=ht("\n"+e.message,a,"StaticInjectorError",r),e.ngTokenPath=a,e.ngTempTokenPath=null,e}(a,e,0,this.source)}}},{key:"toString",value:function(){var e=[];return this._records.forEach((function(t,n){return e.push(Ke(n))})),"StaticInjector[".concat(e.join(", "),"]")}}]),e}();function cn(e){return ln("Cannot mix multi providers and regular providers",e)}function ln(e,t){return new Error(ht(e,t,"StaticInjectorError"))}var hn=new nt("AnalyzeForEntryComponents"),pn=null;function dn(){if(!pn){var e=tt.Symbol;if(e&&e.iterator)pn=e.iterator;else for(var t=Object.getOwnPropertyNames(Map.prototype),n=0;n<t.length;++n){var r=t[n];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(pn=r)}}return pn}function fn(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)}function mn(e,t){var n=gn(e),r=gn(t);return n&&r?function(e,t,n){for(var r=e[dn()](),a=t[dn()]();;){var i=r.next(),o=a.next();if(i.done&&o.done)return!0;if(i.done||o.done)return!1;if(!n(i.value,o.value))return!1}}(e,t,mn):!(n||!(e&&("object"==typeof e||"function"==typeof e))||r||!(t&&("object"==typeof t||"function"==typeof t)))||fn(e,t)}var vn=function(){function e(t){_classCallCheck(this,e),this.wrapped=t}return _createClass(e,null,[{key:"wrap",value:function(t){return new e(t)}},{key:"unwrap",value:function(t){return e.isWrapped(t)?t.wrapped:t}},{key:"isWrapped",value:function(t){return t instanceof e}}]),e}();function gn(e){return!!yn(e)&&(Array.isArray(e)||!(e instanceof Map)&&dn()in e)}function yn(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function bn(e){return!!e&&"function"==typeof e.then}function kn(e){return!!e&&"function"==typeof e.subscribe}var xn=function(){function e(t,n,r){_classCallCheck(this,e),this.previousValue=t,this.currentValue=n,this.firstChange=r}return _createClass(e,[{key:"isFirstChange",value:function(){return this.firstChange}}]),e}(),wn=function e(){_classCallCheck(this,e)};function Cn(e){var t=Error("No component factory found for ".concat(Ke(e),". Did you add it to @NgModule.entryComponents?"));return t[_n]=e,t}var _n="ngComponent",Sn=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"resolveComponentFactory",value:function(e){throw Cn(e)}}]),e}(),In=function(){var e=function e(){_classCallCheck(this,e)};return e.NULL=new Sn,e}(),Tn=function(){function e(t,n,r){_classCallCheck(this,e),this._parent=n,this._ngModule=r,this._factories=new Map;for(var a=0;a<t.length;a++){var i=t[a];this._factories.set(i.componentType,i)}}return _createClass(e,[{key:"resolveComponentFactory",value:function(e){var t=this._factories.get(e);if(!t&&this._parent&&(t=this._parent.resolveComponentFactory(e)),!t)throw Cn(e);return new Nn(t,this._ngModule)}}]),e}(),Nn=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this)).factory=e,a.ngModule=r,a.selector=e.selector,a.componentType=e.componentType,a.ngContentSelectors=e.ngContentSelectors,a.inputs=e.inputs,a.outputs=e.outputs,a}return _createClass(n,[{key:"create",value:function(e,t,n,r){return this.factory.create(e,t,n,r||this.ngModule)}}]),n}(wn);function An(){}var En=function(){var e=function e(t){_classCallCheck(this,e),this.nativeElement=t};return e.__NG_ELEMENT_ID__=function(){return Rn(e)},e}(),Rn=An,Fn=function e(){_classCallCheck(this,e)},Dn=function(){var e={Important:1,DashCase:2};return e[e.Important]="Important",e[e.DashCase]="DashCase",e}(),On=function(){var e=function e(){_classCallCheck(this,e)};return e.__NG_ELEMENT_ID__=function(){return Mn()},e}(),Mn=An,Pn=new function e(t){_classCallCheck(this,e),this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}("8.2.14"),Ln=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"supports",value:function(e){return gn(e)}},{key:"create",value:function(e){return new Bn(e)}}]),e}(),zn=function(e,t){return t},Bn=function(){function e(t){_classCallCheck(this,e),this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||zn}return _createClass(e,[{key:"forEachItem",value:function(e){var t;for(t=this._itHead;null!==t;t=t._next)e(t)}},{key:"forEachOperation",value:function(e){for(var t=this._itHead,n=this._removalsHead,r=0,a=null;t||n;){var i=!n||t&&t.currentIndex<Gn(n,r,a)?t:n,o=Gn(i,r,a),s=i.currentIndex;if(i===n)r--,n=n._nextRemoved;else if(t=t._next,null==i.previousIndex)r++;else{a||(a=[]);var u=o-r,c=s-r;if(u!=c){for(var l=0;l<u;l++){var h=l<a.length?a[l]:a[l]=0,p=h+l;c<=p&&p<u&&(a[l]=h+1)}a[i.previousIndex]=c-u}}o!==s&&e(i,o,s)}}},{key:"forEachPreviousItem",value:function(e){var t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}},{key:"forEachAddedItem",value:function(e){var t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}},{key:"forEachMovedItem",value:function(e){var t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}},{key:"forEachRemovedItem",value:function(e){var t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}},{key:"forEachIdentityChange",value:function(e){var t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}},{key:"diff",value:function(e){if(null==e&&(e=[]),!gn(e))throw new Error("Error trying to diff '".concat(Ke(e),"'. Only arrays and iterables are allowed"));return this.check(e)?this:null}},{key:"onDestroy",value:function(){}},{key:"check",value:function(e){var t=this;this._reset();var n,r,a,i=this._itHead,o=!1;if(Array.isArray(e)){this.length=e.length;for(var s=0;s<this.length;s++)r=e[s],a=this._trackByFn(s,r),null!==i&&fn(i.trackById,a)?(o&&(i=this._verifyReinsertion(i,r,a,s)),fn(i.item,r)||this._addIdentityChange(i,r)):(i=this._mismatch(i,r,a,s),o=!0),i=i._next}else n=0,function(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)t(e[n]);else for(var r,a=e[dn()]();!(r=a.next()).done;)t(r.value)}(e,(function(e){a=t._trackByFn(n,e),null!==i&&fn(i.trackById,a)?(o&&(i=t._verifyReinsertion(i,e,a,n)),fn(i.item,e)||t._addIdentityChange(i,e)):(i=t._mismatch(i,e,a,n),o=!0),i=i._next,n++})),this.length=n;return this._truncate(i),this.collection=e,this.isDirty}},{key:"_reset",value:function(){if(this.isDirty){var e,t;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=t)e.previousIndex=e.currentIndex,t=e._nextMoved;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}},{key:"_mismatch",value:function(e,t,n,r){var a;return null===e?a=this._itTail:(a=e._prev,this._remove(e)),null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(fn(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,a,r)):null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(fn(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,a,r)):e=this._addAfter(new Vn(t,n),a,r),e}},{key:"_verifyReinsertion",value:function(e,t,n,r){var a=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==a?e=this._reinsertAfter(a,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}},{key:"_truncate",value:function(e){for(;null!==e;){var t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}},{key:"_reinsertAfter",value:function(e,t,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);var r=e._prevRemoved,a=e._nextRemoved;return null===r?this._removalsHead=a:r._nextRemoved=a,null===a?this._removalsTail=r:a._prevRemoved=r,this._insertAfter(e,t,n),this._addToMoves(e,n),e}},{key:"_moveAfter",value:function(e,t,n){return this._unlink(e),this._insertAfter(e,t,n),this._addToMoves(e,n),e}},{key:"_addAfter",value:function(e,t,n){return this._insertAfter(e,t,n),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}},{key:"_insertAfter",value:function(e,t,n){var r=null===t?this._itHead:t._next;return e._next=r,e._prev=t,null===r?this._itTail=e:r._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new Wn),this._linkedRecords.put(e),e.currentIndex=n,e}},{key:"_remove",value:function(e){return this._addToRemovals(this._unlink(e))}},{key:"_unlink",value:function(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);var t=e._prev,n=e._next;return null===t?this._itHead=n:t._next=n,null===n?this._itTail=t:n._prev=t,e}},{key:"_addToMoves",value:function(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}},{key:"_addToRemovals",value:function(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Wn),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}},{key:"_addIdentityChange",value:function(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}},{key:"isDirty",get:function(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}}]),e}(),Vn=function e(t,n){_classCallCheck(this,e),this.item=t,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null},Un=function(){function e(){_classCallCheck(this,e),this._head=null,this._tail=null}return _createClass(e,[{key:"add",value:function(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}},{key:"get",value:function(e,t){var n;for(n=this._head;null!==n;n=n._nextDup)if((null===t||t<=n.currentIndex)&&fn(n.trackById,e))return n;return null}},{key:"remove",value:function(e){var t=e._prevDup,n=e._nextDup;return null===t?this._head=n:t._nextDup=n,null===n?this._tail=t:n._prevDup=t,null===this._head}}]),e}(),Wn=function(){function e(){_classCallCheck(this,e),this.map=new Map}return _createClass(e,[{key:"put",value:function(e){var t=e.trackById,n=this.map.get(t);n||(n=new Un,this.map.set(t,n)),n.add(e)}},{key:"get",value:function(e,t){var n=this.map.get(e);return n?n.get(e,t):null}},{key:"remove",value:function(e){var t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}},{key:"clear",value:function(){this.map.clear()}},{key:"isEmpty",get:function(){return 0===this.map.size}}]),e}();function Gn(e,t,n){var r=e.previousIndex;if(null===r)return r;var a=0;return n&&r<n.length&&(a=n[r]),r+t+a}var Hn=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"supports",value:function(e){return e instanceof Map||yn(e)}},{key:"create",value:function(){return new jn}}]),e}(),jn=function(){function e(){_classCallCheck(this,e),this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}return _createClass(e,[{key:"forEachItem",value:function(e){var t;for(t=this._mapHead;null!==t;t=t._next)e(t)}},{key:"forEachPreviousItem",value:function(e){var t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}},{key:"forEachChangedItem",value:function(e){var t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}},{key:"forEachAddedItem",value:function(e){var t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}},{key:"forEachRemovedItem",value:function(e){var t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}},{key:"diff",value:function(e){if(e){if(!(e instanceof Map||yn(e)))throw new Error("Error trying to diff '".concat(Ke(e),"'. Only maps and objects are allowed"))}else e=new Map;return this.check(e)?this:null}},{key:"onDestroy",value:function(){}},{key:"check",value:function(e){var t=this;this._reset();var n=this._mapHead;if(this._appendAfter=null,this._forEach(e,(function(e,r){if(n&&n.key===r)t._maybeAddToChanges(n,e),t._appendAfter=n,n=n._next;else{var a=t._getOrCreateRecordForKey(r,e);n=t._insertBeforeOrAppend(n,a)}})),n){n._prev&&(n._prev._next=null),this._removalsHead=n;for(var r=n;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}},{key:"_insertBeforeOrAppend",value:function(e,t){if(e){var n=e._prev;return t._next=e,t._prev=n,e._prev=t,n&&(n._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}},{key:"_getOrCreateRecordForKey",value:function(e,t){if(this._records.has(e)){var n=this._records.get(e);this._maybeAddToChanges(n,t);var r=n._prev,a=n._next;return r&&(r._next=a),a&&(a._prev=r),n._next=null,n._prev=null,n}var i=new qn(e);return this._records.set(e,i),i.currentValue=t,this._addToAdditions(i),i}},{key:"_reset",value:function(){if(this.isDirty){var e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}},{key:"_maybeAddToChanges",value:function(e,t){fn(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}},{key:"_addToAdditions",value:function(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}},{key:"_addToChanges",value:function(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}},{key:"_forEach",value:function(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach((function(n){return t(e[n],n)}))}},{key:"isDirty",get:function(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}}]),e}(),qn=function e(t){_classCallCheck(this,e),this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null},Kn=function(){var e=function(){function e(t){_classCallCheck(this,e),this.factories=t}return _createClass(e,[{key:"find",value:function(e){var t,n=this.factories.find((function(t){return t.supports(e)}));if(null!=n)return n;throw new Error("Cannot find a differ supporting object '".concat(e,"' of type '").concat((t=e).name||typeof t,"'"))}}],[{key:"create",value:function(t,n){if(null!=n){var r=n.factories.slice();t=t.concat(r)}return new e(t)}},{key:"extend",value:function(t){return{provide:e,useFactory:function(n){if(!n)throw new Error("Cannot extend IterableDiffers without a parent injector");return e.create(t,n)},deps:[[e,new Ue,new Be]]}}}]),e}();return e.ngInjectableDef=He({token:e,providedIn:"root",factory:function(){return new e([new Ln])}}),e}(),Xn=function(){var e=function(){function e(t){_classCallCheck(this,e),this.factories=t}return _createClass(e,[{key:"find",value:function(e){var t=this.factories.find((function(t){return t.supports(e)}));if(t)return t;throw new Error("Cannot find a differ supporting object '".concat(e,"'"))}}],[{key:"create",value:function(t,n){if(n){var r=n.factories.slice();t=t.concat(r)}return new e(t)}},{key:"extend",value:function(t){return{provide:e,useFactory:function(n){if(!n)throw new Error("Cannot extend KeyValueDiffers without a parent injector");return e.create(t,n)},deps:[[e,new Ue,new Be]]}}}]),e}();return e.ngInjectableDef=He({token:e,providedIn:"root",factory:function(){return new e([new Hn])}}),e}(),Yn=[new Hn],Zn=new Kn([new Ln]),Qn=new Xn(Yn),Jn=function(){var e=function e(){_classCallCheck(this,e)};return e.__NG_ELEMENT_ID__=function(){return $n(e,En)},e}(),$n=An,er=function(){var e=function e(){_classCallCheck(this,e)};return e.__NG_ELEMENT_ID__=function(){return tr(e,En)},e}(),tr=An;function nr(e,t,n,r){var a="ExpressionChangedAfterItHasBeenCheckedError: Expression has changed after it was checked. Previous value: '".concat(t,"'. Current value: '").concat(n,"'.");return r&&(a+=" It seems like the view has been created after its parent and its children have been dirty checked. Has it been created in a change detection hook ?"),function(e,t){var n=new Error(e);return rr(n,t),n}(a,e)}function rr(e,t){e.ngDebugContext=t,e.ngErrorLogger=t.logError.bind(t)}function ar(e){return new Error("ViewDestroyedError: Attempt to use a destroyed view: "+e)}function ir(e,t,n){var r=e.state,a=1792&r;return a===t?(e.state=-1793&r|n,e.initIndex=-1,!0):a===n}function or(e,t,n){return(1792&e.state)===t&&e.initIndex<=n&&(e.initIndex=n+1,!0)}function sr(e,t){return e.nodes[t]}function ur(e,t){return e.nodes[t]}function cr(e,t){return e.nodes[t]}function lr(e,t){return e.nodes[t]}function hr(e,t){return e.nodes[t]}var pr={setCurrentNode:void 0,createRootView:void 0,createEmbeddedView:void 0,createComponentView:void 0,createNgModuleRef:void 0,overrideProvider:void 0,overrideComponentView:void 0,clearOverrides:void 0,checkAndUpdateView:void 0,checkNoChangesView:void 0,destroyView:void 0,resolveDep:void 0,createDebugContext:void 0,handleEvent:void 0,updateDirectives:void 0,updateRenderer:void 0,dirtyParentQueries:void 0},dr=function(){},fr=new Map;function mr(e){var t=fr.get(e);return t||(t=Ke(e)+"_"+fr.size,fr.set(e,t)),t}function vr(e){return{id:"$$undefined",styles:e.styles,encapsulation:e.encapsulation,data:e.data}}var gr=0;function yr(e,t,n,r){return!(!(2&e.state)&&fn(e.oldValues[t.bindingIndex+n],r))}function br(e,t,n,r){return!!yr(e,t,n,r)&&(e.oldValues[t.bindingIndex+n]=r,!0)}function kr(e,t,n,r){var a=e.oldValues[t.bindingIndex+n];if(1&e.state||!mn(a,r)){var i=t.bindings[n].name;throw nr(pr.createDebugContext(e,t.nodeIndex),"".concat(i,": ").concat(a),"".concat(i,": ").concat(r),0!=(1&e.state))}}function xr(e){for(var t=e;t;)2&t.def.flags&&(t.state|=8),t=t.viewContainerParent||t.parent}function wr(e,t){for(var n=e;n&&n!==t;)n.state|=64,n=n.viewContainerParent||n.parent}function Cr(e,t,n,r){try{return xr(33554432&e.def.nodes[t].flags?ur(e,t).componentView:e),pr.handleEvent(e,t,n,r)}catch(a){e.root.errorHandler.handleError(a)}}function _r(e){return e.parent?ur(e.parent,e.parentNodeDef.nodeIndex):null}function Sr(e){return e.parent?e.parentNodeDef.parent:null}function Ir(e,t){switch(201347067&t.flags){case 1:return ur(e,t.nodeIndex).renderElement;case 2:return sr(e,t.nodeIndex).renderText}}function Tr(e){return!!e.parent&&!!(32768&e.parentNodeDef.flags)}function Nr(e){return!(!e.parent||32768&e.parentNodeDef.flags)}function Ar(e){var t={},n=0,r={};return e&&e.forEach((function(e){var a=_slicedToArray(e,2),i=a[0],o=a[1];"number"==typeof i?(t[i]=o,n|=function(e){return 1<<e%32}(i)):r[i]=o})),{matchedQueries:t,references:r,matchedQueryIds:n}}function Er(e,t){return e.map((function(e){var n,r,a;return Array.isArray(e)?(a=(n=_slicedToArray(e,2))[0],r=n[1]):(a=0,r=e),r&&("function"==typeof r||"object"==typeof r)&&t&&Object.defineProperty(r,"__source",{value:t,configurable:!0}),{flags:a,token:r,tokenKey:mr(r)}}))}function Rr(e,t,n){var r=n.renderParent;return r?0==(1&r.flags)||0==(33554432&r.flags)||r.element.componentRendererType&&r.element.componentRendererType.encapsulation===vt.Native?ur(e,n.renderParent.nodeIndex).renderElement:void 0:t}var Fr=new WeakMap;function Dr(e){var t=Fr.get(e);return t||((t=e((function(){return dr}))).factory=e,Fr.set(e,t)),t}function Or(e,t,n,r,a){3===t&&(n=e.renderer.parentNode(Ir(e,e.def.lastRenderRootNode))),Mr(e,t,0,e.def.nodes.length-1,n,r,a)}function Mr(e,t,n,r,a,i,o){for(var s=n;s<=r;s++){var u=e.def.nodes[s];11&u.flags&&Lr(e,u,t,a,i,o),s+=u.childCount}}function Pr(e,t,n,r,a,i){for(var o=e;o&&!Tr(o);)o=o.parent;for(var s=o.parent,u=Sr(o),c=u.nodeIndex+u.childCount,l=u.nodeIndex+1;l<=c;l++){var h=s.def.nodes[l];h.ngContentIndex===t&&Lr(s,h,n,r,a,i),l+=h.childCount}if(!s.parent){var p=e.root.projectableNodes[t];if(p)for(var d=0;d<p.length;d++)zr(e,p[d],n,r,a,i)}}function Lr(e,t,n,r,a,i){if(8&t.flags)Pr(e,t.ngContent.index,n,r,a,i);else{var o=Ir(e,t);if(3===n&&33554432&t.flags&&48&t.bindingFlags?(16&t.bindingFlags&&zr(e,o,n,r,a,i),32&t.bindingFlags&&zr(ur(e,t.nodeIndex).componentView,o,n,r,a,i)):zr(e,o,n,r,a,i),16777216&t.flags)for(var s=ur(e,t.nodeIndex).viewContainer._embeddedViews,u=0;u<s.length;u++)Or(s[u],n,r,a,i);1&t.flags&&!t.element.name&&Mr(e,n,t.nodeIndex+1,t.nodeIndex+t.childCount,r,a,i)}}function zr(e,t,n,r,a,i){var o=e.renderer;switch(n){case 1:o.appendChild(r,t);break;case 2:o.insertBefore(r,t,a);break;case 3:o.removeChild(r,t);break;case 0:i.push(t)}}var Br=/^:([^:]+):(.+)$/;function Vr(e){if(":"===e[0]){var t=e.match(Br);return[t[1],t[2]]}return["",e]}function Ur(e){for(var t=0,n=0;n<e.length;n++)t|=e[n].flags;return t}var Wr=new Object,Gr=mr(nn),Hr=mr(rt),jr=mr(pt);function qr(e,t,n,r){return n=Ze(n),{index:-1,deps:Er(r,Ke(t)),flags:e,token:t,value:n}}function Kr(e,t){var n,r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:nn.THROW_IF_NOT_FOUND,i=ut(e);try{if(8&t.flags)return t.token;if(2&t.flags&&(a=null),1&t.flags)return e._parent.get(t.token,a);var o=t.tokenKey;switch(o){case Gr:case Hr:case jr:return e}var s,u=e._def.providersByKey[o];if(u){var c=e._providers[u.index];return void 0===c&&(c=e._providers[u.index]=Xr(e,u)),c===Wr?void 0:c}if((s=je(t.token))&&(n=e,null!=(r=s).providedIn&&(function(e,t){return e._def.modules.indexOf(t)>-1}(n,r.providedIn)||"root"===r.providedIn&&n._def.isRoot))){var l=e._providers.length;return e._def.providers[l]=e._def.providersByKey[t.tokenKey]={flags:5120,value:s.factory,deps:[],index:l,token:t.token},e._providers[l]=Wr,e._providers[l]=Xr(e,e._def.providersByKey[t.tokenKey])}return 4&t.flags?a:e._parent.get(t.token,a)}finally{ut(i)}}function Xr(e,t){var n;switch(201347067&t.flags){case 512:n=function(e,t,n){var r=n.length;switch(r){case 0:return new t;case 1:return new t(Kr(e,n[0]));case 2:return new t(Kr(e,n[0]),Kr(e,n[1]));case 3:return new t(Kr(e,n[0]),Kr(e,n[1]),Kr(e,n[2]));default:for(var a=new Array(r),i=0;i<r;i++)a[i]=Kr(e,n[i]);return _construct(t,a)}}(e,t.value,t.deps);break;case 1024:n=function(e,t,n){var r=n.length;switch(r){case 0:return t();case 1:return t(Kr(e,n[0]));case 2:return t(Kr(e,n[0]),Kr(e,n[1]));case 3:return t(Kr(e,n[0]),Kr(e,n[1]),Kr(e,n[2]));default:for(var a=Array(r),i=0;i<r;i++)a[i]=Kr(e,n[i]);return t.apply(void 0,a)}}(e,t.value,t.deps);break;case 2048:n=Kr(e,t.deps[0]);break;case 256:n=t.value}return n===Wr||null===n||"object"!=typeof n||131072&t.flags||"function"!=typeof n.ngOnDestroy||(t.flags|=131072),void 0===n?Wr:n}function Yr(e,t){var n=e.viewContainer._embeddedViews;if((null==t||t>=n.length)&&(t=n.length-1),t<0)return null;var r=n[t];return r.viewContainerParent=null,mt(n,t),pr.dirtyParentQueries(r),Qr(r),r}function Zr(e,t,n){var r=t?Ir(t,t.def.lastRenderRootNode):e.renderElement,a=n.renderer.parentNode(r),i=n.renderer.nextSibling(r);Or(n,2,a,i,void 0)}function Qr(e){Or(e,3,null,null,void 0)}var Jr=new Object;function $r(e,t,n,r,a,i){return new ea(e,t,n,r,a,i)}var ea=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i,o,s){var u;return _classCallCheck(this,n),(u=t.call(this)).selector=e,u.componentType=r,u._inputs=i,u._outputs=o,u.ngContentSelectors=s,u.viewDefFactory=a,u}return _createClass(n,[{key:"create",value:function(e,t,n,r){if(!r)throw new Error("ngModule should be provided");var a=Dr(this.viewDefFactory),i=a.nodes[0].element.componentProvider.nodeIndex,o=pr.createRootView(e,t||[],n,a,r,Jr),s=cr(o,i).instance;return n&&o.renderer.setAttribute(ur(o,0).renderElement,"ng-version",Pn.full),new ta(o,new ia(o),s)}},{key:"inputs",get:function(){var e=[],t=this._inputs;for(var n in t)e.push({propName:n,templateName:t[n]});return e}},{key:"outputs",get:function(){var e=[];for(var t in this._outputs)e.push({propName:t,templateName:this._outputs[t]});return e}}]),n}(wn),ta=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck(this,n),(i=t.call(this))._view=e,i._viewRef=r,i._component=a,i._elDef=i._view.def.nodes[0],i.hostView=r,i.changeDetectorRef=r,i.instance=a,i}return _createClass(n,[{key:"destroy",value:function(){this._viewRef.destroy()}},{key:"onDestroy",value:function(e){this._viewRef.onDestroy(e)}},{key:"location",get:function(){return new En(ur(this._view,this._elDef.nodeIndex).renderElement)}},{key:"injector",get:function(){return new ca(this._view,this._elDef)}},{key:"componentType",get:function(){return this._component.constructor}}]),n}(function(){return function e(){_classCallCheck(this,e)}}());function na(e,t,n){return new ra(e,t,n)}var ra=function(){function e(t,n,r){_classCallCheck(this,e),this._view=t,this._elDef=n,this._data=r,this._embeddedViews=[]}return _createClass(e,[{key:"clear",value:function(){for(var e=this._embeddedViews.length-1;e>=0;e--){var t=Yr(this._data,e);pr.destroyView(t)}}},{key:"get",value:function(e){var t=this._embeddedViews[e];if(t){var n=new ia(t);return n.attachToViewContainerRef(this),n}return null}},{key:"createEmbeddedView",value:function(e,t,n){var r=e.createEmbeddedView(t||{});return this.insert(r,n),r}},{key:"createComponent",value:function(e,t,n,r,a){var i=n||this.parentInjector;a||e instanceof Nn||(a=i.get(pt));var o=e.create(i,r,void 0,a);return this.insert(o.hostView,t),o}},{key:"insert",value:function(e,t){if(e.destroyed)throw new Error("Cannot insert a destroyed View in a ViewContainer!");var n,r,a,i,o,s=e;return n=this._view,r=this._data,a=t,i=s._view,o=r.viewContainer._embeddedViews,null==a&&(a=o.length),i.viewContainerParent=n,ft(o,a,i),function(e,t){var n=_r(t);if(n&&n!==e&&!(16&t.state)){t.state|=16;var r=n.template._projectedViews;r||(r=n.template._projectedViews=[]),r.push(t),function(e,t){if(!(4&t.flags)){e.nodeFlags|=4,t.flags|=4;for(var n=t.parent;n;)n.childFlags|=4,n=n.parent}}(t.parent.def,t.parentNodeDef)}}(r,i),pr.dirtyParentQueries(i),Zr(r,a>0?o[a-1]:null,i),s.attachToViewContainerRef(this),e}},{key:"move",value:function(e,t){if(e.destroyed)throw new Error("Cannot move a destroyed View in a ViewContainer!");var n,r,a,i,o,s=this._embeddedViews.indexOf(e._view);return n=this._data,r=s,a=t,i=n.viewContainer._embeddedViews,o=i[r],mt(i,r),null==a&&(a=i.length),ft(i,a,o),pr.dirtyParentQueries(o),Qr(o),Zr(n,a>0?i[a-1]:null,o),e}},{key:"indexOf",value:function(e){return this._embeddedViews.indexOf(e._view)}},{key:"remove",value:function(e){var t=Yr(this._data,e);t&&pr.destroyView(t)}},{key:"detach",value:function(e){var t=Yr(this._data,e);return t?new ia(t):null}},{key:"element",get:function(){return new En(this._data.renderElement)}},{key:"injector",get:function(){return new ca(this._view,this._elDef)}},{key:"parentInjector",get:function(){for(var e=this._view,t=this._elDef.parent;!t&&e;)t=Sr(e),e=e.parent;return e?new ca(e,t):new ca(this._view,null)}},{key:"length",get:function(){return this._embeddedViews.length}}]),e}();function aa(e){return new ia(e)}var ia=function(){function e(t){_classCallCheck(this,e),this._view=t,this._viewContainerRef=null,this._appRef=null}return _createClass(e,[{key:"markForCheck",value:function(){xr(this._view)}},{key:"detach",value:function(){this._view.state&=-5}},{key:"detectChanges",value:function(){var e=this._view.root.rendererFactory;e.begin&&e.begin();try{pr.checkAndUpdateView(this._view)}finally{e.end&&e.end()}}},{key:"checkNoChanges",value:function(){pr.checkNoChangesView(this._view)}},{key:"reattach",value:function(){this._view.state|=4}},{key:"onDestroy",value:function(e){this._view.disposables||(this._view.disposables=[]),this._view.disposables.push(e)}},{key:"destroy",value:function(){this._appRef?this._appRef.detachView(this):this._viewContainerRef&&this._viewContainerRef.detach(this._viewContainerRef.indexOf(this)),pr.destroyView(this._view)}},{key:"detachFromAppRef",value:function(){this._appRef=null,Qr(this._view),pr.dirtyParentQueries(this._view)}},{key:"attachToAppRef",value:function(e){if(this._viewContainerRef)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}},{key:"attachToViewContainerRef",value:function(e){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._viewContainerRef=e}},{key:"rootNodes",get:function(){return Or(this._view,0,void 0,void 0,e=[]),e;var e}},{key:"context",get:function(){return this._view.context}},{key:"destroyed",get:function(){return 0!=(128&this._view.state)}}]),e}();function oa(e,t){return new sa(e,t)}var sa=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this))._parentView=e,a._def=r,a}return _createClass(n,[{key:"createEmbeddedView",value:function(e){return new ia(pr.createEmbeddedView(this._parentView,this._def,this._def.element.template,e))}},{key:"elementRef",get:function(){return new En(ur(this._parentView,this._def.nodeIndex).renderElement)}}]),n}(Jn);function ua(e,t){return new ca(e,t)}var ca=function(){function e(t,n){_classCallCheck(this,e),this.view=t,this.elDef=n}return _createClass(e,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nn.THROW_IF_NOT_FOUND;return pr.resolveDep(this.view,this.elDef,!!this.elDef&&0!=(33554432&this.elDef.flags),{flags:0,token:e,tokenKey:mr(e)},t)}}]),e}();function la(e,t){var n=e.def.nodes[t];if(1&n.flags){var r=ur(e,n.nodeIndex);return n.element.template?r.template:r.renderElement}if(2&n.flags)return sr(e,n.nodeIndex).renderText;if(20240&n.flags)return cr(e,n.nodeIndex).instance;throw new Error("Illegal state: read nodeValue for node index "+t)}function ha(e){return new pa(e.renderer)}var pa=function(){function e(t){_classCallCheck(this,e),this.delegate=t}return _createClass(e,[{key:"selectRootElement",value:function(e){return this.delegate.selectRootElement(e)}},{key:"createElement",value:function(e,t){var n=_slicedToArray(Vr(t),2),r=n[0],a=n[1],i=this.delegate.createElement(a,r);return e&&this.delegate.appendChild(e,i),i}},{key:"createViewRoot",value:function(e){return e}},{key:"createTemplateAnchor",value:function(e){var t=this.delegate.createComment("");return e&&this.delegate.appendChild(e,t),t}},{key:"createText",value:function(e,t){var n=this.delegate.createText(t);return e&&this.delegate.appendChild(e,n),n}},{key:"projectNodes",value:function(e,t){for(var n=0;n<t.length;n++)this.delegate.appendChild(e,t[n])}},{key:"attachViewAfter",value:function(e,t){for(var n=this.delegate.parentNode(e),r=this.delegate.nextSibling(e),a=0;a<t.length;a++)this.delegate.insertBefore(n,t[a],r)}},{key:"detachView",value:function(e){for(var t=0;t<e.length;t++){var n=e[t],r=this.delegate.parentNode(n);this.delegate.removeChild(r,n)}}},{key:"destroyView",value:function(e,t){for(var n=0;n<t.length;n++)this.delegate.destroyNode(t[n])}},{key:"listen",value:function(e,t,n){return this.delegate.listen(e,t,n)}},{key:"listenGlobal",value:function(e,t,n){return this.delegate.listen(e,t,n)}},{key:"setElementProperty",value:function(e,t,n){this.delegate.setProperty(e,t,n)}},{key:"setElementAttribute",value:function(e,t,n){var r=_slicedToArray(Vr(t),2),a=r[0],i=r[1];null!=n?this.delegate.setAttribute(e,i,n,a):this.delegate.removeAttribute(e,i,a)}},{key:"setBindingDebugInfo",value:function(e,t,n){}},{key:"setElementClass",value:function(e,t,n){n?this.delegate.addClass(e,t):this.delegate.removeClass(e,t)}},{key:"setElementStyle",value:function(e,t,n){null!=n?this.delegate.setStyle(e,t,n):this.delegate.removeStyle(e,t)}},{key:"invokeElementMethod",value:function(e,t,n){e[t].apply(e,n)}},{key:"setText",value:function(e,t){this.delegate.setValue(e,t)}},{key:"animate",value:function(){throw new Error("Renderer.animate is no longer supported!")}}]),e}();function da(e,t,n,r){return new fa(e,t,n,r)}var fa=function(){function e(t,n,r,a){_classCallCheck(this,e),this._moduleType=t,this._parent=n,this._bootstrapComponents=r,this._def=a,this._destroyListeners=[],this._destroyed=!1,this.injector=this,function(e){for(var t=e._def,n=e._providers=new Array(t.providers.length),r=0;r<t.providers.length;r++){var a=t.providers[r];4096&a.flags||void 0===n[r]&&(n[r]=Xr(e,a))}}(this)}return _createClass(e,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nn.THROW_IF_NOT_FOUND,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:We.Default,r=0;return n&We.SkipSelf?r|=1:n&We.Self&&(r|=4),Kr(this,{token:e,tokenKey:mr(e),flags:r},t)}},{key:"destroy",value:function(){if(this._destroyed)throw new Error("The ng module ".concat(Ke(this.instance.constructor)," has already been destroyed."));this._destroyed=!0,function(e,t){for(var n=e._def,r=new Set,a=0;a<n.providers.length;a++)if(131072&n.providers[a].flags){var i=e._providers[a];if(i&&i!==Wr){var o=i.ngOnDestroy;"function"!=typeof o||r.has(i)||(o.apply(i),r.add(i))}}}(this),this._destroyListeners.forEach((function(e){return e()}))}},{key:"onDestroy",value:function(e){this._destroyListeners.push(e)}},{key:"instance",get:function(){return this.get(this._moduleType)}},{key:"componentFactoryResolver",get:function(){return this.get(In)}}]),e}(),ma=mr((function e(){_classCallCheck(this,e)})),va=mr(On),ga=mr(En),ya=mr(er),ba=mr(Jn),ka=mr(Jt),xa=mr(nn),wa=mr(rt);function Ca(e,t,n,r,a,i,o,s){var u=[];if(o)for(var c in o){var l=_slicedToArray(o[c],2),h=l[0],p=l[1];u[h]={flags:8,name:c,nonMinifiedName:p,ns:null,securityContext:null,suffix:null}}var d=[];if(s)for(var f in s)d.push({type:1,propName:f,target:null,eventName:s[f]});return Sa(e,t|=16384,n,r,a,a,i,u,d)}function _a(e,t,n,r,a){return Sa(-1,e,t,0,n,r,a)}function Sa(e,t,n,r,a,i,o,s,u){var c=Ar(n),l=c.matchedQueries,h=c.references,p=c.matchedQueryIds;u||(u=[]),s||(s=[]),i=Ze(i);var d=Er(o,Ke(a));return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:e,flags:t,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:l,matchedQueryIds:p,references:h,ngContentIndex:-1,childCount:r,bindings:s,bindingFlags:Ur(s),outputs:u,element:null,provider:{token:a,value:i,deps:d},text:null,query:null,ngContent:null}}function Ia(e,t){return Ea(e,t)}function Ta(e,t){for(var n=e;n.parent&&!Tr(n);)n=n.parent;return Ra(n.parent,Sr(n),!0,t.provider.value,t.provider.deps)}function Na(e,t){var n=Ra(e,t.parent,(32768&t.flags)>0,t.provider.value,t.provider.deps);if(t.outputs.length)for(var r=0;r<t.outputs.length;r++){var a=t.outputs[r],i=n[a.propName];if(!kn(i))throw new Error("@Output ".concat(a.propName," not initialized in '").concat(n.constructor.name,"'."));var o=i.subscribe(Aa(e,t.parent.nodeIndex,a.eventName));e.disposables[t.outputIndex+r]=o.unsubscribe.bind(o)}return n}function Aa(e,t,n){return function(r){return Cr(e,t,n,r)}}function Ea(e,t){var n=(8192&t.flags)>0,r=t.provider;switch(201347067&t.flags){case 512:return Ra(e,t.parent,n,r.value,r.deps);case 1024:return function(e,t,n,r,a){var i=a.length;switch(i){case 0:return r();case 1:return r(Da(e,t,n,a[0]));case 2:return r(Da(e,t,n,a[0]),Da(e,t,n,a[1]));case 3:return r(Da(e,t,n,a[0]),Da(e,t,n,a[1]),Da(e,t,n,a[2]));default:for(var o=Array(i),s=0;s<i;s++)o[s]=Da(e,t,n,a[s]);return r.apply(void 0,o)}}(e,t.parent,n,r.value,r.deps);case 2048:return Da(e,t.parent,n,r.deps[0]);case 256:return r.value}}function Ra(e,t,n,r,a){var i=a.length;switch(i){case 0:return new r;case 1:return new r(Da(e,t,n,a[0]));case 2:return new r(Da(e,t,n,a[0]),Da(e,t,n,a[1]));case 3:return new r(Da(e,t,n,a[0]),Da(e,t,n,a[1]),Da(e,t,n,a[2]));default:for(var o=new Array(i),s=0;s<i;s++)o[s]=Da(e,t,n,a[s]);return _construct(r,o)}}var Fa={};function Da(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:nn.THROW_IF_NOT_FOUND;if(8&r.flags)return r.token;var i=e;2&r.flags&&(a=null);var o=r.tokenKey;o===ka&&(n=!(!t||!t.element.componentView)),t&&1&r.flags&&(n=!1,t=t.parent);for(var s=e;s;){if(t)switch(o){case ma:return ha(Oa(s,t,n));case va:return Oa(s,t,n).renderer;case ga:return new En(ur(s,t.nodeIndex).renderElement);case ya:return ur(s,t.nodeIndex).viewContainer;case ba:if(t.element.template)return ur(s,t.nodeIndex).template;break;case ka:return aa(Oa(s,t,n));case xa:case wa:return ua(s,t);default:var u=(n?t.element.allProviders:t.element.publicProviders)[o];if(u){var c=cr(s,u.nodeIndex);return c||(c={instance:Ea(s,u)},s.nodes[u.nodeIndex]=c),c.instance}}n=Tr(s),t=Sr(s),s=s.parent,4&r.flags&&(s=null)}var l=i.root.injector.get(r.token,Fa);return l!==Fa||a===Fa?l:i.root.ngModule.injector.get(r.token,a)}function Oa(e,t,n){var r;if(n)r=ur(e,t.nodeIndex).componentView;else for(r=e;r.parent&&!Tr(r);)r=r.parent;return r}function Ma(e,t,n,r,a,i){if(32768&n.flags){var o=ur(e,n.parent.nodeIndex).componentView;2&o.def.flags&&(o.state|=8)}if(t.instance[n.bindings[r].name]=a,524288&n.flags){i=i||{};var s=vn.unwrap(e.oldValues[n.bindingIndex+r]);i[n.bindings[r].nonMinifiedName]=new xn(s,a,0!=(2&e.state))}return e.oldValues[n.bindingIndex+r]=a,i}function Pa(e,t){if(e.def.nodeFlags&t)for(var n=e.def.nodes,r=0,a=0;a<n.length;a++){var i=n[a],o=i.parent;for(!o&&i.flags&t&&za(e,a,i.flags&t,r++),0==(i.childFlags&t)&&(a+=i.childCount);o&&1&o.flags&&a===o.nodeIndex+o.childCount;)o.directChildFlags&t&&(r=La(e,o,t,r)),o=o.parent}}function La(e,t,n,r){for(var a=t.nodeIndex+1;a<=t.nodeIndex+t.childCount;a++){var i=e.def.nodes[a];i.flags&n&&za(e,a,i.flags&n,r++),a+=i.childCount}return r}function za(e,t,n,r){var a=cr(e,t);if(a){var i=a.instance;i&&(pr.setCurrentNode(e,t),1048576&n&&or(e,512,r)&&i.ngAfterContentInit(),2097152&n&&i.ngAfterContentChecked(),4194304&n&&or(e,768,r)&&i.ngAfterViewInit(),8388608&n&&i.ngAfterViewChecked(),131072&n&&i.ngOnDestroy())}}var Ba=new nt("SCHEDULER_TOKEN",{providedIn:"root",factory:function(){return gt}}),Va={},Ua=function(){var e={LocaleId:0,DayPeriodsFormat:1,DayPeriodsStandalone:2,DaysFormat:3,DaysStandalone:4,MonthsFormat:5,MonthsStandalone:6,Eras:7,FirstDayOfWeek:8,WeekendRange:9,DateFormat:10,TimeFormat:11,DateTimeFormat:12,NumberSymbols:13,NumberFormats:14,CurrencySymbol:15,CurrencyName:16,Currencies:17,PluralCase:18,ExtraData:19};return e[e.LocaleId]="LocaleId",e[e.DayPeriodsFormat]="DayPeriodsFormat",e[e.DayPeriodsStandalone]="DayPeriodsStandalone",e[e.DaysFormat]="DaysFormat",e[e.DaysStandalone]="DaysStandalone",e[e.MonthsFormat]="MonthsFormat",e[e.MonthsStandalone]="MonthsStandalone",e[e.Eras]="Eras",e[e.FirstDayOfWeek]="FirstDayOfWeek",e[e.WeekendRange]="WeekendRange",e[e.DateFormat]="DateFormat",e[e.TimeFormat]="TimeFormat",e[e.DateTimeFormat]="DateTimeFormat",e[e.NumberSymbols]="NumberSymbols",e[e.NumberFormats]="NumberFormats",e[e.CurrencySymbol]="CurrencySymbol",e[e.CurrencyName]="CurrencyName",e[e.Currencies]="Currencies",e[e.PluralCase]="PluralCase",e[e.ExtraData]="ExtraData",e}(),Wa=void 0,Ga=["en",[["a","p"],["AM","PM"],Wa],[["AM","PM"],Wa,Wa],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Wa,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Wa,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Wa,"{1} 'at' {0}",Wa],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"$","US Dollar",{},function(e){var t=Math.floor(Math.abs(e)),n=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===n?1:5}],Ha=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return _classCallCheck(this,n),(e=t.call(this)).__isAsync=r,e}return _createClass(n,[{key:"emit",value:function(e){_get(_getPrototypeOf(n.prototype),"next",this).call(this,e)}},{key:"subscribe",value:function(e,t,r){var a,i=function(e){return null},o=function(){return null};e&&"object"==typeof e?(a=this.__isAsync?function(t){setTimeout((function(){return e.next(t)}))}:function(t){e.next(t)},e.error&&(i=this.__isAsync?function(t){setTimeout((function(){return e.error(t)}))}:function(t){e.error(t)}),e.complete&&(o=this.__isAsync?function(){setTimeout((function(){return e.complete()}))}:function(){e.complete()})):(a=this.__isAsync?function(t){setTimeout((function(){return e(t)}))}:function(t){e(t)},t&&(i=this.__isAsync?function(e){setTimeout((function(){return t(e)}))}:function(e){t(e)}),r&&(o=this.__isAsync?function(){setTimeout((function(){return r()}))}:function(){r()}));var s=_get(_getPrototypeOf(n.prototype),"subscribe",this).call(this,a,i,o);return e instanceof K&&e.add(s),s}}]),n}(ce);function ja(){return this._results[dn()]()}var qa=function(){function e(){_classCallCheck(this,e),this.dirty=!0,this._results=[],this.changes=new Ha,this.length=0;var t=dn(),n=e.prototype;n[t]||(n[t]=ja)}return _createClass(e,[{key:"map",value:function(e){return this._results.map(e)}},{key:"filter",value:function(e){return this._results.filter(e)}},{key:"find",value:function(e){return this._results.find(e)}},{key:"reduce",value:function(e,t){return this._results.reduce(e,t)}},{key:"forEach",value:function(e){this._results.forEach(e)}},{key:"some",value:function(e){return this._results.some(e)}},{key:"toArray",value:function(){return this._results.slice()}},{key:"toString",value:function(){return this._results.toString()}},{key:"reset",value:function(e){this._results=function e(t,n){void 0===n&&(n=t);for(var r=0;r<t.length;r++){var a=t[r];Array.isArray(a)?(n===t&&(n=t.slice(0,r)),e(a,n)):n!==t&&n.push(a)}return n}(e),this.dirty=!1,this.length=this._results.length,this.last=this._results[this.length-1],this.first=this._results[0]}},{key:"notifyOnChanges",value:function(){this.changes.emit(this)}},{key:"setDirty",value:function(){this.dirty=!0}},{key:"destroy",value:function(){this.changes.complete(),this.changes.unsubscribe()}}]),e}(),Ka=new nt("Application Initializer"),Xa=function(){function e(t){var n=this;_classCallCheck(this,e),this.appInits=t,this.initialized=!1,this.done=!1,this.donePromise=new Promise((function(e,t){n.resolve=e,n.reject=t}))}return _createClass(e,[{key:"runInitializers",value:function(){var e=this;if(!this.initialized){var t=[],n=function(){e.done=!0,e.resolve()};if(this.appInits)for(var r=0;r<this.appInits.length;r++){var a=this.appInits[r]();bn(a)&&t.push(a)}Promise.all(t).then((function(){n()})).catch((function(t){e.reject(t)})),0===t.length&&n(),this.initialized=!0}}}]),e}(),Ya=new nt("AppId");function Za(){return"".concat(Qa()).concat(Qa()).concat(Qa())}function Qa(){return String.fromCharCode(97+Math.floor(25*Math.random()))}var Ja=new nt("Platform Initializer"),$a=new nt("Platform ID"),ei=new nt("appBootstrapListener"),ti=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"log",value:function(e){console.log(e)}},{key:"warn",value:function(e){console.warn(e)}}]),e}(),ni=new nt("LocaleId");function ri(){throw new Error("Runtime compiler is not loaded")}var ai,ii,oi=ri,si=ri,ui=ri,ci=ri,li=function(){function e(){_classCallCheck(this,e),this.compileModuleSync=oi,this.compileModuleAsync=si,this.compileModuleAndAllComponentsSync=ui,this.compileModuleAndAllComponentsAsync=ci}return _createClass(e,[{key:"clearCache",value:function(){}},{key:"clearCacheFor",value:function(e){}},{key:"getModuleId",value:function(e){}}]),e}(),hi=function e(){_classCallCheck(this,e)};var pi,di=!(!(pi=tt.wtf)||(ai=pi.trace,!ai)||(ii=ai.events,0));function fi(e,t){return null}var mi=di?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return ii.createScope(e,t)}:function(e,t){return fi},vi=di?function(e,t){return ai.leaveScope(e,t),t}:function(e,t){return t},gi=Promise.resolve(0);function yi(e){"undefined"==typeof Zone?gi.then((function(){e&&e.apply(null,null)})):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}var bi=function(){function e(t){var n,r=t.enableLongStackTrace,a=void 0!==r&&r;if(_classCallCheck(this,e),this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Ha(!1),this.onMicrotaskEmpty=new Ha(!1),this.onStable=new Ha(!1),this.onError=new Ha(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched(),this._nesting=0,this._outer=this._inner=Zone.current,Zone.wtfZoneSpec&&(this._inner=this._inner.fork(Zone.wtfZoneSpec)),Zone.TaskTrackingZoneSpec&&(this._inner=this._inner.fork(new Zone.TaskTrackingZoneSpec)),a&&Zone.longStackTraceZoneSpec&&(this._inner=this._inner.fork(Zone.longStackTraceZoneSpec)),(n=this)._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:function(e,t,r,a,i,o){try{return Ci(n),e.invokeTask(r,a,i,o)}finally{_i(n)}},onInvoke:function(e,t,r,a,i,o,s){try{return Ci(n),e.invoke(r,a,i,o,s)}finally{_i(n)}},onHasTask:function(e,t,r,a){e.hasTask(r,a),t===r&&("microTask"==a.change?(n.hasPendingMicrotasks=a.microTask,wi(n)):"macroTask"==a.change&&(n.hasPendingMacrotasks=a.macroTask))},onHandleError:function(e,t,r,a){return e.handleError(r,a),n.runOutsideAngular((function(){return n.onError.emit(a)})),!1}})}return _createClass(e,[{key:"run",value:function(e,t,n){return this._inner.run(e,t,n)}},{key:"runTask",value:function(e,t,n,r){var a=this._inner,i=a.scheduleEventTask("NgZoneEvent: "+r,e,xi,ki,ki);try{return a.runTask(i,t,n)}finally{a.cancelTask(i)}}},{key:"runGuarded",value:function(e,t,n){return this._inner.runGuarded(e,t,n)}},{key:"runOutsideAngular",value:function(e){return this._outer.run(e)}}],[{key:"isInAngularZone",value:function(){return!0===Zone.current.get("isAngularZone")}},{key:"assertInAngularZone",value:function(){if(!e.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}},{key:"assertNotInAngularZone",value:function(){if(e.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}}]),e}();function ki(){}var xi={};function wi(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular((function(){return e.onStable.emit(null)}))}finally{e.isStable=!0}}}function Ci(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function _i(e){e._nesting--,wi(e)}var Si,Ii=function(){function e(){_classCallCheck(this,e),this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Ha,this.onMicrotaskEmpty=new Ha,this.onStable=new Ha,this.onError=new Ha}return _createClass(e,[{key:"run",value:function(e){return e()}},{key:"runGuarded",value:function(e){return e()}},{key:"runOutsideAngular",value:function(e){return e()}},{key:"runTask",value:function(e){return e()}}]),e}(),Ti=function(){function e(t){var n=this;_classCallCheck(this,e),this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run((function(){n.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")}))}return _createClass(e,[{key:"_watchAngularEvents",value:function(){var e=this;this._ngZone.onUnstable.subscribe({next:function(){e._didWork=!0,e._isZoneStable=!1}}),this._ngZone.runOutsideAngular((function(){e._ngZone.onStable.subscribe({next:function(){bi.assertNotInAngularZone(),yi((function(){e._isZoneStable=!0,e._runCallbacksIfReady()}))}})}))}},{key:"increasePendingRequestCount",value:function(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}},{key:"decreasePendingRequestCount",value:function(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}},{key:"isStable",value:function(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}},{key:"_runCallbacksIfReady",value:function(){var e=this;if(this.isStable())yi((function(){for(;0!==e._callbacks.length;){var t=e._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(e._didWork)}e._didWork=!1}));else{var t=this.getPendingTasks();this._callbacks=this._callbacks.filter((function(e){return!e.updateCb||!e.updateCb(t)||(clearTimeout(e.timeoutId),!1)})),this._didWork=!0}}},{key:"getPendingTasks",value:function(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map((function(e){return{source:e.source,creationLocation:e.creationLocation,data:e.data}})):[]}},{key:"addCallback",value:function(e,t,n){var r=this,a=-1;t&&t>0&&(a=setTimeout((function(){r._callbacks=r._callbacks.filter((function(e){return e.timeoutId!==a})),e(r._didWork,r.getPendingTasks())}),t)),this._callbacks.push({doneCb:e,timeoutId:a,updateCb:n})}},{key:"whenStable",value:function(e,t,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/dist/task-tracking.js" loaded?');this.addCallback(e,t,n),this._runCallbacksIfReady()}},{key:"getPendingRequestCount",value:function(){return this._pendingCount}},{key:"findProviders",value:function(e,t,n){return[]}}]),e}(),Ni=function(){function e(){_classCallCheck(this,e),this._applications=new Map,Ai.addToWindow(this)}return _createClass(e,[{key:"registerApplication",value:function(e,t){this._applications.set(e,t)}},{key:"unregisterApplication",value:function(e){this._applications.delete(e)}},{key:"unregisterAllApplications",value:function(){this._applications.clear()}},{key:"getTestability",value:function(e){return this._applications.get(e)||null}},{key:"getAllTestabilities",value:function(){return Array.from(this._applications.values())}},{key:"getAllRootElements",value:function(){return Array.from(this._applications.keys())}},{key:"findTestabilityInTree",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Ai.findTestabilityInTree(this,e,t)}}]),e}(),Ai=new(function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"addToWindow",value:function(e){}},{key:"findTestabilityInTree",value:function(e,t,n){return null}}]),e}()),Ei=new nt("AllowMultipleToken"),Ri=function e(t,n){_classCallCheck(this,e),this.name=t,this.token=n};function Fi(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r="Platform: "+t,a=new nt(r);return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=Di();if(!i||i.injector.get(Ei,!1))if(e)e(n.concat(t).concat({provide:a,useValue:!0}));else{var o=n.concat(t).concat({provide:a,useValue:!0});!function(e){if(Si&&!Si.destroyed&&!Si.injector.get(Ei,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");Si=e.get(Oi);var t=e.get(Ja,null);t&&t.forEach((function(e){return e()}))}(nn.create({providers:o,name:r}))}return function(e){var t=Di();if(!t)throw new Error("No platform exists!");if(!t.injector.get(e,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return t}(a)}}function Di(){return Si&&!Si.destroyed?Si:null}var Oi=function(){function e(t){_classCallCheck(this,e),this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}return _createClass(e,[{key:"bootstrapModuleFactory",value:function(e,t){var n,r=this,a="noop"===(n=t?t.ngZone:void 0)?new Ii:("zone.js"===n?void 0:n)||new bi({enableLongStackTrace:_t()}),i=[{provide:bi,useValue:a}];return a.run((function(){var t=nn.create({providers:i,parent:r.injector,name:e.moduleType.name}),n=e.create(t),o=n.injector.get(xt,null);if(!o)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return n.onDestroy((function(){return zi(r._modules,n)})),a.runOutsideAngular((function(){return a.onError.subscribe({next:function(e){o.handleError(e)}})})),function(e,t,a){try{var i=((o=n.injector.get(Xa)).runInitializers(),o.donePromise.then((function(){return r._moduleDoBootstrap(n),n})));return bn(i)?i.catch((function(n){throw t.runOutsideAngular((function(){return e.handleError(n)})),n})):i}catch(s){throw t.runOutsideAngular((function(){return e.handleError(s)})),s}var o}(o,a)}))}},{key:"bootstrapModule",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=Mi({},n);return function(e,t,n){return e.get(hi).createCompiler([t]).compileModuleAsync(n)}(this.injector,r,e).then((function(e){return t.bootstrapModuleFactory(e,r)}))}},{key:"_moduleDoBootstrap",value:function(e){var t=e.injector.get(Li);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach((function(e){return t.bootstrap(e)}));else{if(!e.instance.ngDoBootstrap)throw new Error("The module ".concat(Ke(e.instance.constructor),' was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.'));e.instance.ngDoBootstrap(t)}this._modules.push(e)}},{key:"onDestroy",value:function(e){this._destroyListeners.push(e)}},{key:"destroy",value:function(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach((function(e){return e.destroy()})),this._destroyListeners.forEach((function(e){return e()})),this._destroyed=!0}},{key:"injector",get:function(){return this._injector}},{key:"destroyed",get:function(){return this._destroyed}}]),e}();function Mi(e,t){return Array.isArray(t)?t.reduce(Mi,e):Object.assign({},e,t)}var Pi,Li=((Pi=function(){function e(t,n,r,a,i,o){var s=this;_classCallCheck(this,e),this._zone=t,this._console=n,this._injector=r,this._exceptionHandler=a,this._componentFactoryResolver=i,this._initStatus=o,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._enforceNoNewChanges=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._enforceNoNewChanges=_t(),this._zone.onMicrotaskEmpty.subscribe({next:function(){s._zone.run((function(){s.tick()}))}});var u=new re((function(e){s._stable=s._zone.isStable&&!s._zone.hasPendingMacrotasks&&!s._zone.hasPendingMicrotasks,s._zone.runOutsideAngular((function(){e.next(s._stable),e.complete()}))})),c=new re((function(e){var t;s._zone.runOutsideAngular((function(){t=s._zone.onStable.subscribe((function(){bi.assertNotInAngularZone(),yi((function(){s._stable||s._zone.hasPendingMacrotasks||s._zone.hasPendingMicrotasks||(s._stable=!0,e.next(!0))}))}))}));var n=s._zone.onUnstable.subscribe((function(){bi.assertInAngularZone(),s._stable&&(s._stable=!1,s._zone.runOutsideAngular((function(){e.next(!1)})))}));return function(){t.unsubscribe(),n.unsubscribe()}}));this.isStable=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=Number.POSITIVE_INFINITY,a=null,i=t[t.length-1];return he(i)?(a=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(r=t.pop())):"number"==typeof i&&(r=t.pop()),null===a&&1===t.length&&t[0]instanceof re?t[0]:Ne(r)(Ae(t,a))}(u,c.pipe((function(e){return Ee()((t=Pe,function(e){var n;n="function"==typeof t?t:function(){return t};var r=Object.create(e,Oe);return r.source=e,r.subjectFactory=n,r})(e));var t})))}return _createClass(e,[{key:"bootstrap",value:function(e,t){var n,r=this;if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");n=e instanceof wn?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(n.componentType);var a=n instanceof Nn?null:this._injector.get(pt),i=n.create(nn.NULL,[],t||n.selector,a);i.onDestroy((function(){r._unloadComponent(i)}));var o=i.injector.get(Ti,null);return o&&i.injector.get(Ni).registerApplication(i.location.nativeElement,o),this._loadComponent(i),_t()&&this._console.log("Angular is running in the development mode. Call enableProdMode() to enable the production mode."),i}},{key:"tick",value:function(){var t=this;if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");var n=e._tickScope();try{this._runningTick=!0;var r,a=_createForOfIteratorHelper(this._views);try{for(a.s();!(r=a.n()).done;)r.value.detectChanges()}catch(s){a.e(s)}finally{a.f()}if(this._enforceNoNewChanges){var i,o=_createForOfIteratorHelper(this._views);try{for(o.s();!(i=o.n()).done;)i.value.checkNoChanges()}catch(s){o.e(s)}finally{o.f()}}}catch(u){this._zone.runOutsideAngular((function(){return t._exceptionHandler.handleError(u)}))}finally{this._runningTick=!1,vi(n)}}},{key:"attachView",value:function(e){var t=e;this._views.push(t),t.attachToAppRef(this)}},{key:"detachView",value:function(e){var t=e;zi(this._views,t),t.detachFromAppRef()}},{key:"_loadComponent",value:function(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(ei,[]).concat(this._bootstrapListeners).forEach((function(t){return t(e)}))}},{key:"_unloadComponent",value:function(e){this.detachView(e.hostView),zi(this.components,e)}},{key:"ngOnDestroy",value:function(){this._views.slice().forEach((function(e){return e.destroy()}))}},{key:"viewCount",get:function(){return this._views.length}}]),e}())._tickScope=mi("ApplicationRef#tick()"),Pi);function zi(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}var Bi=function e(){_classCallCheck(this,e)},Vi=function e(){_classCallCheck(this,e)},Ui={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"},Wi=function(){function e(t,n){_classCallCheck(this,e),this._compiler=t,this._config=n||Ui}return _createClass(e,[{key:"load",value:function(e){return this._compiler instanceof li?this.loadFactory(e):this.loadAndCompile(e)}},{key:"loadAndCompile",value:function(e){var t=this,r=_slicedToArray(e.split("#"),2),a=r[0],i=r[1];return void 0===i&&(i="default"),n("zn8P")(a).then((function(e){return e[i]})).then((function(e){return Gi(e,a,i)})).then((function(e){return t._compiler.compileModuleAsync(e)}))}},{key:"loadFactory",value:function(e){var t=_slicedToArray(e.split("#"),2),r=t[0],a=t[1],i="NgFactory";return void 0===a&&(a="default",i=""),n("zn8P")(this._config.factoryPathPrefix+r+this._config.factoryPathSuffix).then((function(e){return e[a+i]})).then((function(e){return Gi(e,r,a)}))}}]),e}();function Gi(e,t,n){if(!e)throw new Error("Cannot find '".concat(n,"' in '").concat(t,"'"));return e}var Hi=function e(t,n){_classCallCheck(this,e),this.name=t,this.callback=n},ji=function(){function e(t,n,r){_classCallCheck(this,e),this.listeners=[],this.parent=null,this._debugContext=r,this.nativeNode=t,n&&n instanceof qi&&n.addChild(this)}return _createClass(e,[{key:"injector",get:function(){return this._debugContext.injector}},{key:"componentInstance",get:function(){return this._debugContext.component}},{key:"context",get:function(){return this._debugContext.context}},{key:"references",get:function(){return this._debugContext.references}},{key:"providerTokens",get:function(){return this._debugContext.providerTokens}}]),e}(),qi=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck(this,n),(i=t.call(this,e,r,a)).properties={},i.attributes={},i.classes={},i.styles={},i.childNodes=[],i.nativeElement=e,i}return _createClass(n,[{key:"addChild",value:function(e){e&&(this.childNodes.push(e),e.parent=this)}},{key:"removeChild",value:function(e){var t=this.childNodes.indexOf(e);-1!==t&&(e.parent=null,this.childNodes.splice(t,1))}},{key:"insertChildrenAfter",value:function(e,t){var n,r=this,a=this.childNodes.indexOf(e);-1!==a&&((n=this.childNodes).splice.apply(n,[a+1,0].concat(_toConsumableArray(t))),t.forEach((function(t){t.parent&&t.parent.removeChild(t),e.parent=r})))}},{key:"insertBefore",value:function(e,t){var n=this.childNodes.indexOf(e);-1===n?this.addChild(t):(t.parent&&t.parent.removeChild(t),t.parent=this,this.childNodes.splice(n,0,t))}},{key:"query",value:function(e){return this.queryAll(e)[0]||null}},{key:"queryAll",value:function(e){var t=[];return function e(t,r,a){t.childNodes.forEach((function(t){t instanceof n&&(r(t)&&a.push(t),e(t,r,a))}))}(this,e,t),t}},{key:"queryAllNodes",value:function(e){var t=[];return function e(t,r,a){t instanceof n&&t.childNodes.forEach((function(t){r(t)&&a.push(t),t instanceof n&&e(t,r,a)}))}(this,e,t),t}},{key:"triggerEventHandler",value:function(e,t){this.listeners.forEach((function(n){n.name==e&&n.callback(t)}))}},{key:"children",get:function(){return this.childNodes.filter((function(e){return e instanceof n}))}}]),n}(ji),Ki=new Map,Xi=function(e){return Ki.get(e)||null};function Yi(e){Ki.set(e.nativeNode,e)}var Zi=Fi(null,"core",[{provide:$a,useValue:"unknown"},{provide:Oi,deps:[nn]},{provide:Ni,deps:[]},{provide:ti,deps:[]}]);function Qi(){return Zn}function Ji(){return Qn}function $i(e){return e||"en-US"}function eo(e){var t=[];return e.onStable.subscribe((function(){for(;t.length;)t.pop()()})),function(e){t.push(e)}}var to=function e(t){_classCallCheck(this,e)};function no(e,t,n,r,a,i){e|=1;var o=Ar(t),s=o.matchedQueries,u=o.references;return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,flags:e,checkIndex:-1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:s,matchedQueryIds:o.matchedQueryIds,references:u,ngContentIndex:n,childCount:r,bindings:[],bindingFlags:0,outputs:[],element:{ns:null,name:null,attrs:null,template:i?Dr(i):null,componentProvider:null,componentView:null,componentRendererType:null,publicProviders:null,allProviders:null,handleEvent:a||dr},provider:null,text:null,query:null,ngContent:null}}function ro(e,t,n,r,a,i){var o,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],u=arguments.length>7?arguments[7]:void 0,c=arguments.length>8?arguments[8]:void 0,l=arguments.length>9?arguments[9]:void 0,h=arguments.length>10?arguments[10]:void 0,p=arguments.length>11?arguments[11]:void 0;l||(l=dr);var d=Ar(n),f=d.matchedQueries,m=d.references,v=d.matchedQueryIds,g=null,y=null;i&&(g=(o=_slicedToArray(Vr(i),2))[0],y=o[1]),u=u||[];for(var b=new Array(u.length),k=0;k<u.length;k++){var x=_slicedToArray(u[k],3),w=x[0],C=x[1],_=x[2],S=Vr(C),I=_slicedToArray(S,2),T=I[0],N=I[1],A=void 0,E=void 0;switch(15&w){case 4:E=_;break;case 1:case 8:A=_}b[k]={flags:w,ns:T,name:N,nonMinifiedName:N,securityContext:A,suffix:E}}c=c||[];for(var R=new Array(c.length),F=0;F<c.length;F++){var D=_slicedToArray(c[F],2),O=D[0],M=D[1];R[F]={type:0,target:O,eventName:M,propName:null}}var P=(s=s||[]).map((function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1],a=_slicedToArray(Vr(n),2);return[a[0],a[1],r]}));return p=function(e){if(e&&"$$undefined"===e.id){var t=null!=e.encapsulation&&e.encapsulation!==vt.None||e.styles.length||Object.keys(e.data).length;e.id=t?"c"+gr++:"$$empty"}return e&&"$$empty"===e.id&&(e=null),e||null}(p),h&&(t|=33554432),{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:e,flags:t|=1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:f,matchedQueryIds:v,references:m,ngContentIndex:r,childCount:a,bindings:b,bindingFlags:Ur(b),outputs:R,element:{ns:g,name:y,attrs:P,template:null,componentProvider:null,componentView:h||null,componentRendererType:p,publicProviders:null,allProviders:null,handleEvent:l||dr},provider:null,text:null,query:null,ngContent:null}}function ao(e,t,n){var r,a=n.element,i=e.root.selectorOrNode,o=e.renderer;if(e.parent||!i){r=a.name?o.createElement(a.name,a.ns):o.createComment("");var s=Rr(e,t,n);s&&o.appendChild(s,r)}else r=o.selectRootElement(i,!!a.componentRendererType&&a.componentRendererType.encapsulation===vt.ShadowDom);if(a.attrs)for(var u=0;u<a.attrs.length;u++){var c=_slicedToArray(a.attrs[u],3),l=c[0],h=c[1],p=c[2];o.setAttribute(r,h,p,l)}return r}function io(e,t,n,r){for(var a=0;a<n.outputs.length;a++){var i=n.outputs[a],o=oo(e,n.nodeIndex,(h=i.eventName,(l=i.target)?"".concat(l,":").concat(h):h)),s=i.target,u=e;"component"===i.target&&(s=null,u=t);var c=u.renderer.listen(s||r,i.eventName,o);e.disposables[n.outputIndex+a]=c}var l,h}function oo(e,t,n){return function(r){return Cr(e,t,n,r)}}function so(e,t,n,r){if(!br(e,t,n,r))return!1;var a=t.bindings[n],i=ur(e,t.nodeIndex),o=i.renderElement,s=a.name;switch(15&a.flags){case 1:!function(e,t,n,r,a,i){var o=t.securityContext,s=o?e.root.sanitizer.sanitize(o,i):i;s=null!=s?s.toString():null;var u=e.renderer;null!=i?u.setAttribute(n,a,s,r):u.removeAttribute(n,a,r)}(e,a,o,a.ns,s,r);break;case 2:!function(e,t,n,r){var a=e.renderer;r?a.addClass(t,n):a.removeClass(t,n)}(e,o,s,r);break;case 4:!function(e,t,n,r,a){var i=e.root.sanitizer.sanitize(qt.STYLE,a);if(null!=i){i=i.toString();var o=t.suffix;null!=o&&(i+=o)}else i=null;var s=e.renderer;null!=i?s.setStyle(n,r,i):s.removeStyle(n,r)}(e,a,o,s,r);break;case 8:!function(e,t,n,r,a){var i=t.securityContext,o=i?e.root.sanitizer.sanitize(i,a):a;e.renderer.setProperty(n,r,o)}(33554432&t.flags&&32&a.flags?i.componentView:e,a,o,s,r)}return!0}function uo(e){for(var t=e.def.nodeMatchedQueries;e.parent&&Nr(e);){var n=e.parentNodeDef;e=e.parent;for(var r=n.nodeIndex+n.childCount,a=0;a<=r;a++){var i=e.def.nodes[a];67108864&i.flags&&536870912&i.flags&&(i.query.filterId&t)===i.query.filterId&&hr(e,a).setDirty(),!(1&i.flags&&a+i.childCount<n.nodeIndex)&&67108864&i.childFlags&&536870912&i.childFlags||(a+=i.childCount)}}if(134217728&e.def.nodeFlags)for(var o=0;o<e.def.nodes.length;o++){var s=e.def.nodes[o];134217728&s.flags&&536870912&s.flags&&hr(e,o).setDirty(),o+=s.childCount}}function co(e,t){var n=hr(e,t.nodeIndex);if(n.dirty){var r,a=void 0;if(67108864&t.flags){var i=t.parent.parent;a=lo(e,i.nodeIndex,i.nodeIndex+i.childCount,t.query,[]),r=cr(e,t.parent.nodeIndex).instance}else 134217728&t.flags&&(a=lo(e,0,e.def.nodes.length-1,t.query,[]),r=e.component);n.reset(a);for(var o=t.query.bindings,s=!1,u=0;u<o.length;u++){var c=o[u],l=void 0;switch(c.bindingType){case 0:l=n.first;break;case 1:l=n,s=!0}r[c.propName]=l}s&&n.notifyOnChanges()}}function lo(e,t,n,r,a){for(var i=t;i<=n;i++){var o=e.def.nodes[i],s=o.matchedQueries[r.id];if(null!=s&&a.push(ho(e,o,s)),1&o.flags&&o.element.template&&(o.element.template.nodeMatchedQueries&r.filterId)===r.filterId){var u=ur(e,i);if((o.childMatchedQueries&r.filterId)===r.filterId&&(lo(e,i+1,i+o.childCount,r,a),i+=o.childCount),16777216&o.flags)for(var c=u.viewContainer._embeddedViews,l=0;l<c.length;l++){var h=c[l],p=_r(h);p&&p===u&&lo(h,0,h.def.nodes.length-1,r,a)}var d=u.template._projectedViews;if(d)for(var f=0;f<d.length;f++){var m=d[f];lo(m,0,m.def.nodes.length-1,r,a)}}(o.childMatchedQueries&r.filterId)!==r.filterId&&(i+=o.childCount)}return a}function ho(e,t,n){if(null!=n)switch(n){case 1:return ur(e,t.nodeIndex).renderElement;case 0:return new En(ur(e,t.nodeIndex).renderElement);case 2:return ur(e,t.nodeIndex).template;case 3:return ur(e,t.nodeIndex).viewContainer;case 4:return cr(e,t.nodeIndex).instance}}function po(e,t,n){var r=Rr(e,t,n);r&&Pr(e,n.ngContent.index,1,r,null,void 0)}function fo(e,t){for(var n=Object.keys(t),r=n.length,a=new Array(r),i=0;i<r;i++){var o=n[i];a[t[o]]=o}return function(e,t,n){for(var r=new Array(n.length),a=0;a<n.length;a++){var i=n[a];r[a]={flags:8,name:i,ns:null,nonMinifiedName:i,securityContext:null,suffix:null}}return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:64,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:-1,childCount:0,bindings:r,bindingFlags:Ur(r),outputs:[],element:null,provider:null,text:null,query:null,ngContent:null}}(0,e,a)}function mo(e,t,n){for(var r=new Array(n.length-1),a=1;a<n.length;a++)r[a-1]={flags:8,name:null,ns:null,nonMinifiedName:null,securityContext:null,suffix:n[a]};return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:e,flags:2,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:t,childCount:0,bindings:r,bindingFlags:8,outputs:[],element:null,provider:null,text:{prefix:n[0]},query:null,ngContent:null}}function vo(e,t,n){var r,a=e.renderer;r=a.createText(n.text.prefix);var i=Rr(e,t,n);return i&&a.appendChild(i,r),{renderText:r}}function go(e,t){return(null!=e?e.toString():"")+t.suffix}function yo(e,t,n,r){for(var a=0,i=0,o=0,s=0,u=0,c=null,l=null,h=!1,p=!1,d=null,f=0;f<t.length;f++){var m=t[f];if(m.nodeIndex=f,m.parent=c,m.bindingIndex=a,m.outputIndex=i,m.renderParent=l,o|=m.flags,u|=m.matchedQueryIds,m.element){var v=m.element;v.publicProviders=c?c.element.publicProviders:Object.create(null),v.allProviders=v.publicProviders,h=!1,p=!1,m.element.template&&(u|=m.element.template.nodeMatchedQueries)}if(ko(c,m,t.length),a+=m.bindings.length,i+=m.outputs.length,!l&&3&m.flags&&(d=m),20224&m.flags){h||(h=!0,c.element.publicProviders=Object.create(c.element.publicProviders),c.element.allProviders=c.element.publicProviders);var g=0!=(32768&m.flags);0==(8192&m.flags)||g?c.element.publicProviders[mr(m.provider.token)]=m:(p||(p=!0,c.element.allProviders=Object.create(c.element.publicProviders)),c.element.allProviders[mr(m.provider.token)]=m),g&&(c.element.componentProvider=m)}if(c?(c.childFlags|=m.flags,c.directChildFlags|=m.flags,c.childMatchedQueries|=m.matchedQueryIds,m.element&&m.element.template&&(c.childMatchedQueries|=m.element.template.nodeMatchedQueries)):s|=m.flags,m.childCount>0)c=m,bo(m)||(l=m);else for(;c&&f===c.nodeIndex+c.childCount;){var y=c.parent;y&&(y.childFlags|=c.childFlags,y.childMatchedQueries|=c.childMatchedQueries),l=(c=y)&&bo(c)?c.renderParent:c}}return{factory:null,nodeFlags:o,rootNodeFlags:s,nodeMatchedQueries:u,flags:e,nodes:t,updateDirectives:n||dr,updateRenderer:r||dr,handleEvent:function(e,n,r,a){return t[n].element.handleEvent(e,r,a)},bindingCount:a,outputCount:i,lastRenderRootNode:d}}function bo(e){return 0!=(1&e.flags)&&null===e.element.name}function ko(e,t,n){var r=t.element&&t.element.template;if(r){if(!r.lastRenderRootNode)throw new Error("Illegal State: Embedded templates without nodes are not allowed!");if(r.lastRenderRootNode&&16777216&r.lastRenderRootNode.flags)throw new Error("Illegal State: Last root node of a template can't have embedded views, at index ".concat(t.nodeIndex,"!"))}if(20224&t.flags&&0==(1&(e?e.flags:0)))throw new Error("Illegal State: StaticProvider/Directive nodes need to be children of elements or anchors, at index ".concat(t.nodeIndex,"!"));if(t.query){if(67108864&t.flags&&(!e||0==(16384&e.flags)))throw new Error("Illegal State: Content Query nodes need to be children of directives, at index ".concat(t.nodeIndex,"!"));if(134217728&t.flags&&e)throw new Error("Illegal State: View Query nodes have to be top level nodes, at index ".concat(t.nodeIndex,"!"))}if(t.childCount){var a=e?e.nodeIndex+e.childCount:n-1;if(t.nodeIndex<=a&&t.nodeIndex+t.childCount>a)throw new Error("Illegal State: childCount of node leads outside of parent, at index ".concat(t.nodeIndex,"!"))}}function xo(e,t,n,r){var a=_o(e.root,e.renderer,e,t,n);return So(a,e.component,r),Io(a),a}function wo(e,t,n){var r=_o(e,e.renderer,null,null,t);return So(r,n,n),Io(r),r}function Co(e,t,n,r){var a,i=t.element.componentRendererType;return a=i?e.root.rendererFactory.createRenderer(r,i):e.root.renderer,_o(e.root,a,e,t.element.componentProvider,n)}function _o(e,t,n,r,a){var i=new Array(a.nodes.length),o=a.outputCount?new Array(a.outputCount):null;return{def:a,parent:n,viewContainerParent:null,parentNodeDef:r,context:null,component:null,nodes:i,state:13,root:e,renderer:t,oldValues:new Array(a.bindingCount),disposables:o,initIndex:-1}}function So(e,t,n){e.component=t,e.context=n}function Io(e){var t;Tr(e)&&(t=ur(e.parent,e.parentNodeDef.parent.nodeIndex).renderElement);for(var n=e.def,r=e.nodes,a=0;a<n.nodes.length;a++){var i=n.nodes[a],o=void 0;switch(pr.setCurrentNode(e,a),201347067&i.flags){case 1:var s=ao(e,t,i),u=void 0;if(33554432&i.flags){var c=Dr(i.element.componentView);u=pr.createComponentView(e,i,c,s)}io(e,u,i,s),o={renderElement:s,componentView:u,viewContainer:null,template:i.element.template?oa(e,i):void 0},16777216&i.flags&&(o.viewContainer=na(e,i,o));break;case 2:o=vo(e,t,i);break;case 512:case 1024:case 2048:case 256:(o=r[a])||4096&i.flags||(o={instance:Ia(e,i)});break;case 16:o={instance:Ta(e,i)};break;case 16384:(o=r[a])||(o={instance:Na(e,i)}),32768&i.flags&&So(ur(e,i.parent.nodeIndex).componentView,o.instance,o.instance);break;case 32:case 64:case 128:o={value:void 0};break;case 67108864:case 134217728:o=new qa;break;case 8:po(e,t,i),o=void 0}r[a]=o}Mo(e,Oo.CreateViewNodes),Bo(e,201326592,268435456,0)}function To(e){Eo(e),pr.updateDirectives(e,1),Po(e,Oo.CheckNoChanges),pr.updateRenderer(e,1),Mo(e,Oo.CheckNoChanges),e.state&=-97}function No(e){1&e.state?(e.state&=-2,e.state|=2):e.state&=-3,ir(e,0,256),Eo(e),pr.updateDirectives(e,0),Po(e,Oo.CheckAndUpdate),Bo(e,67108864,536870912,0);var t=ir(e,256,512);Pa(e,2097152|(t?1048576:0)),pr.updateRenderer(e,0),Mo(e,Oo.CheckAndUpdate),Bo(e,134217728,536870912,0),Pa(e,8388608|((t=ir(e,512,768))?4194304:0)),2&e.def.flags&&(e.state&=-9),e.state&=-97,ir(e,768,1024)}function Ao(e,t,n,r,a,i,o,s,u,c,l,h,p){return 0===n?function(e,t,n,r,a,i,o,s,u,c,l,h){switch(201347067&t.flags){case 1:return function(e,t,n,r,a,i,o,s,u,c,l,h){var p=t.bindings.length,d=!1;return p>0&&so(e,t,0,n)&&(d=!0),p>1&&so(e,t,1,r)&&(d=!0),p>2&&so(e,t,2,a)&&(d=!0),p>3&&so(e,t,3,i)&&(d=!0),p>4&&so(e,t,4,o)&&(d=!0),p>5&&so(e,t,5,s)&&(d=!0),p>6&&so(e,t,6,u)&&(d=!0),p>7&&so(e,t,7,c)&&(d=!0),p>8&&so(e,t,8,l)&&(d=!0),p>9&&so(e,t,9,h)&&(d=!0),d}(e,t,n,r,a,i,o,s,u,c,l,h);case 2:return function(e,t,n,r,a,i,o,s,u,c,l,h){var p=!1,d=t.bindings,f=d.length;if(f>0&&br(e,t,0,n)&&(p=!0),f>1&&br(e,t,1,r)&&(p=!0),f>2&&br(e,t,2,a)&&(p=!0),f>3&&br(e,t,3,i)&&(p=!0),f>4&&br(e,t,4,o)&&(p=!0),f>5&&br(e,t,5,s)&&(p=!0),f>6&&br(e,t,6,u)&&(p=!0),f>7&&br(e,t,7,c)&&(p=!0),f>8&&br(e,t,8,l)&&(p=!0),f>9&&br(e,t,9,h)&&(p=!0),p){var m=t.text.prefix;f>0&&(m+=go(n,d[0])),f>1&&(m+=go(r,d[1])),f>2&&(m+=go(a,d[2])),f>3&&(m+=go(i,d[3])),f>4&&(m+=go(o,d[4])),f>5&&(m+=go(s,d[5])),f>6&&(m+=go(u,d[6])),f>7&&(m+=go(c,d[7])),f>8&&(m+=go(l,d[8])),f>9&&(m+=go(h,d[9]));var v=sr(e,t.nodeIndex).renderText;e.renderer.setValue(v,m)}return p}(e,t,n,r,a,i,o,s,u,c,l,h);case 16384:return function(e,t,n,r,a,i,o,s,u,c,l,h){var p=cr(e,t.nodeIndex),d=p.instance,f=!1,m=void 0,v=t.bindings.length;return v>0&&yr(e,t,0,n)&&(f=!0,m=Ma(e,p,t,0,n,m)),v>1&&yr(e,t,1,r)&&(f=!0,m=Ma(e,p,t,1,r,m)),v>2&&yr(e,t,2,a)&&(f=!0,m=Ma(e,p,t,2,a,m)),v>3&&yr(e,t,3,i)&&(f=!0,m=Ma(e,p,t,3,i,m)),v>4&&yr(e,t,4,o)&&(f=!0,m=Ma(e,p,t,4,o,m)),v>5&&yr(e,t,5,s)&&(f=!0,m=Ma(e,p,t,5,s,m)),v>6&&yr(e,t,6,u)&&(f=!0,m=Ma(e,p,t,6,u,m)),v>7&&yr(e,t,7,c)&&(f=!0,m=Ma(e,p,t,7,c,m)),v>8&&yr(e,t,8,l)&&(f=!0,m=Ma(e,p,t,8,l,m)),v>9&&yr(e,t,9,h)&&(f=!0,m=Ma(e,p,t,9,h,m)),m&&d.ngOnChanges(m),65536&t.flags&&or(e,256,t.nodeIndex)&&d.ngOnInit(),262144&t.flags&&d.ngDoCheck(),f}(e,t,n,r,a,i,o,s,u,c,l,h);case 32:case 64:case 128:return function(e,t,n,r,a,i,o,s,u,c,l,h){var p=t.bindings,d=!1,f=p.length;if(f>0&&br(e,t,0,n)&&(d=!0),f>1&&br(e,t,1,r)&&(d=!0),f>2&&br(e,t,2,a)&&(d=!0),f>3&&br(e,t,3,i)&&(d=!0),f>4&&br(e,t,4,o)&&(d=!0),f>5&&br(e,t,5,s)&&(d=!0),f>6&&br(e,t,6,u)&&(d=!0),f>7&&br(e,t,7,c)&&(d=!0),f>8&&br(e,t,8,l)&&(d=!0),f>9&&br(e,t,9,h)&&(d=!0),d){var m,v=lr(e,t.nodeIndex);switch(201347067&t.flags){case 32:m=new Array(p.length),f>0&&(m[0]=n),f>1&&(m[1]=r),f>2&&(m[2]=a),f>3&&(m[3]=i),f>4&&(m[4]=o),f>5&&(m[5]=s),f>6&&(m[6]=u),f>7&&(m[7]=c),f>8&&(m[8]=l),f>9&&(m[9]=h);break;case 64:m={},f>0&&(m[p[0].name]=n),f>1&&(m[p[1].name]=r),f>2&&(m[p[2].name]=a),f>3&&(m[p[3].name]=i),f>4&&(m[p[4].name]=o),f>5&&(m[p[5].name]=s),f>6&&(m[p[6].name]=u),f>7&&(m[p[7].name]=c),f>8&&(m[p[8].name]=l),f>9&&(m[p[9].name]=h);break;case 128:var g=n;switch(f){case 1:m=g.transform(n);break;case 2:m=g.transform(r);break;case 3:m=g.transform(r,a);break;case 4:m=g.transform(r,a,i);break;case 5:m=g.transform(r,a,i,o);break;case 6:m=g.transform(r,a,i,o,s);break;case 7:m=g.transform(r,a,i,o,s,u);break;case 8:m=g.transform(r,a,i,o,s,u,c);break;case 9:m=g.transform(r,a,i,o,s,u,c,l);break;case 10:m=g.transform(r,a,i,o,s,u,c,l,h)}}v.value=m}return d}(e,t,n,r,a,i,o,s,u,c,l,h);default:throw"unreachable"}}(e,t,r,a,i,o,s,u,c,l,h,p):function(e,t,n){switch(201347067&t.flags){case 1:return function(e,t,n){for(var r=!1,a=0;a<n.length;a++)so(e,t,a,n[a])&&(r=!0);return r}(e,t,n);case 2:return function(e,t,n){for(var r=t.bindings,a=!1,i=0;i<n.length;i++)br(e,t,i,n[i])&&(a=!0);if(a){for(var o="",s=0;s<n.length;s++)o+=go(n[s],r[s]);o=t.text.prefix+o;var u=sr(e,t.nodeIndex).renderText;e.renderer.setValue(u,o)}return a}(e,t,n);case 16384:return function(e,t,n){for(var r=cr(e,t.nodeIndex),a=r.instance,i=!1,o=void 0,s=0;s<n.length;s++)yr(e,t,s,n[s])&&(i=!0,o=Ma(e,r,t,s,n[s],o));return o&&a.ngOnChanges(o),65536&t.flags&&or(e,256,t.nodeIndex)&&a.ngOnInit(),262144&t.flags&&a.ngDoCheck(),i}(e,t,n);case 32:case 64:case 128:return function(e,t,n){for(var r=t.bindings,a=!1,i=0;i<n.length;i++)br(e,t,i,n[i])&&(a=!0);if(a){var o,s=lr(e,t.nodeIndex);switch(201347067&t.flags){case 32:o=n;break;case 64:o={};for(var u=0;u<n.length;u++)o[r[u].name]=n[u];break;case 128:var c=n[0],l=n.slice(1);o=c.transform.apply(c,_toConsumableArray(l))}s.value=o}return a}(e,t,n);default:throw"unreachable"}}(e,t,r)}function Eo(e){var t=e.def;if(4&t.nodeFlags)for(var n=0;n<t.nodes.length;n++){var r=t.nodes[n];if(4&r.flags){var a=ur(e,n).template._projectedViews;if(a)for(var i=0;i<a.length;i++){var o=a[i];o.state|=32,wr(o,e)}}else 0==(4&r.childFlags)&&(n+=r.childCount)}}function Ro(e,t,n,r,a,i,o,s,u,c,l,h,p){return 0===n?function(e,t,n,r,a,i,o,s,u,c,l,h){var p=t.bindings.length;p>0&&kr(e,t,0,n),p>1&&kr(e,t,1,r),p>2&&kr(e,t,2,a),p>3&&kr(e,t,3,i),p>4&&kr(e,t,4,o),p>5&&kr(e,t,5,s),p>6&&kr(e,t,6,u),p>7&&kr(e,t,7,c),p>8&&kr(e,t,8,l),p>9&&kr(e,t,9,h)}(e,t,r,a,i,o,s,u,c,l,h,p):function(e,t,n){for(var r=0;r<n.length;r++)kr(e,t,r,n[r])}(e,t,r),!1}function Fo(e,t){if(hr(e,t.nodeIndex).dirty)throw nr(pr.createDebugContext(e,t.nodeIndex),"Query ".concat(t.query.id," not dirty"),"Query ".concat(t.query.id," dirty"),0!=(1&e.state))}function Do(e){if(!(128&e.state)){if(Po(e,Oo.Destroy),Mo(e,Oo.Destroy),Pa(e,131072),e.disposables)for(var t=0;t<e.disposables.length;t++)e.disposables[t]();!function(e){if(16&e.state){var t=_r(e);if(t){var n=t.template._projectedViews;n&&(mt(n,n.indexOf(e)),pr.dirtyParentQueries(e))}}}(e),e.renderer.destroyNode&&function(e){for(var t=e.def.nodes.length,n=0;n<t;n++){var r=e.def.nodes[n];1&r.flags?e.renderer.destroyNode(ur(e,n).renderElement):2&r.flags?e.renderer.destroyNode(sr(e,n).renderText):(67108864&r.flags||134217728&r.flags)&&hr(e,n).destroy()}}(e),Tr(e)&&e.renderer.destroy(),e.state|=128}}var Oo=function(){var e={CreateViewNodes:0,CheckNoChanges:1,CheckNoChangesProjectedViews:2,CheckAndUpdate:3,CheckAndUpdateProjectedViews:4,Destroy:5};return e[e.CreateViewNodes]="CreateViewNodes",e[e.CheckNoChanges]="CheckNoChanges",e[e.CheckNoChangesProjectedViews]="CheckNoChangesProjectedViews",e[e.CheckAndUpdate]="CheckAndUpdate",e[e.CheckAndUpdateProjectedViews]="CheckAndUpdateProjectedViews",e[e.Destroy]="Destroy",e}();function Mo(e,t){var n=e.def;if(33554432&n.nodeFlags)for(var r=0;r<n.nodes.length;r++){var a=n.nodes[r];33554432&a.flags?Lo(ur(e,r).componentView,t):0==(33554432&a.childFlags)&&(r+=a.childCount)}}function Po(e,t){var n=e.def;if(16777216&n.nodeFlags)for(var r=0;r<n.nodes.length;r++){var a=n.nodes[r];if(16777216&a.flags)for(var i=ur(e,r).viewContainer._embeddedViews,o=0;o<i.length;o++)Lo(i[o],t);else 0==(16777216&a.childFlags)&&(r+=a.childCount)}}function Lo(e,t){var n=e.state;switch(t){case Oo.CheckNoChanges:0==(128&n)&&(12==(12&n)?To(e):64&n&&zo(e,Oo.CheckNoChangesProjectedViews));break;case Oo.CheckNoChangesProjectedViews:0==(128&n)&&(32&n?To(e):64&n&&zo(e,t));break;case Oo.CheckAndUpdate:0==(128&n)&&(12==(12&n)?No(e):64&n&&zo(e,Oo.CheckAndUpdateProjectedViews));break;case Oo.CheckAndUpdateProjectedViews:0==(128&n)&&(32&n?No(e):64&n&&zo(e,t));break;case Oo.Destroy:Do(e);break;case Oo.CreateViewNodes:Io(e)}}function zo(e,t){Po(e,t),Mo(e,t)}function Bo(e,t,n,r){if(e.def.nodeFlags&t&&e.def.nodeFlags&n)for(var a=e.def.nodes.length,i=0;i<a;i++){var o=e.def.nodes[i];if(o.flags&t&&o.flags&n)switch(pr.setCurrentNode(e,o.nodeIndex),r){case 0:co(e,o);break;case 1:Fo(e,o)}o.childFlags&t&&o.childFlags&n||(i+=o.childCount)}}var Vo=!1;function Uo(e,t,n,r,a,i){var o=a.injector.get(Fn);return wo(Go(e,a,o,t,n),r,i)}function Wo(e,t,n,r,a,i){var o=a.injector.get(Fn),s=Go(e,a,new xs(o),t,n),u=$o(r);return bs(us.create,wo,null,[s,u,i])}function Go(e,t,n,r,a){var i=t.injector.get(Kt),o=t.injector.get(xt),s=n.createRenderer(null,null);return{ngModule:t,injector:e,projectableNodes:r,selectorOrNode:a,sanitizer:i,rendererFactory:n,renderer:s,errorHandler:o}}function Ho(e,t,n,r){var a=$o(n);return bs(us.create,xo,null,[e,t,a,r])}function jo(e,t,n,r){return n=Yo.get(t.element.componentProvider.provider.token)||$o(n),bs(us.create,Co,null,[e,t,n,r])}function qo(e,t,n,r){return da(e,t,n,function(e){var t=function(e){var t=!1,n=!1;return 0===Ko.size||(e.providers.forEach((function(e){var r=Ko.get(e.token);3840&e.flags&&r&&(t=!0,n=n||r.deprecatedBehavior)})),e.modules.forEach((function(e){Xo.forEach((function(r,a){je(a).providedIn===e&&(t=!0,n=n||r.deprecatedBehavior)}))}))),{hasOverrides:t,hasDeprecatedOverrides:n}}(e),n=t.hasOverrides,r=t.hasDeprecatedOverrides;return n?(function(e){for(var t=0;t<e.providers.length;t++){var n=e.providers[t];r&&(n.flags|=4096);var a=Ko.get(n.token);a&&(n.flags=-3841&n.flags|a.flags,n.deps=Er(a.deps),n.value=a.value)}if(Xo.size>0){var i=new Set(e.modules);Xo.forEach((function(t,n){if(i.has(je(n).providedIn)){var a={token:n,flags:t.flags|(r?4096:0),deps:Er(t.deps),value:t.value,index:e.providers.length};e.providers.push(a),e.providersByKey[mr(n)]=a}}))}}(e=e.factory((function(){return dr}))),e):e}(r))}var Ko=new Map,Xo=new Map,Yo=new Map;function Zo(e){var t;Ko.set(e.token,e),"function"==typeof e.token&&(t=je(e.token))&&"function"==typeof t.providedIn&&Xo.set(e.token,e)}function Qo(e,t){var n=Dr(t.viewDefFactory),r=Dr(n.nodes[0].element.componentView);Yo.set(e,r)}function Jo(){Ko.clear(),Xo.clear(),Yo.clear()}function $o(e){if(0===Ko.size)return e;var t=function(e){for(var t=[],n=null,r=0;r<e.nodes.length;r++){var a=e.nodes[r];1&a.flags&&(n=a),n&&3840&a.flags&&Ko.has(a.provider.token)&&(t.push(n.nodeIndex),n=null)}return t}(e);if(0===t.length)return e;e=e.factory((function(){return dr}));for(var n=0;n<t.length;n++)r(e,t[n]);return e;function r(e,t){for(var n=t+1;n<e.nodes.length;n++){var r=e.nodes[n];if(1&r.flags)return;if(3840&r.flags){var a=r.provider,i=Ko.get(a.token);i&&(r.flags=-3841&r.flags|i.flags,a.deps=Er(i.deps),a.value=i.value)}}}}function es(e,t,n,r,a,i,o,s,u,c,l,h,p){var d=e.def.nodes[t];return Ao(e,d,n,r,a,i,o,s,u,c,l,h,p),224&d.flags?lr(e,t).value:void 0}function ts(e,t,n,r,a,i,o,s,u,c,l,h,p){var d=e.def.nodes[t];return Ro(e,d,n,r,a,i,o,s,u,c,l,h,p),224&d.flags?lr(e,t).value:void 0}function ns(e){return bs(us.detectChanges,No,null,[e])}function rs(e){return bs(us.checkNoChanges,To,null,[e])}function as(e){return bs(us.destroy,Do,null,[e])}var is,os,ss,us=function(){var e={create:0,detectChanges:1,checkNoChanges:2,destroy:3,handleEvent:4};return e[e.create]="create",e[e.detectChanges]="detectChanges",e[e.checkNoChanges]="checkNoChanges",e[e.destroy]="destroy",e[e.handleEvent]="handleEvent",e}();function cs(e,t){os=e,ss=t}function ls(e,t,n,r){return cs(e,t),bs(us.handleEvent,e.def.handleEvent,null,[e,t,n,r])}function hs(e,t){if(128&e.state)throw ar(us[is]);return cs(e,ms(e,0)),e.def.updateDirectives((function(e,n,r){for(var a=e.def.nodes[n],i=arguments.length,o=new Array(i>3?i-3:0),s=3;s<i;s++)o[s-3]=arguments[s];return 0===t?ds(e,a,r,o):fs(e,a,r,o),16384&a.flags&&cs(e,ms(e,n)),224&a.flags?lr(e,a.nodeIndex).value:void 0}),e)}function ps(e,t){if(128&e.state)throw ar(us[is]);return cs(e,vs(e,0)),e.def.updateRenderer((function(e,n,r){for(var a=e.def.nodes[n],i=arguments.length,o=new Array(i>3?i-3:0),s=3;s<i;s++)o[s-3]=arguments[s];return 0===t?ds(e,a,r,o):fs(e,a,r,o),3&a.flags&&cs(e,vs(e,n)),224&a.flags?lr(e,a.nodeIndex).value:void 0}),e)}function ds(e,t,n,r){if(Ao.apply(void 0,[e,t,n].concat(_toConsumableArray(r)))){var a=1===n?r[0]:r;if(16384&t.flags){for(var i={},o=0;o<t.bindings.length;o++){var s=t.bindings[o],u=a[o];8&s.flags&&(i[(d=s.nonMinifiedName,"ng-reflect-"+d.replace(/[$@]/g,"_").replace(Zt,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return"-"+t[1].toLowerCase()})))]=Qt(u))}var c=t.parent,l=ur(e,c.nodeIndex).renderElement;if(c.element.name)for(var h in i){var p=i[h];null!=p?e.renderer.setAttribute(l,h,p):e.renderer.removeAttribute(l,h)}else e.renderer.setValue(l,"bindings="+JSON.stringify(i,null,2))}}var d}function fs(e,t,n,r){Ro.apply(void 0,[e,t,n].concat(_toConsumableArray(r)))}function ms(e,t){for(var n=t;n<e.def.nodes.length;n++){var r=e.def.nodes[n];if(16384&r.flags&&r.bindings&&r.bindings.length)return n}return null}function vs(e,t){for(var n=t;n<e.def.nodes.length;n++){var r=e.def.nodes[n];if(3&r.flags&&r.bindings&&r.bindings.length)return n}return null}var gs=function(){function e(t,n){_classCallCheck(this,e),this.view=t,this.nodeIndex=n,null==n&&(this.nodeIndex=n=0),this.nodeDef=t.def.nodes[n];for(var r=this.nodeDef,a=t;r&&0==(1&r.flags);)r=r.parent;if(!r)for(;!r&&a;)r=Sr(a),a=a.parent;this.elDef=r,this.elView=a}return _createClass(e,[{key:"logError",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a,i;2&this.nodeDef.flags?(a=this.view.def,i=this.nodeDef.nodeIndex):(a=this.elView.def,i=this.elDef.nodeIndex);var o=function(e,t){for(var n=-1,r=0;r<=t;r++)3&e.nodes[r].flags&&n++;return n}(a,i),s=-1;a.factory((function(){var t;return++s===o?(t=e.error).bind.apply(t,[e].concat(n)):dr})),s<o&&(e.error("Illegal state: the ViewDefinitionFactory did not call the logger!"),e.error.apply(e,n))}},{key:"elOrCompView",get:function(){return ur(this.elView,this.elDef.nodeIndex).componentView||this.view}},{key:"injector",get:function(){return ua(this.elView,this.elDef)}},{key:"component",get:function(){return this.elOrCompView.component}},{key:"context",get:function(){return this.elOrCompView.context}},{key:"providerTokens",get:function(){var e=[];if(this.elDef)for(var t=this.elDef.nodeIndex+1;t<=this.elDef.nodeIndex+this.elDef.childCount;t++){var n=this.elView.def.nodes[t];20224&n.flags&&e.push(n.provider.token),t+=n.childCount}return e}},{key:"references",get:function(){var e={};if(this.elDef){ys(this.elView,this.elDef,e);for(var t=this.elDef.nodeIndex+1;t<=this.elDef.nodeIndex+this.elDef.childCount;t++){var n=this.elView.def.nodes[t];20224&n.flags&&ys(this.elView,n,e),t+=n.childCount}}return e}},{key:"componentRenderElement",get:function(){var e=function(e){for(;e&&!Tr(e);)e=e.parent;return e.parent?ur(e.parent,Sr(e).nodeIndex):null}(this.elOrCompView);return e?e.renderElement:void 0}},{key:"renderNode",get:function(){return 2&this.nodeDef.flags?Ir(this.view,this.nodeDef):Ir(this.elView,this.elDef)}}]),e}();function ys(e,t,n){for(var r in t.references)n[r]=ho(e,t,t.references[r])}function bs(e,t,n,r){var a,i,o=is,s=os,u=ss;try{is=e;var c=t.apply(n,r);return os=s,ss=u,is=o,c}catch(l){if(yt(l)||!os)throw l;throw a=l,i=ks(),a instanceof Error||(a=new Error(a.toString())),rr(a,i),a}}function ks(){return os?new gs(os,ss):null}var xs=function(){function e(t){_classCallCheck(this,e),this.delegate=t}return _createClass(e,[{key:"createRenderer",value:function(e,t){return new ws(this.delegate.createRenderer(e,t))}},{key:"begin",value:function(){this.delegate.begin&&this.delegate.begin()}},{key:"end",value:function(){this.delegate.end&&this.delegate.end()}},{key:"whenRenderingDone",value:function(){return this.delegate.whenRenderingDone?this.delegate.whenRenderingDone():Promise.resolve(null)}}]),e}(),ws=function(){function e(t){_classCallCheck(this,e),this.delegate=t,this.debugContextFactory=ks,this.data=this.delegate.data}return _createClass(e,[{key:"createDebugContext",value:function(e){return this.debugContextFactory(e)}},{key:"destroyNode",value:function(e){var t=Xi(e);!function(e){Ki.delete(e.nativeNode)}(t),t instanceof ji&&(t.listeners.length=0),this.delegate.destroyNode&&this.delegate.destroyNode(e)}},{key:"destroy",value:function(){this.delegate.destroy()}},{key:"createElement",value:function(e,t){var n=this.delegate.createElement(e,t),r=this.createDebugContext(n);if(r){var a=new qi(n,null,r);a.name=e,Yi(a)}return n}},{key:"createComment",value:function(e){var t=this.delegate.createComment(e),n=this.createDebugContext(t);return n&&Yi(new ji(t,null,n)),t}},{key:"createText",value:function(e){var t=this.delegate.createText(e),n=this.createDebugContext(t);return n&&Yi(new ji(t,null,n)),t}},{key:"appendChild",value:function(e,t){var n=Xi(e),r=Xi(t);n&&r&&n instanceof qi&&n.addChild(r),this.delegate.appendChild(e,t)}},{key:"insertBefore",value:function(e,t,n){var r=Xi(e),a=Xi(t),i=Xi(n);r&&a&&r instanceof qi&&r.insertBefore(i,a),this.delegate.insertBefore(e,t,n)}},{key:"removeChild",value:function(e,t){var n=Xi(e),r=Xi(t);n&&r&&n instanceof qi&&n.removeChild(r),this.delegate.removeChild(e,t)}},{key:"selectRootElement",value:function(e,t){var n=this.delegate.selectRootElement(e,t),r=ks();return r&&Yi(new qi(n,null,r)),n}},{key:"setAttribute",value:function(e,t,n,r){var a=Xi(e);a&&a instanceof qi&&(a.attributes[r?r+":"+t:t]=n),this.delegate.setAttribute(e,t,n,r)}},{key:"removeAttribute",value:function(e,t,n){var r=Xi(e);r&&r instanceof qi&&(r.attributes[n?n+":"+t:t]=null),this.delegate.removeAttribute(e,t,n)}},{key:"addClass",value:function(e,t){var n=Xi(e);n&&n instanceof qi&&(n.classes[t]=!0),this.delegate.addClass(e,t)}},{key:"removeClass",value:function(e,t){var n=Xi(e);n&&n instanceof qi&&(n.classes[t]=!1),this.delegate.removeClass(e,t)}},{key:"setStyle",value:function(e,t,n,r){var a=Xi(e);a&&a instanceof qi&&(a.styles[t]=n),this.delegate.setStyle(e,t,n,r)}},{key:"removeStyle",value:function(e,t,n){var r=Xi(e);r&&r instanceof qi&&(r.styles[t]=null),this.delegate.removeStyle(e,t,n)}},{key:"setProperty",value:function(e,t,n){var r=Xi(e);r&&r instanceof qi&&(r.properties[t]=n),this.delegate.setProperty(e,t,n)}},{key:"listen",value:function(e,t,n){if("string"!=typeof e){var r=Xi(e);r&&r.listeners.push(new Hi(t,n))}return this.delegate.listen(e,t,n)}},{key:"parentNode",value:function(e){return this.delegate.parentNode(e)}},{key:"nextSibling",value:function(e){return this.delegate.nextSibling(e)}},{key:"setValue",value:function(e,t){return this.delegate.setValue(e,t)}}]),e}();var Cs=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck(this,n),(i=t.call(this)).moduleType=e,i._bootstrapComponents=r,i._ngModuleDefFactory=a,i}return _createClass(n,[{key:"create",value:function(e){!function(){if(!Vo){Vo=!0;var e=_t()?{setCurrentNode:cs,createRootView:Wo,createEmbeddedView:Ho,createComponentView:jo,createNgModuleRef:qo,overrideProvider:Zo,overrideComponentView:Qo,clearOverrides:Jo,checkAndUpdateView:ns,checkNoChangesView:rs,destroyView:as,createDebugContext:function(e,t){return new gs(e,t)},handleEvent:ls,updateDirectives:hs,updateRenderer:ps}:{setCurrentNode:function(){},createRootView:Uo,createEmbeddedView:xo,createComponentView:Co,createNgModuleRef:da,overrideProvider:dr,overrideComponentView:dr,clearOverrides:dr,checkAndUpdateView:No,checkNoChangesView:To,destroyView:Do,createDebugContext:function(e,t){return new gs(e,t)},handleEvent:function(e,t,n,r){return e.def.handleEvent(e,t,n,r)},updateDirectives:function(e,t){return e.def.updateDirectives(0===t?es:ts,e)},updateRenderer:function(e,t){return e.def.updateRenderer(0===t?es:ts,e)}};pr.setCurrentNode=e.setCurrentNode,pr.createRootView=e.createRootView,pr.createEmbeddedView=e.createEmbeddedView,pr.createComponentView=e.createComponentView,pr.createNgModuleRef=e.createNgModuleRef,pr.overrideProvider=e.overrideProvider,pr.overrideComponentView=e.overrideComponentView,pr.clearOverrides=e.clearOverrides,pr.checkAndUpdateView=e.checkAndUpdateView,pr.checkNoChangesView=e.checkNoChangesView,pr.destroyView=e.destroyView,pr.resolveDep=Da,pr.createDebugContext=e.createDebugContext,pr.handleEvent=e.handleEvent,pr.updateDirectives=e.updateDirectives,pr.updateRenderer=e.updateRenderer,pr.dirtyParentQueries=uo}}();var t=function(e){var t=Array.from(e.providers),n=Array.from(e.modules),r={};for(var a in e.providersByKey)r[a]=e.providersByKey[a];return{factory:e.factory,isRoot:e.isRoot,providers:t,modules:n,providersByKey:r}}(Dr(this._ngModuleDefFactory));return pr.createNgModuleRef(this.moduleType,e||nn.NULL,this._bootstrapComponents,t)}}]),n}(dt),_s=function e(){_classCallCheck(this,e)},Ss=function e(){_classCallCheck(this,e)},Is=function e(){_classCallCheck(this,e)},Ts=new nt("Location Initialized"),Ns=function e(){_classCallCheck(this,e)},As=new nt("appBaseHref"),Es=function(){function e(t,n){var r=this;_classCallCheck(this,e),this._subject=new Ha,this._urlChangeListeners=[],this._platformStrategy=t;var a=this._platformStrategy.getBaseHref();this._platformLocation=n,this._baseHref=e.stripTrailingSlash(Rs(a)),this._platformStrategy.onPopState((function(e){r._subject.emit({url:r.path(!0),pop:!0,state:e.state,type:e.type})}))}return _createClass(e,[{key:"path",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.normalize(this._platformStrategy.path(e))}},{key:"getState",value:function(){return this._platformLocation.getState()}},{key:"isCurrentPathEqualTo",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this.path()==this.normalize(t+e.normalizeQueryParams(n))}},{key:"normalize",value:function(t){return e.stripTrailingSlash(function(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,Rs(t)))}},{key:"prepareExternalUrl",value:function(e){return e&&"/"!==e[0]&&(e="/"+e),this._platformStrategy.prepareExternalUrl(e)}},{key:"go",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._platformStrategy.pushState(r,"",t,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+e.normalizeQueryParams(n)),r)}},{key:"replaceState",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._platformStrategy.replaceState(r,"",t,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+e.normalizeQueryParams(n)),r)}},{key:"forward",value:function(){this._platformStrategy.forward()}},{key:"back",value:function(){this._platformStrategy.back()}},{key:"onUrlChange",value:function(e){var t=this;this._urlChangeListeners.push(e),this.subscribe((function(e){t._notifyUrlChangeListeners(e.url,e.state)}))}},{key:"_notifyUrlChangeListeners",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;this._urlChangeListeners.forEach((function(n){return n(e,t)}))}},{key:"subscribe",value:function(e,t,n){return this._subject.subscribe({next:e,error:t,complete:n})}}],[{key:"normalizeQueryParams",value:function(e){return e&&"?"!==e[0]?"?"+e:e}},{key:"joinWithSlash",value:function(e,t){if(0==e.length)return t;if(0==t.length)return e;var n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}},{key:"stripTrailingSlash",value:function(e){var t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}}]),e}();function Rs(e){return e.replace(/\/index.html$/,"")}var Fs=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this))._platformLocation=e,a._baseHref="",null!=r&&(a._baseHref=r),a}return _createClass(n,[{key:"onPopState",value:function(e){this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e)}},{key:"getBaseHref",value:function(){return this._baseHref}},{key:"path",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e=this._platformLocation.hash;return null==e&&(e="#"),e.length>0?e.substring(1):e}},{key:"prepareExternalUrl",value:function(e){var t=Es.joinWithSlash(this._baseHref,e);return t.length>0?"#"+t:t}},{key:"pushState",value:function(e,t,n,r){var a=this.prepareExternalUrl(n+Es.normalizeQueryParams(r));0==a.length&&(a=this._platformLocation.pathname),this._platformLocation.pushState(e,t,a)}},{key:"replaceState",value:function(e,t,n,r){var a=this.prepareExternalUrl(n+Es.normalizeQueryParams(r));0==a.length&&(a=this._platformLocation.pathname),this._platformLocation.replaceState(e,t,a)}},{key:"forward",value:function(){this._platformLocation.forward()}},{key:"back",value:function(){this._platformLocation.back()}}]),n}(Ns),Ds=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;if(_classCallCheck(this,n),(a=t.call(this))._platformLocation=e,null==r&&(r=a._platformLocation.getBaseHrefFromDOM()),null==r)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");return a._baseHref=r,_possibleConstructorReturn(a)}return _createClass(n,[{key:"onPopState",value:function(e){this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e)}},{key:"getBaseHref",value:function(){return this._baseHref}},{key:"prepareExternalUrl",value:function(e){return Es.joinWithSlash(this._baseHref,e)}},{key:"path",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this._platformLocation.pathname+Es.normalizeQueryParams(this._platformLocation.search),n=this._platformLocation.hash;return n&&e?"".concat(t).concat(n):t}},{key:"pushState",value:function(e,t,n,r){var a=this.prepareExternalUrl(n+Es.normalizeQueryParams(r));this._platformLocation.pushState(e,t,a)}},{key:"replaceState",value:function(e,t,n,r){var a=this.prepareExternalUrl(n+Es.normalizeQueryParams(r));this._platformLocation.replaceState(e,t,a)}},{key:"forward",value:function(){this._platformLocation.forward()}},{key:"back",value:function(){this._platformLocation.back()}}]),n}(Ns),Os=function(){var e={Zero:0,One:1,Two:2,Few:3,Many:4,Other:5};return e[e.Zero]="Zero",e[e.One]="One",e[e.Two]="Two",e[e.Few]="Few",e[e.Many]="Many",e[e.Other]="Other",e}(),Ms=new nt("UseV4Plurals"),Ps=function e(){_classCallCheck(this,e)},Ls=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this)).locale=e,a.deprecatedPluralFn=r,a}return _createClass(n,[{key:"getPluralCategory",value:function(e,t){switch(this.deprecatedPluralFn?this.deprecatedPluralFn(t||this.locale,e):function(e){return function(e){var t=e.toLowerCase().replace(/_/g,"-"),n=Va[t];if(n)return n;var r=t.split("-")[0];if(n=Va[r])return n;if("en"===r)return Ga;throw new Error('Missing locale data for the locale "'.concat(e,'".'))}(e)[Ua.PluralCase]}(t||this.locale)(e)){case Os.Zero:return"zero";case Os.One:return"one";case Os.Two:return"two";case Os.Few:return"few";case Os.Many:return"many";default:return"other"}}}]),n}(Ps),zs=function e(){_classCallCheck(this,e)},Bs=function(){function e(t,n,r,a){_classCallCheck(this,e),this._iterableDiffers=t,this._keyValueDiffers=n,this._ngEl=r,this._renderer=a,this._initialClasses=[]}return _createClass(e,[{key:"getValue",value:function(){return null}},{key:"setClass",value:function(e){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof e?e.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}},{key:"setNgClass",value:function(e){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof e?e.split(/\s+/):e,this._rawClass&&(gn(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}},{key:"applyChanges",value:function(){if(this._iterableDiffer){var e=this._iterableDiffer.diff(this._rawClass);e&&this._applyIterableChanges(e)}else if(this._keyValueDiffer){var t=this._keyValueDiffer.diff(this._rawClass);t&&this._applyKeyValueChanges(t)}}},{key:"_applyKeyValueChanges",value:function(e){var t=this;e.forEachAddedItem((function(e){return t._toggleClass(e.key,e.currentValue)})),e.forEachChangedItem((function(e){return t._toggleClass(e.key,e.currentValue)})),e.forEachRemovedItem((function(e){e.previousValue&&t._toggleClass(e.key,!1)}))}},{key:"_applyIterableChanges",value:function(e){var t=this;e.forEachAddedItem((function(e){if("string"!=typeof e.item)throw new Error("NgClass can only toggle CSS classes expressed as strings, got "+Ke(e.item));t._toggleClass(e.item,!0)})),e.forEachRemovedItem((function(e){return t._toggleClass(e.item,!1)}))}},{key:"_applyClasses",value:function(e){var t=this;e&&(Array.isArray(e)||e instanceof Set?e.forEach((function(e){return t._toggleClass(e,!0)})):Object.keys(e).forEach((function(n){return t._toggleClass(n,!!e[n])})))}},{key:"_removeClasses",value:function(e){var t=this;e&&(Array.isArray(e)||e instanceof Set?e.forEach((function(e){return t._toggleClass(e,!1)})):Object.keys(e).forEach((function(e){return t._toggleClass(e,!1)})))}},{key:"_toggleClass",value:function(e,t){var n=this;(e=e.trim())&&e.split(/\s+/g).forEach((function(e){t?n._renderer.addClass(n._ngEl.nativeElement,e):n._renderer.removeClass(n._ngEl.nativeElement,e)}))}}]),e}(),Vs=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"ngDoCheck",value:function(){this._delegate.applyChanges()}},{key:"klass",set:function(e){this._delegate.setClass(e)}},{key:"ngClass",set:function(e){this._delegate.setNgClass(e)}}]),n}(function(){var e=function(){function e(t){_classCallCheck(this,e),this._delegate=t}return _createClass(e,[{key:"getValue",value:function(){return this._delegate.getValue()}}]),e}();return e.ngDirectiveDef=void 0,e}()),Us=function(){function e(t,n,r,a){_classCallCheck(this,e),this.$implicit=t,this.ngForOf=n,this.index=r,this.count=a}return _createClass(e,[{key:"first",get:function(){return 0===this.index}},{key:"last",get:function(){return this.index===this.count-1}},{key:"even",get:function(){return this.index%2==0}},{key:"odd",get:function(){return!this.even}}]),e}(),Ws=function(){function e(t,n,r){_classCallCheck(this,e),this._viewContainer=t,this._template=n,this._differs=r,this._ngForOfDirty=!0,this._differ=null}return _createClass(e,[{key:"ngDoCheck",value:function(){if(this._ngForOfDirty){this._ngForOfDirty=!1;var e=this._ngForOf;if(!this._differ&&e)try{this._differ=this._differs.find(e).create(this.ngForTrackBy)}catch(r){throw new Error("Cannot find a differ supporting object '".concat(e,"' of type '").concat((t=e).name||typeof t,"'. NgFor only supports binding to Iterables such as Arrays."))}}var t;if(this._differ){var n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}},{key:"_applyChanges",value:function(e){var t=this,n=[];e.forEachOperation((function(e,r,a){if(null==e.previousIndex){var i=t._viewContainer.createEmbeddedView(t._template,new Us(null,t._ngForOf,-1,-1),null===a?void 0:a),o=new Gs(e,i);n.push(o)}else if(null==a)t._viewContainer.remove(null===r?void 0:r);else if(null!==r){var s=t._viewContainer.get(r);t._viewContainer.move(s,a);var u=new Gs(e,s);n.push(u)}}));for(var r=0;r<n.length;r++)this._perViewChange(n[r].view,n[r].record);for(var a=0,i=this._viewContainer.length;a<i;a++){var o=this._viewContainer.get(a);o.context.index=a,o.context.count=i,o.context.ngForOf=this._ngForOf}e.forEachIdentityChange((function(e){t._viewContainer.get(e.currentIndex).context.$implicit=e.item}))}},{key:"_perViewChange",value:function(e,t){e.context.$implicit=t.item}},{key:"ngForOf",set:function(e){this._ngForOf=e,this._ngForOfDirty=!0}},{key:"ngForTrackBy",set:function(e){_t()&&null!=e&&"function"!=typeof e&&console&&console.warn&&console.warn("trackBy must be a function, but received ".concat(JSON.stringify(e),". See https://angular.io/docs/ts/latest/api/common/index/NgFor-directive.html#!#change-propagation for more information.")),this._trackByFn=e},get:function(){return this._trackByFn}},{key:"ngForTemplate",set:function(e){e&&(this._template=e)}}],[{key:"ngTemplateContextGuard",value:function(e,t){return!0}}]),e}(),Gs=function e(t,n){_classCallCheck(this,e),this.record=t,this.view=n},Hs=function(){function e(t,n){_classCallCheck(this,e),this._viewContainer=t,this._context=new js,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=n}return _createClass(e,[{key:"_updateView",value:function(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}},{key:"ngIf",set:function(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}},{key:"ngIfThen",set:function(e){qs("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}},{key:"ngIfElse",set:function(e){qs("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}}]),e}(),js=function e(){_classCallCheck(this,e),this.$implicit=null,this.ngIf=null};function qs(e,t){if(t&&!t.createEmbeddedView)throw new Error("".concat(e," must be a TemplateRef, but received '").concat(Ke(t),"'."))}var Ks,Xs=function e(){_classCallCheck(this,e)},Ys=new nt("DocumentToken"),Zs=((Ks=function e(){_classCallCheck(this,e)}).ngInjectableDef=He({token:Ks,providedIn:"root",factory:function(){return new Qs(ct(Ys),window,ct(xt))}}),Ks),Qs=function(){function e(t,n,r){_classCallCheck(this,e),this.document=t,this.window=n,this.errorHandler=r,this.offset=function(){return[0,0]}}return _createClass(e,[{key:"setOffset",value:function(e){this.offset=Array.isArray(e)?function(){return e}:e}},{key:"getScrollPosition",value:function(){return this.supportScrollRestoration()?[this.window.scrollX,this.window.scrollY]:[0,0]}},{key:"scrollToPosition",value:function(e){this.supportScrollRestoration()&&this.window.scrollTo(e[0],e[1])}},{key:"scrollToAnchor",value:function(e){if(this.supportScrollRestoration()){e=this.window.CSS&&this.window.CSS.escape?this.window.CSS.escape(e):e.replace(/(\"|\'\ |:|\.|\[|\]|,|=)/g,"\\$1");try{var t=this.document.querySelector("#"+e);if(t)return void this.scrollToElement(t);var n=this.document.querySelector("[name='".concat(e,"']"));if(n)return void this.scrollToElement(n)}catch(r){this.errorHandler.handleError(r)}}}},{key:"setHistoryScrollRestoration",value:function(e){if(this.supportScrollRestoration()){var t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}},{key:"scrollToElement",value:function(e){var t=e.getBoundingClientRect(),n=t.left+this.window.pageXOffset,r=t.top+this.window.pageYOffset,a=this.offset();this.window.scrollTo(n-a[0],r-a[1])}},{key:"supportScrollRestoration",value:function(){try{return!!this.window&&!!this.window.scrollTo}catch(e){return!1}}}]),e}();function Js(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[t.length-1];return he(r)?(t.pop(),ke(t,r)):Ae(t)}var $s=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this))._value=e,r}return _createClass(n,[{key:"_subscribe",value:function(e){var t=_get(_getPrototypeOf(n.prototype),"_subscribe",this).call(this,e);return t&&!t.closed&&e.next(this._value),t}},{key:"getValue",value:function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new oe;return this._value}},{key:"next",value:function(e){_get(_getPrototypeOf(n.prototype),"next",this).call(this,this._value=e)}},{key:"value",get:function(){return this.getValue()}}]),n}(ce),eu=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}(),tu=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"notifyNext",value:function(e,t,n,r,a){this.destination.next(t)}},{key:"notifyError",value:function(e,t){this.destination.error(e)}},{key:"notifyComplete",value:function(e){this.destination.complete()}}]),n}(Z),nu=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck(this,n),(i=t.call(this)).parent=e,i.outerValue=r,i.outerIndex=a,i.index=0,i}return _createClass(n,[{key:"_next",value:function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)}},{key:"_error",value:function(e){this.parent.notifyError(e,this),this.unsubscribe()}},{key:"_complete",value:function(){this.parent.notifyComplete(this),this.unsubscribe()}}]),n}(Z);function ru(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new nu(e,n,r);if(!a.closed)return t instanceof re?t.subscribe(a):be(t)(a)}var au={},iu=function(){function e(t){_classCallCheck(this,e),this.resultSelector=t}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new ou(e,this.resultSelector))}}]),e}(),ou=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this,e)).resultSelector=r,a.active=0,a.values=[],a.observables=[],a}return _createClass(n,[{key:"_next",value:function(e){this.values.push(au),this.observables.push(e)}},{key:"_complete",value:function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(var n=0;n<t;n++)this.add(ru(this,e[n],void 0,n))}}},{key:"notifyComplete",value:function(e){0==(this.active-=1)&&this.destination.complete()}},{key:"notifyNext",value:function(e,t,n){var r=this.values,a=this.toRespond?r[n]===au?--this.toRespond:this.toRespond:0;r[n]=t,0===a&&(this.resultSelector?this._tryResultSelector(r):this.destination.next(r.slice()))}},{key:"_tryResultSelector",value:function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(n){return void this.destination.error(n)}this.destination.next(t)}}]),n}(tu),su=new re((function(e){return e.complete()}));function uu(e){return e?function(e){return new re((function(t){return e.schedule((function(){return t.complete()}))}))}(e):su}function cu(e){return new re((function(t){var n;try{n=e()}catch(r){return void t.error(r)}return(n?xe(n):uu()).subscribe(t)}))}function lu(){return Ne(1)}function hu(e,t){return function(n){return n.lift(new pu(e,t))}}var pu=function(){function e(t,n){_classCallCheck(this,e),this.predicate=t,this.thisArg=n}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new du(e,this.predicate,this.thisArg))}}]),e}(),du=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck(this,n),(i=t.call(this,e)).predicate=r,i.thisArg=a,i.count=0,i}return _createClass(n,[{key:"_next",value:function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}t&&this.destination.next(e)}}]),n}(Z),fu=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}();function mu(e){return function(t){return 0===e?uu():t.lift(new vu(e))}}var vu=function(){function e(t){if(_classCallCheck(this,e),this.total=t,this.total<0)throw new fu}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new gu(e,this.total))}}]),e}(),gu=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this,e)).total=r,a.ring=new Array,a.count=0,a}return _createClass(n,[{key:"_next",value:function(e){var t=this.ring,n=this.total,r=this.count++;t.length<n?t.push(e):t[r%n]=e}},{key:"_complete",value:function(){var e=this.destination,t=this.count;if(t>0)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,a=0;a<n;a++){var i=t++%n;e.next(r[i])}e.complete()}}]),n}(Z);function yu(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xu;return function(t){return t.lift(new bu(e))}}var bu=function(){function e(t){_classCallCheck(this,e),this.errorFactory=t}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new ku(e,this.errorFactory))}}]),e}(),ku=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this,e)).errorFactory=r,a.hasValue=!1,a}return _createClass(n,[{key:"_next",value:function(e){this.hasValue=!0,this.destination.next(e)}},{key:"_complete",value:function(){if(this.hasValue)return this.destination.complete();var e;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)}}]),n}(Z);function xu(){return new eu}function wu(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(t){return t.lift(new Cu(e))}}var Cu=function(){function e(t){_classCallCheck(this,e),this.defaultValue=t}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new _u(e,this.defaultValue))}}]),e}(),_u=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this,e)).defaultValue=r,a.isEmpty=!0,a}return _createClass(n,[{key:"_next",value:function(e){this.isEmpty=!1,this.destination.next(e)}},{key:"_complete",value:function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}]),n}(Z);function Su(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?hu((function(t,n){return e(t,n,r)})):$,mu(1),n?wu(t):yu((function(){return new eu})))}}function Iu(e){return function(t){var n=new Tu(e),r=t.lift(n);return n.caught=r}}var Tu=function(){function e(t){_classCallCheck(this,e),this.selector=t}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new Nu(e,this.selector,this.caught))}}]),e}(),Nu=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck(this,n),(i=t.call(this,e)).selector=r,i.caught=a,i}return _createClass(n,[{key:"error",value:function(e){if(!this.isStopped){var t;try{t=this.selector(e,this.caught)}catch(i){return void _get(_getPrototypeOf(n.prototype),"error",this).call(this,i)}this._unsubscribeAndRecycle();var r=new we(this);this.add(r);var a=_e(t,r);a!==r&&this.add(a)}}}]),n}(Ce);function Au(e){return function(t){return 0===e?uu():t.lift(new Eu(e))}}var Eu=function(){function e(t){if(_classCallCheck(this,e),this.total=t,this.total<0)throw new fu}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new Ru(e,this.total))}}]),e}(),Ru=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this,e)).total=r,a.count=0,a}return _createClass(n,[{key:"_next",value:function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))}}]),n}(Z);function Fu(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?hu((function(t,n){return e(t,n,r)})):$,Au(1),n?wu(t):yu((function(){return new eu})))}}var Du=function(){function e(t,n,r){_classCallCheck(this,e),this.predicate=t,this.thisArg=n,this.source=r}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new Ou(e,this.predicate,this.thisArg,this.source))}}]),e}(),Ou=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck(this,n),(o=t.call(this,e)).predicate=r,o.thisArg=a,o.source=i,o.index=0,o.thisArg=a||_assertThisInitialized(o),o}return _createClass(n,[{key:"notifyComplete",value:function(e){this.destination.next(e),this.destination.complete()}},{key:"_next",value:function(e){var t=!1;try{t=this.predicate.call(this.thisArg,e,this.index++,this.source)}catch(n){return void this.destination.error(n)}t||this.notifyComplete(!1)}},{key:"_complete",value:function(){this.notifyComplete(!0)}}]),n}(Z);function Mu(e,t){return"function"==typeof t?function(n){return n.pipe(Mu((function(n,r){return xe(e(n,r)).pipe(pe((function(e,a){return t(n,e,r,a)})))})))}:function(t){return t.lift(new Pu(e))}}var Pu=function(){function e(t){_classCallCheck(this,e),this.project=t}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new Lu(e,this.project))}}]),e}(),Lu=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this,e)).project=r,a.index=0,a}return _createClass(n,[{key:"_next",value:function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this._innerSub(t)}},{key:"_innerSub",value:function(e){var t=this.innerSubscription;t&&t.unsubscribe();var n=new we(this),r=this.destination;r.add(n),this.innerSubscription=_e(e,n),this.innerSubscription!==n&&r.add(this.innerSubscription)}},{key:"_complete",value:function(){var e=this.innerSubscription;e&&!e.closed||_get(_getPrototypeOf(n.prototype),"_complete",this).call(this),this.unsubscribe()}},{key:"_unsubscribe",value:function(){this.innerSubscription=void 0}},{key:"notifyComplete",value:function(){this.innerSubscription=void 0,this.isStopped&&_get(_getPrototypeOf(n.prototype),"_complete",this).call(this)}},{key:"notifyNext",value:function(e){this.destination.next(e)}}]),n}(Ce);function zu(){return lu()(Js.apply(void 0,arguments))}function Bu(e,t){var n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new Vu(e,t,n))}}var Vu=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck(this,e),this.accumulator=t,this.seed=n,this.hasSeed=r}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new Uu(e,this.accumulator,this.seed,this.hasSeed))}}]),e}(),Uu=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck(this,n),(o=t.call(this,e)).accumulator=r,o._seed=a,o.hasSeed=i,o.index=0,o}return _createClass(n,[{key:"_next",value:function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)}},{key:"_tryNext",value:function(e){var t,n=this.index++;try{t=this.accumulator(this.seed,e,n)}catch(r){this.destination.error(r)}this.seed=t,this.destination.next(t)}},{key:"seed",get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e}}]),n}(Z);function Wu(e,t){return Se(e,t,1)}function Gu(){}function Hu(e,t,n){return function(r){return r.lift(new ju(e,t,n))}}var ju=function(){function e(t,n,r){_classCallCheck(this,e),this.nextOrObserver=t,this.error=n,this.complete=r}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new qu(e,this.nextOrObserver,this.error,this.complete))}}]),e}(),qu=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck(this,n),(o=t.call(this,e))._tapNext=Gu,o._tapError=Gu,o._tapComplete=Gu,o._tapError=a||Gu,o._tapComplete=i||Gu,z(r)?(o._context=_assertThisInitialized(o),o._tapNext=r):r&&(o._context=r,o._tapNext=r.next||Gu,o._tapError=r.error||Gu,o._tapComplete=r.complete||Gu),o}return _createClass(n,[{key:"_next",value:function(e){try{this._tapNext.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.next(e)}},{key:"_error",value:function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)}},{key:"_complete",value:function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()}}]),n}(Z),Ku=function(){function e(t){_classCallCheck(this,e),this.callback=t}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new Xu(e,this.callback))}}]),e}(),Xu=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this,e)).add(new K(r)),a}return n}(Z),Yu=null;function Zu(){return Yu}var Qu,Ju={class:"className",innerHtml:"innerHTML",readonly:"readOnly",tabindex:"tabIndex"},$u={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},ec={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},tc=function(){if(tt.Node)return tt.Node.prototype.contains||function(e){return!!(16&this.compareDocumentPosition(e))}}(),nc=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"parse",value:function(e){throw new Error("parse not implemented")}},{key:"hasProperty",value:function(e,t){return t in e}},{key:"setProperty",value:function(e,t,n){e[t]=n}},{key:"getProperty",value:function(e,t){return e[t]}},{key:"invoke",value:function(e,t,n){e[t].apply(e,_toConsumableArray(n))}},{key:"logError",value:function(e){window.console&&(console.error?console.error(e):console.log(e))}},{key:"log",value:function(e){window.console&&window.console.log&&window.console.log(e)}},{key:"logGroup",value:function(e){window.console&&window.console.group&&window.console.group(e)}},{key:"logGroupEnd",value:function(){window.console&&window.console.groupEnd&&window.console.groupEnd()}},{key:"contains",value:function(e,t){return tc.call(e,t)}},{key:"querySelector",value:function(e,t){return e.querySelector(t)}},{key:"querySelectorAll",value:function(e,t){return e.querySelectorAll(t)}},{key:"on",value:function(e,t,n){e.addEventListener(t,n,!1)}},{key:"onAndCancel",value:function(e,t,n){return e.addEventListener(t,n,!1),function(){e.removeEventListener(t,n,!1)}}},{key:"dispatchEvent",value:function(e,t){e.dispatchEvent(t)}},{key:"createMouseEvent",value:function(e){var t=this.getDefaultDocument().createEvent("MouseEvent");return t.initEvent(e,!0,!0),t}},{key:"createEvent",value:function(e){var t=this.getDefaultDocument().createEvent("Event");return t.initEvent(e,!0,!0),t}},{key:"preventDefault",value:function(e){e.preventDefault(),e.returnValue=!1}},{key:"isPrevented",value:function(e){return e.defaultPrevented||null!=e.returnValue&&!e.returnValue}},{key:"getInnerHTML",value:function(e){return e.innerHTML}},{key:"getTemplateContent",value:function(e){return"content"in e&&this.isTemplateElement(e)?e.content:null}},{key:"getOuterHTML",value:function(e){return e.outerHTML}},{key:"nodeName",value:function(e){return e.nodeName}},{key:"nodeValue",value:function(e){return e.nodeValue}},{key:"type",value:function(e){return e.type}},{key:"content",value:function(e){return this.hasProperty(e,"content")?e.content:e}},{key:"firstChild",value:function(e){return e.firstChild}},{key:"nextSibling",value:function(e){return e.nextSibling}},{key:"parentElement",value:function(e){return e.parentNode}},{key:"childNodes",value:function(e){return e.childNodes}},{key:"childNodesAsList",value:function(e){for(var t=e.childNodes,n=new Array(t.length),r=0;r<t.length;r++)n[r]=t[r];return n}},{key:"clearNodes",value:function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}},{key:"appendChild",value:function(e,t){e.appendChild(t)}},{key:"removeChild",value:function(e,t){e.removeChild(t)}},{key:"replaceChild",value:function(e,t,n){e.replaceChild(t,n)}},{key:"remove",value:function(e){return e.parentNode&&e.parentNode.removeChild(e),e}},{key:"insertBefore",value:function(e,t,n){e.insertBefore(n,t)}},{key:"insertAllBefore",value:function(e,t,n){n.forEach((function(n){return e.insertBefore(n,t)}))}},{key:"insertAfter",value:function(e,t,n){e.insertBefore(n,t.nextSibling)}},{key:"setInnerHTML",value:function(e,t){e.innerHTML=t}},{key:"getText",value:function(e){return e.textContent}},{key:"setText",value:function(e,t){e.textContent=t}},{key:"getValue",value:function(e){return e.value}},{key:"setValue",value:function(e,t){e.value=t}},{key:"getChecked",value:function(e){return e.checked}},{key:"setChecked",value:function(e,t){e.checked=t}},{key:"createComment",value:function(e){return this.getDefaultDocument().createComment(e)}},{key:"createTemplate",value:function(e){var t=this.getDefaultDocument().createElement("template");return t.innerHTML=e,t}},{key:"createElement",value:function(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}},{key:"createElementNS",value:function(e,t,n){return(n=n||this.getDefaultDocument()).createElementNS(e,t)}},{key:"createTextNode",value:function(e,t){return(t=t||this.getDefaultDocument()).createTextNode(e)}},{key:"createScriptTag",value:function(e,t,n){var r=(n=n||this.getDefaultDocument()).createElement("SCRIPT");return r.setAttribute(e,t),r}},{key:"createStyleElement",value:function(e,t){var n=(t=t||this.getDefaultDocument()).createElement("style");return this.appendChild(n,this.createTextNode(e,t)),n}},{key:"createShadowRoot",value:function(e){return e.createShadowRoot()}},{key:"getShadowRoot",value:function(e){return e.shadowRoot}},{key:"getHost",value:function(e){return e.host}},{key:"clone",value:function(e){return e.cloneNode(!0)}},{key:"getElementsByClassName",value:function(e,t){return e.getElementsByClassName(t)}},{key:"getElementsByTagName",value:function(e,t){return e.getElementsByTagName(t)}},{key:"classList",value:function(e){return Array.prototype.slice.call(e.classList,0)}},{key:"addClass",value:function(e,t){e.classList.add(t)}},{key:"removeClass",value:function(e,t){e.classList.remove(t)}},{key:"hasClass",value:function(e,t){return e.classList.contains(t)}},{key:"setStyle",value:function(e,t,n){e.style[t]=n}},{key:"removeStyle",value:function(e,t){e.style[t]=""}},{key:"getStyle",value:function(e,t){return e.style[t]}},{key:"hasStyle",value:function(e,t,n){var r=this.getStyle(e,t)||"";return n?r==n:r.length>0}},{key:"tagName",value:function(e){return e.tagName}},{key:"attributeMap",value:function(e){for(var t=new Map,n=e.attributes,r=0;r<n.length;r++){var a=n.item(r);t.set(a.name,a.value)}return t}},{key:"hasAttribute",value:function(e,t){return e.hasAttribute(t)}},{key:"hasAttributeNS",value:function(e,t,n){return e.hasAttributeNS(t,n)}},{key:"getAttribute",value:function(e,t){return e.getAttribute(t)}},{key:"getAttributeNS",value:function(e,t,n){return e.getAttributeNS(t,n)}},{key:"setAttribute",value:function(e,t,n){e.setAttribute(t,n)}},{key:"setAttributeNS",value:function(e,t,n,r){e.setAttributeNS(t,n,r)}},{key:"removeAttribute",value:function(e,t){e.removeAttribute(t)}},{key:"removeAttributeNS",value:function(e,t,n){e.removeAttributeNS(t,n)}},{key:"templateAwareRoot",value:function(e){return this.isTemplateElement(e)?this.content(e):e}},{key:"createHtmlDocument",value:function(){return document.implementation.createHTMLDocument("fakeTitle")}},{key:"getDefaultDocument",value:function(){return document}},{key:"getBoundingClientRect",value:function(e){try{return e.getBoundingClientRect()}catch(t){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}}},{key:"getTitle",value:function(e){return e.title}},{key:"setTitle",value:function(e,t){e.title=t||""}},{key:"elementMatches",value:function(e,t){return!!this.isElementNode(e)&&(e.matches&&e.matches(t)||e.msMatchesSelector&&e.msMatchesSelector(t)||e.webkitMatchesSelector&&e.webkitMatchesSelector(t))}},{key:"isTemplateElement",value:function(e){return this.isElementNode(e)&&"TEMPLATE"===e.nodeName}},{key:"isTextNode",value:function(e){return e.nodeType===Node.TEXT_NODE}},{key:"isCommentNode",value:function(e){return e.nodeType===Node.COMMENT_NODE}},{key:"isElementNode",value:function(e){return e.nodeType===Node.ELEMENT_NODE}},{key:"hasShadowRoot",value:function(e){return null!=e.shadowRoot&&e instanceof HTMLElement}},{key:"isShadowRoot",value:function(e){return e instanceof DocumentFragment}},{key:"importIntoDoc",value:function(e){return document.importNode(this.templateAwareRoot(e),!0)}},{key:"adoptNode",value:function(e){return document.adoptNode(e)}},{key:"getHref",value:function(e){return e.getAttribute("href")}},{key:"getEventKey",value:function(e){var t=e.key;if(null==t){if(null==(t=e.keyIdentifier))return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&ec.hasOwnProperty(t)&&(t=ec[t]))}return $u[t]||t}},{key:"getGlobalEventTarget",value:function(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}},{key:"getHistory",value:function(){return window.history}},{key:"getLocation",value:function(){return window.location}},{key:"getBaseHref",value:function(e){var t,n=rc||(rc=document.querySelector("base"))?rc.getAttribute("href"):null;return null==n?null:(t=n,Qu||(Qu=document.createElement("a")),Qu.setAttribute("href",t),"/"===Qu.pathname.charAt(0)?Qu.pathname:"/"+Qu.pathname)}},{key:"resetBaseElement",value:function(){rc=null}},{key:"getUserAgent",value:function(){return window.navigator.userAgent}},{key:"setData",value:function(e,t,n){this.setAttribute(e,"data-"+t,n)}},{key:"getData",value:function(e,t){return this.getAttribute(e,"data-"+t)}},{key:"getComputedStyle",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return getComputedStyle(e)}))},{key:"supportsWebAnimation",value:function(){return"function"==typeof Element.prototype.animate}},{key:"performanceNow",value:function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}},{key:"supportsCookies",value:function(){return!0}},{key:"getCookie",value:function(e){return function(e,t){t=encodeURIComponent(t);var n,r=_createForOfIteratorHelper(e.split(";"));try{for(r.s();!(n=r.n()).done;){var a=n.value,i=a.indexOf("="),o=_slicedToArray(-1==i?[a,""]:[a.slice(0,i),a.slice(i+1)],2),s=o[0],u=o[1];if(s.trim()===t)return decodeURIComponent(u)}}catch(c){r.e(c)}finally{r.f()}return null}(document.cookie,e)}},{key:"setCookie",value:function(e,t){document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)}},{key:"attrToPropMap",get:function(){return Ju}}],[{key:"makeCurrent",value:function(){var e;e=new n,Yu||(Yu=e)}}]),n}(function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck(this,n),(e=t.call(this))._animationPrefix=null,e._transitionEnd=null;try{var r=e.createElement("div",document);if(null!=e.getStyle(r,"animationName"))e._animationPrefix="";else for(var a=["Webkit","Moz","O","ms"],i=0;i<a.length;i++)if(null!=e.getStyle(r,a[i]+"AnimationName")){e._animationPrefix="-"+a[i].toLowerCase()+"-";break}var o={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};Object.keys(o).forEach((function(t){null!=e.getStyle(r,t)&&(e._transitionEnd=o[t])}))}catch(s){e._animationPrefix=null,e._transitionEnd=null}return e}return _createClass(n,[{key:"getDistributedNodes",value:function(e){return e.getDistributedNodes()}},{key:"resolveAndSetHref",value:function(e,t,n){e.href=null==n?t:t+"/../"+n}},{key:"supportsDOMEvents",value:function(){return!0}},{key:"supportsNativeShadowDOM",value:function(){return"function"==typeof document.body.createShadowRoot}},{key:"getAnimationPrefix",value:function(){return this._animationPrefix?this._animationPrefix:""}},{key:"getTransitionEnd",value:function(){return this._transitionEnd?this._transitionEnd:""}},{key:"supportsAnimation",value:function(){return null!=this._animationPrefix&&null!=this._transitionEnd}}]),n}(function(){function e(){_classCallCheck(this,e),this.resourceLoaderType=null}return _createClass(e,[{key:"attrToPropMap",get:function(){return this._attrToPropMap},set:function(e){this._attrToPropMap=e}}]),e}())),rc=null;function ac(){return!!window.history.pushState}var ic=new nt("TRANSITION_ID"),oc=[{provide:Ka,useFactory:function(e,t,n){return function(){n.get(Xa).donePromise.then((function(){var n=Zu();Array.prototype.slice.apply(n.querySelectorAll(t,"style[ng-transition]")).filter((function(t){return n.getAttribute(t,"ng-transition")===e})).forEach((function(e){return n.remove(e)}))}))}},deps:[ic,Ys,nn],multi:!0}],sc=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"addToWindow",value:function(e){tt.getAngularTestability=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e.findTestabilityInTree(t,n);if(null==r)throw new Error("Could not find testability for element.");return r},tt.getAllAngularTestabilities=function(){return e.getAllTestabilities()},tt.getAllAngularRootElements=function(){return e.getAllRootElements()},tt.frameworkStabilizers||(tt.frameworkStabilizers=[]),tt.frameworkStabilizers.push((function(e){var t=tt.getAllAngularTestabilities(),n=t.length,r=!1,a=function(t){r=r||t,0==--n&&e(r)};t.forEach((function(e){e.whenStable(a)}))}))}},{key:"findTestabilityInTree",value:function(e,t,n){if(null==t)return null;var r=e.getTestability(t);return null!=r?r:n?Zu().isShadowRoot(t)?this.findTestabilityInTree(e,Zu().getHost(t),!0):this.findTestabilityInTree(e,Zu().parentElement(t),!0):null}}],[{key:"init",value:function(){var t;t=new e,Ai=t}}]),e}();function uc(e,t){"undefined"!=typeof COMPILED&&COMPILED||((tt.ng=tt.ng||{})[e]=t)}var cc={ApplicationRef:Li,NgZone:bi};function lc(e){return Xi(e)}var hc=new nt("EventManagerPlugins"),pc=function(){function e(t,n){var r=this;_classCallCheck(this,e),this._zone=n,this._eventNameToPlugin=new Map,t.forEach((function(e){return e.manager=r})),this._plugins=t.slice().reverse()}return _createClass(e,[{key:"addEventListener",value:function(e,t,n){return this._findPluginFor(t).addEventListener(e,t,n)}},{key:"addGlobalEventListener",value:function(e,t,n){return this._findPluginFor(t).addGlobalEventListener(e,t,n)}},{key:"getZone",value:function(){return this._zone}},{key:"_findPluginFor",value:function(e){var t=this._eventNameToPlugin.get(e);if(t)return t;for(var n=this._plugins,r=0;r<n.length;r++){var a=n[r];if(a.supports(e))return this._eventNameToPlugin.set(e,a),a}throw new Error("No event manager plugin found for event "+e)}}]),e}(),dc=function(){function e(t){_classCallCheck(this,e),this._doc=t}return _createClass(e,[{key:"addGlobalEventListener",value:function(e,t,n){var r=Zu().getGlobalEventTarget(this._doc,e);if(!r)throw new Error("Unsupported event target ".concat(r," for event ").concat(t));return this.addEventListener(r,t,n)}}]),e}(),fc=function(){function e(){_classCallCheck(this,e),this._stylesSet=new Set}return _createClass(e,[{key:"addStyles",value:function(e){var t=this,n=new Set;e.forEach((function(e){t._stylesSet.has(e)||(t._stylesSet.add(e),n.add(e))})),this.onStylesAdded(n)}},{key:"onStylesAdded",value:function(e){}},{key:"getAllStyles",value:function(){return Array.from(this._stylesSet)}}]),e}(),mc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this))._doc=e,r._hostNodes=new Set,r._styleNodes=new Set,r._hostNodes.add(e.head),r}return _createClass(n,[{key:"_addStylesToHost",value:function(e,t){var n=this;e.forEach((function(e){var r=n._doc.createElement("style");r.textContent=e,n._styleNodes.add(t.appendChild(r))}))}},{key:"addHost",value:function(e){this._addStylesToHost(this._stylesSet,e),this._hostNodes.add(e)}},{key:"removeHost",value:function(e){this._hostNodes.delete(e)}},{key:"onStylesAdded",value:function(e){var t=this;this._hostNodes.forEach((function(n){return t._addStylesToHost(e,n)}))}},{key:"ngOnDestroy",value:function(){this._styleNodes.forEach((function(e){return Zu().remove(e)}))}}]),n}(fc),vc={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},gc=/%COMP%/g;function yc(e,t,n){for(var r=0;r<t.length;r++){var a=t[r];Array.isArray(a)?yc(e,a,n):(a=a.replace(gc,e),n.push(a))}return n}function bc(e){return function(t){!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}var kc=function(){function e(t,n,r){_classCallCheck(this,e),this.eventManager=t,this.sharedStylesHost=n,this.appId=r,this.rendererByCompId=new Map,this.defaultRenderer=new xc(t)}return _createClass(e,[{key:"createRenderer",value:function(e,t){if(!e||!t)return this.defaultRenderer;switch(t.encapsulation){case vt.Emulated:var n=this.rendererByCompId.get(t.id);return n||(n=new _c(this.eventManager,this.sharedStylesHost,t,this.appId),this.rendererByCompId.set(t.id,n)),n.applyToHost(e),n;case vt.Native:case vt.ShadowDom:return new Sc(this.eventManager,this.sharedStylesHost,e,t);default:if(!this.rendererByCompId.has(t.id)){var r=yc(t.id,t.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(t.id,this.defaultRenderer)}return this.defaultRenderer}}},{key:"begin",value:function(){}},{key:"end",value:function(){}}]),e}(),xc=function(){function e(t){_classCallCheck(this,e),this.eventManager=t,this.data=Object.create(null)}return _createClass(e,[{key:"destroy",value:function(){}},{key:"createElement",value:function(e,t){return t?document.createElementNS(vc[t]||t,e):document.createElement(e)}},{key:"createComment",value:function(e){return document.createComment(e)}},{key:"createText",value:function(e){return document.createTextNode(e)}},{key:"appendChild",value:function(e,t){e.appendChild(t)}},{key:"insertBefore",value:function(e,t,n){e&&e.insertBefore(t,n)}},{key:"removeChild",value:function(e,t){e&&e.removeChild(t)}},{key:"selectRootElement",value:function(e,t){var n="string"==typeof e?document.querySelector(e):e;if(!n)throw new Error('The selector "'.concat(e,'" did not match any elements'));return t||(n.textContent=""),n}},{key:"parentNode",value:function(e){return e.parentNode}},{key:"nextSibling",value:function(e){return e.nextSibling}},{key:"setAttribute",value:function(e,t,n,r){if(r){t=r+":"+t;var a=vc[r];a?e.setAttributeNS(a,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)}},{key:"removeAttribute",value:function(e,t,n){if(n){var r=vc[n];r?e.removeAttributeNS(r,t):e.removeAttribute("".concat(n,":").concat(t))}else e.removeAttribute(t)}},{key:"addClass",value:function(e,t){e.classList.add(t)}},{key:"removeClass",value:function(e,t){e.classList.remove(t)}},{key:"setStyle",value:function(e,t,n,r){r&Dn.DashCase?e.style.setProperty(t,n,r&Dn.Important?"important":""):e.style[t]=n}},{key:"removeStyle",value:function(e,t,n){n&Dn.DashCase?e.style.removeProperty(t):e.style[t]=""}},{key:"setProperty",value:function(e,t,n){Cc(t,"property"),e[t]=n}},{key:"setValue",value:function(e,t){e.nodeValue=t}},{key:"listen",value:function(e,t,n){return Cc(t,"listener"),"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,bc(n)):this.eventManager.addEventListener(e,t,bc(n))}}]),e}(),wc="@".charCodeAt(0);function Cc(e,t){if(e.charCodeAt(0)===wc)throw new Error("Found the synthetic ".concat(t," ").concat(e,'. Please include either "BrowserAnimationsModule" or "NoopAnimationsModule" in your application.'))}var _c=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;_classCallCheck(this,n),(o=t.call(this,e)).component=a;var s,u=yc(i+"-"+a.id,a.styles,[]);return r.addStyles(u),o.contentAttr="_ngcontent-%COMP%".replace(gc,i+"-"+a.id),o.hostAttr=(s=i+"-"+a.id,"_nghost-%COMP%".replace(gc,s)),o}return _createClass(n,[{key:"applyToHost",value:function(e){_get(_getPrototypeOf(n.prototype),"setAttribute",this).call(this,e,this.hostAttr,"")}},{key:"createElement",value:function(e,t){var r=_get(_getPrototypeOf(n.prototype),"createElement",this).call(this,e,t);return _get(_getPrototypeOf(n.prototype),"setAttribute",this).call(this,r,this.contentAttr,""),r}}]),n}(xc),Sc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;_classCallCheck(this,n),(o=t.call(this,e)).sharedStylesHost=r,o.hostEl=a,o.component=i,o.shadowRoot=i.encapsulation===vt.ShadowDom?a.attachShadow({mode:"open"}):a.createShadowRoot(),o.sharedStylesHost.addHost(o.shadowRoot);for(var s=yc(i.id,i.styles,[]),u=0;u<s.length;u++){var c=document.createElement("style");c.textContent=s[u],o.shadowRoot.appendChild(c)}return o}return _createClass(n,[{key:"nodeOrShadowRoot",value:function(e){return e===this.hostEl?this.shadowRoot:e}},{key:"destroy",value:function(){this.sharedStylesHost.removeHost(this.shadowRoot)}},{key:"appendChild",value:function(e,t){return _get(_getPrototypeOf(n.prototype),"appendChild",this).call(this,this.nodeOrShadowRoot(e),t)}},{key:"insertBefore",value:function(e,t,r){return _get(_getPrototypeOf(n.prototype),"insertBefore",this).call(this,this.nodeOrShadowRoot(e),t,r)}},{key:"removeChild",value:function(e,t){return _get(_getPrototypeOf(n.prototype),"removeChild",this).call(this,this.nodeOrShadowRoot(e),t)}},{key:"parentNode",value:function(e){return this.nodeOrShadowRoot(_get(_getPrototypeOf(n.prototype),"parentNode",this).call(this,this.nodeOrShadowRoot(e)))}}]),n}(xc),Ic="undefined"!=typeof Zone&&Zone.__symbol__||function(e){return"__zone_symbol__"+e},Tc=Ic("addEventListener"),Nc=Ic("removeEventListener"),Ac={},Ec="__zone_symbol__propagationStopped",Rc=function(){var e="undefined"!=typeof Zone&&Zone[Ic("BLACK_LISTED_EVENTS")];if(e){var t={};return e.forEach((function(e){t[e]=e})),t}}(),Fc=function(e){return!!Rc&&Rc.hasOwnProperty(e)},Dc=function(e){var t=Ac[e.type];if(t){var n=this[t];if(n){var r=[e];if(1===n.length){var a=n[0];return a.zone!==Zone.current?a.zone.run(a.handler,this,r):a.handler.apply(this,r)}for(var i=n.slice(),o=0;o<i.length&&!0!==e[Ec];o++){var s=i[o];s.zone!==Zone.current?s.zone.run(s.handler,this,r):s.handler.apply(this,r)}}}},Oc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck(this,n),(i=t.call(this,e)).ngZone=r,a&&function(e){return"server"===e}(a)||i.patchEvent(),i}return _createClass(n,[{key:"patchEvent",value:function(){if("undefined"!=typeof Event&&Event&&Event.prototype&&!Event.prototype.__zone_symbol__stopImmediatePropagation){var e=Event.prototype.__zone_symbol__stopImmediatePropagation=Event.prototype.stopImmediatePropagation;Event.prototype.stopImmediatePropagation=function(){this&&(this[Ec]=!0),e&&e.apply(this,arguments)}}}},{key:"supports",value:function(e){return!0}},{key:"addEventListener",value:function(e,t,n){var r=this,a=n;if(!e[Tc]||bi.isInAngularZone()&&!Fc(t))e.addEventListener(t,a,!1);else{var i=Ac[t];i||(i=Ac[t]=Ic("ANGULAR"+t+"FALSE"));var o=e[i],s=o&&o.length>0;o||(o=e[i]=[]);var u=Fc(t)?Zone.root:Zone.current;if(0===o.length)o.push({zone:u,handler:a});else{for(var c=!1,l=0;l<o.length;l++)if(o[l].handler===a){c=!0;break}c||o.push({zone:u,handler:a})}s||e[Tc](t,Dc,!1)}return function(){return r.removeEventListener(e,t,a)}}},{key:"removeEventListener",value:function(e,t,n){var r=e[Nc];if(!r)return e.removeEventListener.apply(e,[t,n,!1]);var a=Ac[t],i=a&&e[a];if(!i)return e.removeEventListener.apply(e,[t,n,!1]);for(var o=!1,s=0;s<i.length;s++)if(i[s].handler===n){o=!0,i.splice(s,1);break}o?0===i.length&&r.apply(e,[t,Dc,!1]):e.removeEventListener.apply(e,[t,n,!1])}}]),n}(dc),Mc={pan:!0,panstart:!0,panmove:!0,panend:!0,pancancel:!0,panleft:!0,panright:!0,panup:!0,pandown:!0,pinch:!0,pinchstart:!0,pinchmove:!0,pinchend:!0,pinchcancel:!0,pinchin:!0,pinchout:!0,press:!0,pressup:!0,rotate:!0,rotatestart:!0,rotatemove:!0,rotateend:!0,rotatecancel:!0,swipe:!0,swipeleft:!0,swiperight:!0,swipeup:!0,swipedown:!0,tap:!0},Pc=new nt("HammerGestureConfig"),Lc=new nt("HammerLoader"),zc=function(){function e(){_classCallCheck(this,e),this.events=[],this.overrides={}}return _createClass(e,[{key:"buildHammer",value:function(e){var t=new Hammer(e,this.options);for(var n in t.get("pinch").set({enable:!0}),t.get("rotate").set({enable:!0}),this.overrides)t.get(n).set(this.overrides[n]);return t}}]),e}(),Bc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck(this,n),(o=t.call(this,e))._config=r,o.console=a,o.loader=i,o}return _createClass(n,[{key:"supports",value:function(e){return!(!Mc.hasOwnProperty(e.toLowerCase())&&!this.isCustomEvent(e)||!window.Hammer&&!this.loader&&(this.console.warn('The "'.concat(e,'" event cannot be bound because Hammer.JS is not loaded and no custom loader has been specified.')),1))}},{key:"addEventListener",value:function(e,t,n){var r=this,a=this.manager.getZone();if(t=t.toLowerCase(),!window.Hammer&&this.loader){var i=!1,o=function(){i=!0};return this.loader().then((function(){if(!window.Hammer)return r.console.warn("The custom HAMMER_LOADER completed, but Hammer.JS is not present."),void(o=function(){});i||(o=r.addEventListener(e,t,n))})).catch((function(){r.console.warn('The "'.concat(t,'" event cannot be bound because the custom Hammer.JS loader failed.')),o=function(){}})),function(){o()}}return a.runOutsideAngular((function(){var i=r._config.buildHammer(e),o=function(e){a.runGuarded((function(){n(e)}))};return i.on(t,o),function(){i.off(t,o),"function"==typeof i.destroy&&i.destroy()}}))}},{key:"isCustomEvent",value:function(e){return this._config.events.indexOf(e)>-1}}]),n}(dc),Vc=["alt","control","meta","shift"],Uc={alt:function(e){return e.altKey},control:function(e){return e.ctrlKey},meta:function(e){return e.metaKey},shift:function(e){return e.shiftKey}},Wc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"supports",value:function(e){return null!=n.parseEventName(e)}},{key:"addEventListener",value:function(e,t,r){var a=n.parseEventName(t),i=n.eventCallback(a.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular((function(){return Zu().onAndCancel(e,a.domEventName,i)}))}}],[{key:"parseEventName",value:function(e){var t=e.toLowerCase().split("."),r=t.shift();if(0===t.length||"keydown"!==r&&"keyup"!==r)return null;var a=n._normalizeKey(t.pop()),i="";if(Vc.forEach((function(e){var n=t.indexOf(e);n>-1&&(t.splice(n,1),i+=e+".")})),i+=a,0!=t.length||0===a.length)return null;var o={};return o.domEventName=r,o.fullKey=i,o}},{key:"getEventFullKey",value:function(e){var t="",n=Zu().getEventKey(e);return" "===(n=n.toLowerCase())?n="space":"."===n&&(n="dot"),Vc.forEach((function(r){r!=n&&(0,Uc[r])(e)&&(t+=r+".")})),t+=n}},{key:"eventCallback",value:function(e,t,r){return function(a){n.getEventFullKey(a)===e&&r.runGuarded((function(){return t(a)}))}}},{key:"_normalizeKey",value:function(e){switch(e){case"esc":return"escape";default:return e}}}]),n}(dc),Gc=function e(){_classCallCheck(this,e)},Hc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this))._doc=e,r}return _createClass(n,[{key:"sanitize",value:function(e,t){if(null==t)return null;switch(e){case qt.NONE:return t;case qt.HTML:return t instanceof qc?t.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(t,"HTML"),function(e,t){var n=null;try{Rt=Rt||new St(e);var r=t?String(t):"";n=Rt.getInertBodyElement(r);var a=5,i=r;do{if(0===a)throw new Error("Failed to sanitize html because the input is unstable");a--,r=i,i=n.innerHTML,n=Rt.getInertBodyElement(r)}while(r!==i);var o=new Ut,s=o.sanitizeChildren(jt(n)||n);return _t()&&o.sanitizedSomething&&console.warn("WARNING: sanitizing HTML stripped some content, see http://g.co/ng/security#xss"),s}finally{if(n)for(var u=jt(n)||n;u.firstChild;)u.removeChild(u.firstChild)}}(this._doc,String(t)));case qt.STYLE:return t instanceof Kc?t.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(t,"Style"),function(e){if(!(e=String(e).trim()))return"";var t=e.match(Yt);return t&&Nt(t[1])===t[1]||e.match(Xt)&&function(e){for(var t=!0,n=!0,r=0;r<e.length;r++){var a=e.charAt(r);"'"===a&&n?t=!t:'"'===a&&t&&(n=!n)}return t&&n}(e)?e:(_t()&&console.warn("WARNING: sanitizing unsafe style value ".concat(e," (see http://g.co/ng/security#xss).")),"unsafe")}(t));case qt.SCRIPT:if(t instanceof Xc)return t.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(t,"Script"),new Error("unsafe value used in a script context");case qt.URL:return t instanceof Zc||t instanceof Yc?t.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(t,"URL"),Nt(String(t)));case qt.RESOURCE_URL:if(t instanceof Zc)return t.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(t,"ResourceURL"),new Error("unsafe value used in a resource URL context (see http://g.co/ng/security#xss)");default:throw new Error("Unexpected SecurityContext ".concat(e," (see http://g.co/ng/security#xss)"))}}},{key:"checkNotSafeValue",value:function(e,t){if(e instanceof jc)throw new Error("Required a safe ".concat(t,", got a ").concat(e.getTypeName()," (see http://g.co/ng/security#xss)"))}},{key:"bypassSecurityTrustHtml",value:function(e){return new qc(e)}},{key:"bypassSecurityTrustStyle",value:function(e){return new Kc(e)}},{key:"bypassSecurityTrustScript",value:function(e){return new Xc(e)}},{key:"bypassSecurityTrustUrl",value:function(e){return new Yc(e)}},{key:"bypassSecurityTrustResourceUrl",value:function(e){return new Zc(e)}}]),n}(Gc),jc=function(){function e(t){_classCallCheck(this,e),this.changingThisBreaksApplicationSecurity=t}return _createClass(e,[{key:"toString",value:function(){return"SafeValue must use [property]=binding: "+this.changingThisBreaksApplicationSecurity+" (see http://g.co/ng/security#xss)"}}]),e}(),qc=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"getTypeName",value:function(){return"HTML"}}]),n}(jc),Kc=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"getTypeName",value:function(){return"Style"}}]),n}(jc),Xc=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"getTypeName",value:function(){return"Script"}}]),n}(jc),Yc=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"getTypeName",value:function(){return"URL"}}]),n}(jc),Zc=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"getTypeName",value:function(){return"ResourceURL"}}]),n}(jc),Qc=Fi(Zi,"browser",[{provide:$a,useValue:"browser"},{provide:Ja,useValue:function(){nc.makeCurrent(),sc.init()},multi:!0},{provide:Is,useClass:function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this))._doc=e,r._init(),r}return _createClass(n,[{key:"_init",value:function(){this.location=Zu().getLocation(),this._history=Zu().getHistory()}},{key:"getBaseHrefFromDOM",value:function(){return Zu().getBaseHref(this._doc)}},{key:"onPopState",value:function(e){Zu().getGlobalEventTarget(this._doc,"window").addEventListener("popstate",e,!1)}},{key:"onHashChange",value:function(e){Zu().getGlobalEventTarget(this._doc,"window").addEventListener("hashchange",e,!1)}},{key:"pushState",value:function(e,t,n){ac()?this._history.pushState(e,t,n):this.location.hash=n}},{key:"replaceState",value:function(e,t,n){ac()?this._history.replaceState(e,t,n):this.location.hash=n}},{key:"forward",value:function(){this._history.forward()}},{key:"back",value:function(){this._history.back()}},{key:"getState",value:function(){return this._history.state}},{key:"href",get:function(){return this.location.href}},{key:"protocol",get:function(){return this.location.protocol}},{key:"hostname",get:function(){return this.location.hostname}},{key:"port",get:function(){return this.location.port}},{key:"pathname",get:function(){return this.location.pathname},set:function(e){this.location.pathname=e}},{key:"search",get:function(){return this.location.search}},{key:"hash",get:function(){return this.location.hash}}]),n}(Is),deps:[Ys]},{provide:Ys,useFactory:function(){return document},deps:[]}]);function Jc(){return new xt}var $c=function(){function e(t){if(_classCallCheck(this,e),t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}return _createClass(e,null,[{key:"withServerTransition",value:function(t){return{ngModule:e,providers:[{provide:Ya,useValue:t.appId},{provide:ic,useExisting:Ya},oc]}}}]),e}();"undefined"!=typeof window&&window;var el=function e(t,n){_classCallCheck(this,e),this.id=t,this.url=n},tl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"imperative",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return _classCallCheck(this,n),(a=t.call(this,e,r)).navigationTrigger=i,a.restoredState=o,a}return _createClass(n,[{key:"toString",value:function(){return"NavigationStart(id: ".concat(this.id,", url: '").concat(this.url,"')")}}]),n}(el),nl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck(this,n),(i=t.call(this,e,r)).urlAfterRedirects=a,i}return _createClass(n,[{key:"toString",value:function(){return"NavigationEnd(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"')")}}]),n}(el),rl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck(this,n),(i=t.call(this,e,r)).reason=a,i}return _createClass(n,[{key:"toString",value:function(){return"NavigationCancel(id: ".concat(this.id,", url: '").concat(this.url,"')")}}]),n}(el),al=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck(this,n),(i=t.call(this,e,r)).error=a,i}return _createClass(n,[{key:"toString",value:function(){return"NavigationError(id: ".concat(this.id,", url: '").concat(this.url,"', error: ").concat(this.error,")")}}]),n}(el),il=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck(this,n),(o=t.call(this,e,r)).urlAfterRedirects=a,o.state=i,o}return _createClass(n,[{key:"toString",value:function(){return"RoutesRecognized(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,")")}}]),n}(el),ol=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck(this,n),(o=t.call(this,e,r)).urlAfterRedirects=a,o.state=i,o}return _createClass(n,[{key:"toString",value:function(){return"GuardsCheckStart(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,")")}}]),n}(el),sl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i,o){var s;return _classCallCheck(this,n),(s=t.call(this,e,r)).urlAfterRedirects=a,s.state=i,s.shouldActivate=o,s}return _createClass(n,[{key:"toString",value:function(){return"GuardsCheckEnd(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,", shouldActivate: ").concat(this.shouldActivate,")")}}]),n}(el),ul=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck(this,n),(o=t.call(this,e,r)).urlAfterRedirects=a,o.state=i,o}return _createClass(n,[{key:"toString",value:function(){return"ResolveStart(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,")")}}]),n}(el),cl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck(this,n),(o=t.call(this,e,r)).urlAfterRedirects=a,o.state=i,o}return _createClass(n,[{key:"toString",value:function(){return"ResolveEnd(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,")")}}]),n}(el),ll=function(){function e(t){_classCallCheck(this,e),this.route=t}return _createClass(e,[{key:"toString",value:function(){return"RouteConfigLoadStart(path: ".concat(this.route.path,")")}}]),e}(),hl=function(){function e(t){_classCallCheck(this,e),this.route=t}return _createClass(e,[{key:"toString",value:function(){return"RouteConfigLoadEnd(path: ".concat(this.route.path,")")}}]),e}(),pl=function(){function e(t){_classCallCheck(this,e),this.snapshot=t}return _createClass(e,[{key:"toString",value:function(){return"ChildActivationStart(path: '".concat(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"","')")}}]),e}(),dl=function(){function e(t){_classCallCheck(this,e),this.snapshot=t}return _createClass(e,[{key:"toString",value:function(){return"ChildActivationEnd(path: '".concat(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"","')")}}]),e}(),fl=function(){function e(t){_classCallCheck(this,e),this.snapshot=t}return _createClass(e,[{key:"toString",value:function(){return"ActivationStart(path: '".concat(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"","')")}}]),e}(),ml=function(){function e(t){_classCallCheck(this,e),this.snapshot=t}return _createClass(e,[{key:"toString",value:function(){return"ActivationEnd(path: '".concat(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"","')")}}]),e}(),vl=function(){function e(t,n,r){_classCallCheck(this,e),this.routerEvent=t,this.position=n,this.anchor=r}return _createClass(e,[{key:"toString",value:function(){return"Scroll(anchor: '".concat(this.anchor,"', position: '").concat(this.position?"".concat(this.position[0],", ").concat(this.position[1]):null,"')")}}]),e}(),gl=function e(){_classCallCheck(this,e)},yl=function(){function e(t){_classCallCheck(this,e),this.params=t||{}}return _createClass(e,[{key:"has",value:function(e){return this.params.hasOwnProperty(e)}},{key:"get",value:function(e){if(this.has(e)){var t=this.params[e];return Array.isArray(t)?t[0]:t}return null}},{key:"getAll",value:function(e){if(this.has(e)){var t=this.params[e];return Array.isArray(t)?t:[t]}return[]}},{key:"keys",get:function(){return Object.keys(this.params)}}]),e}();function bl(e){return new yl(e)}function kl(e){var t=Error("NavigationCancelingError: "+e);return t.ngNavigationCancelingError=!0,t}function xl(e,t,n){var r=n.path.split("/");if(r.length>e.length)return null;if("full"===n.pathMatch&&(t.hasChildren()||r.length<e.length))return null;for(var a={},i=0;i<r.length;i++){var o=r[i],s=e[i];if(o.startsWith(":"))a[o.substring(1)]=s;else if(o!==s.path)return null}return{consumed:e.slice(0,r.length),posParams:a}}var wl=function e(t,n){_classCallCheck(this,e),this.routes=t,this.module=n};function Cl(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=0;n<e.length;n++){var r=e[n];_l(r,Sl(t,r))}}function _l(e,t){if(!e)throw new Error("\n      Invalid configuration of route '".concat(t,"': Encountered undefined route.\n      The reason might be an extra comma.\n\n      Example:\n      const routes: Routes = [\n        { path: '', redirectTo: '/dashboard', pathMatch: 'full' },\n        { path: 'dashboard',  component: DashboardComponent },, << two commas\n        { path: 'detail/:id', component: HeroDetailComponent }\n      ];\n    "));if(Array.isArray(e))throw new Error("Invalid configuration of route '".concat(t,"': Array cannot be specified"));if(!e.component&&!e.children&&!e.loadChildren&&e.outlet&&"primary"!==e.outlet)throw new Error("Invalid configuration of route '".concat(t,"': a componentless route without children or loadChildren cannot have a named outlet set"));if(e.redirectTo&&e.children)throw new Error("Invalid configuration of route '".concat(t,"': redirectTo and children cannot be used together"));if(e.redirectTo&&e.loadChildren)throw new Error("Invalid configuration of route '".concat(t,"': redirectTo and loadChildren cannot be used together"));if(e.children&&e.loadChildren)throw new Error("Invalid configuration of route '".concat(t,"': children and loadChildren cannot be used together"));if(e.redirectTo&&e.component)throw new Error("Invalid configuration of route '".concat(t,"': redirectTo and component cannot be used together"));if(e.path&&e.matcher)throw new Error("Invalid configuration of route '".concat(t,"': path and matcher cannot be used together"));if(void 0===e.redirectTo&&!e.component&&!e.children&&!e.loadChildren)throw new Error("Invalid configuration of route '".concat(t,"'. One of the following must be provided: component, redirectTo, children or loadChildren"));if(void 0===e.path&&void 0===e.matcher)throw new Error("Invalid configuration of route '".concat(t,"': routes must have either a path or a matcher specified"));if("string"==typeof e.path&&"/"===e.path.charAt(0))throw new Error("Invalid configuration of route '".concat(t,"': path cannot start with a slash"));if(""===e.path&&void 0!==e.redirectTo&&void 0===e.pathMatch)throw new Error("Invalid configuration of route '{path: \"".concat(t,'", redirectTo: "').concat(e.redirectTo,"\"}': please provide 'pathMatch'. The default value of 'pathMatch' is 'prefix', but often the intent is to use 'full'."));if(void 0!==e.pathMatch&&"full"!==e.pathMatch&&"prefix"!==e.pathMatch)throw new Error("Invalid configuration of route '".concat(t,"': pathMatch can only be set to 'prefix' or 'full'"));e.children&&Cl(e.children,t)}function Sl(e,t){return t?e||t.path?e&&!t.path?e+"/":!e&&t.path?t.path:"".concat(e,"/").concat(t.path):"":e}function Il(e){var t=e.children&&e.children.map(Il),n=t?Object.assign({},e,{children:t}):Object.assign({},e);return!n.component&&(t||n.loadChildren)&&n.outlet&&"primary"!==n.outlet&&(n.component=gl),n}function Tl(e,t){var n,r=Object.keys(e),a=Object.keys(t);if(!r||!a||r.length!=a.length)return!1;for(var i=0;i<r.length;i++)if(e[n=r[i]]!==t[n])return!1;return!0}function Nl(e){return Array.prototype.concat.apply([],e)}function Al(e){return e.length>0?e[e.length-1]:null}function El(e,t){for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)}function Rl(e){return kn(e)?e:bn(e)?xe(Promise.resolve(e)):Js(e)}function Fl(e,t,n){return n?function(e,t){return Tl(e,t)}(e.queryParams,t.queryParams)&&function e(t,n){if(!Pl(t.segments,n.segments))return!1;if(t.numberOfChildren!==n.numberOfChildren)return!1;for(var r in n.children){if(!t.children[r])return!1;if(!e(t.children[r],n.children[r]))return!1}return!0}(e.root,t.root):function(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every((function(n){return t[n]===e[n]}))}(e.queryParams,t.queryParams)&&function e(t,n){return function t(n,r,a){if(n.segments.length>a.length)return!!Pl(n.segments.slice(0,a.length),a)&&!r.hasChildren();if(n.segments.length===a.length){if(!Pl(n.segments,a))return!1;for(var i in r.children){if(!n.children[i])return!1;if(!e(n.children[i],r.children[i]))return!1}return!0}var o=a.slice(0,n.segments.length),s=a.slice(n.segments.length);return!!Pl(n.segments,o)&&!!n.children.primary&&t(n.children.primary,r,s)}(t,n,n.segments)}(e.root,t.root)}var Dl=function(){function e(t,n,r){_classCallCheck(this,e),this.root=t,this.queryParams=n,this.fragment=r}return _createClass(e,[{key:"toString",value:function(){return Vl.serialize(this)}},{key:"queryParamMap",get:function(){return this._queryParamMap||(this._queryParamMap=bl(this.queryParams)),this._queryParamMap}}]),e}(),Ol=function(){function e(t,n){var r=this;_classCallCheck(this,e),this.segments=t,this.children=n,this.parent=null,El(n,(function(e,t){return e.parent=r}))}return _createClass(e,[{key:"hasChildren",value:function(){return this.numberOfChildren>0}},{key:"toString",value:function(){return Ul(this)}},{key:"numberOfChildren",get:function(){return Object.keys(this.children).length}}]),e}(),Ml=function(){function e(t,n){_classCallCheck(this,e),this.path=t,this.parameters=n}return _createClass(e,[{key:"toString",value:function(){return Kl(this)}},{key:"parameterMap",get:function(){return this._parameterMap||(this._parameterMap=bl(this.parameters)),this._parameterMap}}]),e}();function Pl(e,t){return e.length===t.length&&e.every((function(e,n){return e.path===t[n].path}))}function Ll(e,t){var n=[];return El(e.children,(function(e,r){"primary"===r&&(n=n.concat(t(e,r)))})),El(e.children,(function(e,r){"primary"!==r&&(n=n.concat(t(e,r)))})),n}var zl=function e(){_classCallCheck(this,e)},Bl=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"parse",value:function(e){var t=new Jl(e);return new Dl(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}},{key:"serialize",value:function(e){return"".concat("/"+function e(t,n){if(!t.hasChildren())return Ul(t);if(n){var r=t.children.primary?e(t.children.primary,!1):"",a=[];return El(t.children,(function(t,n){"primary"!==n&&a.push("".concat(n,":").concat(e(t,!1)))})),a.length>0?"".concat(r,"(").concat(a.join("//"),")"):r}var i=Ll(t,(function(n,r){return"primary"===r?[e(t.children.primary,!1)]:["".concat(r,":").concat(e(n,!1))]}));return"".concat(Ul(t),"/(").concat(i.join("//"),")")}(e.root,!0)).concat((t=e.queryParams,n=Object.keys(t).map((function(e){var n=t[e];return Array.isArray(n)?n.map((function(t){return"".concat(Gl(e),"=").concat(Gl(t))})).join("&"):"".concat(Gl(e),"=").concat(Gl(n))})),n.length?"?"+n.join("&"):"")).concat("string"==typeof e.fragment?"#"+encodeURI(e.fragment):"");var t,n}}]),e}(),Vl=new Bl;function Ul(e){return e.segments.map((function(e){return Kl(e)})).join("/")}function Wl(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Gl(e){return Wl(e).replace(/%3B/gi,";")}function Hl(e){return Wl(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function jl(e){return decodeURIComponent(e)}function ql(e){return jl(e.replace(/\+/g,"%20"))}function Kl(e){return"".concat(Hl(e.path)).concat((t=e.parameters,Object.keys(t).map((function(e){return";".concat(Hl(e),"=").concat(Hl(t[e]))})).join("")));var t}var Xl=/^[^\/()?;=#]+/;function Yl(e){var t=e.match(Xl);return t?t[0]:""}var Zl=/^[^=?&#]+/,Ql=/^[^?&#]+/,Jl=function(){function e(t){_classCallCheck(this,e),this.url=t,this.remaining=t}return _createClass(e,[{key:"parseRootSegment",value:function(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Ol([],{}):new Ol([],this.parseChildren())}},{key:"parseQueryParams",value:function(){var e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}},{key:"parseFragment",value:function(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}},{key:"parseChildren",value:function(){if(""===this.remaining)return{};this.consumeOptional("/");var e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());var t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));var n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(n.primary=new Ol(e,t)),n}},{key:"parseSegment",value:function(){var e=Yl(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error("Empty path url segment cannot have parameters: '".concat(this.remaining,"'."));return this.capture(e),new Ml(jl(e),this.parseMatrixParams())}},{key:"parseMatrixParams",value:function(){for(var e={};this.consumeOptional(";");)this.parseParam(e);return e}},{key:"parseParam",value:function(e){var t=Yl(this.remaining);if(t){this.capture(t);var n="";if(this.consumeOptional("=")){var r=Yl(this.remaining);r&&(n=r,this.capture(n))}e[jl(t)]=jl(n)}}},{key:"parseQueryParam",value:function(e){var t,n,r=(t=this.remaining,(n=t.match(Zl))?n[0]:"");if(r){this.capture(r);var a="";if(this.consumeOptional("=")){var i=function(e){var t=e.match(Ql);return t?t[0]:""}(this.remaining);i&&(a=i,this.capture(a))}var o=ql(r),s=ql(a);if(e.hasOwnProperty(o)){var u=e[o];Array.isArray(u)||(u=[u],e[o]=u),u.push(s)}else e[o]=s}}},{key:"parseParens",value:function(e){var t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){var n=Yl(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new Error("Cannot parse url '".concat(this.url,"'"));var a=void 0;n.indexOf(":")>-1?(a=n.substr(0,n.indexOf(":")),this.capture(a),this.capture(":")):e&&(a="primary");var i=this.parseChildren();t[a]=1===Object.keys(i).length?i.primary:new Ol([],i),this.consumeOptional("//")}return t}},{key:"peekStartsWith",value:function(e){return this.remaining.startsWith(e)}},{key:"consumeOptional",value:function(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}},{key:"capture",value:function(e){if(!this.consumeOptional(e))throw new Error('Expected "'.concat(e,'".'))}}]),e}(),$l=function(){function e(t){_classCallCheck(this,e),this._root=t}return _createClass(e,[{key:"parent",value:function(e){var t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}},{key:"children",value:function(e){var t=eh(e,this._root);return t?t.children.map((function(e){return e.value})):[]}},{key:"firstChild",value:function(e){var t=eh(e,this._root);return t&&t.children.length>0?t.children[0].value:null}},{key:"siblings",value:function(e){var t=th(e,this._root);return t.length<2?[]:t[t.length-2].children.map((function(e){return e.value})).filter((function(t){return t!==e}))}},{key:"pathFromRoot",value:function(e){return th(e,this._root).map((function(e){return e.value}))}},{key:"root",get:function(){return this._root.value}}]),e}();function eh(e,t){if(e===t.value)return t;var n,r=_createForOfIteratorHelper(t.children);try{for(r.s();!(n=r.n()).done;){var a=eh(e,n.value);if(a)return a}}catch(i){r.e(i)}finally{r.f()}return null}function th(e,t){if(e===t.value)return[t];var n,r=_createForOfIteratorHelper(t.children);try{for(r.s();!(n=r.n()).done;){var a=th(e,n.value);if(a.length)return a.unshift(t),a}}catch(i){r.e(i)}finally{r.f()}return[]}var nh=function(){function e(t,n){_classCallCheck(this,e),this.value=t,this.children=n}return _createClass(e,[{key:"toString",value:function(){return"TreeNode(".concat(this.value,")")}}]),e}();function rh(e){var t={};return e&&e.children.forEach((function(e){return t[e.value.outlet]=e})),t}var ah=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this,e)).snapshot=r,lh(_assertThisInitialized(a),e),a}return _createClass(n,[{key:"toString",value:function(){return this.snapshot.toString()}}]),n}($l);function ih(e,t){var n=function(e,t){var n=new uh([],{},{},"",{},"primary",t,null,e.root,-1,{});return new ch("",new nh(n,[]))}(e,t),r=new $s([new Ml("",{})]),a=new $s({}),i=new $s({}),o=new $s({}),s=new $s(""),u=new oh(r,a,o,s,i,"primary",t,n.root);return u.snapshot=n.root,new ah(new nh(u,[]),n)}var oh=function(){function e(t,n,r,a,i,o,s,u){_classCallCheck(this,e),this.url=t,this.params=n,this.queryParams=r,this.fragment=a,this.data=i,this.outlet=o,this.component=s,this._futureSnapshot=u}return _createClass(e,[{key:"toString",value:function(){return this.snapshot?this.snapshot.toString():"Future(".concat(this._futureSnapshot,")")}},{key:"routeConfig",get:function(){return this._futureSnapshot.routeConfig}},{key:"root",get:function(){return this._routerState.root}},{key:"parent",get:function(){return this._routerState.parent(this)}},{key:"firstChild",get:function(){return this._routerState.firstChild(this)}},{key:"children",get:function(){return this._routerState.children(this)}},{key:"pathFromRoot",get:function(){return this._routerState.pathFromRoot(this)}},{key:"paramMap",get:function(){return this._paramMap||(this._paramMap=this.params.pipe(pe((function(e){return bl(e)})))),this._paramMap}},{key:"queryParamMap",get:function(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(pe((function(e){return bl(e)})))),this._queryParamMap}}]),e}();function sh(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"emptyOnly",n=e.pathFromRoot,r=0;if("always"!==t)for(r=n.length-1;r>=1;){var a=n[r],i=n[r-1];if(a.routeConfig&&""===a.routeConfig.path)r--;else{if(i.component)break;r--}}return function(e){return e.reduce((function(e,t){return{params:Object.assign({},e.params,t.params),data:Object.assign({},e.data,t.data),resolve:Object.assign({},e.resolve,t._resolvedData)}}),{params:{},data:{},resolve:{}})}(n.slice(r))}var uh=function(){function e(t,n,r,a,i,o,s,u,c,l,h){_classCallCheck(this,e),this.url=t,this.params=n,this.queryParams=r,this.fragment=a,this.data=i,this.outlet=o,this.component=s,this.routeConfig=u,this._urlSegment=c,this._lastPathIndex=l,this._resolve=h}return _createClass(e,[{key:"toString",value:function(){return"Route(url:'".concat(this.url.map((function(e){return e.toString()})).join("/"),"', path:'").concat(this.routeConfig?this.routeConfig.path:"","')")}},{key:"root",get:function(){return this._routerState.root}},{key:"parent",get:function(){return this._routerState.parent(this)}},{key:"firstChild",get:function(){return this._routerState.firstChild(this)}},{key:"children",get:function(){return this._routerState.children(this)}},{key:"pathFromRoot",get:function(){return this._routerState.pathFromRoot(this)}},{key:"paramMap",get:function(){return this._paramMap||(this._paramMap=bl(this.params)),this._paramMap}},{key:"queryParamMap",get:function(){return this._queryParamMap||(this._queryParamMap=bl(this.queryParams)),this._queryParamMap}}]),e}(),ch=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this,r)).url=e,lh(_assertThisInitialized(a),r),a}return _createClass(n,[{key:"toString",value:function(){return hh(this._root)}}]),n}($l);function lh(e,t){t.value._routerState=e,t.children.forEach((function(t){return lh(e,t)}))}function hh(e){var t=e.children.length>0?" { ".concat(e.children.map(hh).join(", ")," } "):"";return"".concat(e.value).concat(t)}function ph(e){if(e.snapshot){var t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,Tl(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),Tl(t.params,n.params)||e.params.next(n.params),function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(!Tl(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),Tl(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function dh(e,t){var n,r;return Tl(e.params,t.params)&&Pl(n=e.url,r=t.url)&&n.every((function(e,t){return Tl(e.parameters,r[t].parameters)}))&&!(!e.parent!=!t.parent)&&(!e.parent||dh(e.parent,t.parent))}function fh(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function mh(e,t,n,r,a){var i={};return r&&El(r,(function(e,t){i[t]=Array.isArray(e)?e.map((function(e){return""+e})):""+e})),new Dl(n.root===e?t:function e(t,n,r){var a={};return El(t.children,(function(t,i){a[i]=t===n?r:e(t,n,r)})),new Ol(t.segments,a)}(n.root,e,t),i,a)}var vh=function(){function e(t,n,r){if(_classCallCheck(this,e),this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=r,t&&r.length>0&&fh(r[0]))throw new Error("Root segment cannot have matrix parameters");var a=r.find((function(e){return"object"==typeof e&&null!=e&&e.outlets}));if(a&&a!==Al(r))throw new Error("{outlets:{}} has to be the last command")}return _createClass(e,[{key:"toRoot",value:function(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}]),e}(),gh=function e(t,n,r){_classCallCheck(this,e),this.segmentGroup=t,this.processChildren=n,this.index=r};function yh(e){return"object"==typeof e&&null!=e&&e.outlets?e.outlets.primary:""+e}function bh(e,t,n){if(e||(e=new Ol([],{})),0===e.segments.length&&e.hasChildren())return kh(e,t,n);var r=function(e,t,n){for(var r=0,a=t,i={match:!1,pathIndex:0,commandIndex:0};a<e.segments.length;){if(r>=n.length)return i;var o=e.segments[a],s=yh(n[r]),u=r<n.length-1?n[r+1]:null;if(a>0&&void 0===s)break;if(s&&u&&"object"==typeof u&&void 0===u.outlets){if(!_h(s,u,o))return i;r+=2}else{if(!_h(s,{},o))return i;r++}a++}return{match:!0,pathIndex:a,commandIndex:r}}(e,t,n),a=n.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){var i=new Ol(e.segments.slice(0,r.pathIndex),{});return i.children.primary=new Ol(e.segments.slice(r.pathIndex),e.children),kh(i,0,a)}return r.match&&0===a.length?new Ol(e.segments,{}):r.match&&!e.hasChildren()?xh(e,t,n):r.match?kh(e,0,a):xh(e,t,n)}function kh(e,t,n){if(0===n.length)return new Ol(e.segments,{});var r=function(e){return"object"!=typeof e[0]||void 0===e[0].outlets?{primary:e}:e[0].outlets}(n),a={};return El(r,(function(n,r){null!==n&&(a[r]=bh(e.children[r],t,n))})),El(e.children,(function(e,t){void 0===r[t]&&(a[t]=e)})),new Ol(e.segments,a)}function xh(e,t,n){for(var r=e.segments.slice(0,t),a=0;a<n.length;){if("object"==typeof n[a]&&void 0!==n[a].outlets){var i=wh(n[a].outlets);return new Ol(r,i)}if(0===a&&fh(n[0]))r.push(new Ml(e.segments[t].path,n[0])),a++;else{var o=yh(n[a]),s=a<n.length-1?n[a+1]:null;o&&s&&fh(s)?(r.push(new Ml(o,Ch(s))),a+=2):(r.push(new Ml(o,{})),a++)}}return new Ol(r,{})}function wh(e){var t={};return El(e,(function(e,n){null!==e&&(t[n]=xh(new Ol([],{}),0,e))})),t}function Ch(e){var t={};return El(e,(function(e,n){return t[n]=""+e})),t}function _h(e,t,n){return e==n.path&&Tl(t,n.parameters)}var Sh=function(){function e(t,n,r,a){_classCallCheck(this,e),this.routeReuseStrategy=t,this.futureState=n,this.currState=r,this.forwardEvent=a}return _createClass(e,[{key:"activate",value:function(e){var t=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,n,e),ph(this.futureState.root),this.activateChildRoutes(t,n,e)}},{key:"deactivateChildRoutes",value:function(e,t,n){var r=this,a=rh(t);e.children.forEach((function(e){var t=e.value.outlet;r.deactivateRoutes(e,a[t],n),delete a[t]})),El(a,(function(e,t){r.deactivateRouteAndItsChildren(e,n)}))}},{key:"deactivateRoutes",value:function(e,t,n){var r=e.value,a=t?t.value:null;if(r===a)if(r.component){var i=n.getContext(r.outlet);i&&this.deactivateChildRoutes(e,t,i.children)}else this.deactivateChildRoutes(e,t,n);else a&&this.deactivateRouteAndItsChildren(t,n)}},{key:"deactivateRouteAndItsChildren",value:function(e,t){this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}},{key:"detachAndStoreRouteSubtree",value:function(e,t){var n=t.getContext(e.value.outlet);if(n&&n.outlet){var r=n.outlet.detach(),a=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:r,route:e,contexts:a})}}},{key:"deactivateRouteAndOutlet",value:function(e,t){var n=this,r=t.getContext(e.value.outlet);if(r){var a=rh(e),i=e.value.component?r.children:t;El(a,(function(e,t){return n.deactivateRouteAndItsChildren(e,i)})),r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated())}}},{key:"activateChildRoutes",value:function(e,t,n){var r=this,a=rh(t);e.children.forEach((function(e){r.activateRoutes(e,a[e.value.outlet],n),r.forwardEvent(new ml(e.value.snapshot))})),e.children.length&&this.forwardEvent(new dl(e.value.snapshot))}},{key:"activateRoutes",value:function(e,t,n){var r=e.value,a=t?t.value:null;if(ph(r),r===a)if(r.component){var i=n.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,i.children)}else this.activateChildRoutes(e,t,n);else if(r.component){var o=n.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){var s=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),o.children.onOutletReAttached(s.contexts),o.attachRef=s.componentRef,o.route=s.route.value,o.outlet&&o.outlet.attach(s.componentRef,s.route.value),Ih(s.route)}else{var u=function(e){for(var t=e.parent;t;t=t.parent){var n=t.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig;if(n&&n.component)return null}return null}(r.snapshot),c=u?u.module.componentFactoryResolver:null;o.attachRef=null,o.route=r,o.resolver=c,o.outlet&&o.outlet.activateWith(r,c),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,n)}}]),e}();function Ih(e){ph(e.value),e.children.forEach(Ih)}function Th(e){return"function"==typeof e}function Nh(e){return e instanceof Dl}var Ah=function e(t){_classCallCheck(this,e),this.segmentGroup=t||null},Eh=function e(t){_classCallCheck(this,e),this.urlTree=t};function Rh(e){return new re((function(t){return t.error(new Ah(e))}))}function Fh(e){return new re((function(t){return t.error(new Eh(e))}))}function Dh(e){return new re((function(t){return t.error(new Error("Only absolute redirects can have named outlets. redirectTo: '".concat(e,"'")))}))}var Oh=function(){function e(t,n,r,a,i){_classCallCheck(this,e),this.configLoader=n,this.urlSerializer=r,this.urlTree=a,this.config=i,this.allowRedirects=!0,this.ngModule=t.get(pt)}return _createClass(e,[{key:"apply",value:function(){var e=this;return this.expandSegmentGroup(this.ngModule,this.config,this.urlTree.root,"primary").pipe(pe((function(t){return e.createUrlTree(t,e.urlTree.queryParams,e.urlTree.fragment)}))).pipe(Iu((function(t){if(t instanceof Eh)return e.allowRedirects=!1,e.match(t.urlTree);if(t instanceof Ah)throw e.noMatchError(t);throw t})))}},{key:"match",value:function(e){var t=this;return this.expandSegmentGroup(this.ngModule,this.config,e.root,"primary").pipe(pe((function(n){return t.createUrlTree(n,e.queryParams,e.fragment)}))).pipe(Iu((function(e){if(e instanceof Ah)throw t.noMatchError(e);throw e})))}},{key:"noMatchError",value:function(e){return new Error("Cannot match any routes. URL Segment: '".concat(e.segmentGroup,"'"))}},{key:"createUrlTree",value:function(e,t,n){var r=e.segments.length>0?new Ol([],{primary:e}):e;return new Dl(r,t,n)}},{key:"expandSegmentGroup",value:function(e,t,n,r){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(e,t,n).pipe(pe((function(e){return new Ol([],e)}))):this.expandSegment(e,n,t,n.segments,r,!0)}},{key:"expandChildren",value:function(e,t,n){var r=this;return function(n,a){if(0===Object.keys(n).length)return Js({});var i=[],o=[],s={};return El(n,(function(n,a){var u,c,l=(u=a,c=n,r.expandSegmentGroup(e,t,c,u)).pipe(pe((function(e){return s[a]=e})));"primary"===a?i.push(l):o.push(l)})),Js.apply(null,i.concat(o)).pipe(lu(),Su(),pe((function(){return s})))}(n.children)}},{key:"expandSegment",value:function(e,t,n,r,a,i){var o=this;return Js.apply(void 0,_toConsumableArray(n)).pipe(pe((function(s){return o.expandSegmentAgainstRoute(e,t,n,s,r,a,i).pipe(Iu((function(e){if(e instanceof Ah)return Js(null);throw e})))})),lu(),Fu((function(e){return!!e})),Iu((function(e,n){if(e instanceof eu||"EmptyError"===e.name){if(o.noLeftoversInUrl(t,r,a))return Js(new Ol([],{}));throw new Ah(t)}throw e})))}},{key:"noLeftoversInUrl",value:function(e,t,n){return 0===t.length&&!e.children[n]}},{key:"expandSegmentAgainstRoute",value:function(e,t,n,r,a,i,o){return zh(r)!==i?Rh(t):void 0===r.redirectTo?this.matchSegmentAgainstRoute(e,t,r,a):o&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,n,r,a,i):Rh(t)}},{key:"expandSegmentAgainstRouteUsingRedirect",value:function(e,t,n,r,a,i){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,r,i):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,r,a,i)}},{key:"expandWildCardWithParamsAgainstRouteUsingRedirect",value:function(e,t,n,r){var a=this,i=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?Fh(i):this.lineralizeSegments(n,i).pipe(Se((function(n){var i=new Ol(n,{});return a.expandSegment(e,i,t,n,r,!1)})))}},{key:"expandRegularSegmentAgainstRouteUsingRedirect",value:function(e,t,n,r,a,i){var o=this,s=Mh(t,r,a),u=s.matched,c=s.consumedSegments,l=s.lastChild,h=s.positionalParamSegments;if(!u)return Rh(t);var p=this.applyRedirectCommands(c,r.redirectTo,h);return r.redirectTo.startsWith("/")?Fh(p):this.lineralizeSegments(r,p).pipe(Se((function(r){return o.expandSegment(e,t,n,r.concat(a.slice(l)),i,!1)})))}},{key:"matchSegmentAgainstRoute",value:function(e,t,n,r){var a=this;if("**"===n.path)return n.loadChildren?this.configLoader.load(e.injector,n).pipe(pe((function(e){return n._loadedConfig=e,new Ol(r,{})}))):Js(new Ol(r,{}));var i=Mh(t,n,r),o=i.matched,s=i.consumedSegments,u=i.lastChild;if(!o)return Rh(t);var c=r.slice(u);return this.getChildConfig(e,n,r).pipe(Se((function(e){var n=e.module,r=e.routes,i=function(e,t,n,r){return n.length>0&&function(e,t,n){return n.some((function(n){return Lh(e,t,n)&&"primary"!==zh(n)}))}(e,n,r)?{segmentGroup:Ph(new Ol(t,function(e,t){var n={};n.primary=t;var r,a=_createForOfIteratorHelper(e);try{for(a.s();!(r=a.n()).done;){var i=r.value;""===i.path&&"primary"!==zh(i)&&(n[zh(i)]=new Ol([],{}))}}catch(o){a.e(o)}finally{a.f()}return n}(r,new Ol(n,e.children)))),slicedSegments:[]}:0===n.length&&function(e,t,n){return n.some((function(n){return Lh(e,t,n)}))}(e,n,r)?{segmentGroup:Ph(new Ol(e.segments,function(e,t,n,r){var a,i={},o=_createForOfIteratorHelper(n);try{for(o.s();!(a=o.n()).done;){var s=a.value;Lh(e,t,s)&&!r[zh(s)]&&(i[zh(s)]=new Ol([],{}))}}catch(u){o.e(u)}finally{o.f()}return Object.assign({},r,i)}(e,n,r,e.children))),slicedSegments:n}:{segmentGroup:e,slicedSegments:n}}(t,s,c,r),o=i.segmentGroup,u=i.slicedSegments;return 0===u.length&&o.hasChildren()?a.expandChildren(n,r,o).pipe(pe((function(e){return new Ol(s,e)}))):0===r.length&&0===u.length?Js(new Ol(s,{})):a.expandSegment(n,o,r,u,"primary",!0).pipe(pe((function(e){return new Ol(s.concat(e.segments),e.children)})))})))}},{key:"getChildConfig",value:function(e,t,n){var r=this;return t.children?Js(new wl(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?Js(t._loadedConfig):function(e,t,n){var r,a=t.canLoad;return a&&0!==a.length?xe(a).pipe(pe((function(r){var a,i=e.get(r);if(function(e){return e&&Th(e.canLoad)}(i))a=i.canLoad(t,n);else{if(!Th(i))throw new Error("Invalid CanLoad guard");a=i(t,n)}return Rl(a)}))).pipe(lu(),(r=function(e){return!0===e},function(e){return e.lift(new Du(r,void 0,e))})):Js(!0)}(e.injector,t,n).pipe(Se((function(n){return n?r.configLoader.load(e.injector,t).pipe(pe((function(e){return t._loadedConfig=e,e}))):function(e){return new re((function(t){return t.error(kl("Cannot load children because the guard of the route \"path: '".concat(e.path,"'\" returned false")))}))}(t)}))):Js(new wl([],e))}},{key:"lineralizeSegments",value:function(e,t){for(var n=[],r=t.root;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return Js(n);if(r.numberOfChildren>1||!r.children.primary)return Dh(e.redirectTo);r=r.children.primary}}},{key:"applyRedirectCommands",value:function(e,t,n){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,n)}},{key:"applyRedirectCreatreUrlTree",value:function(e,t,n,r){var a=this.createSegmentGroup(e,t.root,n,r);return new Dl(a,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}},{key:"createQueryParams",value:function(e,t){var n={};return El(e,(function(e,r){if("string"==typeof e&&e.startsWith(":")){var a=e.substring(1);n[r]=t[a]}else n[r]=e})),n}},{key:"createSegmentGroup",value:function(e,t,n,r){var a=this,i=this.createSegments(e,t.segments,n,r),o={};return El(t.children,(function(t,i){o[i]=a.createSegmentGroup(e,t,n,r)})),new Ol(i,o)}},{key:"createSegments",value:function(e,t,n,r){var a=this;return t.map((function(t){return t.path.startsWith(":")?a.findPosParam(e,t,r):a.findOrReturn(t,n)}))}},{key:"findPosParam",value:function(e,t,n){var r=n[t.path.substring(1)];if(!r)throw new Error("Cannot redirect to '".concat(e,"'. Cannot find '").concat(t.path,"'."));return r}},{key:"findOrReturn",value:function(e,t){var n,r=0,a=_createForOfIteratorHelper(t);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i.path===e.path)return t.splice(r),i;r++}}catch(o){a.e(o)}finally{a.f()}return e}}]),e}();function Mh(e,t,n){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}:{matched:!0,consumedSegments:[],lastChild:0,positionalParamSegments:{}};var r=(t.matcher||xl)(n,e,t);return r?{matched:!0,consumedSegments:r.consumed,lastChild:r.consumed.length,positionalParamSegments:r.posParams}:{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}}function Ph(e){if(1===e.numberOfChildren&&e.children.primary){var t=e.children.primary;return new Ol(e.segments.concat(t.segments),t.children)}return e}function Lh(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path&&void 0!==n.redirectTo}function zh(e){return e.outlet||"primary"}var Bh=function e(t){_classCallCheck(this,e),this.path=t,this.route=this.path[this.path.length-1]},Vh=function e(t,n){_classCallCheck(this,e),this.component=t,this.route=n};function Uh(e,t,n){var r=function(e){if(!e)return null;for(var t=e.parent;t;t=t.parent){var n=t.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig}return null}(t);return(r?r.module.injector:n).get(e)}function Wh(e,t,n){var r=rh(e),a=e.value;El(r,(function(e,r){Wh(e,a.component?t?t.children.getContext(r):null:t,n)})),n.canDeactivateChecks.push(new Vh(a.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,a))}var Gh=Symbol("INITIAL_VALUE");function Hh(){return Mu((function(e){return(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=void 0,a=void 0;return he(t[t.length-1])&&(a=t.pop()),"function"==typeof t[t.length-1]&&(r=t.pop()),1===t.length&&G(t[0])&&(t=t[0]),Ae(t,a).lift(new iu(r))}).apply(void 0,_toConsumableArray(e.map((function(e){return e.pipe(Au(1),function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[t.length-1];return he(r)?(t.pop(),function(e){return zu(t,e,r)}):function(e){return zu(t,e)}}(Gh))})))).pipe(Bu((function(e,t){var n=!1;return t.reduce((function(e,r,a){if(e!==Gh)return e;if(r===Gh&&(n=!0),!n){if(!1===r)return r;if(a===t.length-1||Nh(r))return r}return e}),e)}),Gh),hu((function(e){return e!==Gh})),pe((function(e){return Nh(e)?e:!0===e})),Au(1))}))}function jh(e,t){return null!==e&&t&&t(new fl(e)),Js(!0)}function qh(e,t){return null!==e&&t&&t(new pl(e)),Js(!0)}function Kh(e,t,n){var r=t.routeConfig?t.routeConfig.canActivate:null;return r&&0!==r.length?Js(r.map((function(r){return cu((function(){var a,i=Uh(r,t,n);if(function(e){return e&&Th(e.canActivate)}(i))a=Rl(i.canActivate(t,e));else{if(!Th(i))throw new Error("Invalid CanActivate guard");a=Rl(i(t,e))}return a.pipe(Fu())}))}))).pipe(Hh()):Js(!0)}function Xh(e,t,n){var r=t[t.length-1],a=t.slice(0,t.length-1).reverse().map((function(e){return function(e){var t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(e)})).filter((function(e){return null!==e})).map((function(t){return cu((function(){return Js(t.guards.map((function(a){var i,o=Uh(a,t.node,n);if(function(e){return e&&Th(e.canActivateChild)}(o))i=Rl(o.canActivateChild(r,e));else{if(!Th(o))throw new Error("Invalid CanActivateChild guard");i=Rl(o(r,e))}return i.pipe(Fu())}))).pipe(Hh())}))}));return Js(a).pipe(Hh())}var Yh=function e(){_classCallCheck(this,e)},Zh=function(){function e(t,n,r,a,i,o){_classCallCheck(this,e),this.rootComponentType=t,this.config=n,this.urlTree=r,this.url=a,this.paramsInheritanceStrategy=i,this.relativeLinkResolution=o}return _createClass(e,[{key:"recognize",value:function(){try{var e=$h(this.urlTree.root,[],[],this.config,this.relativeLinkResolution).segmentGroup,t=this.processSegmentGroup(this.config,e,"primary"),n=new uh([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},"primary",this.rootComponentType,null,this.urlTree.root,-1,{}),r=new nh(n,t),a=new ch(this.url,r);return this.inheritParamsAndData(a._root),Js(a)}catch(i){return new re((function(e){return e.error(i)}))}}},{key:"inheritParamsAndData",value:function(e){var t=this,n=e.value,r=sh(n,this.paramsInheritanceStrategy);n.params=Object.freeze(r.params),n.data=Object.freeze(r.data),e.children.forEach((function(e){return t.inheritParamsAndData(e)}))}},{key:"processSegmentGroup",value:function(e,t,n){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,n)}},{key:"processChildren",value:function(e,t){var n,r=this,a=Ll(t,(function(t,n){return r.processSegmentGroup(e,t,n)}));return n={},a.forEach((function(e){var t=n[e.value.outlet];if(t){var r=t.url.map((function(e){return e.toString()})).join("/"),a=e.value.url.map((function(e){return e.toString()})).join("/");throw new Error("Two segments cannot have the same outlet name: '".concat(r,"' and '").concat(a,"'."))}n[e.value.outlet]=e.value})),a.sort((function(e,t){return"primary"===e.value.outlet?-1:"primary"===t.value.outlet?1:e.value.outlet.localeCompare(t.value.outlet)})),a}},{key:"processSegment",value:function(e,t,n,r){var a,i=_createForOfIteratorHelper(e);try{for(i.s();!(a=i.n()).done;){var o=a.value;try{return this.processSegmentAgainstRoute(o,t,n,r)}catch(s){if(!(s instanceof Yh))throw s}}}catch(u){i.e(u)}finally{i.f()}if(this.noLeftoversInUrl(t,n,r))return[];throw new Yh}},{key:"noLeftoversInUrl",value:function(e,t,n){return 0===t.length&&!e.children[n]}},{key:"processSegmentAgainstRoute",value:function(e,t,n,r){if(e.redirectTo)throw new Yh;if((e.outlet||"primary")!==r)throw new Yh;var a,i=[],o=[];if("**"===e.path){var s=n.length>0?Al(n).parameters:{};a=new uh(n,s,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,np(e),r,e.component,e,Qh(t),Jh(t)+n.length,rp(e))}else{var u=function(e,t,n){if(""===t.path){if("full"===t.pathMatch&&(e.hasChildren()||n.length>0))throw new Yh;return{consumedSegments:[],lastChild:0,parameters:{}}}var r=(t.matcher||xl)(n,e,t);if(!r)throw new Yh;var a={};El(r.posParams,(function(e,t){a[t]=e.path}));var i=r.consumed.length>0?Object.assign({},a,r.consumed[r.consumed.length-1].parameters):a;return{consumedSegments:r.consumed,lastChild:r.consumed.length,parameters:i}}(t,e,n);i=u.consumedSegments,o=n.slice(u.lastChild),a=new uh(i,u.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,np(e),r,e.component,e,Qh(t),Jh(t)+i.length,rp(e))}var c=function(e){return e.children?e.children:e.loadChildren?e._loadedConfig.routes:[]}(e),l=$h(t,i,o,c,this.relativeLinkResolution),h=l.segmentGroup,p=l.slicedSegments;if(0===p.length&&h.hasChildren()){var d=this.processChildren(c,h);return[new nh(a,d)]}if(0===c.length&&0===p.length)return[new nh(a,[])];var f=this.processSegment(c,h,p,"primary");return[new nh(a,f)]}}]),e}();function Qh(e){for(var t=e;t._sourceSegment;)t=t._sourceSegment;return t}function Jh(e){for(var t=e,n=t._segmentIndexShift?t._segmentIndexShift:0;t._sourceSegment;)n+=(t=t._sourceSegment)._segmentIndexShift?t._segmentIndexShift:0;return n-1}function $h(e,t,n,r,a){if(n.length>0&&function(e,t,n){return n.some((function(n){return ep(e,t,n)&&"primary"!==tp(n)}))}(e,n,r)){var i=new Ol(t,function(e,t,n,r){var a={};a.primary=r,r._sourceSegment=e,r._segmentIndexShift=t.length;var i,o=_createForOfIteratorHelper(n);try{for(o.s();!(i=o.n()).done;){var s=i.value;if(""===s.path&&"primary"!==tp(s)){var u=new Ol([],{});u._sourceSegment=e,u._segmentIndexShift=t.length,a[tp(s)]=u}}}catch(c){o.e(c)}finally{o.f()}return a}(e,t,r,new Ol(n,e.children)));return i._sourceSegment=e,i._segmentIndexShift=t.length,{segmentGroup:i,slicedSegments:[]}}if(0===n.length&&function(e,t,n){return n.some((function(n){return ep(e,t,n)}))}(e,n,r)){var o=new Ol(e.segments,function(e,t,n,r,a,i){var o,s={},u=_createForOfIteratorHelper(r);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(ep(e,n,c)&&!a[tp(c)]){var l=new Ol([],{});l._sourceSegment=e,l._segmentIndexShift="legacy"===i?e.segments.length:t.length,s[tp(c)]=l}}}catch(h){u.e(h)}finally{u.f()}return Object.assign({},a,s)}(e,t,n,r,e.children,a));return o._sourceSegment=e,o._segmentIndexShift=t.length,{segmentGroup:o,slicedSegments:n}}var s=new Ol(e.segments,e.children);return s._sourceSegment=e,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:n}}function ep(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path&&void 0===n.redirectTo}function tp(e){return e.outlet||"primary"}function np(e){return e.data||{}}function rp(e){return e.resolve||{}}function ap(e,t,n,r){var a=Uh(e,t,r);return Rl(a.resolve?a.resolve(t,n):a(t,n))}function ip(e){return function(t){return t.pipe(Mu((function(t){var n=e(t);return n?xe(n).pipe(pe((function(){return t}))):xe([t])})))}}var op=function e(){_classCallCheck(this,e)},sp=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"shouldDetach",value:function(e){return!1}},{key:"store",value:function(e,t){}},{key:"shouldAttach",value:function(e){return!1}},{key:"retrieve",value:function(e){return null}},{key:"shouldReuseRoute",value:function(e,t){return e.routeConfig===t.routeConfig}}]),e}(),up=new nt("ROUTES"),cp=function(){function e(t,n,r,a){_classCallCheck(this,e),this.loader=t,this.compiler=n,this.onLoadStartListener=r,this.onLoadEndListener=a}return _createClass(e,[{key:"load",value:function(e,t){var n=this;return this.onLoadStartListener&&this.onLoadStartListener(t),this.loadModuleFactory(t.loadChildren).pipe(pe((function(r){n.onLoadEndListener&&n.onLoadEndListener(t);var a=r.create(e);return new wl(Nl(a.injector.get(up)).map(Il),a)})))}},{key:"loadModuleFactory",value:function(e){var t=this;return"string"==typeof e?xe(this.loader.load(e)):Rl(e()).pipe(Se((function(e){return e instanceof dt?Js(e):xe(t.compiler.compileModuleAsync(e))})))}}]),e}(),lp=function e(){_classCallCheck(this,e)},hp=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"shouldProcessUrl",value:function(e){return!0}},{key:"extract",value:function(e){return e}},{key:"merge",value:function(e,t){return e}}]),e}();function pp(e){throw e}function dp(e,t,n){return t.parse("/")}function fp(e,t){return Js(null)}var mp=function(){function e(t,n,r,a,i,o,s,u){var c=this;_classCallCheck(this,e),this.rootComponentType=t,this.urlSerializer=n,this.rootContexts=r,this.location=a,this.config=u,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.navigationId=0,this.isNgZoneEnabled=!1,this.events=new ce,this.errorHandler=pp,this.malformedUriErrorHandler=dp,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:fp,afterPreactivation:fp},this.urlHandlingStrategy=new hp,this.routeReuseStrategy=new sp,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="legacy",this.ngModule=i.get(pt),this.console=i.get(ti);var l=i.get(bi);this.isNgZoneEnabled=l instanceof bi,this.resetConfig(u),this.currentUrlTree=new Dl(new Ol([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new cp(o,s,(function(e){return c.triggerEvent(new ll(e))}),(function(e){return c.triggerEvent(new hl(e))})),this.routerState=ih(this.currentUrlTree,this.rootComponentType),this.transitions=new $s({id:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}return _createClass(e,[{key:"setupNavigations",value:function(e){var t=this,n=this.events;return e.pipe(hu((function(e){return 0!==e.id})),pe((function(e){return Object.assign({},e,{extractedUrl:t.urlHandlingStrategy.extract(e.rawUrl)})})),Mu((function(e){var r,a,i,o,s=!1,u=!1;return Js(e).pipe(Hu((function(e){t.currentNavigation={id:e.id,initialUrl:e.currentRawUrl,extractedUrl:e.extractedUrl,trigger:e.source,extras:e.extras,previousNavigation:t.lastSuccessfulNavigation?Object.assign({},t.lastSuccessfulNavigation,{previousNavigation:null}):null}})),Mu((function(e){var r,a,i,o,s=!t.navigated||e.extractedUrl.toString()!==t.browserUrlTree.toString();if(("reload"===t.onSameUrlNavigation||s)&&t.urlHandlingStrategy.shouldProcessUrl(e.rawUrl))return Js(e).pipe(Mu((function(e){var r=t.transitions.getValue();return n.next(new tl(e.id,t.serializeUrl(e.extractedUrl),e.source,e.restoredState)),r!==t.transitions.getValue()?su:[e]})),Mu((function(e){return Promise.resolve(e)})),(r=t.ngModule.injector,a=t.configLoader,i=t.urlSerializer,o=t.config,function(e){return e.pipe(Mu((function(e){return function(e,t,n,r,a){return new Oh(e,t,n,r,a).apply()}(r,a,i,e.extractedUrl,o).pipe(pe((function(t){return Object.assign({},e,{urlAfterRedirects:t})})))})))}),Hu((function(e){t.currentNavigation=Object.assign({},t.currentNavigation,{finalUrl:e.urlAfterRedirects})})),function(e,n,r,a,i){return function(r){return r.pipe(Se((function(r){return function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"emptyOnly",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"legacy";return new Zh(e,t,n,r,a,i).recognize()}(e,n,r.urlAfterRedirects,(o=r.urlAfterRedirects,t.serializeUrl(o)),a,i).pipe(pe((function(e){return Object.assign({},r,{targetSnapshot:e})})));var o})))}}(t.rootComponentType,t.config,0,t.paramsInheritanceStrategy,t.relativeLinkResolution),Hu((function(e){"eager"===t.urlUpdateStrategy&&(e.extras.skipLocationChange||t.setBrowserUrl(e.urlAfterRedirects,!!e.extras.replaceUrl,e.id,e.extras.state),t.browserUrlTree=e.urlAfterRedirects)})),Hu((function(e){var r=new il(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);n.next(r)})));if(s&&t.rawUrlTree&&t.urlHandlingStrategy.shouldProcessUrl(t.rawUrlTree)){var u=e.id,c=e.extractedUrl,l=e.source,h=e.restoredState,p=e.extras,d=new tl(u,t.serializeUrl(c),l,h);n.next(d);var f=ih(c,t.rootComponentType).snapshot;return Js(Object.assign({},e,{targetSnapshot:f,urlAfterRedirects:c,extras:Object.assign({},p,{skipLocationChange:!1,replaceUrl:!1})}))}return t.rawUrlTree=e.rawUrl,t.browserUrlTree=e.urlAfterRedirects,e.resolve(null),su})),ip((function(e){var n=e.targetSnapshot,r=e.id,a=e.extractedUrl,i=e.rawUrl,o=e.extras,s=o.skipLocationChange,u=o.replaceUrl;return t.hooks.beforePreactivation(n,{navigationId:r,appliedUrlTree:a,rawUrlTree:i,skipLocationChange:!!s,replaceUrl:!!u})})),Hu((function(e){var n=new ol(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.triggerEvent(n)})),pe((function(e){return Object.assign({},e,{guards:(n=e.targetSnapshot,r=e.currentSnapshot,a=t.rootContexts,i=n._root,function e(t,n,r,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{canDeactivateChecks:[],canActivateChecks:[]},o=rh(n);return t.children.forEach((function(t){!function(t,n,r,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{canDeactivateChecks:[],canActivateChecks:[]},o=t.value,s=n?n.value:null,u=r?r.getContext(t.value.outlet):null;if(s&&o.routeConfig===s.routeConfig){var c=function(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!Pl(e.url,t.url);case"pathParamsOrQueryParamsChange":return!Pl(e.url,t.url)||!Tl(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!dh(e,t)||!Tl(e.queryParams,t.queryParams);case"paramsChange":default:return!dh(e,t)}}(s,o,o.routeConfig.runGuardsAndResolvers);c?i.canActivateChecks.push(new Bh(a)):(o.data=s.data,o._resolvedData=s._resolvedData),e(t,n,o.component?u?u.children:null:r,a,i),c&&i.canDeactivateChecks.push(new Vh(u&&u.outlet&&u.outlet.component||null,s))}else s&&Wh(n,u,i),i.canActivateChecks.push(new Bh(a)),e(t,null,o.component?u?u.children:null:r,a,i)}(t,o[t.value.outlet],r,a.concat([t.value]),i),delete o[t.value.outlet]})),El(o,(function(e,t){return Wh(e,r.getContext(t),i)})),i}(i,r?r._root:null,a,[i.value]))});var n,r,a,i})),function(e,t){return function(n){return n.pipe(Se((function(n){var r=n.targetSnapshot,a=n.currentSnapshot,i=n.guards,o=i.canActivateChecks,s=i.canDeactivateChecks;return 0===s.length&&0===o.length?Js(Object.assign({},n,{guardsResult:!0})):function(e,t,n,r){return xe(e).pipe(Se((function(e){return function(e,t,n,r,a){var i=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return i&&0!==i.length?Js(i.map((function(i){var o,s=Uh(i,t,a);if(function(e){return e&&Th(e.canDeactivate)}(s))o=Rl(s.canDeactivate(e,t,n,r));else{if(!Th(s))throw new Error("Invalid CanDeactivate guard");o=Rl(s(e,t,n,r))}return o.pipe(Fu())}))).pipe(Hh()):Js(!0)}(e.component,e.route,n,t,r)})),Fu((function(e){return!0!==e}),!0))}(s,r,a,e).pipe(Se((function(n){return n&&"boolean"==typeof n?function(e,t,n,r){return xe(t).pipe(Wu((function(t){return xe([qh(t.route.parent,r),jh(t.route,r),Xh(e,t.path,n),Kh(e,t.route,n)]).pipe(lu(),Fu((function(e){return!0!==e}),!0))})),Fu((function(e){return!0!==e}),!0))}(r,o,e,t):Js(n)})),pe((function(e){return Object.assign({},n,{guardsResult:e})})))})))}}(t.ngModule.injector,(function(e){return t.triggerEvent(e)})),Hu((function(e){if(Nh(e.guardsResult)){var n=kl('Redirecting to "'.concat(t.serializeUrl(e.guardsResult),'"'));throw n.url=e.guardsResult,n}})),Hu((function(e){var n=new sl(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot,!!e.guardsResult);t.triggerEvent(n)})),hu((function(e){if(!e.guardsResult){t.resetUrlToCurrentUrlTree();var r=new rl(e.id,t.serializeUrl(e.extractedUrl),"");return n.next(r),e.resolve(!1),!1}return!0})),ip((function(e){if(e.guards.canActivateChecks.length)return Js(e).pipe(Hu((function(e){var n=new ul(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.triggerEvent(n)})),(n=t.paramsInheritanceStrategy,r=t.ngModule.injector,function(e){return e.pipe(Se((function(e){var t=e.targetSnapshot,a=e.guards.canActivateChecks;return a.length?xe(a).pipe(Wu((function(e){return function(e,t,n,r){return function(e,t,n,r){var a=Object.keys(e);if(0===a.length)return Js({});if(1===a.length){var i=a[0];return ap(e[i],t,n,r).pipe(pe((function(e){return _defineProperty({},i,e)})))}var o={};return xe(a).pipe(Se((function(a){return ap(e[a],t,n,r).pipe(pe((function(e){return o[a]=e,e})))}))).pipe(Su(),pe((function(){return o})))}(e._resolve,e,t,r).pipe(pe((function(t){return e._resolvedData=t,e.data=Object.assign({},e.data,sh(e,n).resolve),null})))}(e.route,t,n,r)})),function(e,t){return arguments.length>=2?function(n){return ee(Bu(e,t),mu(1),wu(t))(n)}:function(t){return ee(Bu((function(t,n,r){return e(t,n,r+1)})),mu(1))(t)}}((function(e,t){return e})),pe((function(t){return e}))):Js(e)})))}),Hu((function(e){var n=new cl(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.triggerEvent(n)})));var n,r})),ip((function(e){var n=e.targetSnapshot,r=e.id,a=e.extractedUrl,i=e.rawUrl,o=e.extras,s=o.skipLocationChange,u=o.replaceUrl;return t.hooks.afterPreactivation(n,{navigationId:r,appliedUrlTree:a,rawUrlTree:i,skipLocationChange:!!s,replaceUrl:!!u})})),pe((function(e){var n=function(e,t,n){var r=function e(t,n,r){if(r&&t.shouldReuseRoute(n.value,r.value.snapshot)){var a=r.value;a._futureSnapshot=n.value;var i=function(t,n,r){return n.children.map((function(n){var a,i=_createForOfIteratorHelper(r.children);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(t.shouldReuseRoute(o.value.snapshot,n.value))return e(t,n,o)}}catch(s){i.e(s)}finally{i.f()}return e(t,n)}))}(t,n,r);return new nh(a,i)}var o=t.retrieve(n.value);if(o){var s=o.route;return function e(t,n){if(t.value.routeConfig!==n.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(t.children.length!==n.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");n.value._futureSnapshot=t.value;for(var r=0;r<t.children.length;++r)e(t.children[r],n.children[r])}(n,s),s}var u,c=new oh(new $s((u=n.value).url),new $s(u.params),new $s(u.queryParams),new $s(u.fragment),new $s(u.data),u.outlet,u.component,u),l=n.children.map((function(n){return e(t,n)}));return new nh(c,l)}(e,t._root,n?n._root:void 0);return new ah(r,t)}(t.routeReuseStrategy,e.targetSnapshot,e.currentRouterState);return Object.assign({},e,{targetRouterState:n})})),Hu((function(e){t.currentUrlTree=e.urlAfterRedirects,t.rawUrlTree=t.urlHandlingStrategy.merge(t.currentUrlTree,e.rawUrl),t.routerState=e.targetRouterState,"deferred"===t.urlUpdateStrategy&&(e.extras.skipLocationChange||t.setBrowserUrl(t.rawUrlTree,!!e.extras.replaceUrl,e.id,e.extras.state),t.browserUrlTree=e.urlAfterRedirects)})),(a=t.rootContexts,i=t.routeReuseStrategy,o=function(e){return t.triggerEvent(e)},pe((function(e){return new Sh(i,e.targetRouterState,e.currentRouterState,o).activate(a),e}))),Hu({next:function(){s=!0},complete:function(){s=!0}}),(r=function(){if(!s&&!u){t.resetUrlToCurrentUrlTree();var r=new rl(e.id,t.serializeUrl(e.extractedUrl),"Navigation ID ".concat(e.id," is not equal to the current navigation id ").concat(t.navigationId));n.next(r),e.resolve(!1)}t.currentNavigation=null},function(e){return e.lift(new Ku(r))}),Iu((function(r){if(u=!0,(s=r)&&s.ngNavigationCancelingError){var a=Nh(r.url);a||(t.navigated=!0,t.resetStateAndUrl(e.currentRouterState,e.currentUrlTree,e.rawUrl));var i=new rl(e.id,t.serializeUrl(e.extractedUrl),r.message);n.next(i),e.resolve(!1),a&&t.navigateByUrl(r.url)}else{t.resetStateAndUrl(e.currentRouterState,e.currentUrlTree,e.rawUrl);var o=new al(e.id,t.serializeUrl(e.extractedUrl),r);n.next(o);try{e.resolve(t.errorHandler(r))}catch(c){e.reject(c)}}var s;return su})))})))}},{key:"resetRootComponentType",value:function(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}},{key:"getTransition",value:function(){var e=this.transitions.value;return e.urlAfterRedirects=this.browserUrlTree,e}},{key:"setTransition",value:function(e){this.transitions.next(Object.assign({},this.getTransition(),e))}},{key:"initialNavigation",value:function(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}},{key:"setUpLocationChangeListener",value:function(){var e=this;this.locationSubscription||(this.locationSubscription=this.location.subscribe((function(t){var n=e.parseUrl(t.url),r="popstate"===t.type?"popstate":"hashchange",a=t.state&&t.state.navigationId?t.state:null;setTimeout((function(){e.scheduleNavigation(n,r,a,{replaceUrl:!0})}),0)})))}},{key:"getCurrentNavigation",value:function(){return this.currentNavigation}},{key:"triggerEvent",value:function(e){this.events.next(e)}},{key:"resetConfig",value:function(e){Cl(e),this.config=e.map(Il),this.navigated=!1,this.lastSuccessfulId=-1}},{key:"ngOnDestroy",value:function(){this.dispose()}},{key:"dispose",value:function(){this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=null)}},{key:"createUrlTree",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.relativeTo,r=t.queryParams,a=t.fragment,i=t.preserveQueryParams,o=t.queryParamsHandling,s=t.preserveFragment;_t()&&i&&console&&console.warn&&console.warn("preserveQueryParams is deprecated, use queryParamsHandling instead.");var u=n||this.routerState.root,c=s?this.currentUrlTree.fragment:a,l=null;if(o)switch(o){case"merge":l=Object.assign({},this.currentUrlTree.queryParams,r);break;case"preserve":l=this.currentUrlTree.queryParams;break;default:l=r||null}else l=i?this.currentUrlTree.queryParams:r||null;return null!==l&&(l=this.removeEmptyProps(l)),function(e,t,n,r,a){if(0===n.length)return mh(t.root,t.root,t,r,a);var i=function(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new vh(!0,0,e);var t=0,n=!1,r=e.reduce((function(e,r,a){if("object"==typeof r&&null!=r){if(r.outlets){var i={};return El(r.outlets,(function(e,t){i[t]="string"==typeof e?e.split("/"):e})),[].concat(_toConsumableArray(e),[{outlets:i}])}if(r.segmentPath)return[].concat(_toConsumableArray(e),[r.segmentPath])}return"string"!=typeof r?[].concat(_toConsumableArray(e),[r]):0===a?(r.split("/").forEach((function(r,a){0==a&&"."===r||(0==a&&""===r?n=!0:".."===r?t++:""!=r&&e.push(r))})),e):[].concat(_toConsumableArray(e),[r])}),[]);return new vh(n,t,r)}(n);if(i.toRoot())return mh(t.root,new Ol([],{}),t,r,a);var o=function(e,t,n){if(e.isAbsolute)return new gh(t.root,!0,0);if(-1===n.snapshot._lastPathIndex)return new gh(n.snapshot._urlSegment,!0,0);var r=fh(e.commands[0])?0:1;return function(e,t,n){for(var r=e,a=t,i=n;i>a;){if(i-=a,!(r=r.parent))throw new Error("Invalid number of '../'");a=r.segments.length}return new gh(r,!1,a-i)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+r,e.numberOfDoubleDots)}(i,t,e),s=o.processChildren?kh(o.segmentGroup,o.index,i.commands):bh(o.segmentGroup,o.index,i.commands);return mh(o.segmentGroup,s,t,r,a)}(u,this.currentUrlTree,e,l,c)}},{key:"navigateByUrl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{skipLocationChange:!1};_t()&&this.isNgZoneEnabled&&!bi.isInAngularZone()&&this.console.warn("Navigation triggered outside Angular zone, did you forget to call 'ngZone.run()'?");var n=Nh(e)?e:this.parseUrl(e),r=this.urlHandlingStrategy.merge(n,this.rawUrlTree);return this.scheduleNavigation(r,"imperative",null,t)}},{key:"navigate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{skipLocationChange:!1};return function(e){for(var t=0;t<e.length;t++){var n=e[t];if(null==n)throw new Error("The requested path contains ".concat(n," segment at index ").concat(t))}}(e),this.navigateByUrl(this.createUrlTree(e,t),t)}},{key:"serializeUrl",value:function(e){return this.urlSerializer.serialize(e)}},{key:"parseUrl",value:function(e){var t;try{t=this.urlSerializer.parse(e)}catch(n){t=this.malformedUriErrorHandler(n,this.urlSerializer,e)}return t}},{key:"isActive",value:function(e,t){if(Nh(e))return Fl(this.currentUrlTree,e,t);var n=this.parseUrl(e);return Fl(this.currentUrlTree,n,t)}},{key:"removeEmptyProps",value:function(e){return Object.keys(e).reduce((function(t,n){var r=e[n];return null!=r&&(t[n]=r),t}),{})}},{key:"processNavigations",value:function(){var e=this;this.navigations.subscribe((function(t){e.navigated=!0,e.lastSuccessfulId=t.id,e.events.next(new nl(t.id,e.serializeUrl(t.extractedUrl),e.serializeUrl(e.currentUrlTree))),e.lastSuccessfulNavigation=e.currentNavigation,e.currentNavigation=null,t.resolve(!0)}),(function(t){e.console.warn("Unhandled Navigation Error: ")}))}},{key:"scheduleNavigation",value:function(e,t,n,r){var a=this.getTransition();if(a&&"imperative"!==t&&"imperative"===a.source&&a.rawUrl.toString()===e.toString())return Promise.resolve(!0);if(a&&"hashchange"==t&&"popstate"===a.source&&a.rawUrl.toString()===e.toString())return Promise.resolve(!0);if(a&&"popstate"==t&&"hashchange"===a.source&&a.rawUrl.toString()===e.toString())return Promise.resolve(!0);var i=null,o=null,s=new Promise((function(e,t){i=e,o=t})),u=++this.navigationId;return this.setTransition({id:u,source:t,restoredState:n,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:r,resolve:i,reject:o,promise:s,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),s.catch((function(e){return Promise.reject(e)}))}},{key:"setBrowserUrl",value:function(e,t,n,r){var a=this.urlSerializer.serialize(e);r=r||{},this.location.isCurrentPathEqualTo(a)||t?this.location.replaceState(a,"",Object.assign({},r,{navigationId:n})):this.location.go(a,"",Object.assign({},r,{navigationId:n}))}},{key:"resetStateAndUrl",value:function(e,t,n){this.routerState=e,this.currentUrlTree=t,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n),this.resetUrlToCurrentUrlTree()}},{key:"resetUrlToCurrentUrlTree",value:function(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",{navigationId:this.lastSuccessfulId})}},{key:"url",get:function(){return this.serializeUrl(this.currentUrlTree)}}]),e}(),vp=function(){function e(t,n,r,a,i){_classCallCheck(this,e),this.router=t,this.route=n,this.commands=[],null==r&&a.setAttribute(i.nativeElement,"tabindex","0")}return _createClass(e,[{key:"onClick",value:function(){var e={skipLocationChange:gp(this.skipLocationChange),replaceUrl:gp(this.replaceUrl)};return this.router.navigateByUrl(this.urlTree,e),!0}},{key:"routerLink",set:function(e){this.commands=null!=e?Array.isArray(e)?e:[e]:[]}},{key:"preserveQueryParams",set:function(e){_t()&&console&&console.warn&&console.warn("preserveQueryParams is deprecated!, use queryParamsHandling instead."),this.preserve=e}},{key:"urlTree",get:function(){return this.router.createUrlTree(this.commands,{relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,preserveQueryParams:gp(this.preserve),queryParamsHandling:this.queryParamsHandling,preserveFragment:gp(this.preserveFragment)})}}]),e}();function gp(e){return""===e||!!e}var yp=function e(){_classCallCheck(this,e),this.outlet=null,this.route=null,this.resolver=null,this.children=new bp,this.attachRef=null},bp=function(){function e(){_classCallCheck(this,e),this.contexts=new Map}return _createClass(e,[{key:"onChildOutletCreated",value:function(e,t){var n=this.getOrCreateContext(e);n.outlet=t,this.contexts.set(e,n)}},{key:"onChildOutletDestroyed",value:function(e){var t=this.getContext(e);t&&(t.outlet=null)}},{key:"onOutletDeactivated",value:function(){var e=this.contexts;return this.contexts=new Map,e}},{key:"onOutletReAttached",value:function(e){this.contexts=e}},{key:"getOrCreateContext",value:function(e){var t=this.getContext(e);return t||(t=new yp,this.contexts.set(e,t)),t}},{key:"getContext",value:function(e){return this.contexts.get(e)||null}}]),e}(),kp=function(){function e(t,n,r,a,i){_classCallCheck(this,e),this.parentContexts=t,this.location=n,this.resolver=r,this.changeDetector=i,this.activated=null,this._activatedRoute=null,this.activateEvents=new Ha,this.deactivateEvents=new Ha,this.name=a||"primary",t.onChildOutletCreated(this.name,this)}return _createClass(e,[{key:"ngOnDestroy",value:function(){this.parentContexts.onChildOutletDestroyed(this.name)}},{key:"ngOnInit",value:function(){if(!this.activated){var e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.resolver||null))}}},{key:"detach",value:function(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();var e=this.activated;return this.activated=null,this._activatedRoute=null,e}},{key:"attach",value:function(e,t){this.activated=e,this._activatedRoute=t,this.location.insert(e.hostView)}},{key:"deactivate",value:function(){if(this.activated){var e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}},{key:"activateWith",value:function(e,t){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=e;var n=(t=t||this.resolver).resolveComponentFactory(e._futureSnapshot.routeConfig.component),r=this.parentContexts.getOrCreateContext(this.name).children,a=new xp(e,r,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,a),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}},{key:"isActivated",get:function(){return!!this.activated}},{key:"component",get:function(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}},{key:"activatedRoute",get:function(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}},{key:"activatedRouteData",get:function(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}}]),e}(),xp=function(){function e(t,n,r){_classCallCheck(this,e),this.route=t,this.childContexts=n,this.parent=r}return _createClass(e,[{key:"get",value:function(e,t){return e===oh?this.route:e===bp?this.childContexts:this.parent.get(e,t)}}]),e}(),wp=function e(){_classCallCheck(this,e)},Cp=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"preload",value:function(e,t){return t().pipe(Iu((function(){return Js(null)})))}}]),e}(),_p=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"preload",value:function(e,t){return Js(null)}}]),e}(),Sp=function(){function e(t,n,r,a,i){_classCallCheck(this,e),this.router=t,this.injector=a,this.preloadingStrategy=i,this.loader=new cp(n,r,(function(e){return t.triggerEvent(new ll(e))}),(function(e){return t.triggerEvent(new hl(e))}))}return _createClass(e,[{key:"setUpPreloading",value:function(){var e=this;this.subscription=this.router.events.pipe(hu((function(e){return e instanceof nl})),Wu((function(){return e.preload()}))).subscribe((function(){}))}},{key:"preload",value:function(){var e=this.injector.get(pt);return this.processRoutes(e,this.router.config)}},{key:"ngOnDestroy",value:function(){this.subscription.unsubscribe()}},{key:"processRoutes",value:function(e,t){var n,r=[],a=_createForOfIteratorHelper(t);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i.loadChildren&&!i.canLoad&&i._loadedConfig){var o=i._loadedConfig;r.push(this.processRoutes(o.module,o.routes))}else i.loadChildren&&!i.canLoad?r.push(this.preloadConfig(e,i)):i.children&&r.push(this.processRoutes(e,i.children))}}catch(s){a.e(s)}finally{a.f()}return xe(r).pipe(Ne(),pe((function(e){})))}},{key:"preloadConfig",value:function(e,t){var n=this;return this.preloadingStrategy.preload(t,(function(){return n.loader.load(e.injector,t).pipe(Se((function(e){return t._loadedConfig=e,n.processRoutes(e.module,e.routes)})))}))}}]),e}(),Ip=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,e),this.router=t,this.viewportScroller=n,this.options=r,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},r.scrollPositionRestoration=r.scrollPositionRestoration||"disabled",r.anchorScrolling=r.anchorScrolling||"disabled"}return _createClass(e,[{key:"init",value:function(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}},{key:"createScrollEvents",value:function(){var e=this;return this.router.events.subscribe((function(t){t instanceof tl?(e.store[e.lastId]=e.viewportScroller.getScrollPosition(),e.lastSource=t.navigationTrigger,e.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof nl&&(e.lastId=t.id,e.scheduleScrollEvent(t,e.router.parseUrl(t.urlAfterRedirects).fragment))}))}},{key:"consumeScrollEvents",value:function(){var e=this;return this.router.events.subscribe((function(t){t instanceof vl&&(t.position?"top"===e.options.scrollPositionRestoration?e.viewportScroller.scrollToPosition([0,0]):"enabled"===e.options.scrollPositionRestoration&&e.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===e.options.anchorScrolling?e.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==e.options.scrollPositionRestoration&&e.viewportScroller.scrollToPosition([0,0]))}))}},{key:"scheduleScrollEvent",value:function(e,t){this.router.triggerEvent(new vl(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,t))}},{key:"ngOnDestroy",value:function(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}]),e}(),Tp=new nt("ROUTER_CONFIGURATION"),Np=new nt("ROUTER_FORROOT_GUARD"),Ap=[Es,{provide:zl,useClass:Bl},{provide:mp,useFactory:Pp,deps:[Li,zl,bp,Es,nn,Bi,li,up,Tp,[lp,new Be],[op,new Be]]},bp,{provide:oh,useFactory:Lp,deps:[mp]},{provide:Bi,useClass:Wi},Sp,_p,Cp,{provide:Tp,useValue:{enableTracing:!1}}];function Ep(){return new Ri("Router",mp)}var Rp=function(){function e(t,n){_classCallCheck(this,e)}return _createClass(e,null,[{key:"forRoot",value:function(t,n){return{ngModule:e,providers:[Ap,Mp(t),{provide:Np,useFactory:Op,deps:[[mp,new Be,new Ue]]},{provide:Tp,useValue:n||{}},{provide:Ns,useFactory:Dp,deps:[Is,[new ze(As),new Be],Tp]},{provide:Ip,useFactory:Fp,deps:[mp,Zs,Tp]},{provide:wp,useExisting:n&&n.preloadingStrategy?n.preloadingStrategy:_p},{provide:Ri,multi:!0,useFactory:Ep},[zp,{provide:Ka,multi:!0,useFactory:Bp,deps:[zp]},{provide:Up,useFactory:Vp,deps:[zp]},{provide:ei,multi:!0,useExisting:Up}]]}}},{key:"forChild",value:function(t){return{ngModule:e,providers:[Mp(t)]}}}]),e}();function Fp(e,t,n){return n.scrollOffset&&t.setOffset(n.scrollOffset),new Ip(e,t,n)}function Dp(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.useHash?new Fs(e,t):new Ds(e,t)}function Op(e){if(e)throw new Error("RouterModule.forRoot() called twice. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function Mp(e){return[{provide:hn,multi:!0,useValue:e},{provide:up,multi:!0,useValue:e}]}function Pp(e,t,n,r,a,i,o,s){var u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{},c=arguments.length>9?arguments[9]:void 0,l=arguments.length>10?arguments[10]:void 0,h=new mp(null,t,n,r,a,i,o,Nl(s));if(c&&(h.urlHandlingStrategy=c),l&&(h.routeReuseStrategy=l),u.errorHandler&&(h.errorHandler=u.errorHandler),u.malformedUriErrorHandler&&(h.malformedUriErrorHandler=u.malformedUriErrorHandler),u.enableTracing){var p=Zu();h.events.subscribe((function(e){p.logGroup("Router Event: "+e.constructor.name),p.log(e.toString()),p.log(e),p.logGroupEnd()}))}return u.onSameUrlNavigation&&(h.onSameUrlNavigation=u.onSameUrlNavigation),u.paramsInheritanceStrategy&&(h.paramsInheritanceStrategy=u.paramsInheritanceStrategy),u.urlUpdateStrategy&&(h.urlUpdateStrategy=u.urlUpdateStrategy),u.relativeLinkResolution&&(h.relativeLinkResolution=u.relativeLinkResolution),h}function Lp(e){return e.routerState.root}var zp=function(){function e(t){_classCallCheck(this,e),this.injector=t,this.initNavigation=!1,this.resultOfPreactivationDone=new ce}return _createClass(e,[{key:"appInitializer",value:function(){var e=this;return this.injector.get(Ts,Promise.resolve(null)).then((function(){var t=null,n=new Promise((function(e){return t=e})),r=e.injector.get(mp),a=e.injector.get(Tp);if(e.isLegacyDisabled(a)||e.isLegacyEnabled(a))t(!0);else if("disabled"===a.initialNavigation)r.setUpLocationChangeListener(),t(!0);else{if("enabled"!==a.initialNavigation)throw new Error("Invalid initialNavigation options: '".concat(a.initialNavigation,"'"));r.hooks.afterPreactivation=function(){return e.initNavigation?Js(null):(e.initNavigation=!0,t(!0),e.resultOfPreactivationDone)},r.initialNavigation()}return n}))}},{key:"bootstrapListener",value:function(e){var t=this.injector.get(Tp),n=this.injector.get(Sp),r=this.injector.get(Ip),a=this.injector.get(mp),i=this.injector.get(Li);e===i.components[0]&&(this.isLegacyEnabled(t)?a.initialNavigation():this.isLegacyDisabled(t)&&a.setUpLocationChangeListener(),n.setUpPreloading(),r.init(),a.resetRootComponentType(i.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}},{key:"isLegacyEnabled",value:function(e){return"legacy_enabled"===e.initialNavigation||!0===e.initialNavigation||void 0===e.initialNavigation}},{key:"isLegacyDisabled",value:function(e){return"legacy_disabled"===e.initialNavigation||!1===e.initialNavigation}}]),e}();function Bp(e){return e.appInitializer.bind(e)}function Vp(e){return e.bootstrapListener.bind(e)}var Up=new nt("Router Initializer"),Wp=vr({encapsulation:2,styles:[],data:{}});function Gp(e){return yo(0,[(e()(),ro(0,16777216,null,null,1,"router-outlet",[],null,null,null,null,null)),Ca(1,212992,null,0,kp,[bp,er,In,[8,null],Jt],null,null)],(function(e,t){e(t,1,0)}),null)}var Hp,jp=$r("ng-component",gl,(function(e){return yo(0,[(e()(),ro(0,0,null,null,1,"ng-component",[],null,null,null,Gp,Wp)),Ca(1,49152,null,0,gl,[],null,null)],null,null)}),{},{},[]),qp=function(){function e(t,n){_classCallCheck(this,e),this._socketService=t,this._router=n,this.subscriptions=[]}return _createClass(e,[{key:"createRoom",value:function(){var e=prompt("Room name?");e&&this._socketService.sendMessage("create-room",e)}},{key:"joinRoom",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=e;t||(t=prompt("Room name?")),t&&this._socketService.sendMessage("join-room",t)}},{key:"getRooms",value:function(){var e=prompt("Room name?");this._socketService.sendMessage("get-rooms",e)}},{key:"broadcast",value:function(){this._socketService.sendMessage("broadcast",this._socketService.room)}},{key:"ngOnInit",value:function(){var e=this;this.subscriptions.push(this._socketService.notifications().subscribe((function(e){alert(e)}))),this.subscriptions.push(this._socketService.roomJoined().subscribe((function(t){e._socketService.room=t,e._router.navigate(["playground"])}))),this.subscriptions.push(this._socketService.roomCreated().subscribe((function(t){e.joinRoom(t)})))}},{key:"ngOnDestroy",value:function(){this.subscriptions.forEach((function(e){e&&e.unsubscribe()}))}}]),e}(),Kp=n("gFX4"),Xp=((Hp=function(){function e(){_classCallCheck(this,e),this._socket=Kp("https://rock-paper-scissors-prashant.herokuapp.com"),this._room=""}return _createClass(e,[{key:"sendMessage",value:function(e,t){this._socket.emit(e,t)}},{key:"notifications",value:function(){var e=this;return new re((function(t){return e._socket.on("notification",(function(e){t.next(e)})),function(){}}))}},{key:"roomJoined",value:function(){var e=this;return new re((function(t){return e._socket.on("room-joined",(function(e){t.next(e)})),function(){}}))}},{key:"roomCreated",value:function(){var e=this;return new re((function(t){return e._socket.on("room-created",(function(e){t.next(e)})),function(){}}))}},{key:"startGame",value:function(){var e=this;return new re((function(t){return e._socket.on("start-game",(function(e){t.next(e)})),function(){}}))}},{key:"opponentMove",value:function(){var e=this;return new re((function(t){return e._socket.on("made-a-move",(function(e){t.next(e)})),function(){}}))}},{key:"opponentLeft",value:function(){var e=this;return new re((function(t){return e._socket.on("opponent-left",(function(e){alert("Opponent Left"),t.next(e)})),function(){}}))}},{key:"room",get:function(){return this._room},set:function(e){this._room=e}}]),e}()).ngInjectableDef=He({factory:function(){return new Hp},token:Hp,providedIn:"root"}),Hp),Yp=vr({encapsulation:0,styles:[[".menu-option[_ngcontent-%COMP%]{cursor:pointer;color:#fff}"]],data:{}});function Zp(e){return yo(0,[(e()(),ro(0,0,null,null,15,"div",[["class","container"],["style","margin-top: 5rem"]],null,null,null,null,null)),(e()(),ro(1,0,null,null,6,"div",[["class","row menu-option"]],null,[[null,"click"]],(function(e,t,n){var r=!0;return"click"===t&&(r=!1!==e.component.createRoom()&&r),r}),null,null)),(e()(),ro(2,0,null,null,2,"div",[["class","col-8 offset-1"]],null,null,null,null,null)),(e()(),ro(3,0,null,null,1,"h3",[],null,null,null,null,null)),(e()(),mo(-1,null,["Create Room"])),(e()(),ro(5,0,null,null,2,"div",[["class","col-2"]],null,null,null,null,null)),(e()(),ro(6,0,null,null,1,"span",[],null,null,null,null,null)),(e()(),ro(7,0,null,null,0,"i",[["aria-hidden","true"],["class","fa fa-angle-right fa-2x"]],null,null,null,null,null)),(e()(),ro(8,0,null,null,0,"br",[],null,null,null,null,null)),(e()(),ro(9,0,null,null,6,"div",[["class","row menu-option"]],null,[[null,"click"]],(function(e,t,n){var r=!0;return"click"===t&&(r=!1!==e.component.joinRoom()&&r),r}),null,null)),(e()(),ro(10,0,null,null,2,"div",[["class","col-8 offset-1"]],null,null,null,null,null)),(e()(),ro(11,0,null,null,1,"h3",[],null,null,null,null,null)),(e()(),mo(-1,null,["Join Room"])),(e()(),ro(13,0,null,null,2,"div",[["class","col-2"]],null,null,null,null,null)),(e()(),ro(14,0,null,null,1,"span",[],null,null,null,null,null)),(e()(),ro(15,0,null,null,0,"i",[["aria-hidden","true"],["class","fa fa-angle-right fa-2x"]],null,null,null,null,null))],null,null)}var Qp=$r("app-lobby",qp,(function(e){return yo(0,[(e()(),ro(0,0,null,null,1,"app-lobby",[],null,null,null,Zp,Yp)),Ca(1,245760,null,0,qp,[Xp,mp],null,null)],(function(e,t){e(t,1,0)}),null)}),{},{},[]),Jp=function(){function e(){_classCallCheck(this,e),this.progress=0}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"ngOnChanges",value:function(){this.progress>100&&(this.progress=100)}}]),e}(),$p=vr({encapsulation:0,styles:[[".progress-bar-container[_ngcontent-%COMP%]{border-radius:.3rem;border:1px solid #fff;height:12px}.progress-bar-container[_ngcontent-%COMP%]   .filled[_ngcontent-%COMP%]{background-color:#fff;float:left;height:12px}"]],data:{}});function ed(e){return yo(0,[(e()(),ro(0,0,null,null,1,"div",[["class","progress-bar-container"]],null,null,null,null,null)),(e()(),ro(1,0,null,null,0,"div",[["class","filled"]],[[4,"width",null]],null,null,null,null))],null,(function(e,t){e(t,1,0,t.component.progress+"%")}))}function td(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){e.done?a(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}var nd=function(){function e(t){_classCallCheck(this,e),this._knnService=t,this.moveProgress=0,this.play=new Ha,this.select=new Ha}return _createClass(e,[{key:"startPrediction",value:function(){return td(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._knnService.predict();case 2:(t=e.sent)&&(t.confidence<1?(clearInterval(this.interval),this.moveProgress=0,this.currentMove=null,this.select.emit(this.currentMove)):this.currentMove!==t.label&&(clearInterval(this.interval),this.moveProgress=0,this.currentMove=t.label,this.select.emit(this.currentMove),this.interval=setInterval((function(){n.moveProgress+=10,100===n.moveProgress&&(n.play.emit(),clearInterval(n.interval),n.moveProgress=0,n.currentMove=null,n.select.emit(n.currentMove))}),200)));case 4:e.next=0;break;case 6:case"end":return e.stop()}}),e,this)})))}},{key:"ngOnInit",value:function(){var e=document.getElementById("webcam");navigator.mediaDevices.getUserMedia({video:!0}).then((function(t){e&&(e.srcObject=t)})),e&&this._knnService.addWebCam(e),this.startPrediction()}}]),e}(),rd=function(){function e(t,n){_classCallCheck(this,e),this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return _createClass(e,[{key:"get",value:function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}},{key:"set",value:function(e,t){this.dataIdsCount++,this.data.set(e,t)}},{key:"has",value:function(e){return this.data.has(e)}},{key:"delete",value:function(e){return this.dataIdsCount--,this.data.delete(e)}},{key:"numDataIds",value:function(){return this.dataIdsCount}}]),e}(),ad=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"time",value:function(e){return id("time")}},{key:"read",value:function(e){return id("read")}},{key:"readSync",value:function(e){return id("readSync")}},{key:"numDataIds",value:function(){return id("numDataIds")}},{key:"disposeData",value:function(e){return id("disposeData")}},{key:"write",value:function(e,t,n){return id("write")}},{key:"move",value:function(e,t,n,r){return id("move")}},{key:"memory",value:function(){return id("memory")}},{key:"floatPrecision",value:function(){return id("floatPrecision")}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"batchMatMul",value:function(e,t,n,r){return id("batchMatMul")}},{key:"fusedBatchMatMul",value:function(e){return _objectDestructuringEmpty(e),id("fusedBatchMatMul")}},{key:"slice",value:function(e,t,n){return id("slice")}},{key:"stridedSlice",value:function(e,t,n,r){return id("stridedSlice")}},{key:"unstack",value:function(e,t){return id("unstack")}},{key:"reverse",value:function(e,t){return id("reverse")}},{key:"concat",value:function(e,t){return id("concat")}},{key:"neg",value:function(e){return id("neg")}},{key:"add",value:function(e,t){return id("add")}},{key:"addN",value:function(e){return id("addN")}},{key:"subtract",value:function(e,t){return id("subtract")}},{key:"multiply",value:function(e,t){return id("multiply")}},{key:"realDivide",value:function(e,t){return id("realDivide")}},{key:"floorDiv",value:function(e,t){return id("floorDiv")}},{key:"sum",value:function(e,t){return id("sum")}},{key:"prod",value:function(e,t){return id("prod")}},{key:"unsortedSegmentSum",value:function(e,t,n){return id("unsortedSegmentSum")}},{key:"argMin",value:function(e,t){return id("argMin")}},{key:"argMax",value:function(e,t){return id("argMax")}},{key:"equal",value:function(e,t){return id("equal")}},{key:"notEqual",value:function(e,t){return id("notEqual")}},{key:"less",value:function(e,t){return id("less")}},{key:"lessEqual",value:function(e,t){return id("lessEqual")}},{key:"greater",value:function(e,t){return id("greater")}},{key:"greaterEqual",value:function(e,t){return id("greaterEqual")}},{key:"logicalNot",value:function(e){return id("logicalNot")}},{key:"logicalAnd",value:function(e,t){return id("logicalAnd")}},{key:"logicalOr",value:function(e,t){return id("logicalOr")}},{key:"where",value:function(e){return id("where")}},{key:"select",value:function(e,t,n){return id("select")}},{key:"topk",value:function(e,t,n){return id("topk")}},{key:"min",value:function(e,t){return id("min")}},{key:"minimum",value:function(e,t){return id("minimum")}},{key:"mod",value:function(e,t){return id("mod")}},{key:"max",value:function(e,t){return id("max")}},{key:"maximum",value:function(e,t){return id("maximum")}},{key:"all",value:function(e,t){return id("all")}},{key:"any",value:function(e,t){return id("any")}},{key:"squaredDifference",value:function(e,t){return id("squaredDifference")}},{key:"ceil",value:function(e){return id("ceil")}},{key:"floor",value:function(e){return id("floor")}},{key:"round",value:function(e){return id("round")}},{key:"sign",value:function(e){return id("sign")}},{key:"isNaN",value:function(e){return id("isNaN")}},{key:"isInf",value:function(e){return id("isInf")}},{key:"isFinite",value:function(e){return id("isFinite")}},{key:"pow",value:function(e,t){return id("pow")}},{key:"exp",value:function(e){return id("exp")}},{key:"expm1",value:function(e){return id("expm1")}},{key:"softmax",value:function(e,t){return id("softmax")}},{key:"log",value:function(e){return id("log")}},{key:"log1p",value:function(e){return id("log1p")}},{key:"sqrt",value:function(e){return id("sqrt")}},{key:"rsqrt",value:function(e){return id("rsqrt")}},{key:"square",value:function(e){return id("square")}},{key:"reciprocal",value:function(e){return id("reciprocal")}},{key:"relu",value:function(e){return id("relu")}},{key:"relu6",value:function(e){return id("relu6")}},{key:"prelu",value:function(e,t){return id("prelu")}},{key:"elu",value:function(e){return id("elu")}},{key:"eluDer",value:function(e,t){return id("eluDer")}},{key:"selu",value:function(e){return id("selu")}},{key:"int",value:function(e){return id("int")}},{key:"clip",value:function(e,t,n){return id("clip")}},{key:"abs",value:function(e){return id("abs")}},{key:"complexAbs",value:function(e){return id("complexAbs")}},{key:"sigmoid",value:function(e){return id("sigmoid")}},{key:"softplus",value:function(e){return id("softplus")}},{key:"sin",value:function(e){return id("sin")}},{key:"cos",value:function(e){return id("cos")}},{key:"tan",value:function(e){return id("tan")}},{key:"asin",value:function(e){return id("asin")}},{key:"acos",value:function(e){return id("acos")}},{key:"atan",value:function(e){return id("atan")}},{key:"atan2",value:function(e,t){return id("atan2")}},{key:"sinh",value:function(e){return id("sinh")}},{key:"cosh",value:function(e){return id("cosh")}},{key:"tanh",value:function(e){return id("tanh")}},{key:"asinh",value:function(e){return id("asinh")}},{key:"acosh",value:function(e){return id("acosh")}},{key:"atanh",value:function(e){return id("atanh")}},{key:"erf",value:function(e){return id("erf")}},{key:"step",value:function(e,t){return id("step")}},{key:"fusedConv2d",value:function(e){return _objectDestructuringEmpty(e),id("fusedConv2d")}},{key:"conv2d",value:function(e,t,n){return id("conv2d")}},{key:"conv2dDerInput",value:function(e,t,n){return id("conv2dDerInput")}},{key:"conv2dDerFilter",value:function(e,t,n){return id("conv2dDerFilter")}},{key:"fusedDepthwiseConv2D",value:function(e){return _objectDestructuringEmpty(e),id("fusedDepthwiseConv2D")}},{key:"depthwiseConv2D",value:function(e,t,n){return id("depthwiseConv2D")}},{key:"depthwiseConv2DDerInput",value:function(e,t,n){return id("depthwiseConv2DDerInput")}},{key:"depthwiseConv2DDerFilter",value:function(e,t,n){return id("depthwiseConv2DDerFilter")}},{key:"conv3d",value:function(e,t,n){return id("conv3d")}},{key:"conv3dDerInput",value:function(e,t,n){return id("conv3dDerInput")}},{key:"conv3dDerFilter",value:function(e,t,n){return id("conv3dDerFilter")}},{key:"maxPool",value:function(e,t){return id("maxPool")}},{key:"maxPoolBackprop",value:function(e,t,n,r){return id("maxPoolBackprop")}},{key:"avgPool",value:function(e,t){return id("avgPool")}},{key:"avgPoolBackprop",value:function(e,t,n){return id("avgPoolBackprop")}},{key:"avgPool3d",value:function(e,t){return id("avgPool3d")}},{key:"avgPool3dBackprop",value:function(e,t,n){return id("avgPool3dBackprop")}},{key:"maxPool3d",value:function(e,t){return id("maxPool3d")}},{key:"maxPool3dBackprop",value:function(e,t,n,r){return id("maxPool3dBackprop")}},{key:"reshape",value:function(e,t){return id("reshape")}},{key:"cast",value:function(e,t){return id("cast")}},{key:"tile",value:function(e,t){return id("tile")}},{key:"pad",value:function(e,t,n){return id("pad")}},{key:"transpose",value:function(e,t){return id("transpose")}},{key:"gather",value:function(e,t,n){arguments.length>3&&void 0!==arguments[3]&&arguments[3];return id("gather")}},{key:"gatherND",value:function(e,t){return id("gatherND")}},{key:"scatterND",value:function(e,t,n){return id("scatterND")}},{key:"batchToSpaceND",value:function(e,t,n){return id("batchToSpaceND")}},{key:"spaceToBatchND",value:function(e,t,n){return id("spaceToBatchND")}},{key:"resizeBilinear",value:function(e,t,n,r,a){return id("resizeBilinear")}},{key:"resizeBilinearBackprop",value:function(e,t,n){return id("resizeBilinearBackprop")}},{key:"resizeNearestNeighbor",value:function(e,t,n,r,a){return id("resizeNearestNeighbor")}},{key:"resizeNearestNeighborBackprop",value:function(e,t,n){return id("resizeNearestNeighborBackprop")}},{key:"batchNorm",value:function(e,t,n,r,a,i){return id("batchNorm")}},{key:"localResponseNormalization4D",value:function(e,t,n,r,a){return id("localResponseNormalization4D")}},{key:"LRNGrad",value:function(e,t,n,r,a,i,o){return id("LRNGrad")}},{key:"multinomial",value:function(e,t,n,r){return id("multinomial")}},{key:"oneHot",value:function(e,t,n,r){return id("oneHot")}},{key:"cumsum",value:function(e,t,n,r){return id("cumsum")}},{key:"nonMaxSuppression",value:function(e,t,n,r,a){return id("nonMaxSuppression")}},{key:"fft",value:function(e){return id("fft")}},{key:"ifft",value:function(e){return id("ifft")}},{key:"complex",value:function(e,t){return id("complex")}},{key:"real",value:function(e){return id("real")}},{key:"imag",value:function(e){return id("imag")}},{key:"cropAndResize",value:function(e,t,n,r,a,i){return id("cropAndResize")}},{key:"depthToSpace",value:function(e,t,n){return id("depthToSpace")}},{key:"split",value:function(e,t,n){return id("split")}},{key:"sparseToDense",value:function(e,t,n,r){return id("sparseToDense")}},{key:"diag",value:function(e){return id("diag")}},{key:"fill",value:function(e,t,n){return id("fill")}},{key:"onesLike",value:function(e){return id("onesLike")}},{key:"zerosLike",value:function(e){return id("zerosLike")}},{key:"linspace",value:function(e,t,n){return id("linspace")}},{key:"dispose",value:function(){return id("dispose")}}]),e}();function id(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen"))}function od(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function sd(e,t,n){return Math.max(e,Math.min(t,n))}function ud(e){return e%2==0?e:e+1}function cd(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function ld(e,t){var n=Math.random();return t*n+(1-n)*e}function hd(e,t){for(var n=0,r=0;r<e.length;r++){var a=Number(e[r])-Number(t[r]);n+=a*a}return n}function pd(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function dd(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";pd(yd(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}function fd(e){pd(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function md(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),Array.isArray(e)||Dd(e)&&!n)for(var r=0;r<e.length;++r)md(e[r],t,n);else t.push(e);return t}function vd(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function gd(e){return 0===e.length}function yd(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function bd(e){return e%1==0}function kd(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function xd(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function wd(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return od(t),t}function Cd(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function _d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 0},n=arguments.length>2?arguments[2]:void 0;return new Promise((function(r,a){var i=0;!function o(){if(e())r();else{i++;var s=t(i);null!=n&&i>=n?a():setTimeout(o,s)}}()}))}function Sd(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found ".concat(e[a]," at dim ").concat(a));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when there are 0 elements"));if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got ".concat(t," / ").concat(n));var i=e.slice();return i[r]=t/n,i}function Id(e,t){var n=t.length;return pd((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but got axis ")+e})),pd(e.every((function(e){return bd(e)})),(function(){return"All values in axis param must be integers but got axis "+e})),e.map((function(e){return e<0?n+e:e}))}function Td(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:Id(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function Nd(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function Ad(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function Ed(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}function Rd(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function Fd(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function Dd(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function Od(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function Md(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}function Pd(e){return"string"==typeof e||e instanceof String}function Ld(e){return"boolean"==typeof e}function zd(e){return"number"==typeof e}function Bd(e){return Array.isArray(e)?Bd(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":zd(e)?"float32":Pd(e)?"string":Ld(e)?"bool":"float32"}function Vd(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Ud(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function Wd(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Gd(e,t){if(0===e.length)return t[0];var n=e.reduce((function(e,t){return e*t}));if(0===n)return[];if(n!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length,"."));return function e(t,n,r){var a=new Array;if(1===n.length)for(var i=n[0],o=0;o<i;o++)a[o]=r[t+o];else for(var s=n[0],u=n.slice(1),c=u.reduce((function(e,t){return e*t})),l=0;l<s;l++)a[l]=e(t+l*c,u,r);return a}(0,e,t)}function Hd(e,t){for(var n=jd(e,t),r=0;r<n.length;r++)n[r]=1;return n}function jd(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function qd(e,t){var n=e.reduce((function(e,t){return e*t}),1);if(null==t||"float32"===t)return Gd(e,new Float32Array(n));if("int32"===t)return Gd(e,new Int32Array(n));if("bool"===t)return Gd(e,new Uint8Array(n));throw new Error("Unknown data type "+t)}function Kd(e){e.forEach((function(t){pd(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape [".concat(e,"].")}))}))}function Xd(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function Yd(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function Zd(e){return e&&e.then&&"function"==typeof e.then}var Qd=function(){function e(t){_classCallCheck(this,e),this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}var t;return _createClass(e,[{key:"setPlatform",value:function(e,t){null!=this.platform&&console.warn("Platform ".concat(this.platformName," has already been set. Overwriting the platform with ").concat(t,".")),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL ".concat(e,": ").concat(r,".")),this.set(e,r)}}},{key:"getAsync",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t in this.flags,e.t0){e.next=5;break}return e.next=4,this.evaluateFlag(t);case 4:this.flags[t]=e.sent;case 5:return e.abrupt("return",this.flags[t]);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"get",value:function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(Zd(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. Please use getAsync() instead."));return this.flags[e]=t,this.flags[e]}},{key:"getNumber",value:function(e){return this.get(e)}},{key:"getBool",value:function(e){return this.get(e)}},{key:"getFlags",value:function(){return this.flags}},{key:"set",value:function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function(e){this.flags=Object.assign({},e)}},{key:"reset",value:function(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t,n,r=(t=this.global.location.search,n={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(n,r[0],r[1]),r.join("=")})),n);"tfjsflags"in r&&r.tfjsflags.split(",").forEach((function(t){var n=_slicedToArray(t.split(":"),2),r=n[0],a=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value ".concat(t," for flag ").concat(e,"."))}(r,a)}))}}},{key:"features",get:function(){return this.flags}}]),e}();function Jd(){return ef}var $d,ef=null;function tf(){if(null==$d){var e;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof global)e=global;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}$d=e}return $d}function nf(e,t){var n,r=(null==(n=tf())._tfGlobals&&(n._tfGlobals=new Map),n._tfGlobals);if(r.has(e))return r.get(e);var a=t();return r.set(e,a),r.get(e)}var rf="Abs",af="Acos",of="Acosh",sf="Add",uf="AddN",cf="All",lf="Any",hf="ArgMax",pf="ArgMin",df="Asin",ff="Asinh",mf="Atan",vf="Atanh",gf="Atan2",yf="AvgPool",bf="AvgPoolGrad",kf="AvgPool3D",xf="AvgPool3DGrad",wf="BatchMatMul",Cf="BatchToSpaceND",_f="Bincount",Sf="BroadcastTo",If="Cast",Tf="Ceil",Nf="ClipByValue",Af="Complex",Ef="ComplexAbs",Rf="Concat",Ff="Conv2D",Df="Conv2DBackpropFilter",Of="Conv2DBackpropInput",Mf="Conv3D",Pf="Conv3DBackpropFilterV2",Lf="Conv3DBackpropInputV2",zf="Cos",Bf="Cosh",Vf="Cumsum",Uf="CropAndResize",Wf="DenseBincount",Gf="DepthToSpace",Hf="DepthwiseConv2dNative",jf="DepthwiseConv2dNativeBackpropFilter",qf="DepthwiseConv2dNativeBackpropInput",Kf="Diag",Xf="Dilation2D",Yf="Dilation2DBackpropInput",Zf="Dilation2DBackpropFilter",Qf="RealDiv",Jf="Elu",$f="EluGrad",em="Erf",tm="Equal",nm="Exp",rm="ExpandDims",am="Expm1",im="FFT",om="Fill",sm="FlipLeftRight",um="Floor",cm="FloorDiv",lm="FusedBatchNorm",hm="GatherV2",pm="GatherNd",dm="Greater",fm="GreaterEqual",mm="Identity",vm="IFFT",gm="Imag",ym="IsFinite",bm="IsInf",km="IsNan",xm="LeakyRelu",wm="Less",Cm="LessEqual",_m="LinSpace",Sm="Log",Im="Log1p",Tm="LogicalAnd",Nm="LogicalNot",Am="LogicalOr",Em="LogSoftmax",Rm="LRN",Fm="LRNGrad",Dm="Max",Om="Maximum",Mm="MaxPool",Pm="MaxPoolGrad",Lm="MaxPool3D",zm="MaxPool3DGrad",Bm="MaxPoolWithArgmax",Vm="Mean",Um="Min",Wm="Minimum",Gm="MirrorPad",Hm="Mod",jm="Multinomial",qm="Multiply",Km="Neg",Xm="NotEqual",Ym="NonMaxSuppressionV3",Zm="NonMaxSuppressionV4",Qm="NonMaxSuppressionV5",Jm="OnesLike",$m="OneHot",ev="Pack",tv="PadV2",nv="Pool",rv="Pow",av="Prelu",iv="Prod",ov="Range",sv="Real",uv="Reciprocal",cv="Relu",lv="Reshape",hv="ResizeNearestNeighbor",pv="ResizeNearestNeighborGrad",dv="ResizeBilinear",fv="ResizeBilinearGrad",mv="Relu6",vv="Reverse",gv="Round",yv="Rsqrt",bv="ScatterNd",kv="Select",xv="Selu",wv="Slice",Cv="Sin",_v="Sinh",Sv="Sign",Iv="Sigmoid",Tv="Softplus",Nv="Sqrt",Av="Sum",Ev="SpaceToBatchND",Rv="SplitV",Fv="Softmax",Dv="SquaredDifference",Ov="Square",Mv="Sub",Pv="SparseToDense",Lv="StridedSlice",zv="Tan",Bv="Tanh",Vv="Tile",Uv="TopK",Wv="Transpose",Gv="Unique",Hv="Unpack",jv="UnsortedSegmentSum",qv="ZerosLike",Kv="Step",Xv="FromPixels",Yv="RotateWithOffset",Zv="_FusedMatMul",Qv="FusedConv2D",Jv="FusedDepthwiseConv2D",$v=nf("kernelRegistry",(function(){return new Map})),eg=nf("gradRegistry",(function(){return new Map}));function tg(e,t){var n=cg(e,t);return $v.get(n)}function ng(e){return eg.get(e)}function rg(e){for(var t=$v.entries(),n=[];;){var r=t.next(),a=r.done,i=r.value;if(a)break;var o=_slicedToArray(i,2),s=o[0],u=o[1];_slicedToArray(s.split("_"),1)[0]===e&&n.push(u)}return n}function ag(e){var t=e.kernelName,n=e.backendName,r=cg(t,n);$v.has(r)&&console.warn("The kernel '".concat(t,"' for backend '").concat(n,"' is already registered")),$v.set(r,e)}function ig(e){var t=e.kernelName;eg.has(t)&&Jd().getBool("DEBUG")&&console.warn("Overriding the gradient for '".concat(t,"'")),eg.set(t,e)}function og(e,t){var n=cg(e,t);if(!$v.has(n))throw new Error("The kernel '".concat(e,"' for backend '").concat(t,"' is not registered"));$v.delete(n)}function sg(e){if(!eg.has(e))throw new Error("The gradient '".concat(e,"' for backend is not registered"));eg.delete(e)}function ug(e,t){rg(e).forEach((function(e){ag(Object.assign({},e,{backendName:t}))}))}function cg(e,t){return"".concat(t,"_").concat(e)}var lg=function(){function e(t,n){_classCallCheck(this,e),this.backendTimer=t,this.logger=n,null==n&&(this.logger=new hg)}return _createClass(e,[{key:"profileKernel",value:function(e,t,n){var r,a=this.backendTimer.time((function(){r=n()}));if(Jd().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var i=function(t){var n=r[t];n.data().then((function(t){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(n,"'")),!0}}(t,n.dtype,e)}))},o=0;o<r.length;o++)i(o);return{kernelName:e,outputs:r,inputs:t,timeMs:a.then((function(e){return e.kernelMs})),extraInfo:a.then((function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""}))}}},{key:"logKernelProfile",value:function(e){var t=this,n=e.kernelName,r=e.outputs,a=e.timeMs,i=e.inputs,o=e.extraInfo;r.forEach((function(e){Promise.all([e.data(),a,o]).then((function(r){t.logger.logKernelProfile(n,e,r[0],r[1],i,r[2])}))}))}}]),e}();var hg=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"logKernelProfile",value:function(e,t,n,r,a,i){var o="number"==typeof r?Cd(r+"ms",9):r.error,s=Cd(e,25),u=t.rank,c=t.size,l=Cd(t.shape.toString(),14),h="";for(var p in a){var d=a[p];if(null!=d){var f=d.shape||t.shape,m=f.length;h+="".concat(p,": ").concat(m,"D ").concat(m>0?f:""," ")}}console.log("%c".concat(s,"\t%c").concat(o,"\t%c").concat(u,"D ").concat(l,"\t%c").concat(c,"\t%c").concat(h,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}]),e}();function pg(e,t,n){return Cd(Array.isArray(e)?parseFloat(e[0].toFixed(7))+" + "+parseFloat(e[1].toFixed(7))+"j":Pd(e)?"'".concat(e,"'"):"bool"===n?dg(e):parseFloat(e.toFixed(7)).toString(),t)}function dg(e){return 0===e?"false":"true"}function fg(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}function mg(e,t){return"string"===t?bg(e):vg([e],t)}function vg(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=md(e)),Jd().getBool("DEBUG")&&Ed(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var n=new Uint8Array(e.length),r=0;r<n.length;++r)0!==Math.round(e[r])&&(n[r]=1);return n}throw new Error("Unknown data type "+t)}function gg(){return Jd().platform.now()}function yg(e,t){return Jd().platform.fetch(e,t)}function bg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",Jd().platform.encode(e,t)}function kg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",Jd().platform.decode(e,t)}var xg=function(){function e(t,n,r){var a=this;if(_classCallCheck(this,e),this.dtype=n,this.shape=t.slice(),this.size=vd(t),null!=r){var i=r.length;pd(i===this.size,(function(){return"Length of values '".concat(i,"' does not match the size inferred by the shape '").concat(a.size,"'.")}))}if("complex64"===n)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Ad(n,this.size),this.strides=Wd(t)}return _createClass(e,[{key:"set",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];0===r.length&&(r=[0]),pd(r.length===this.rank,(function(){return"The number of provided coordinates (".concat(r.length,") must match the rank (").concat(t.rank,")")}));var i=this.locToIndex(r);this.values[i]=e}},{key:"get",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);for(var r=0,a=0,i=t;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[r])throw new Error("Requested out of range element at ".concat(t,".   Buffer shape=")+this.shape);r++}for(var s=t[t.length-1],u=0;u<t.length-1;++u)s+=this.strides[u]*t[u];return this.values[s]}},{key:"locToIndex",value:function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}},{key:"indexToLoc",value:function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}},{key:"toTensor",value:function(){return wg().makeTensor(this.values,this.shape,this.dtype)}},{key:"rank",get:function(){return this.shape.length}}]),e}(),wg=null,Cg=null,_g=function(){function e(t,n,r,a){_classCallCheck(this,e),this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=vd(t),this.strides=Wd(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}var t,n,r,a;return _createClass(e,[{key:"buffer",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",Cg.buffer(this.shape,this.dtype,t));case 4:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"bufferSync",value:function(){return Cg.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",Gd(this.shape,t));case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"arraySync",value:function(){return Gd(this.shape,this.dataSync())}},{key:"data",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.throwIfDisposed(),t=wg().read(this.dataId),"string"!==this.dtype){e.next=13;break}return e.next=5,t;case 5:return n=e.sent,e.prev=6,e.abrupt("return",n.map((function(e){return kg(e)})));case 10:throw e.prev=10,e.t0=e.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[6,10]])}))),function(){return n.apply(this,arguments)})},{key:"dataSync",value:function(){this.throwIfDisposed();var e=wg().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return kg(e)}))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.throwIfDisposed(),e.next=3,wg().read(this.dataId);case 3:return t=e.sent,e.abrupt("return","string"===this.dtype?t:new Uint8Array(t.buffer));case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"dispose",value:function(){this.isDisposed||(wg().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"throwIfDisposed",value:function(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Cg.print(this,e)}},{key:"clone",value:function(){return this.throwIfDisposed(),Cg.clone(this)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(e,t,n,r){var a=Wd(t),i=function(e,t,n,r){var a=vd(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,u="complex64"===n?fg(e):e;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,h=0;h<i;h++)o[h]=Math.max(o[h],pg(u[l+h],0,n).length);return o}(e,t,n,a),o=t.length,s=function e(t,n,r,a,i){var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s="complex64"===r?2:1,u=n[0],c=n.length;if(0===c)return"complex64"===r?[pg(fg(t)[0],0,r)]:"bool"===r?[dg(t[0])]:[t[0].toString()];if(1===c){if(u>20){var l=Array.from(t.slice(0,3*s)),h=Array.from(t.slice((u-3)*s,u*s));return"complex64"===r&&(l=fg(l),h=fg(h)),["["+l.map((function(e,t){return pg(e,i[t],r)})).join(", ")+", ..., "+h.map((function(e,t){return pg(e,i[u-3+t],r)})).join(", ")+"]"]}return["["+("complex64"===r?fg(t):Array.from(t)).map((function(e,t){return pg(e,i[t],r)})).join(", ")+"]"]}var p=n.slice(1),d=a.slice(1),f=a[0]*s,m=[];if(u>20){for(var v=0;v<3;v++){var g=v*f;m.push.apply(m,_toConsumableArray(e(t.slice(g,g+f),p,r,d,i,!1)))}m.push("...");for(var y=u-3;y<u;y++){var b=y*f;m.push.apply(m,_toConsumableArray(e(t.slice(b,b+f),p,r,d,i,y===u-1)))}}else for(var k=0;k<u;k++){var x=k*f;m.push.apply(m,_toConsumableArray(e(t.slice(x,x+f),p,r,d,i,k===u-1)))}var w=2===c?",":"";m[0]="["+m[0]+w;for(var C=1;C<m.length-1;C++)m[C]=" "+m[C]+w;for(var _=",\n",S=2;S<c;S++)_+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(o?"":_),m}(e,t,n,a,i),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+o),u.push("  shape: [".concat(t,"]")),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,e)}},{key:"cast",value:function(e){return this.throwIfDisposed(),Cg.cast(this,e)}},{key:"variable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),wg().makeVariable(this,e,t,n)}},{key:"rank",get:function(){return this.shape.length}},{key:"isDisposed",get:function(){return this.isDisposedInternal}}]),e}();Object.defineProperty(_g,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}});var Sg,Ig,Tg,Ng,Ag,Eg=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck(this,n),(o=t.call(this,e.shape,e.dtype,e.dataId,i)).trainable=r,o.name=a,o}return _createClass(n,[{key:"assign",value:function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and previous value (").concat(this.dtype,") must match"));if(!yd(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and previous value (").concat(this.shape,") must match"));wg().disposeTensor(this),this.dataId=e.dataId,wg().incRef(this,null)}},{key:"dispose",value:function(){wg().disposeVariable(this),this.isDisposedInternal=!0}}]),n}(_g);Object.defineProperty(Eg,Symbol.hasInstance,{value:function(e){return e instanceof _g&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(Sg||(Sg={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Ig||(Ig={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Tg||(Tg={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Ng||(Ng={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Ag||(Ag={}));var Rg={float32:Ng,int32:Ig,bool:Tg,complex64:Ag};function Fg(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return Rg[e][t]}function Dg(e){return Fg(e,"int32")}function Og(e,t){if(e.dtype===t.dtype)return[e,t];var n=Fg(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Mg(e,t){pd(e.dtype===t.dtype,(function(){return"The dtypes of the first(".concat(e.dtype,") and second(").concat(t.dtype,") input must match")}))}function Pg(e,t){return t.some((function(t){return t.id===e.id}))}function Lg(e){var t=[];return function e(t,n,r){if(null!=t)if(t instanceof _g)n.push(t);else if(a=t,Array.isArray(a)||"object"==typeof a){var a,i=t;for(var o in i){var s=i[o];r.has(s)||(r.add(s),e(s,n,r))}}}(e,t,new Set),t}var zg=function(){function e(){_classCallCheck(this,e),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((function(e){return e.name}))))}}}return _createClass(e,[{key:"dispose",value:function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()}}]),e}(),Bg=function(){function e(t){_classCallCheck(this,e),this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new zg}var t,n,r,a;return _createClass(e,[{key:"ready",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.pendingBackendInit){e.next=2;break}return e.abrupt("return",this.pendingBackendInit.then((function(){})));case 2:if(null==this.backendInstance){e.next=4;break}return e.abrupt("return");case 4:t=this.getSortedBackends(),n=0;case 6:if(!(n<t.length)){e.next=17;break}return r=t[n],e.next=10,this.initializeBackend(r).success;case 10:if(!e.sent){e.next=14;break}return e.next=13,this.setBackend(r);case 13:return e.abrupt("return",void e.sent);case 14:n++,e.next=6;break;case 17:throw new Error("Could not initialize any backends, all backend initializations failed.");case 18:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"backendNames",value:function(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.registryFactory[t]){e.next=2;break}throw new Error("Backend name '".concat(t,"' not found in registry"));case 2:if(this.backendName=t,null!=this.registry[t]){e.next=14;break}if(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,!n.asyncInit){e.next=11;break}return e.next=8,r;case 8:e.t0=e.sent,e.next=12;break;case 11:e.t0=r;case 12:if(e.t0){e.next=14;break}return e.abrupt("return",!1);case 14:return e.abrupt("return",(this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new lg(this.backendInstance),!0));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setupRegisteredKernels",value:function(){var e=this;rg(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))}},{key:"disposeRegisteredKernels",value:function(e){var t=this;rg(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))}},{key:"initializeBackend",value:function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var r=n.factory();if(!r||r instanceof ad||"function"!=typeof r.then)return this.registry[e]=r,{success:!0,asyncInit:!1};var a=++this.pendingBackendInitId,i=r.then((function(n){return!(a<t.pendingBackendInitId||(t.registry[e]=n,t.pendingBackendInit=null,0))})).catch((function(n){return a<t.pendingBackendInitId||(t.pendingBackendInit=null,console.warn("Initialization of backend ".concat(e," failed")),console.warn(n.stack||n.message)),!1}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}catch(o){return console.warn("Initialization of backend ".concat(e," failed")),console.warn(o.stack||o.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))}},{key:"initializeBackendsAndReturnBest",value:function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,a,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function(e,t){var n,r=this,a=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return r.startScope(a)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))}},{key:"scopedRun",value:function(e,t,n){e();try{var r=n();return t(),r}catch(a){throw t(),a}}},{key:"nextTensorId",value:function(){return e.nextTensorId++}},{key:"nextVariableId",value:function(){return e.nextVariableId++}},{key:"clone",value:function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype);return this.addTapeNode(this.state.activeScope.name,{x:e},[t],(function(e){return{x:function(){return Ug.runKernelFunc((function(t){return t.cast(e,"float32")}),{x:e},null,If,{dtype:"float32"})}}}),[],{}),t}},{key:"runKernel",value:function(e,t,n,r,a){return this.runKernelFunc(null,t,null,e,n,r,a)}},{key:"shouldCheckForMemLeaks",value:function(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var i=r-t-a-this.state.numDataMovesStack[this.state.numDataMovesStack.length-1];if(i>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak (").concat(i," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function(e,t,n,r,a,i,o){var s,u=this,c=[],l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var h,p=this.state.numBytes,d=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var f,m,v=tg(r,this.backendName);if(null!=v)h=function(){var e=u.backend.numDataIds();f=v.kernelFunc({inputs:t,attrs:a,backend:u.backend});var n=Array.isArray(f)?f:[f];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n);var s=n.map((function(e){if(null!=e.rank)return e;var t=e.dataId,n=e.shape,r=e.dtype;return u.makeTensorFromDataId(t,n,r)}));if(l){var h=u.getTensorsForGradient(r,t,s);if(null==h){null==o&&(o=[]);var p=s.filter((function(e,t){return o[t]}));h=(i||[]).slice().concat(p)}c=u.saveTensorsForBackwardMode(h)}return s};else{if(null==e)throw new Error("Error running ".concat(r,": Neither modular kernel nor forward func passed"));var g=function(e){l&&(c=e.map((function(e){return u.keep(u.clone(e))})))};h=function(){var t=u.backend.numDataIds();f=u.tidy((function(){return e(u.backend,g)}));var n=Array.isArray(f)?f:[f];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n),n}}return this.scopedRun((function(){return u.state.kernelDepth++}),(function(){return u.state.kernelDepth--}),(function(){u.ENV.getBool("DEBUG")||u.state.profiling?(m=u.profiler.profileKernel(r,t,(function(){return h()})),u.ENV.getBool("DEBUG")&&u.profiler.logKernelProfile(m),s=m.outputs):s=h()})),l&&this.addTapeNode(r,t,s,n,c,a),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-d,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(e){return null!=t[e]?t[e].shape:null})),outputShapes:s.map((function(e){return e.shape})),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(f)?s:s[0]}},{key:"saveTensorsForBackwardMode",value:function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))}},{key:"getTensorsForGradient",value:function(e,t,n){var r=ng(e);if(null!=r){var a,i=r.inputsToSave||[],o=r.outputsToSave||[];r.saveAllInputs?(pd(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),a=Object.keys(t).map((function(e){return t[e]}))):a=i.map((function(e){return t[e]}));var s=n.filter((function(e,t){return o[t]}));return a.concat(s)}return null}},{key:"makeTensor",value:function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");r=r||this.backend;var a=e;"string"===(n=n||"float32")&&Pd(e[0])&&(a=e.map((function(e){return bg(e)})));var i=r.write(a,t,n),o=new _g(t,n,i,this.nextTensorId());if(this.incRef(o,r),"string"===n){var s=this.state.tensorInfo.get(i),u=Md(a);this.state.numBytes+=u-s.bytes,s.bytes=u}return o}},{key:"makeTensorFromDataId",value:function(e,t,n,r){var a=new _g(t,n=n||"float32",e,this.nextTensorId());return this.incRef(a,r),a}},{key:"makeVariable",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));var a=new Eg(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"incRef",value:function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*Od(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Eg||this.track(e)}},{key:"disposeTensor",value:function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}}},{key:"disposeVariables",value:function(){for(var e in this.state.registeredVariables)this.disposeVariable(this.state.registeredVariables[e])}},{key:"disposeVariable",value:function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],e.next=5,t();case 5:this.state.activeProfile.result=e.sent,this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,_toConsumableArray(this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,a=_createForOfIteratorHelper(this.state.activeProfile.kernels),e.prev=11,a.s();case 13:if((i=a.n()).done){e.next=23;break}return o=i.value,e.next=17,o.kernelTimeMs;case 17:return o.kernelTimeMs=e.sent,e.next=20,o.extraInfo;case 20:o.extraInfo=e.sent;case 21:e.next=13;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(11),a.e(e.t0);case 28:return e.prev=28,a.f(),e.finish(28);case 31:return e.abrupt("return",this.state.activeProfile);case 32:case"end":return e.stop()}}),e,this,[[11,25,28,31]])}))),function(e){return n.apply(this,arguments)})},{key:"isTapeOn",value:function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function(e,t,n,r,a,i){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},u=ng(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],a=jd(r.size,r.dtype);return o.makeTensor(a,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],a,i)}),this.state.activeTape.push(s)}},{key:"keep",value:function(e){return e.kept=!0,e}},{key:"startTape",value:function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function(){this.state.gradientDepth--}},{key:"startScope",value:function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function(e){for(var t=this,n=Lg(e),r=new Set(n.map((function(e){return e.id}))),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];i.kept||r.has(i.id)||i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))}},{key:"gradients",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(pd(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var i=this.scopedRun((function(){return r.startTape()}),(function(){return r.endTape()}),(function(){return r.tidy("forward",e)}));pd(i instanceof _g,(function(){return"The result y returned by f() must be a tensor."}));var o=function(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(var o=0;o<e.length;o++){var s=e[o],u=s.inputs;for(var c in u){for(var l=u[c],h=!1,p=0;p<t.length;p++)if(r[l.id]){s.outputs.forEach((function(e){return r[e.id]=!0})),h=!0,a[s.id]=!0;break}if(h)break}}var d={};d[n.id]=!0;for(var f={},m=e.length-1;m>=0;m--)for(var v=e[m],g=v.inputs,y=0;y<v.outputs.length;y++)if(d[v.outputs[y].id]){for(var b in g)d[g[b].id]=!0,f[v.id]=!0;break}for(var k=[],x=0;x<e.length;x++){var w=e[x];if(a[w.id]&&f[w.id]){var C={};for(var _ in w.inputs){var S=w.inputs[_];r[S.id]&&(C[_]=S)}var I=Object.assign({},w);I.inputs=C,I.outputs=w.outputs,k.push(I)}}return k}(this.state.activeTape,t,i);if(!a&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e,a,s={};s[i.id]=null==n?(e=i.shape,a=Hd(vd(e),"float32"),Ug.makeTensor(a,e,"float32")):n,function(e,t,n,a){for(var i=function(n){var i=t[n],o=[];if(i.outputs.forEach((function(t){var n=e[t.id];o.push(null!=n?n:null)})),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found for ".concat(i.kernelName,"."));var s=i.gradient(o),u=function(t){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". Available gradients found: ").concat(Object.keys(s),"."));var n=function(e){return r.tidy(e)}((function(){return s[t]()}));if("float32"!==n.dtype)throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ").concat(t," must have 'float32' dtype, but has '").concat(n.dtype,"'"));var o=i.inputs[t];if(!yd(n.shape,o.shape))throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input '").concat(t,"' has shape '").concat(n.shape,"', which does not match the shape of the input '").concat(o.shape,"'"));if(null==e[o.id])e[o.id]=n;else{var u=e[o.id];e[o.id]=a(u,n),u.dispose()}};for(var c in i.inputs)u(c)},o=t.length-1;o>=0;o--)i(o)}(s,o,0,Wg);var u=t.map((function(e){return s[e.id]}));return 0===r.state.gradientDepth&&(r.state.activeTape.forEach((function(e){var t,n=_createForOfIteratorHelper(e.saved);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch(r){n.e(r)}finally{n.f()}})),r.state.activeTape=null),{value:i,grads:u}}))}},{key:"customGrad",value:function(e){var t=this;return pd(Vd(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i;pd(r.every((function(e){return e instanceof _g})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var o={};return r.forEach((function(e,t){o[t]=e})),t.runKernelFunc((function(t,n){return pd((i=e.apply(void 0,r.concat([n]))).value instanceof _g,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),pd(Vd(i.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),i.value}),o,(function(e,t){var n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];pd(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),pd(a.every((function(e){return e instanceof _g})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o}))}}},{key:"readSync",value:function(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"time",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=gg(),e.next=3,this.backend.time(t);case 3:return r=e.sent,e.abrupt("return",(r.wallMs=gg()-n,r));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"track",value:function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"reset",value:function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new zg,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}},{key:"backend",get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '".concat(t,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));this.setBackend(t)}return this.backendInstance}},{key:"registeredVariables",get:function(){return this.state.registeredVariables}}]),e}();function Vg(){var e=tf();if(null==e._tfengine){var t=new Qd(e);e._tfengine=new Bg(t)}return ef=e._tfengine.ENV,wg=function(){return e._tfengine},e._tfengine}Bg.nextTensorId=0,Bg.nextVariableId=0;var Ug=Vg();function Wg(e,t){return Ug.runKernel(sf,{a:e,b:t})}function Gg(){if("undefined"!=typeof navigator&&null!=navigator){var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function Hg(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var jg=Jd();function qg(e,t){var n=e;if(Dd(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||Dd(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&Jd().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],Array.isArray(t)||Dd(t)){pd(n.length>0,(function(){return"Element arr[".concat(r.join("]["),"] should be a primitive, but is an array of ").concat(t.length," elements")})),pd(t.length===n[0],(function(){return"Element arr[".concat(r.join("]["),"] should have ").concat(n[0]," elements, but has ").concat(t.length," elements")}));for(var a=n.slice(1),i=0;i<t.length;++i)e(t[i],a,r.concat(i))}else pd(0===n.length,(function(){return"Element arr[".concat(r.join("]["),"] is a primitive, but should be an array/TypedArray of ").concat(n[0]," elements")}))}(e,r,[]),r}function Kg(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must be ").concat(e," tensor, but got ").concat(t," tensor"))}function Xg(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof _g)return Kg(r,e.dtype,t,n),e;var a=Bd(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),Kg(r,a,t,n),null==e||!Dd(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a Tensor or TensorLike, but got '").concat(null==e?"null":e.constructor.name,"'"));var i=qg(e,a);Dd(e)||Array.isArray(e)||(e=[e]);var o="string"!==a?vg(e,a):md(e,[],!0);return Ug.makeTensor(o,i,a)}function Yg(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a `Tensor[]` or `TensorLike[]`"));return e.map((function(e,r){return Xg(e,"".concat(t,"[").concat(r,"]"),n)}),r)}jg.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),jg.registerFlag("IS_BROWSER",(function(){return Hg()})),jg.registerFlag("IS_NODE",(function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node})),jg.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),jg.registerFlag("PROD",(function(){return!1})),jg.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return jg.getBool("DEBUG")})),jg.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),jg.registerFlag("IS_TEST",(function(){return!1})),jg.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(function(){return!0}));var Zg="__op";function Qg(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+=Zg;var a=function(){Ug.startScope(n);try{var e=r.apply(void 0,arguments);return Zd(e)&&console.error("Cannot return a Promise inside of tidy."),Ug.endScope(e),e}catch(t){throw Ug.endScope(null),t}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}var Jg=Qg({complex_:function(e,t){var n=Xg(e,"real","complex"),r=Xg(t,"imag","complex");return dd(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", must match in call to tf.complex().")),Ug.runKernel(Af,{real:n,imag:r})}});function $g(e,t,n,r){if(null==r&&(r=Bd(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Dd(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){Kd(t);var a=vd(t),i=vd(n);pd(a===i,(function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ").concat(a," values but has ").concat(i)}));for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==vd(t.slice(o));pd(n[o]===t[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape (".concat(n,") does not match the provided shape (").concat(t,"). ")}))}}return Dd(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?vg(e,r):md(e,[],!0),Ug.makeTensor(e,t,r)}function ey(e,t,n){return $g(e,t,qg(e,n),n)}var ty={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};function ny(e,t){return ry.apply(this,arguments)}function ry(){return(ry=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=[],a=[],i=Array.isArray(t)?t.map((function(e){return e.name})):Object.keys(t),o=function(e){var o=i[e],s=Array.isArray(t)?t[e].tensor:t[o];if("float32"!==s.dtype&&"int32"!==s.dtype&&"bool"!==s.dtype&&"string"!==s.dtype&&"complex64"!==s.dtype)throw new Error("Unsupported dtype in weight '".concat(o,"': ").concat(s.dtype));var u={name:o,shape:s.shape,dtype:s.dtype};if("string"===s.dtype){var c=new Promise(function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i,o,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.bytes();case 2:for(n=e.sent,r=n.reduce((function(e,t){return e+t.length}),0)+4*n.length,a=new Uint8Array(r),i=0,o=0;o<n.length;o++)u=n[o],c=new Uint8Array(new Uint32Array([u.length]).buffer),a.set(c,i),i+=4,a.set(u,i),i+=u.length;t(a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());a.push(c)}else a.push(s.data());null!=n&&(u.group=n),r.push(u)},s=0;s<i.length;++s)o(s);return e.t0=iy,e.next=6,Promise.all(a);case 6:return e.t1=e.sent,e.t2=(0,e.t0)(e.t1),e.t3=r,e.abrupt("return",{data:e.t2,specs:e.t3});case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ay(e,t){var n,r,a={},i=0,o=_createForOfIteratorHelper(t);try{for(o.s();!(r=o.n()).done;){var s=r.value,u=s.name,c=s.dtype,l=s.shape,h=vd(l),p=void 0;if("quantization"in s){var d=s.quantization;if("uint8"===d.dtype||"uint16"===d.dtype){if(!("min"in d&&"scale"in d))throw new Error("Weight ".concat(s.name," with quantization ").concat(d.dtype," doesn't have corresponding metadata min and scale."))}else{if("float16"!==d.dtype)throw new Error("Weight ".concat(s.name," has unknown quantization dtype ").concat(d.dtype,". Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'."));if("float32"!==c)throw new Error("Weight ".concat(s.name," is quantized with ").concat(d.dtype," which only supports weights of type float32 not ").concat(c,"."))}var f=ty[d.dtype],m=e.slice(i,i+h*f),v="uint8"===d.dtype?new Uint8Array(m):new Uint16Array(m);if("float32"===c)if("uint8"===d.dtype||"uint16"===d.dtype){p=new Float32Array(v.length);for(var g=0;g<v.length;g++)p[g]=v[g]*d.scale+d.min}else{if("float16"!==d.dtype)throw new Error("Unsupported quantization type ".concat(d.dtype," for weight type float32."));void 0===n&&(n=hy()),p=n(v)}else{if("int32"!==c)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(c));if("uint8"!==d.dtype&&"uint16"!==d.dtype)throw new Error("Unsupported quantization type ".concat(d.dtype," for weight type int32."));p=new Int32Array(v.length);for(var y=0;y<v.length;y++)p[y]=Math.round(v[y]*d.scale+d.min)}i+=h*f}else if("string"===c){var b=vd(s.shape);p=[];for(var k=0;k<b;k++){var x=new Uint32Array(e.slice(i,i+4))[0];i+=4;var w=new Uint8Array(e.slice(i,i+x));p.push(w),i+=x}}else{var C=ty[c],_=e.slice(i,i+h*C);if("float32"===c)p=new Float32Array(_);else if("int32"===c)p=new Int32Array(_);else if("bool"===c)p=new Uint8Array(_);else{if("complex64"!==c)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(c));p=new Float32Array(_);for(var S=new Float32Array(p.length/2),I=new Float32Array(p.length/2),T=0;T<S.length;T++)S[T]=p[2*T],I[T]=p[2*T+1];var N=ey(S,l,"float32"),A=ey(I,l,"float32");a[u]=Jg(N,A),N.dispose(),A.dispose()}i+=h*C}"complex64"!==c&&(a[u]=ey(p,l,c))}}catch(E){o.e(E)}finally{o.f()}return a}function iy(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)}));var r=new Uint8Array(t),a=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),a),a+=e.byteLength})),r.buffer}var oy="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function sy(e){return oy?Buffer.byteLength(e):new Blob([e]).size}function uy(e){if(1===e.length)return e[0];var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function cy(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function ly(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:sy(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:sy(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function hy(){var e=function(){var e=function(e){for(var t=e<<13,n=0;0==(8388608&t);)n-=8388608,t<<=1;return(t&=-8388609)|(n+=947912704)},t=new Uint32Array(2048);t[0]=0;for(var n=1;n<1024;n++)t[n]=e(n);for(var r=1024;r<2048;r++)t[r]=939524096+(r-1024<<13);return t}(),t=function(){var e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(var t=1;t<31;t++)e[t]=t<<23;for(var n=33;n<63;n++)e[n]=2147483648+(n-32<<23);return e}(),n=function(){for(var e=new Uint32Array(64),t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return function(r){for(var a=new ArrayBuffer(4*r.length),i=new Uint32Array(a),o=0;o<r.length;o++){var s=r[o];i[o]=e[n[s>>10]+(1023&s)]+t[s>>10]}return new Float32Array(a)}}var py=function(){function e(){_classCallCheck(this,e),this.saveRouters=[],this.loadRouters=[]}return _createClass(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerSaveRouter",value:function(t){e.getInstance().saveRouters.push(t)}},{key:"registerLoadRouter",value:function(t){e.getInstance().loadRouters.push(t)}},{key:"getSaveHandlers",value:function(t){return e.getHandlers(t,"save")}},{key:"getLoadHandlers",value:function(t,n){return e.getHandlers(t,"load",n)}},{key:"getHandlers",value:function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&a.push(n)})),a}}]),e}(),dy=function(e){return py.registerSaveRouter(e)},fy=function(e){return py.registerLoadRouter(e)},my=function(e){return py.getSaveHandlers(e)},vy=function(e,t){return py.getLoadHandlers(e,t)};function gy(){if(!Jd().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e="undefined"==typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function yy(e){var t=e.result;t.createObjectStore("models_store",{keyPath:"modelPath"}),t.createObjectStore("model_info_store",{keyPath:"modelPath"})}var by=function(){function e(t){if(_classCallCheck(this,e),this.indexedDB=gy(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}var t,n;return _createClass(e,[{key:"save",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return e.abrupt("return",this.databaseAction(this.modelPath,t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"load",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.databaseAction(this.modelPath));case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"databaseAction",value:function(e,t){var n=this;return new Promise((function(e,r){var a=n.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return yy(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction("models_store","readonly"),s=o.objectStore("models_store").get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '".concat(n.modelPath,"' in IndexedDB.")));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{var u,c=ly(t),l=i.transaction("model_info_store","readwrite"),h=l.objectStore("model_info_store"),p=h.put({modelPath:n.modelPath,modelArtifactsInfo:c});p.onsuccess=function(){var a=(u=i.transaction("models_store","readwrite")).objectStore("models_store").put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});a.onsuccess=function(){return e({modelArtifactsInfo:c})},a.onerror=function(e){var t=(h=l.objectStore("model_info_store")).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},p.onerror=function(e){return i.close(),r(p.error)},l.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}}))}}]),e}();by.URL_SCHEME="indexeddb://";var ky=function(e){return Jd().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(by.URL_SCHEME)?(t=e.slice(by.URL_SCHEME.length),new by(t)):null;var t};py.registerSaveRouter(ky),py.registerLoadRouter(ky);var xy=function(){function e(){_classCallCheck(this,e),this.indexedDB=gy()}var t,n;return _createClass(e,[{key:"listModels",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return yy(r)},r.onsuccess=function(){var t=r.result,a=t.transaction("model_info_store","readonly"),i=a.objectStore("model_info_store").getAll();i.onsuccess=function(){var t,n={},r=_createForOfIteratorHelper(i.result);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.modelPath]=a.modelArtifactsInfo}}catch(o){r.e(o)}finally{r.f()}e(n)},i.onerror=function(e){return t.close(),n(i.error)},a.oncomplete=function(){return t.close()}},r.onerror=function(e){return n(r.error)}})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"removeModel",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=(n=t).startsWith(by.URL_SCHEME)?n.slice(by.URL_SCHEME.length):n,new Promise((function(e,n){var a=r.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return yy(a)},a.onsuccess=function(){var r,i=a.result,o=i.transaction("model_info_store","readwrite"),s=o.objectStore("model_info_store"),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),n(new Error("Cannot find model with path '".concat(t,"' in IndexedDB.")));var a=s.delete(t),o=function(){var a=(r=i.transaction("models_store","readwrite")).objectStore("models_store").delete(t);a.onsuccess=function(){return e(u.result.modelArtifactsInfo)},a.onerror=function(e){return n(u.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),n(u.error)}},u.onerror=function(e){return i.close(),n(u.error)},o.oncomplete=function(){null==r?i.close():r.oncomplete=function(){return i.close()}}},a.onerror=function(e){return n(a.error)}}))));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}(),wy="tensorflowjs_models",Cy="info",_y="model_topology",Sy="weight_specs",Iy="weight_data",Ty="model_metadata";function Ny(e){return{info:[wy,e,Cy].join("/"),topology:[wy,e,_y].join("/"),weightSpecs:[wy,e,Sy].join("/"),weightData:[wy,e,Iy].join("/"),modelMetadata:[wy,e,Ty].join("/")}}function Ay(e){var t=e.split("/");if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join("/")}var Ey=function(){function e(t){if(_classCallCheck(this,e),!Jd().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=Ny(this.modelPath)}var t,n;return _createClass(e,[{key:"save",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),a=ly(t),e.prev=3,this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(e){if(oy)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(t.weightData)),i={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy},e.abrupt("return",(null!=t.signature&&(i.signature=t.signature),null!=t.userDefinedMetadata&&(i.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(i.modelInitializer=t.modelInitializer),this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:a}));case 9:throw e.prev=9,e.t0=e.catch(3),this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=").concat(a.modelTopologyBytes,", weightSpecsBytes=").concat(a.weightSpecsBytes,", weightDataBytes=").concat(a.weightDataBytes,"."));case 12:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(e){return n.apply(this,arguments)})},{key:"load",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a,i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=JSON.parse(this.LS.getItem(this.keys.info)))){e.next=3;break}throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));case 3:if("JSON"===t.modelTopologyType){e.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(n={},null!=(r=JSON.parse(this.LS.getItem(this.keys.topology)))){e.next=8;break}throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' is missing."));case 8:if(n.modelTopology=r,null!=(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))){e.next=12;break}throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' are missing."));case 12:if(n.weightSpecs=a,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(i),n.format=o.format,n.generatedBy=o.generatedBy,n.convertedBy=o.convertedBy,null!=o.signature&&(n.signature=o.signature),null!=o.userDefinedMetadata&&(n.userDefinedMetadata=o.userDefinedMetadata),null!=o.modelInitializer&&(n.modelInitializer=o.modelInitializer)),null!=(s=this.LS.getItem(this.keys.weightData))){e.next=18;break}throw new Error("In local storage, the binary weight values of model '".concat(this.modelPath,"' are missing."));case 18:return e.abrupt("return",(n.weightData=function(e){if(oy){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}(s),n));case 19:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();Ey.URL_SCHEME="localstorage://";var Ry=function(e){return Jd().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Ey.URL_SCHEME)?(t=e.slice(Ey.URL_SCHEME.length),new Ey(t)):null;var t};py.registerSaveRouter(Ry),py.registerLoadRouter(Ry);var Fy=function(){function e(){_classCallCheck(this,e),pd(Jd().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),pd("undefined"==typeof window||void 0!==window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}var t,n;return _createClass(e,[{key:"listModels",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={},n=wy+"/",r="/"+Cy,a=0;a<this.LS.length;++a)(i=this.LS.key(a)).startsWith(n)&&i.endsWith(r)&&(t[Ay(i)]=JSON.parse(this.LS.getItem(i)));return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"removeModel",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Ny(t=(n=t).startsWith(Ey.URL_SCHEME)?n.slice(Ey.URL_SCHEME.length):n),null!=this.LS.getItem(r.info)){e.next=3;break}throw new Error("Cannot find model at path '".concat(t,"'"));case 3:return a=JSON.parse(this.LS.getItem(r.info)),e.abrupt("return",(this.LS.removeItem(r.info),this.LS.removeItem(r.topology),this.LS.removeItem(r.weightSpecs),this.LS.removeItem(r.weightData),a));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),Dy=function(){function e(){_classCallCheck(this,e),this.managers={}}return _createClass(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerManager",value:function(t,n){pd(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith("://")&&(t=t.slice(0,t.indexOf("://"))),pd(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();pd(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '".concat(t,"'.")})),r.managers[t]=n}},{key:"getManager",value:function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t}},{key:"getSchemes",value:function(){return Object.keys(this.getInstance().managers)}}]),e}();function Oy(e){if(-1===e.indexOf("://"))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Dy.getSchemes().join(","));return{scheme:e.split("://")[0],path:e.split("://")[1]}}function My(e,t){return Py.apply(this,arguments)}function Py(){return(Py=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,u,c,l,h,p,d=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=d.length>2&&void 0!==d[2]&&d[2],pd(t!==n,(function(){return"Old path and new path are the same: '".concat(t,"'")})),pd((a=py.getLoadHandlers(t)).length>0,(function(){return"Copying failed because no load handler is found for source URL ".concat(t,".")})),pd(a.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") load handlers for source URL ").concat(t,".")})),i=a[0],pd((o=py.getSaveHandlers(n)).length>0,(function(){return"Copying failed because no save handler is found for destination URL ".concat(n,".")})),pd(o.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") save handlers for destination URL ").concat(n,".")})),s=o[0],u=Oy(t).scheme,c=Oy(t).path,l=u===Oy(t).scheme,e.next=12,i.load();case 12:if(h=e.sent,e.t0=r&&l,!e.t0){e.next=17;break}return e.next=17,Dy.getManager(u).removeModel(c);case 17:return e.next=19,s.save(h);case 19:if(p=e.sent,e.t1=r&&!l,!e.t1){e.next=24;break}return e.next=24,Dy.getManager(u).removeModel(c);case 24:return e.abrupt("return",p.modelArtifactsInfo);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ly(){return zy.apply(this,arguments)}function zy(){return(zy=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a,i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Dy.getSchemes(),n={},r=_createForOfIteratorHelper(t),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=12;break}return i=a.value,e.next=8,Dy.getManager(i).listModels();case 8:for(s in o=e.sent)n[i+"://"+s]=o[s];case 10:e.next=4;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),r.e(e.t0);case 17:return e.prev=17,r.f(),e.finish(17);case 20:return e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,null,[[2,14,17,20]])})))).apply(this,arguments)}function By(e){return Vy.apply(this,arguments)}function Vy(){return(Vy=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Oy(t),e.abrupt("return",Dy.getManager(n.scheme).removeModel(n.path));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Uy(e,t){return Wy.apply(this,arguments)}function Wy(){return(Wy=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",My(t,n,!1));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gy(e,t){return Hy.apply(this,arguments)}function Hy(){return(Hy=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",My(t,n,!0));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var jy,qy=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return fetch(e,t)}))},{key:"now",value:function(){return performance.now()}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return new TextDecoder(t).decode(e)}}]),e}();if(Jd().get("IS_BROWSER")){Jd().setPlatform("browser",new qy);try{Dy.registerManager(Ey.URL_SCHEME,new Fy)}catch(UY){}try{Dy.registerManager(by.URL_SCHEME,new xy)}catch(UY){}}function Ky(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",Kd(e),new xg(e,t,n)}Jd().get("IS_NODE")&&Jd().setPlatform("node",new(function(){function e(){_classCallCheck(this,e),this.util=n(3),this.textEncoder=new this.util.TextEncoder}return _createClass(e,[{key:"fetch",value:function(e,t){return null!=Jd().global.fetch?Jd().global.fetch(e,t):(null==jy&&(jy=n(2)),jy(e,t))}},{key:"now",value:function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}}]),e}()));var Xy=Qg({cast_:function(e,t){var n=Xg(e,"x","cast");if(!Rd(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");return Ug.runKernel(If,{x:n},{dtype:t})}}),Yy=Qg({clone_:function(e){var t=Xg(e,"x","clone",null);return Ug.runKernel(mm,{x:t})}});function Zy(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}function Qy(e){return new Promise((function(e){return setTimeout(e)})).then(e)}Vg(),Cg={buffer:Ky,cast:Xy,clone:Yy,print:Zy};var Jy=function(){function e(t){if(_classCallCheck(this,e),!Jd().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}var t;return _createClass(e,[{key:"save",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!=typeof document){e.next=2;break}throw new Error("Browser downloads are not supported in this environment since `document` is not present");case 2:if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer)){e.next=5;break}throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 5:return r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]},null!=t.signature&&(r.signature=t.signature),null!=t.userDefinedMetadata&&(r.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(r.modelInitializer=t.modelInitializer),a=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(i=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,i.href=a,e.next=12,Qy((function(){return i.dispatchEvent(new MouseEvent("click"))}));case 12:if(null==t.weightData){e.next=18;break}return(o=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,o.href=n,e.next=18,Qy((function(){return o.dispatchEvent(new MouseEvent("click"))}));case 18:return e.abrupt("return",{modelArtifactsInfo:ly(t)});case 19:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();Jy.URL_SCHEME="downloads://";var $y=function(){function e(t){if(_classCallCheck(this,e),null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}var t;return _createClass(e,[{key:"load",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.files[0],n=this.files.slice(1),e.abrupt("return",new Promise((function(e,a){var i=new FileReader;i.onload=function(i){var o=JSON.parse(i.target.result),s=o.modelTopology;if(null!=s){0===n.length&&e({modelTopology:s});var u=o.weightsManifest;if(null!=u){var c;try{c=r.checkManifestAndWeightFiles(u,n)}catch(UY){return void a(UY)}var l=[],h=[],p=[];u.forEach((function(e){e.paths.forEach((function(e){h.push(e),p.push(null)})),l.push.apply(l,_toConsumableArray(e.weights))})),u.forEach((function(t){t.paths.forEach((function(t){var n=new FileReader;n.onload=function(n){var r=n.target.result,a=h.indexOf(t);if(p[a]=r,-1===p.indexOf(null)){var i={modelTopology:s,weightSpecs:l,weightData:uy(p),format:o.format,generatedBy:o.generatedBy,convertedBy:o.convertedBy};null!=o.signature&&(i.signature=o.signature),null!=o.userDefinedMetadata&&(i.userDefinedMetadata=o.userDefinedMetadata),null!=o.modelInitializer&&(i.modelInitializer=o.modelInitializer),e(i)}},n.onerror=function(e){return a("Failed to weights data from file of path '".concat(t,"'."))},n.readAsArrayBuffer(c[t])}))}))}else a(new Error("weightManifest field is missing from file "+t.name))}else a(new Error("modelTopology field is missing from file "+t.name))},i.onerror=function(e){return a("Failed to read model topology and weights manifest JSON from file '".concat(t.name,"'. BrowserFiles supports loading Keras-style tf.Model artifacts only."))},i.readAsText(t)})));case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"checkManifestAndWeightFiles",value:function(e,t){var n,r=[],a=t.map((function(e){return cy(e.name)})),i={},o=_createForOfIteratorHelper(e);try{for(o.s();!(n=o.n()).done;){n.value.paths.forEach((function(e){var n=cy(e);if(-1!==r.indexOf(n))throw new Error("Duplicate file basename found in weights manifest: '".concat(n,"'"));if(r.push(n),-1===a.indexOf(n))throw new Error("Weight file with basename '".concat(n,"' is not provided."));i[e]=t[a.indexOf(n)]}))}}catch(UY){o.e(UY)}finally{o.f()}if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest (".concat(r.length,") and the number of weight files provided (").concat(t.length,")."));return i}}]),e}();function eb(e){return new $y(e)}function tb(e,t,n,r){!function(e){pd(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){pd(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e})),pd(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t})),pd(t>=e,(function(){return"startFraction must be no more than endFraction, but got startFraction ".concat(e," and endFraction ")+t}))}(n=null==n?0:n,r=null==r?1:r);var a=0;return Promise.all(e.map((function(i){return i.then((function(i){var o=n+ ++a/e.length*(r-n);return t(o),i})),i})))}function nb(e,t){return rb.apply(this,arguments)}function rb(){return(rb=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),r=null==n.fetchFunc?Jd().platform.fetch:n.fetchFunc,a=t.map((function(e){return r(e,n.requestInit,{isBinary:!0})})),null!=n.onProgress){e.next=9;break}return e.next=6,Promise.all(a);case 6:e.t0=e.sent,e.next=12;break;case 9:return e.next=11,tb(a,n.onProgress,0,.5);case 11:e.t0=e.sent;case 12:if(i=e.t0.map((function(e){return e.arrayBuffer()})),null!=n.onProgress){e.next=19;break}return e.next=16,Promise.all(i);case 16:e.t1=e.sent,e.next=22;break;case 19:return e.next=21,tb(i,n.onProgress,.5,1);case 21:e.t1=e.sent;case 22:return e.abrupt("return",e.t1);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ab(e){return ib.apply(this,arguments)}function ib(){return(ib=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:"",r=i.length>2?i[2]:void 0,a=i.length>3?i[3]:void 0,e.abrupt("return",ob((function(e){return nb(e,{requestInit:a})}))(t,n,r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ob(e){return function(){var t=_asyncToGenerator(regeneratorRuntime.mark((function t(n){var r,a,i,o,s,u,c,l,h,p,d,f,m=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=m.length>1&&void 0!==m[1]?m[1]:"",a=m.length>2?m[2]:void 0,i=n.map((function(){return!1})),o={},s=null!=a?a.map((function(){return!1})):[],u=[],n.forEach((function(e,t){var n=0;e.weights.forEach((function(e){var r=ty["quantization"in e?e.quantization.dtype:e.dtype]*vd(e.shape),c=function(){i[t]=!0,null==o[t]&&(o[t]=[]),o[t].push({manifestEntry:e,groupOffset:n,sizeBytes:r})};null!=a?a.forEach((function(t,n){t===e.name&&(c(),s[n]=!0)})):c(),u.push(e.name),n+=r}))})),s.every((function(e){return e}))){t.next=6;break}throw c=a.filter((function(e,t){return!s[t]})),new Error("Could not find weights in manifest with names: "+c.join(", ")+". \nManifest JSON has weights with names: "+u.join(", ")+".");case 6:return l=i.reduce((function(e,t,n){return t&&e.push(n),e}),[]),h=[],l.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;h.push(t)}))})),t.next=10,e(h);case 10:return p=t.sent,d={},f=0,t.abrupt("return",(l.forEach((function(e){for(var t=n[e].paths.length,r=0,a=0;a<t;a++)r+=p[f+a].byteLength;for(var i=new ArrayBuffer(r),s=new Uint8Array(i),u=0,c=0;c<t;c++){var l=new Uint8Array(p[f+c]);s.set(l,u),u+=l.byteLength}o[e].forEach((function(e){var t=ay(i.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)d[n]=t[n]})),f+=t})),d));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}py.registerSaveRouter((function(e){return Jd().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Jy.URL_SCHEME)?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new Jy(e)}(e.slice(Jy.URL_SCHEME.length)):null}));var sb=function(){function e(t,n){if(_classCallCheck(this,e),this.DEFAULT_METHOD="POST",null==n&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,null!=n.fetchFunc?(pd("function"==typeof n.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=n.fetchFunc):this.fetch=Jd().platform.fetch,pd(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&pd(2===t.length,(function(){return"URL paths for http must have a length of 2, (actual length is ".concat(t.length,").")})),this.path=t,null!=n.requestInit&&null!=n.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}var t,n,r;return _createClass(e,[{key:"save",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");case 2:return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:[{paths:["./model.weights.bin"],weights:t.weightSpecs}]},null!=t.signature&&(r.signature=t.signature),null!=t.userDefinedMetadata&&(r.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(r.modelInitializer=t.modelInitializer),n.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=t.weightData&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),e.next=8,this.fetch(this.path,n);case 8:if(!(a=e.sent).ok){e.next=11;break}return e.abrupt("return",{modelArtifactsInfo:ly(t),responses:[a]});case 11:throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+a.status+".");case 12:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"load",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a,i,o,s,u,c,l,h,p,d,f,m,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(this.path,this.requestInit);case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Request to ".concat(this.path," failed with status code ")+t.status+". Please verify this URL points to the model JSON of the model to load.");case 5:return e.prev=5,e.next=8,t.json();case 8:n=e.sent,e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(5),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 15:if(a=n.modelTopology,i=n.weightsManifest,o=n.generatedBy,s=n.convertedBy,u=n.format,c=n.signature,l=n.userDefinedMetadata,null!=a||null!=i){e.next=18;break}throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model topology or manifest for weights."));case 18:if(null==i){e.next=25;break}return e.next=21,this.loadWeights(i);case 21:d=e.sent,f=_slicedToArray(d,2),h=f[0],p=f[1];case 25:return m={modelTopology:a,weightSpecs:h,weightData:p,generatedBy:o,convertedBy:s,format:u},null!=c&&(m.signature=c),null!=l&&(m.userDefinedMetadata=l),v=n.modelInitializer,e.abrupt("return",(v&&(m.modelInitializer=v),m));case 29:case"end":return e.stop()}}),e,this,[[5,11]])}))),function(){return n.apply(this,arguments)})},{key:"loadWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i,o,s,u,c,l,h,p,d,f,m,v,g,y,b;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Array.isArray(this.path)?this.path[1]:this.path,x=void 0,w=void 0,x=(k=n).lastIndexOf("/"),w=k.lastIndexOf("?"),r=[k.substring(0,x)+"/",w>x?k.substring(w):""],a=_slicedToArray(r,2),i=a[0],o=a[1],s=this.weightPathPrefix||i,u=[],c=_createForOfIteratorHelper(t);try{for(c.s();!(l=c.n()).done;)h=l.value,u.push.apply(u,_toConsumableArray(h.weights))}catch(UY){c.e(UY)}finally{c.f()}p=[],d=[],f=_createForOfIteratorHelper(t);try{for(f.s();!(m=f.n()).done;){v=m.value,g=_createForOfIteratorHelper(v.paths);try{for(g.s();!(y=g.n()).done;)b=y.value,null!=this.weightUrlConverter?d.push(this.weightUrlConverter(b)):p.push(s+b+o)}catch(UY){g.e(UY)}finally{g.f()}}}catch(UY){f.e(UY)}finally{f.f()}if(e.t0=this.weightUrlConverter,!e.t0){e.next=16;break}return e.t1=p.push,e.t2=p,e.t3=_toConsumableArray,e.next=13,Promise.all(d);case 13:e.t4=e.sent,e.t5=(0,e.t3)(e.t4),e.t1.apply.call(e.t1,e.t2,e.t5);case 16:return e.t6=u,e.t7=uy,e.next=20,nb(p,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});case 20:return e.t8=e.sent,e.t9=(0,e.t7)(e.t8),e.abrupt("return",[e.t6,e.t9]);case 23:case"end":return e.stop()}var k,x,w}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();function ub(e){return null!=e.match(sb.URL_SCHEME_REGEX)}sb.URL_SCHEME_REGEX=/^https?:\/\//;var cb=function(e,t){if("undefined"==typeof fetch&&(null==t||null==t.fetchFunc))return null;return(Array.isArray(e)?e.every((function(e){return ub(e)})):ub(e))?lb(e,t):null};function lb(e,t){return new sb(e,t)}function hb(e,t){return lb(e,t)}py.registerSaveRouter(cb),py.registerLoadRouter(cb);var pb=function(){function e(t){_classCallCheck(this,e),this.modelArtifacts=t}var t;return _createClass(e,[{key:"load",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.modelArtifacts);case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),db=function(){function e(t){_classCallCheck(this,e),this.saveHandler=t}var t;return _createClass(e,[{key:"save",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.saveHandler(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();function fb(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new pb(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new pb({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new pb({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))}function mb(e){return new db(e)}var vb,gb=Qg({matMul_:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=Xg(e,"a","matMul"),o=Xg(t,"b","matMul");return i=(n=_slicedToArray(Og(i,o),2))[0],o=n[1],Ug.runKernel(wf,{a:i,b:o},{transposeA:r,transposeB:a})}}),yb=Qg({oneHot_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var a=Xg(e,"indices","oneHot","int32");return Ug.runKernel($m,{indices:a},{depth:t,onValue:n,offValue:r})}}),bb=Qg({transpose_:function(e,t){var n=Xg(e,"x","transpose");return null==t&&(t=n.shape.map((function(e,t){return t})).reverse()),pd(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," must match length of perm ").concat(t,".")})),t.forEach((function(e){pd(e>=0&&e<n.rank,(function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t}))})),n.rank<=1?n.clone():Ug.runKernel(Wv,{x:n},{perm:t})}}),kb=Qg({confusionMatrix_:function(e,t,n){var r=Xg(e,"labels","confusionMatrix"),a=Xg(t,"predictions","confusionMatrix");pd(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, but got "+n})),pd(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),pd(1===a.rank,(function(){return"Expected the rank of predictions to be 1, but got "+a.rank})),pd(r.shape[0]===a.shape[0],(function(){return"Mismatch in the number of examples: ".concat(r.shape[0]," vs. ").concat(a.shape[0],". Labels and predictions should have the same number of elements.")})),pd(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got "+n}));var i=yb(Xy(r,"int32"),n),o=yb(Xy(a,"int32"),n),s=bb(i),u=gb(s,o);return Xy(u,"int32")}});function xb(e,t,n){if(fd(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=qg(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return $g(e,t,r,n)}function wb(e,t){return Cb.apply(this,arguments)}function Cb(){return(Cb=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,u,c,l,h,p,d,f,m,v,g,y,b;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Xg(t,"img","toPixels"),t instanceof _g||(r=Xy(a=r,"int32"),a.dispose()),2===r.rank||3===r.rank){e.next=4;break}throw new Error("toPixels only supports rank 2 or 3 tensors, got rank ".concat(r.rank,"."));case 4:if(i=r.shape.slice(0,2),o=_slicedToArray(i,2),s=o[0],u=o[1],!((c=2===r.rank?1:r.shape[2])>4||2===c)){e.next=7;break}throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+c);case 7:if("float32"===r.dtype||"int32"===r.dtype){e.next=9;break}throw new Error("Unsupported type for toPixels: ".concat(r.dtype,". Please use float32 or int32 tensors."));case 9:return e.next=11,r.data();case 11:l=e.sent,h="float32"===r.dtype?255:1,p=new Uint8ClampedArray(u*s*4),d=0;case 15:if(!(d<s*u)){e.next=36;break}f=[0,0,0,255],m=0;case 18:if(!(m<c)){e.next=31;break}if(v=l[d*c+m],"float32"!==r.dtype){e.next=25;break}if(!(v<0||v>1)){e.next=23;break}throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ".concat(v,"."));case 23:e.next=27;break;case 25:if("int32"!==r.dtype||!(v<0||v>255)){e.next=27;break}throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ".concat(v,"."));case 27:1===c?(f[0]=v*h,f[1]=v*h,f[2]=v*h):f[m]=v*h;case 28:m++,e.next=18;break;case 31:p[(g=4*d)+0]=Math.round(f[0]),p[g+1]=Math.round(f[1]),p[g+2]=Math.round(f[2]),p[g+3]=Math.round(f[3]);case 33:++d,e.next=15;break;case 36:return null!=n&&(n.width=u,n.height=s,y=n.getContext("2d"),b=new ImageData(p,u,s),y.putImageData(b,0,0)),e.abrupt("return",(r!==t&&r.dispose(),p));case 38:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var _b=Qg({fromPixels_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,a=!1,i=!1,o=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)i=!0;else{if(null==e.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);o=!0}if(a){var s=2;if(a&&e.readyState<s)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=tg(Xv,Ug.backendName))return Ug.runKernel(Xv,{pixels:e},{numChannels:t});var u,c,l=a?[e.videoWidth,e.videoHeight]:[e.width,e.height],h=_slicedToArray(l,2),p=h[0],d=h[1];if(o?u=e.getContext("2d").getImageData(0,0,p,d).data:r||n?u=e.data:(i||a)&&(null==vb&&(vb=document.createElement("canvas").getContext("2d")),vb.canvas.width=p,vb.canvas.height=d,vb.drawImage(e,0,0,p,d),u=vb.getImageData(0,0,p,d).data),4===t)c=new Int32Array(u);else{var f=p*d;c=new Int32Array(f*t);for(var m=0;m<f;m++)for(var v=0;v<t;++v)c[m*t+v]=u[4*m+v]}return xb(c,[d,p,t],"int32")}});function Sb(e,t){var n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: ".concat(t.shape[r-1]," vs. ").concat(n));if(0===vd(e.shape))throw new Error("Requested more than 0 entries, but input is empty. Input shape: ".concat(e.shape,"."));for(var a=t.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=e.shape,c=a.slice();c.pop();for(var l=1,h=i;h<n;++h)l*=u[h],c.push(u[h]);var p=[].concat(_toConsumableArray(Wd(e.shape).map((function(e){return e/l}))),[1]).slice(0,i);return[c,o,l,p]}function Ib(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: ".concat(t.shape,", shape: ").concat(e)+", sliceDim: ".concat(r,", and batchDim: ").concat(a,".");if(n.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(e.length<r+(n.rank-a))throw new Error(i+" Output shape length < "+(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != "+(a+e.length-r));for(var o=0;o<a;++o)if(n.shape[o]!==t.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(n.shape[o],") != indices.shape[").concat(o,"] (").concat(t.shape[o],")."));for(var s=0;s<n.rank-a;++s)if(n.shape[s+a]!==e[s+r])throw new Error(i+" updates.shape[".concat(s+a,"] (").concat(n.shape[s+a],") != shape[").concat(s+a,"] (").concat(e[s+a],")"))}function Tb(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}Ib(n,t,e)}function Nb(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length,o=1,s=a;s<i;++s)o*=n[s];var u=a<1?1:a;return{sliceRank:a,numUpdates:vd(t.shape)/u,sliceSize:o,strides:[].concat(_toConsumableArray(Wd(n.slice(0,a))),[1]),outputSize:vd(n)}}function Ab(e,t,n){var r=e.shape.length;pd(r===t.length,(function(){return"Error in slice".concat(r,"D: Length of begin ").concat(t," must match the rank of the array (").concat(r,").")})),pd(r===n.length,(function(){return"Error in slice".concat(r,"D: Length of size ").concat(n," must match the rank of the array (").concat(r,").")}));for(var a=function(a){pd(t[a]+n[a]<=e.shape[a],(function(){return"Error in slice".concat(r,"D: begin[").concat(a,"] + size[").concat(a,"] (").concat(t[a]+n[a],") would overflow input.shape[").concat(a,"] (").concat(e.shape[a],")")}))},i=0;i<r;++i)a(i)}function Eb(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function Rb(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function Fb(e,t,n,r){for(var a=_toConsumableArray(e),i=a.length;i<r.length;i++)a.push(1);for(var o=0;o<n;o++)0===o?a[t]=1:(a.splice(t,0,1),a.pop());return a}function Db(e,t,n){return n<=e?n:n-(t-1)}function Ob(e,t){for(var n=[],r=0;r<e;r++)n.push(t+r);return n}function Mb(e,t,n,r,a,i,o,s,u){var c=e.length,l=new Array(c),h=new Array(c),p=new Array(c);if(t.length&&n>0){var d=t[0],f=n+1;l=Pb(o,d,f,r,e),h=Lb(s,d,f,a,e),p=Fb(i,d,f,e)}else for(var m=0;m<c;m++)l[m]=Bb(o,r,i,e,m,u),h[m]=Vb(s,a,i,e,m,u),p[m]=zb(i,m,u);return{begin:l,end:h,strides:p}}function Pb(e,t,n,r,a){for(var i=_toConsumableArray(a),o=Ob(n,t),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=0;else{var u=Db(t,n,s),c=r[u];e&1<<u&&(c=0),i[s]=c}return i}function Lb(e,t,n,r,a){for(var i=_toConsumableArray(a),o=Ob(n,t),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=Number.MAX_SAFE_INTEGER;else{var u=Db(t,n,s),c=r[u];e&1<<u&&(c=Number.MAX_SAFE_INTEGER),i[s]=c}for(var l=0;l<i.length;l++){var h=a[l];i[l]<0&&(i[l]+=h),i[l]=sd(0,i[l],a[l])}return i}function zb(e,t,n){var r=e[t];return(n&1<<t||null==r)&&(r=1),r}function Bb(e,t,n,r,a,i){var o=t[a];(e&1<<a||i&1<<a||null==o)&&(o=(n[a]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[a];return o<0&&(o+=s),o=sd(0,o,s-1)}function Vb(e,t,n,r,a,i){var o=t[a],s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=s>0?sd(0,o,u):sd(-1,o,u-1)}function Ub(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(var i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function Wb(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function Gb(e,t,n){var r,a,i=e.shape.length;return(r="number"==typeof t?[t].concat(_toConsumableArray(new Array(i-1).fill(0))):t.length<i?t.concat(new Array(i-t.length).fill(0)):t.slice()).forEach((function(e){pd(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),a=(a=null==n?new Array(i).fill(-1):"number"==typeof n?[n].concat(_toConsumableArray(new Array(i-1).fill(-1))):n.length<i?n.concat(new Array(i-n.length).fill(-1)):n).map((function(t,n){return t>=0?t:(pd(-1===t,(function(){return"Negative size values should be exactly -1 but got ".concat(t," for the slice() size at index ").concat(n,".")})),e.shape[n]-r[n])})),[r,a]}function Hb(e,t,n,r,a,i,o,s,u){var c=t.slice(),l=n.slice(),h=r;null==r&&(h=new Array(c.length));var p=Eb(o);if(p.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(0!==o&&0!==s)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(0!==o&&0!==u)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");var d=e.length-c.length,f=Eb(s),m=e.slice();f.forEach((function(e){c[e]=0,l[e]=1,m.splice(e,0,1)}));var v=Mb(m,p,d,c,l,h,a,i,o),g=v.begin,y=v.end,b=v.strides;c=g,l=y,h=b;var k=Eb(u);k.forEach((function(e){l[e]=c[e]+1,h[e]=1}));var x=Rb(c,l,h),w=x.filter((function(e,t){return-1===k.indexOf(t)}));return{nonStrided:h.every((function(e){return 1===e})),$begin:c,$end:l,$strides:h,size:x,newShape:m,outShape:w}}var jb=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"getClassName",value:function(){return this.constructor.className}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),e}(),qb=function(){function e(){_classCallCheck(this,e),this.classNameMap={}}return _createClass(e,null,[{key:"getMap",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"register",value:function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]}}]),e}();function Kb(e){pd(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),pd("string"==typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),pd(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),qb.register(e)}var Xb=.1;function Yb(e,t,n){return null==n&&(n=Zb()),Qb(e,t,(function(e,t){return tk(e,t,n)}))}function Zb(){return 32===Ug.backend.floatPrecision()?.001:Xb}function Qb(e,t,n){var r=!0;if((Dd(e)||Dd(t))&&(r=!1),Dd(e)&&Dd(t)&&(r=!0),r){var a=e.constructor.name,i=t.constructor.name;if(a!==i)throw new Error("Arrays are of different type. Actual: ".concat(a,". Expected: ")+i)}if(Array.isArray(e)&&Array.isArray(t)){var o=qg(e),s=qg(t);if(!yd(o,s))throw new Error("Arrays have different shapes. Actual: [".concat(o,"]. Expected: [").concat(s,"]"))}var u=Dd(e)?e:md(e),c=Dd(t)?t:md(t);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: ".concat(u.length," vs expected: ").concat(c.length,".\nActual:   ").concat(u,".\nExpected: ").concat(c,"."));for(var l=0;l<c.length;++l){var h=u[l],p=c[l];if(!n(h,p))throw new Error("Arrays differ: actual[".concat(l,"] = ").concat(h,", expected[").concat(l,"] = ").concat(p,".\nActual:   ").concat(u,".\nExpected: ").concat(c,"."))}}function Jb(e,t){e().then((function(){return t.fail()}),(function(){return t()}))}function $b(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return Pd(e)||Pd(e[0])||Pd(t)||Pd(t[0])?Qb(e,n,(function(e,t){return e==t})):Qb(e,t,(function(e,t){return tk(e,t,0)}))}function ek(e,t,n){if(null==n&&(n=Zb()),!tk(e,t,n))throw new Error("Numbers differ: actual === ".concat(e,", expected === ").concat(t))}function tk(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}function nk(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:".concat(e[r]," low: ").concat(t,", high: ").concat(n))}function rk(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}function ak(e){for(var t=0;t<e.length;t++){var n=e[t];Array.isArray(n)?ak(n):e[t]=bg(n)}return e}var ik="2.8.1";function ok(){Jd().set("PROD",!0)}function sk(){Jd().set("DEBUG",!0)}function uk(){Jd().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function ck(e){Jd().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function lk(){Ug.disposeVariables()}function hk(){return Ug}function pk(){return Ug.memory()}function dk(e){return Ug.profile(e)}function fk(e,t){return Ug.tidy(e,t)}function mk(e){Lg(e).forEach((function(e){return e.dispose()}))}function vk(e){return Ug.keep(e)}function gk(e){return Ug.time(e)}function yk(e){return Ug.setBackend(e)}function bk(){return Ug.ready()}function kk(){return Ug.backendName}function xk(e){Ug.removeBackend(e)}function wk(e){return Ug.findBackend(e)}function Ck(e){return Ug.findBackendFactory(e)}function _k(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Ug.registerBackend(e,t,n)}function Sk(){return Ug.backend}function Ik(e,t){Jd().setPlatform(e,t)}var Tk=Qg({add_:function(e,t){var n,r=Xg(e,"a","add"),a=Xg(t,"b","add");return r=(n=_slicedToArray(Og(r,a),2))[0],a=n[1],Ug.runKernel(sf,{a:r,b:a})}}),Nk=Qg({floorDiv_:function(e,t){var n,r=Xg(e,"a","floorDiv"),a=Xg(t,"b","floorDiv");return r=(n=_slicedToArray(Og(r,a),2))[0],a=n[1],Ug.runKernel(cm,{a:r,b:a})}}),Ak=Qg({div_:function(e,t){var n,r=Xg(e,"a","div"),a=Xg(t,"b","div");return r=(n=_slicedToArray(Og(r,a),2))[0],a=n[1],"int32"===r.dtype&&"int32"===a.dtype?Nk(r,a):Ug.runKernel(Qf,{a:r,b:a},{})}}),Ek=Qg({mul_:function(e,t){var n,r=Xg(e,"a","mul"),a=Xg(t,"b","mul");return r=(n=_slicedToArray(Og(r,a),2))[0],a=n[1],Ug.runKernel(qm,{a:r,b:a})}}),Rk=Qg({sqrt_:function(e){var t=Xg(e,"x","sqrt");return Ug.runKernel(Nv,{x:t})}}),Fk=Qg({square_:function(e){var t=Xg(e,"x","square");return Ug.runKernel("Square",{x:t},{})}}),Dk=Qg({zerosLike_:function(e){var t=Xg(e,"x","zerosLike");return Ug.runKernel(qv,{x:t})}});function Ok(e){return pd(Vd(e),(function(){return"The f passed in grad(f) must be a function"})),function(t,n){var r=Xg(t,"x","tf.grad",null),a=null!=n?Xg(n,"dy","tf.grad"):null;return Ug.tidy((function(){var t=Ug.gradients((function(){return e(r)}),[r],a),n=t.value,i=t.grads;return null!=a&&dd(n.shape,a.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Vk(i),i[0]}))}}function Mk(e){return pd(Vd(e),(function(){return"The f passed in grads(f) must be a function"})),function(t,n){pd(Array.isArray(t),(function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"}));var r=Yg(t,"args","tf.grads",null),a=null!=n?Xg(n,"dy","tf.grads"):null;return Ug.tidy((function(){var t=Ug.gradients((function(){return e.apply(void 0,_toConsumableArray(r))}),r,a),n=t.value,i=t.grads;return null!=a&&dd(n.shape,a.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Vk(i),i}))}}function Pk(e){return pd(Vd(e),(function(){return"The f passed in valueAndGrad(f) must be a function"})),function(t,n){pd(t instanceof _g,(function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"})),pd(null==n||n instanceof _g,(function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"}));var r=Ug.gradients((function(){return e(t)}),[t],n),a=r.grads,i=r.value;return Vk(a),{grad:a[0],value:i}}}function Lk(e){return pd(Vd(e),(function(){return"The f passed in valueAndGrads(f) must be a function"})),function(t,n){pd(Array.isArray(t)&&t.every((function(e){return e instanceof _g})),(function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"})),pd(null==n||n instanceof _g,(function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"}));var r=Ug.gradients((function(){return e.apply(void 0,_toConsumableArray(t))}),t,n);return null!=n&&dd(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Vk(r.grads),r}}function zk(e,t){pd(Vd(e),(function(){return"The f passed in variableGrads(f) must be a function"})),pd(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof Eg})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],Ug.registeredVariables)t.push(Ug.registeredVariables[r]);var a=n?t.filter((function(e){return!e.trainable})):null,i=t.length;pd((t=t.filter((function(e){return e.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the ".concat(i," variables is trainable.")}));var o=Ug.gradients(e,t,null,!0),s=o.value,u=o.grads;pd(u.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),pd(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-".concat(s.rank," tensor")}));var c={};return t.forEach((function(e,t){null!=u[t]&&(c[e.name]=u[t])})),null!=a&&a.forEach((function(e){return c[e.name]=null})),{value:s,grads:c}}function Bk(e){return Ug.customGrad(e)}function Vk(e){if(e.filter((function(e){return null==e})).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}function Uk(e,t){if((Dd(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&Dd(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return $g(e,[],[],t)}var Wk=function(e){_inherits(o,e);var t,n,r,a,i=_createSuper(o);function o(){return _classCallCheck(this,o),i.apply(this,arguments)}return _createClass(o,[{key:"minimize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.computeGradients(e,n),a=r.value,i=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:i[e.name]}}));this.applyGradients(o)}else this.applyGradients(i);return mk(i),t?a:(a.dispose(),null)}},{key:"incrementIterations",value:function(){this.iterations_=this.iterations+1}},{key:"computeGradients",value:function(e,t){return zk(e,t)}},{key:"dispose",value:function(){null!=this.iterations_&&mk(this.iterations_)}},{key:"saveIterations",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:Uk(this.iterations_,"int32")}));case 1:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getWeights",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for this optimizer yet.");case 1:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"setWeights",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName());case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"extractIterations",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t[0].tensor.data();case 2:return this.iterations_=e.sent[0],e.abrupt("return",t.slice(1));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"iterations",get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}}]),o}(jb);Object.defineProperty(Wk,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var Gk=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return _classCallCheck(this,a),(n=r.call(this)).learningRate=e,n.rho=t,n.epsilon=i,n.accumulatedGrads=[],n.accumulatedUpdates=[],null==i&&(n.epsilon=Ug.backend.epsilon()),n}return _createClass(a,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Ug.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:fk((function(){return Dk(a).variable(!1)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:fk((function(){return Dk(a).variable(!1)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;fk((function(){var e=Tk(Ek(o,t.rho),Ek(Fk(i),1-t.rho)),n=Ek(Ak(Rk(Tk(s,t.epsilon)),Rk(Tk(o,t.epsilon))),i),r=Tk(Ek(s,t.rho),Ek(Fk(n),1-t.rho));o.assign(e),s.assign(r);var u=Tk(Ek(n,-t.learningRate),a);a.assign(u)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedUpdates&&(mk(this.accumulatedGrads.map((function(e){return e.variable}))),mk(this.accumulatedUpdates.map((function(e){return e.variable}))))}},{key:"getWeights",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(_toConsumableArray(this.accumulatedGrads),_toConsumableArray(this.accumulatedUpdates)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:e.t0=(t=e.sent).length,n=e.t0/2,this.accumulatedGrads=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedUpdates=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}]),a}(Wk);function Hk(e,t,n){return Ug.runKernel(om,{},{shape:e,value:t,dtype:n})}Gk.className="Adadelta",Kb(Gk);var jk=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return _classCallCheck(this,a),(t=r.call(this)).learningRate=e,t.initialAccumulatorValue=n,t.accumulatedGrads=[],t}return _createClass(a,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Ug.registeredVariables[n];if(null==t.accumulatedGrads[r]){t.accumulatedGrads[r]={originalName:n+"/accumulator",variable:fk((function(){return Hk(a.shape,t.initialAccumulatorValue).variable(!1)}))}}var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable;fk((function(){var e=Tk(o,Fk(i));o.assign(e);var n=Tk(Ek(Ak(i,Rk(Tk(e,Ug.backend.epsilon()))),-t.learningRate),a);a.assign(n)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedGrads&&mk(this.accumulatedGrads.map((function(e){return e.variable})))}},{key:"getWeights",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,this.accumulatedGrads=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}]),a}(Wk);jk.className="Adagrad",Kb(jk);var qk=Qg({pow_:function(e,t){var n,r=Xg(e,"base","pow"),a=Xg(t,"exp","pow");return r=(n=_slicedToArray(Og(r,a),2))[0],a=n[1],Ug.runKernel(rv,{a:r,b:a})}}),Kk=Qg({sub_:function(e,t){var n,r=Xg(e,"a","sub"),a=Xg(t,"b","sub");return r=(n=_slicedToArray(Og(r,a),2))[0],a=n[1],Ug.runKernel(Mv,{a:r,b:a})}}),Xk=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t,n){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return _classCallCheck(this,a),(i=r.call(this)).learningRate=e,i.beta1=t,i.beta2=n,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],fk((function(){i.accBeta1=Uk(t).variable(),i.accBeta2=Uk(n).variable()})),null==o&&(i.epsilon=Ug.backend.epsilon()),i}return _createClass(a,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);fk((function(){var r=Kk(1,t.accBeta1),a=Kk(1,t.accBeta2);n.forEach((function(n,i){var o=Ug.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:n+"/m",variable:fk((function(){return Dk(o).variable(!1)}))}),null==t.accumulatedSecondMoment[i]&&(t.accumulatedSecondMoment[i]={originalName:n+"/v",variable:fk((function(){return Dk(o).variable(!1)}))});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedSecondMoment[i].variable,l=Tk(Ek(u,t.beta1),Ek(s,1-t.beta1)),h=Tk(Ek(c,t.beta2),Ek(Fk(s),1-t.beta2)),p=Ak(l,r),d=Ak(h,a);u.assign(l),c.assign(h);var f=Tk(Ek(Ak(p,Tk(Rk(d),t.epsilon)),-t.learningRate),o);o.assign(f)}})),t.accBeta1.assign(Ek(t.accBeta1,t.beta1)),t.accBeta2.assign(Ek(t.accBeta2,t.beta2))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&mk(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&mk(this.accumulatedSecondMoment.map((function(e){return e.variable})))}},{key:"getWeights",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(_toConsumableArray(this.accumulatedFirstMoment),_toConsumableArray(this.accumulatedSecondMoment)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,fk((function(){r.accBeta1.assign(qk(r.beta1,r.iterations_+1)),r.accBeta2.assign(qk(r.beta2,r.iterations_+1))})),n=t.length/2,this.accumulatedFirstMoment=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedSecondMoment=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}]),a}(Wk);Xk.className="Adam",Kb(Xk);var Yk=Qg({abs_:function(e){var t=Xg(e,"x","abs");return Ug.runKernel("complex64"===t.dtype?Ef:rf,{x:t})}});function Zk(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r}function Qk(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function Jk(e,t){for(var n=[],r=Math.max(e.length,t.length),a=0;a<r;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)n.unshift(o);else if(1===o)n.unshift(i);else{if(i!==o)throw Error("Operands could not be broadcast together with shapes ".concat(e," and ").concat(t,"."));n.unshift(i)}}return n}var $k=Qg({maximum_:function(e,t){var n,r=Xg(e,"a","maximum"),a=Xg(t,"b","maximum");return r=(n=_slicedToArray(Og(r,a),2))[0],a=n[1],"bool"===r.dtype&&(r=Xy(r,"int32"),a=Xy(a,"int32")),Jk(r.shape,a.shape),Ug.runKernel(Om,{a:r,b:a})}}),ex=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t,n){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return _classCallCheck(this,a),(i=r.call(this)).learningRate=e,i.beta1=t,i.beta2=n,i.epsilon=o,i.decay=s,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],fk((function(){i.iteration=Uk(0).variable(),i.accBeta1=Uk(t).variable()})),null==o&&(i.epsilon=Ug.backend.epsilon()),i}return _createClass(a,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);fk((function(){var r=Kk(1,t.accBeta1),a=Ak(-t.learningRate,Tk(Ek(t.iteration,t.decay),1));n.forEach((function(n,i){var o=Ug.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:n+"/m",variable:Dk(o).variable(!1)}),null==t.accumulatedWeightedInfNorm[i]&&(t.accumulatedWeightedInfNorm[i]={originalName:n+"/v",variable:Dk(o).variable(!1)});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedWeightedInfNorm[i].variable,l=Tk(Ek(u,t.beta1),Ek(s,1-t.beta1)),h=Ek(c,t.beta2),p=Yk(s),d=$k(h,p);u.assign(l),c.assign(d);var f=Tk(Ek(Ak(a,r),Ak(l,Tk(d,t.epsilon))),o);o.assign(f)}})),t.iteration.assign(Tk(t.iteration,1)),t.accBeta1.assign(Ek(t.accBeta1,t.beta1))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&mk(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&mk(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))}},{key:"getWeights",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"setWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}]),a}(Wk);ex.className="Adamax",Kb(ex);var tx=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e){var t;return _classCallCheck(this,a),(t=r.call(this)).learningRate=e,t.setLearningRate(e),t}return _createClass(a,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=Ug.registeredVariables[n];fk((function(){var e=Tk(Ek(t.c,a),i);i.assign(e)}))}})),this.incrementIterations()}},{key:"setLearningRate",value:function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=vk(Uk(-e))}},{key:"dispose",value:function(){this.c.dispose()}},{key:"getWeights",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:if(e.t0=(t=e.sent).length,0===e.t0){e.next=5;break}throw new Error("SGD optimizer does not have settable weights.");case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return{learningRate:this.learningRate}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate)}}]),a}(Wk);tx.className="SGD",Kb(tx);var nx=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return _classCallCheck(this,a),(n=r.call(this,e)).learningRate=e,n.momentum=t,n.useNesterov=i,n.accumulations=[],n.m=Uk(n.momentum),n}return _createClass(a,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Ug.registeredVariables[n];if(null==t.accumulations[r]){t.accumulations[r]={originalName:n+"/momentum",variable:fk((function(){return Dk(a).variable(!1)}))}}var i=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&fk((function(){var e,n=Tk(Ek(t.m,i),o);e=Tk(Ek(t.c,t.useNesterov?Tk(o,Ek(n,t.m)):n),a),i.assign(n),a.assign(e)}))})),this.incrementIterations()}},{key:"dispose",value:function(){this.m.dispose(),null!=this.accumulations&&mk(this.accumulations.map((function(e){return e.variable})))}},{key:"setMomentum",value:function(e){this.momentum=e}},{key:"getWeights",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,this.accumulations=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}]),a}(tx);nx.className="Momentum",Kb(nx);var rx=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(_classCallCheck(this,a),(t=r.call(this)).learningRate=e,t.decay=n,t.momentum=i,t.epsilon=o,t.accumulatedMeanSquares=[],t.accumulatedMoments=[],t.accumulatedMeanGrads=[],t.centered=s,null==o&&(t.epsilon=Ug.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return _possibleConstructorReturn(t)}return _createClass(a,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Ug.registeredVariables[n];null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:fk((function(){return Dk(a).variable(!1)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:n+"/momentum",variable:fk((function(){return Dk(a).variable(!1)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:fk((function(){return Dk(a).variable(!1)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedMeanSquares[r].variable,s=t.accumulatedMoments[r].variable;fk((function(){var e=Tk(Ek(o,t.decay),Ek(Fk(i),1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,u=Tk(Ek(n,t.decay),Ek(i,1-t.decay)),c=Ak(Ek(i,t.learningRate),Rk(Kk(e,Tk(Fk(u),t.epsilon)))),l=Tk(Ek(s,t.momentum),c);o.assign(e),n.assign(u),s.assign(l);var h=Kk(a,l);a.assign(h)}else{var p=Tk(Ek(o,t.decay),Ek(Fk(i),1-t.decay)),d=Tk(Ek(s,t.momentum),Ak(Ek(i,t.learningRate),Rk(Tk(p,t.epsilon))));o.assign(p),s.assign(d);var f=Kk(a,d);a.assign(f)}}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedMeanSquares&&mk(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&mk(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&mk(this.accumulatedMoments.map((function(e){return e.variable})))}},{key:"getWeights",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(_toConsumableArray(this.accumulatedMeanSquares),_toConsumableArray(this.accumulatedMoments)),this.centered&&t.push.apply(t,_toConsumableArray(this.accumulatedMeanGrads)),e.next=4,this.saveIterations();case 4:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedMoments=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}]),a}(Wk);rx.className="RMSProp",Kb(rx);var ax=Qg({acos_:function(e){var t=Xg(e,"x","acos");return Ug.runKernel(af,{x:t})}}),ix=Qg({acosh_:function(e){var t=Xg(e,"x","acosh");return Ug.runKernel(of,{x:t})}}),ox=Qg({addN_:function(e){pd(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),pd(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length}));var t=e.map((function(e,t){return Xg(e,"tensors"+t,"addN")})),n=t[0];return t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!yd(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")})),Ug.runKernel(uf,t)}}),sx=Qg({all_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Xg(e,"x","all","bool");return Ug.runKernel(cf,{x:r},{axis:t,keepDims:n})}}),ux=Qg({any_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Xg(e,"x","any","bool");return Ug.runKernel(lf,{x:r},{axis:t,keepDims:n})}}),cx=Qg({argMax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Xg(e,"x","argMax");return Ug.runKernel(hf,{x:n},{axis:t})}}),lx=Qg({argMin_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Xg(e,"x","argMin");return Ug.runKernel(pf,{x:n},{axis:t})}}),hx=Qg({asin_:function(e){var t=Xg(e,"x","asin");return Ug.runKernel(df,{x:t})}}),px=Qg({asinh_:function(e){var t=Xg(e,"x","asinh");return Ug.runKernel(ff,{x:t})}}),dx=Qg({atan_:function(e){var t=Xg(e,"x","atan");return Ug.runKernel(mf,{x:t})}}),fx=Qg({atan2_:function(e,t){var n,r=Xg(e,"a","atan2"),a=Xg(t,"b","atan2");return r=(n=_slicedToArray(Og(r,a),2))[0],a=n[1],Ug.runKernel(gf,{a:r,b:a})}}),mx=Qg({atanh_:function(e){var t=Xg(e,"x","atanh");return Ug.runKernel(vf,{x:t})}});function vx(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5?arguments[5]:void 0;return bx(e,[].concat(_toConsumableArray(t),[e[3]]),n,i,r,null,null,Nx(a))}function gx(e,t,n,r,a,i){var o,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",u=wx(t),c=_slicedToArray(u,2),l=c[0],h=c[1];if("channelsLast"===s)o=[l,h,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);o=[l,h,e[1],e[1]]}return bx(e,o,n,r,a,i,!1,s)}function yx(e,t,n,r,a,i){var o,s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC",c=Cx(t),l=_slicedToArray(c,3),h=l[0],p=l[1],d=l[2];if("NDHWC"===u)s="channelsLast",o=[h,p,d,e[4],e[4]];else{if("NCDHW"!==u)throw new Error("Unknown dataFormat "+u);s="channelsFirst",o=[h,p,d,e[1],e[1]]}return kx(e,o,n,r,a,!1,s,i)}function bx(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",u=-1,c=-1,l=-1,h=-1;if("channelsLast"===s){var p=_slicedToArray(e,4);u=p[0],c=p[1],l=p[2],h=p[3]}else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);var d=_slicedToArray(e,4);u=d[0],h=d[1],c=d[2],l=d[3]}var f,m=_slicedToArray(t,4),v=m[0],g=m[1],y=m[3],b=wx(n),k=_slicedToArray(b,2),x=k[0],w=k[1],C=wx(r),_=_slicedToArray(C,2),S=_[0],I=_[1],T=_x(v,S),N=_x(g,I),A=function(e,t,n,r,a,i,o,s,u){var c,l,h;if("number"==typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var p=function(e,t,n,r,a){null==r&&(r=xx(e,t,n));var i=e[1];return[Sx((e[0]-t+2*r)/n+1,a),Sx((i-t+2*r)/n+1,a)]}([t,n],i,r,e,s);l=p[0],h=p[1]}else if("same"===e){l=Math.ceil(t/r),h=Math.ceil(n/a);var d=Math.max(0,(l-1)*r+i-t),f=Math.max(0,(h-1)*a+o-n),m=Math.floor(d/2),v=d-m,g=Math.floor(f/2);c={top:m,bottom:v,left:g,right:f-g,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-i+1)/r),h=Math.ceil((n-o+1)/a);else{if("object"!=typeof e)throw Error("Unknown padding parameter: "+e);var y="channelsLast"===u?e[1][0]:e[2][0],b="channelsLast"===u?e[1][1]:e[2][1],k="channelsLast"===u?e[2][0]:e[3][0],x="channelsLast"===u?e[2][1]:e[3][1];c={top:y,bottom:b,left:k,right:x,type:0===y&&0===b&&0===k&&0===x?"VALID":"EXPLICIT"},l=Sx((t-i+y+b)/r+1,s),h=Sx((n-o+k+x)/a+1,s)}return{padInfo:c,outHeight:l,outWidth:h}}(a,c,l,x,w,T,N,i,s),E=A.padInfo,R=A.outHeight,F=A.outWidth,D=o?y*h:y;return"channelsFirst"===s?f=[u,D,R,F]:"channelsLast"===s&&(f=[u,R,F,D]),{batchSize:u,dataFormat:s,inHeight:c,inWidth:l,inChannels:h,outHeight:R,outWidth:F,outChannels:D,padInfo:E,strideHeight:x,strideWidth:w,filterHeight:v,filterWidth:g,effectiveFilterHeight:T,effectiveFilterWidth:N,dilationHeight:S,dilationWidth:I,inShape:e,outShape:f,filterShape:t}}function kx(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",s=arguments.length>7?arguments[7]:void 0,u=-1,c=-1,l=-1,h=-1,p=-1;if("channelsLast"===o){var d=_slicedToArray(e,5);u=d[0],c=d[1],l=d[2],h=d[3],p=d[4]}else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);var f=_slicedToArray(e,5);u=f[0],p=f[1],c=f[2],l=f[3],h=f[4]}var m,v=_slicedToArray(t,5),g=v[0],y=v[1],b=v[2],k=v[4],x=Cx(n),w=_slicedToArray(x,3),C=w[0],_=w[1],S=w[2],I=Cx(r),T=_slicedToArray(I,3),N=T[0],A=T[1],E=T[2],R=_x(g,N),F=_x(y,A),D=_x(b,E),O=function(e,t,n,r,a,i,o,s,u,c,l){var h,p,d,f;if("number"==typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=function(e,t,n,r,a,i){null==a&&(a=xx(e,t,r));var o=e[1],s=e[2];return[Sx((e[0]-t+2*a)/r+1,i),Sx((o-t+2*a)/r+1,i),Sx((s-t+2*a)/r+1,i),1]}([t,n,r,1],s,0,a,e,l);p=m[0],d=m[1],f=m[2]}else if("same"===e){var v=((p=Math.ceil(t/a))-1)*a+s-t,g=((d=Math.ceil(n/i))-1)*i+u-n,y=((f=Math.ceil(r/o))-1)*o+c-r,b=Math.floor(v/2),k=v-b,x=Math.floor(g/2),w=g-x,C=Math.floor(y/2);h={top:x,bottom:w,left:C,right:y-C,front:b,back:k,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},p=Math.ceil((t-s+1)/a),d=Math.ceil((n-u+1)/i),f=Math.ceil((r-c+1)/o)}return{padInfo:h,outDepth:p,outHeight:d,outWidth:f}}(a,c,l,h,C,_,S,R,F,D,s),M=O.padInfo,P=O.outDepth,L=O.outHeight,z=O.outWidth,B=i?k*p:k;return"channelsFirst"===o?m=[u,B,P,L,z]:"channelsLast"===o&&(m=[u,P,L,z,B]),{batchSize:u,dataFormat:o,inDepth:c,inHeight:l,inWidth:h,inChannels:p,outDepth:P,outHeight:L,outWidth:z,outChannels:B,padInfo:M,strideDepth:C,strideHeight:_,strideWidth:S,filterDepth:g,filterHeight:y,filterWidth:b,effectiveFilterDepth:R,effectiveFilterHeight:F,effectiveFilterWidth:D,dilationDepth:N,dilationHeight:A,dilationWidth:E,inShape:e,outShape:m,filterShape:t}}function xx(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=_x(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function wx(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function Cx(e){return"number"==typeof e?[e,e,e]:e}function _x(e,t){return t<=1?e:e+(e-1)*(t-1)}function Sx(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function Ix(e){var t=_slicedToArray(wx(e),3),n=t[0],r=t[1],a=t[2];return 1===n&&1===r&&1===a}function Tx(e,t){return Ix(e)||Ix(t)}function Nx(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat "+e)}var Ax=Qg({reshape_:function(e,t){var n=Xg(e,"x","reshape",null);return Ug.runKernel(lv,{x:n},{shape:t})}}),Ex=Qg({avgPool_:function(e,t,n,r,a){var i=Xg(e,"x","avgPool","float32");pd(Tx(n,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '1'")}));var o=i,s=!1;3===i.rank&&(s=!0,o=Ax(i,[1,i.shape[0],i.shape[1],i.shape[2]])),pd(4===o.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(o.rank,".")})),null!=a&&pd(bd(r),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var u=Ug.runKernel(yf,{x:o},{filterSize:t,strides:n,pad:r,dimRoundingMode:a});return u=Xy(u,i.dtype),s?Ax(u,[u.shape[1],u.shape[2],u.shape[3]]):u}}),Rx=Qg({avgPool3d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=arguments.length>6?arguments[6]:void 0;null==o?o=[1,1,1]:ck("dilations is deprecated, this field will be gone in v3.0.0.");var s=Xg(e,"x","avgPool3d","float32"),u=s,c=!1;4===s.rank&&(c=!0,u=Ax(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),pd(5===u.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(u.rank,".")})),pd("NDHWC"===i,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i})),pd(Tx(n,o),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(o,"'")})),null!=a&&pd(bd(r),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var l=Ug.runKernel(kf,{x:u},{filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i,dilations:o});return l=Xy(l,u.dtype),c?Ax(l,[l.shape[1],l.shape[2],l.shape[3],l.shape[4]]):l}}),Fx=Qg({concat_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;pd(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=Yg(e,"tensors","concat");return"complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),1===n.length?Yy(n[0]):Ug.runKernel(Rf,n,{axis:t})}}),Dx=Qg({sigmoid_:function(e){var t=Xg(e,"x","sigmoid");return Ug.runKernel(Iv,{x:t})}}),Ox=Qg({slice_:function(e,t,n){var r=Xg(e,"x","slice",null);if(0===r.rank)throw new Error("Slicing scalar is not possible");return Ug.runKernel(wv,{x:r},{begin:t,size:n})}}),Mx=Qg({tanh_:function(e){var t=Xg(e,"x","tanh");return Ug.runKernel(Bv,{x:t})}}),Px=Qg({basicLSTMCell_:function(e,t,n,r,a,i){var o=Xg(e,"forgetBias","basicLSTMCell"),s=Xg(t,"lstmKernel","basicLSTMCell"),u=Xg(n,"lstmBias","basicLSTMCell"),c=Xg(r,"data","basicLSTMCell"),l=Xg(a,"c","basicLSTMCell"),h=Xg(i,"h","basicLSTMCell"),p=Fx([c,h],1),d=gb(p,s),f=Tk(d,u),m=f.shape[1]/4,v=[f.shape[0],m],g=Ox(f,[0,0],v),y=Ox(f,[0,m],v),b=Ox(f,[0,2*m],v),k=Ox(f,[0,3*m],v),x=Tk(Ek(Dx(g),Mx(y)),Ek(l,Dx(Tk(o,b))));return[x,Ek(Mx(x),Dx(k))]}}),Lx=Qg({batchToSpaceND_:function(e,t,n){var r=Xg(e,"x","batchToSpaceND"),a=t.reduce((function(e,t){return e*t}));return pd(r.rank>=1+t.length,(function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length)})),pd(n.length===t.length,(function(){return"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)})),pd(r.shape[0]%a==0,(function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of the elements of blockShape ").concat(t.join(" * ")," === ").concat(a)})),Ug.runKernel(Cf,{x:r},{blockShape:t,crops:n})}}),zx=Qg({batchNorm_:function(e,t,n,r,a,i){null==i&&(i=.001);var o,s,u=Xg(e,"x","batchNorm"),c=Xg(t,"mean","batchNorm"),l=Xg(n,"variance","batchNorm");null!=a&&(o=Xg(a,"scale","batchNorm")),null!=r&&(s=Xg(r,"offset","batchNorm")),pd(c.rank===l.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),pd(null==s||c.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),pd(null==o||c.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var h=function(e){return 0===e.rank||1===e.rank?Ax(e,[1,1,1,e.size]):2===e.rank?Ax(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?Ax(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}(u),p=Ug.runKernel(lm,{x:h,scale:o,offset:s,mean:c,variance:l},{varianceEpsilon:i});return Ax(p,u.shape)}}),Bx=Qg({batchNorm2d_:function(e,t,n,r,a,i){var o,s,u=Xg(e,"x","batchNorm"),c=Xg(t,"mean","batchNorm"),l=Xg(n,"variance","batchNorm");return null!=a&&(o=Xg(a,"scale","batchNorm")),null!=r&&(s=Xg(r,"offset","batchNorm")),pd(2===u.rank,(function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+u.rank+"."})),pd(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ".concat(c.rank,".")})),pd(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ".concat(l.rank,".")})),null!=o&&pd(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ".concat(o.rank,".")})),null!=s&&pd(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ".concat(s.rank,".")})),zx(u,c,l,s,o,i)}}),Vx=Qg({batchNorm3d_:function(e,t,n,r,a,i){var o,s,u=Xg(e,"x","batchNorm"),c=Xg(t,"mean","batchNorm"),l=Xg(n,"variance","batchNorm");return null!=a&&(o=Xg(a,"scale","batchNorm")),null!=r&&(s=Xg(r,"offset","batchNorm")),pd(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),pd(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ".concat(c.rank,".")})),pd(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ".concat(l.rank,".")})),null!=o&&pd(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ".concat(o.rank,".")})),null!=s&&pd(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ".concat(s.rank,".")})),zx(u,c,l,s,o,i)}}),Ux=Qg({batchNorm4d_:function(e,t,n,r,a,i){var o,s,u=Xg(e,"x","batchNorm"),c=Xg(t,"mean","batchNorm"),l=Xg(n,"variance","batchNorm");return null!=a&&(o=Xg(a,"scale","batchNorm")),null!=r&&(s=Xg(r,"offset","batchNorm")),pd(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."})),pd(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ".concat(c.rank,".")})),pd(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ".concat(l.rank,".")})),null!=o&&pd(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ".concat(o.rank,".")})),null!=s&&pd(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ".concat(s.rank,".")})),zx(u,c,l,s,o,i)}}),Wx=Qg({bincount_:function(e,t,n){var r=Xg(e,"x","bincount"),a=Xg(t,"weights","bincount");return pd("int32"===r.dtype,(function(){return"Error in bincount: input dtype must be int32, but got "+r.dtype})),pd(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),pd(a.size===r.size||0===a.size,(function(){return"Error in bincount: weights must have the same size as input or0-length, but got input shape: ".concat(r.shape,", weights shape: ")+a.shape+"."})),Ug.runKernel(_f,{x:r,weights:a},{size:n})}}),Gx=Qg({broadcastTo_:function(e,t){var n=Xg(e,"broadcastTo","x"),r=n.shape;if(t.some((function(e){return!(e>0)||e%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape [".concat(t,"]."));if(t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=Ax(n,a)}for(var i=n.shape,o=Array.from(t),s=t.length-1;s>=0;s--)if(i[s]===t[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));return 0===o.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0})).length?Yy(n):Ug.runKernel(Vv,{x:n},{reps:o})}}),Hx=Qg({ceil_:function(e){var t=Xg(e,"x","ceil");return Ug.runKernel(Tf,{x:t})}}),jx=Qg({clipByValue_:function(e,t,n){var r=Xg(e,"x","clipByValue");return pd(t<=n,(function(){return"Error in clip: min (".concat(t,") must be less than or equal to max (").concat(n,").")})),Ug.runKernel(Nf,{x:r},{clipValueMin:t,clipValueMax:n})}}),qx=Qg({concat1d_:function(e){return Fx(e,0)}}),Kx=Qg({concat2d_:function(e,t){return Fx(e,t)}}),Xx=Qg({concat3d_:function(e,t){return Fx(e,t)}}),Yx=Qg({concat4d_:function(e,t){return Fx(e,t)}}),Zx=Qg({conv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=Xg(e,"x","conv2d"),u=Xg(t,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=Ax(s,[1,s.shape[0],s.shape[1],s.shape[2]])),pd(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),pd(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."})),null!=o&&pd(bd(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(r,".")}));var h="NHWC"===a?c.shape[3]:c.shape[1];pd(h===u.shape[2],(function(){return"Error in conv2d: depth of input (".concat(h,") must match input depth for filter ").concat(u.shape[2],".")})),pd(Tx(n,i),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(i,"'")}));var p=Ug.runKernel(Ff,{x:c,filter:u},{strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o});return l?Ax(p,[p.shape[1],p.shape[2],p.shape[3]]):p}}),Qx=Qg({conv1d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6?arguments[6]:void 0,s=Xg(e,"x","conv1d"),u=Xg(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=Ax(s,[1,s.shape[0],s.shape[1]])),pd(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")})),pd(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."})),null!=o&&pd(bd(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(r,".")})),pd(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match input depth for filter ").concat(u.shape[1],".")})),pd(Tx(n,i),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride ".concat(n," and dilation '").concat(i,"'")})),pd("NWC"===a,(function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")}));var h=Ax(u,[1,u.shape[0],u.shape[1],u.shape[2]]),p=Ax(c,[c.shape[0],1,c.shape[1],c.shape[2]]),d=Zx(p,h,[1,n],r,"NHWC",[1,i],o);return Ax(d,l?[d.shape[2],d.shape[3]]:[d.shape[0],d.shape[2],d.shape[3]])}}),Jx=Qg({conv2DBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0;pd(e.length===t.rank,(function(){return"Length of inShape (".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=Ax(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),pd(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."})),pd(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank})),pd(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank}));var l="NHWC"===i?s[3]:s[1],h="NHWC"===i?u.shape[3]:u.shape[1];pd(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must match input depth for filter ").concat(n.shape[2],".")})),pd(h===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output (".concat(h,") must match output depth for filter ").concat(n.shape[3],".")})),null!=o&&pd(bd(a),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(a,".")}));var p=Ug.runKernel(Of,{dy:u,filter:n},{strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s});return c?Ax(p,[p.shape[1],p.shape[2],p.shape[3]]):p}}),$x=Qg({conv2dTranspose_:function(e,t,n,r,a,i){var o=Xg(e,"x","conv2dTranspose"),s=Xg(t,"filter","conv2dTranspose");return Jx(n,o,s,r,a,"NHWC",i)}}),ew=Qg({conv3d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=Xg(e,"x","conv3d"),s=Xg(t,"filter","conv3d"),u=o,c=!1;4===o.rank&&(c=!0,u=Ax(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),pd(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")})),pd(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."})),pd(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match input depth for filter ").concat(s.shape[3],".")})),pd(Tx(n,i),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(i,"'")})),pd("NDHWC"===a,(function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}));var l=Ug.runKernel(Mf,{x:u,filter:s},{strides:n,pad:r,dataFormat:a,dilations:i});return c?Ax(l,[l.shape[1],l.shape[2],l.shape[3],l.shape[4]]):l}}),tw=Qg({conv3DBackpropInput_:function(e,t,n,r,a){pd(e.length===t.rank,(function(){return"Length of inShape (".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var i=e,o=t,s=!1;4===t.rank&&(s=!0,o=Ax(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],c=o.shape[4];pd(5===i.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."})),pd(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank})),pd(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank})),pd(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must match input depth for filter ").concat(n.shape[3],".")})),pd(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must match output depth for filter ").concat(n.shape[4],".")}));var l=Ug.runKernel(Lf,{dy:o,filter:n},{pad:a,strides:r,inputShape:i});return s?Ax(l,[l.shape[1],l.shape[2],l.shape[3],l.shape[4]]):l}}),nw=Qg({conv3dTranspose_:function(e,t,n,r,a){var i=Xg(e,"x","conv3dTranspose"),o=Xg(t,"filter","conv3dTranspose");return tw(n,i,o,r,a)}}),rw=Qg({cos_:function(e){var t=Xg(e,"x","cos");return Ug.runKernel(zf,{x:t})}}),aw=Qg({cosh_:function(e){var t=Xg(e,"x","cosh");return Ug.runKernel(Bf,{x:t})}}),iw=Qg({cumsum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Xg(e,"x","cumsum");return Ug.runKernel(Vf,{x:a},{axis:t,exclusive:n,reverse:r})}}),ow=Qg({denseBincount_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Xg(e,"x","denseBincount"),i=Xg(t,"weights","denseBincount");return pd("int32"===a.dtype,(function(){return"Error in denseBincount: input dtype must be int32, but got "+a.dtype})),pd(a.rank<=2,(function(){return"Error in denseBincount: input must be at most rank 2, but got rank ".concat(a.rank,".")})),pd(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),pd(i.size===a.size||0===i.size,(function(){return"Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ".concat(a.shape,", weights shape: ")+i.shape+"."})),Ug.runKernel(Wf,{x:a,weights:i},{size:n,binaryOutput:r})}}),sw=Qg({depthToSpace_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC",r=Xg(e,"x","depthToSpace"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];return pd(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape)})),pd(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(i," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape)})),pd(o%(t*t)==0,(function(){return"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)})),Ug.runKernel(Gf,{x:r},{blockSize:t,dataFormat:n})}}),uw=Qg({depthwiseConv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=Xg(e,"x","depthwiseConv2d"),u=Xg(t,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=Ax(s,[1,s.shape[0],s.shape[1],s.shape[2]])),pd(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),pd(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."})),pd(c.shape[3]===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels (".concat(c.shape[3],") must match the inChannels dimension in filter ").concat(u.shape[2],".")})),null!=o&&pd(bd(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(r,".")}));var h=Ug.runKernel(Hf,{x:c,filter:u},{strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o});return l?Ax(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),cw=Qg({diag_:function(e){var t=Xg(e,"x","diag");return Ug.runKernel(Kf,{x:t})}}),lw=Qg({dilation2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=Xg(e,"x","dilation2d"),s=Xg(t,"filter","dilation2d");pd(3===o.rank||4===o.rank,(function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+o.rank+"."})),pd(3===s.rank,(function(){return"Error in dilation2d: filter must be rank 3, but got rank "+s.rank+"."})),pd("NHWC"===i,(function(){return"Error in dilation2d: Only NHWC is currently supported, but got dataFormat of "+i}));var u=o,c=!1;3===o.rank&&(u=Ax(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0);var l=Ug.runKernel(Xf,{x:u,filter:s},{strides:n,pad:r,dilations:a});return c?Ax(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),hw=Qg({equal_:function(e,t){var n,r=Xg(e,"a","equal"),a=Xg(t,"b","equal");return r=(n=_slicedToArray(Og(r,a),2))[0],a=n[1],Jk(r.shape,a.shape),Ug.runKernel(tm,{a:r,b:a})}}),pw=Qg({where_:function(e,t,n){var r=Xg(t,"a","where"),a=Xg(n,"b","where"),i=Xg(e,"condition","where","bool"),o=Jk(r.shape,a.shape),s=Gx(r,o),u=Gx(a,o);return 1===i.rank&&pd(i.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})),1!==i.rank&&dd(i.shape,u.shape,"Error in where: "),Ug.runKernel(kv,{condition:i,t:s,e:u})}}),dw=Qg({divNoNan_:function(e,t){var n=Xg(e,"a","div"),r=Xg(t,"b","div"),a=_slicedToArray(Og(n,r),2);n=a[0],r=a[1];var i=Ak(n,r),o=Dk(i),s=hw(r,o);return pw(s,o,i)}}),fw=Qg({dot_:function(e,t){var n=Xg(e,"t1","dot"),r=Xg(t,"t2","dot");pd(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks ".concat(n.rank," and ").concat(r.rank,".")}));var a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];if(pd(a===i,(function(){return"Error in dot: inner dimensions of inputs must match, but got ".concat(a," and ").concat(i,".")})),1===n.rank&&1===r.rank){var o=Ax(n,[1,-1]),s=Ax(r,[-1,1]),u=gb(o,s);return Ax(u,[])}if(1===n.rank&&2===r.rank){var c=Ax(n,[1,-1]),l=Ax(r,[r.shape[0],r.shape[1]]),h=gb(c,l);return Ax(h,[h.size])}if(2===n.rank&&1===r.rank){var p=Ax(r,[-1,1]),d=gb(n,p);return Ax(d,[d.size])}var f=Ax(r,[r.shape[0],r.shape[1]]);return gb(n,f)}}),mw=Qg({elu_:function(e){var t=Xg(e,"x","elu");return Ug.runKernel(Jf,{x:t})}}),vw=Qg({erf_:function(e){var t=Xg(e,"x","erf");return pd("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=Xy(t,"float32")),Ug.runKernel(em,{x:t})}}),gw=Qg({exp_:function(e){var t=Xg(e,"x","exp");return Ug.runKernel(nm,{x:t})}}),yw=Qg({expandDims_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Xg(e,"x","expandDims",null);return pd(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"})),Ug.runKernel(rm,{input:n},{dim:t})}}),bw=Qg({expm1_:function(e){var t=Xg(e,"x","expm1");return Ug.runKernel(am,{x:t})}}),kw=Qg({tile_:function(e,t){var n=Xg(e,"x","tile",null);return pd(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," must match length of reps ").concat(t,".")})),Ug.runKernel(Vv,{x:n},{reps:t})}}),xw=Qg({eye_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";null==t&&(t=e);for(var a=Ky([e,t],r),i=e<=t?e:t,o=0;o<i;++o)a.set(1,o,o);var s=Ax(a.toTensor(),[e,t]);if(null==n)return s;if(1===n.length)return kw(yw(s,0),[n[0],1,1]);if(2===n.length)return kw(yw(yw(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return kw(yw(yw(yw(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received ".concat(n.length,"D."))}}),ww=Qg({floor_:function(e){var t=Xg(e,"x","floor");return Ug.runKernel(um,{x:t})}}),Cw=Qg({gather_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=Xg(e,"x","gather"),i=Xg(t,"indices","gather","int32");return Ug.runKernel(hm,{x:a,indices:i},{axis:n,batchDims:r})}}),_w=Qg({greater_:function(e,t){var n,r=Xg(e,"a","greater"),a=Xg(t,"b","greater");return r=(n=_slicedToArray(Og(r,a),2))[0],a=n[1],Jk(r.shape,a.shape),Ug.runKernel(dm,{a:r,b:a})}}),Sw=Qg({greaterEqual_:function(e,t){var n,r=Xg(e,"a","greaterEqual"),a=Xg(t,"b","greaterEqual");return r=(n=_slicedToArray(Og(r,a),2))[0],a=n[1],Jk(r.shape,a.shape),Ug.runKernel(fm,{a:r,b:a})}}),Iw=Qg({imag_:function(e){var t=Xg(e,"input","imag");return Ug.runKernel(gm,{input:t})}}),Tw=Qg({isFinite_:function(e){var t=Xg(e,"x","isFinite");return Ug.runKernel(ym,{x:t})}}),Nw=Qg({isInf_:function(e){var t=Xg(e,"x","isInf");return Ug.runKernel(bm,{x:t})}}),Aw=Qg({isNaN_:function(e){var t=Xg(e,"x","isNaN");return Ug.runKernel(km,{x:t})}}),Ew=Qg({leakyRelu_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n=Xg(e,"x","leakyRelu");return Ug.runKernel(xm,{x:n},{alpha:t})}}),Rw=Qg({less_:function(e,t){var n,r=Xg(e,"a","less"),a=Xg(t,"b","less");return r=(n=_slicedToArray(Og(r,a),2))[0],a=n[1],Jk(r.shape,a.shape),Ug.runKernel(wm,{a:r,b:a})}}),Fw=Qg({lessEqual_:function(e,t){var n,r=Xg(e,"a","lessEqual"),a=Xg(t,"b","lessEqual");return r=(n=_slicedToArray(Og(r,a),2))[0],a=n[1],Jk(r.shape,a.shape),Ug.runKernel(Cm,{a:r,b:a})}});function Dw(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return Ug.runKernel(_m,{},{start:e,stop:t,num:n})}var Ow=Qg({localResponseNormalization_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,i=Xg(e,"x","localResponseNormalization");pd(4===i.rank||3===i.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(i.rank,".")})),pd(bd(t),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ".concat(t,".")}));var o=i,s=!1;3===i.rank&&(s=!0,o=Ax(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u=Ug.runKernel(Rm,{x:o},{depthRadius:t,bias:n,alpha:r,beta:a});return s?Ax(u,[u.shape[1],u.shape[2],u.shape[3]]):u}}),Mw=Qg({log_:function(e){var t=Xg(e,"x","log");return Ug.runKernel(Sm,{x:t})}}),Pw=Qg({log1p_:function(e){var t=Xg(e,"x","log1p");return Ug.runKernel(Im,{x:t})}}),Lw=Qg({neg_:function(e){var t=Xg(e,"x","neg");return Ug.runKernel(Km,{x:t})}}),zw=Qg({softplus_:function(e){var t=Xg(e,"x","softplus");return Ug.runKernel(Tv,{x:t})}}),Bw=Qg({logSigmoid_:function(e){var t=Xg(e,"x","logSigmoid");return Bk((function(e){return{value:Lw(zw(Lw(e))),gradFunc:function(t){return Ek(t,Dx(Lw(e)))}}}))(t)}}),Vw=Qg({max_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Xg(e,"x","max");return Ug.runKernel(Dm,{x:r},{reductionIndices:t,keepDims:n})}}),Uw=Qg({sum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Xg(e,"x","sum");return"bool"===r.dtype&&(r=Xy(r,"int32")),Ug.runKernel(Av,{x:r},{axis:t,keepDims:n})}}),Ww=Qg({logSoftmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=Xg(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(n.rank," and axis was ").concat(t));return Bk((function(e,n){var r=Vw(e,t,!0),a=Kk(e,r),i=Kk(Xy(a,"float32"),Mw(Uw(gw(a),t,!0)));return n([i]),{value:i,gradFunc:function(e,n){var r=_slicedToArray(n,1)[0],a=gw(r);return Kk(e,Ek(Uw(e,t,!0),a))}}}))(n)}});function Gw(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function Hw(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}function jw(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);return[n,t.map((function(t){return e[t]}))]}function qw(e,t){return Hw(e,t.map((function(e){return 1})),t)}function Kw(e,t,n){pd(Gw(t,n),(function(){return e+" supports only inner-most axes for now. "+"Got axes ".concat(t," and rank-").concat(n," input.")}))}function Xw(e,t){if(Gw(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function Yw(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function Zw(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}var Qw=Qg({logSumExp_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Xg(e,"x","logSumExp"),a=Id(t,r.shape),i=Vw(r,a,!0),o=Kk(r,i),s=gw(o),u=Uw(s,a),c=Mw(u),l=Tk(Ax(i,c.shape),c);if(n){var h=qw(l.shape,a);return Ax(l,h)}return l}}),Jw=Qg({logicalAnd_:function(e,t){var n=Xg(e,"a","logicalAnd","bool"),r=Xg(t,"b","logicalAnd","bool");return Jk(n.shape,r.shape),Ug.runKernel(Tm,{a:n,b:r})}}),$w=Qg({logicalNot_:function(e){var t=Xg(e,"x","logicalNot","bool");return Ug.runKernel(Nm,{x:t})}}),eC=Qg({logicalOr_:function(e,t){var n=Xg(e,"a","logicalOr","bool"),r=Xg(t,"b","logicalOr","bool");return Jk(n.shape,r.shape),Ug.runKernel(Am,{a:n,b:r})}}),tC=Qg({logicalXor_:function(e,t){var n=Xg(e,"a","logicalXor","bool"),r=Xg(t,"b","logicalXor","bool");return Jk(n.shape,r.shape),Jw(eC(e,t),$w(Jw(e,t)))}}),nC=Qg({maxPool_:function(e,t,n,r,a){var i=Xg(e,"x","maxPool"),o=i,s=!1;3===i.rank&&(s=!0,o=Ax(i,[1,i.shape[0],i.shape[1],i.shape[2]])),pd(4===o.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(o.rank,".")})),pd(Tx(n,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '1'")})),null!=a&&pd(bd(r),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var u=Ug.runKernel(Mm,{x:o},{filterSize:t,strides:n,pad:r,dimRoundingMode:a});return s?Ax(u,[u.shape[1],u.shape[2],u.shape[3]]):u}}),rC=Qg({maxPool3d_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=arguments.length>6?arguments[6]:void 0;null==o?o=[1,1,1]:ck("dilations is deprecated, this field will be gone in v3.0.0.");var s=Xg(e,"x","maxPool3d"),u=s,c=!1;4===s.rank&&(c=!0,u=Ax(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),pd(5===u.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(u.rank,".")})),pd("NDHWC"===i,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i})),pd(Tx(n,o),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(o,"'")})),null!=a&&pd(bd(r),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var l=Ug.runKernel(Lm,{x:u},{filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i,dilations:o});return c?Ax(l,[l.shape[1],l.shape[2],l.shape[3],l.shape[4]]):l}}),aC=Qg({maxPoolWithArgmax_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=Xg(e,"x","maxPoolWithArgmax"),o=Ug.runKernel(Bm,{x:i},{filterSize:t,strides:n,pad:r,includeBatchInIndex:a});return{result:o[0],indexes:o[1]}}}),iC=Qg({mean_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Xg(e,"x","mean");return Ug.runKernel(Vm,{x:r},{axis:t,keepDims:n})}}),oC=Qg({min_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Xg(e,"x","min");return Ug.runKernel(Um,{x:r},{axis:t,keepDims:n})}}),sC=Qg({minimum_:function(e,t){var n,r=Xg(e,"a","minimum"),a=Xg(t,"b","minimum");return r=(n=_slicedToArray(Og(r,a),2))[0],a=n[1],"bool"===r.dtype&&(r=Xy(r,"int32"),a=Xy(a,"int32")),Jk(r.shape,a.shape),Ug.runKernel(Wm,{a:r,b:a})}}),uC=Qg({mirrorPad_:function(e,t,n){pd("reflect"===n||"symmetric"===n,(function(){return"Invalid mode. Mode must be either reflect or symmetric. Got ".concat(n,".")}));var r=Xg(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");pd(t.length===r.rank,(function(){return"Padding doesn't match input. Must be ".concat(r.rank,". Got ").concat(t.length,".")}));for(var a="reflect"===n?1:0,i=function(e){pd(2===t[e].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),pd(t[e][0]>=0&&t[e][0]<=r.shape[e]-a&&t[e][1]>=0&&t[e][1]<=r.shape[e]-a,(function(){return"Padding in dimension ".concat(e," cannot be greater than or equal to ").concat(r.shape[e]-a," or less than 0 for input of shape ")+r.shape}))},o=0;o<r.rank;o++)i(o);return Ug.runKernel(Gm,{x:r},{paddings:t,mode:n})}}),cC=Qg({mod_:function(e,t){var n,r=Xg(e,"a","mod"),a=Xg(t,"b","mod");return r=(n=_slicedToArray(Og(r,a),2))[0],a=n[1],Ug.runKernel(Hm,{a:r,b:a})}}),lC=Qg({moments_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Id(t,(e=Xg(e,"x","moments")).shape),a=iC(e,r,n),i=a.shape;n||(i=qw(a.shape,r));var o=Fk(Kk(Xy(e,"float32"),Ax(a,i)));return{mean:a,variance:iC(o,r,n)}}}),hC=Qg({multiRNNCell_:function(e,t,n,r){for(var a=Xg(t,"data","multiRNNCell"),i=Yg(n,"c","multiRNNCell"),o=Yg(r,"h","multiRNNCell"),s=a,u=[],c=0;c<e.length;c++){var l=e[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var h=[],p=[],d=0;d<u.length;d+=2)h.push(u[d]),p.push(u[d+1]);return[h,p]}}),pC=Qg({multinomial_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Xg(e,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);n=n||Math.random();var s=1===o?Ax(a,[1,-1]):a,u=Ug.runKernel(jm,{logits:s},{numSamples:t,seed:n,normalized:r});return 1===o?Ax(u,[u.size]):u}}),dC=Qg({notEqual_:function(e,t){var n,r=Xg(e,"a","notEqual"),a=Xg(t,"b","notEqual");return r=(n=_slicedToArray(Og(r,a),2))[0],a=n[1],Jk(r.shape,a.shape),Ug.runKernel(Xm,{a:r,b:a})}});function fC(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=fC(e,"float32"),r=fC(e,"float32");return Jg(n,r)}var a=jd(vd(e),t);return Ug.makeTensor(a,e,t)}function mC(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=mC(e,"float32"),r=fC(e,"float32");return Jg(n,r)}var a=Hd(vd(e),t);return Ug.makeTensor(a,e,t)}var vC=Qg({onesLike_:function(e){var t=Xg(e,"x","onesLike");return Ug.runKernel(Jm,{x:t})}}),gC=Qg({outerProduct_:function(e,t){var n=Xg(e,"v1","outerProduct"),r=Xg(t,"v2","outerProduct");pd(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks ".concat(n.rank," and ").concat(r.rank,".")}));var a=Ax(n,[-1,1]),i=Ax(r,[1,-1]);return gb(a,i)}}),yC=Qg({pad_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Xg(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");return Ug.runKernel(tv,{x:r},{paddings:t,constantValue:n})}}),bC=Qg({pad1d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return pd(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),yC(e,[t],n)}}),kC=Qg({pad2d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return pd(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),yC(e,t,n)}}),xC=Qg({pad3d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return pd(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),yC(e,t,n)}}),wC=Qg({pad4d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return pd(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),yC(e,t,n)}}),CC=Qg({spaceToBatchND_:function(e,t,n){var r=Xg(e,"x","spaceToBatchND");return pd(r.rank>=1+t.length,(function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length)})),pd(n.length===t.length,(function(){return"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)})),pd(r.shape.reduce((function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]==0:e}),!0),(function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())})),Ug.runKernel(Ev,{x:r},{blockShape:t,paddings:n})}}),_C=Qg({pool_:function(e,t,n,r,a,i){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");var o=Xg(e,"x","maxPool"),s=o,u=!1;3===o.rank&&(u=!0,s=Ax(o,[1,o.shape[0],o.shape[1],o.shape[2]])),pd(Tx(i,a),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides ".concat(i," and dilations '").concat(a,"'")}));var c,l=gx(s.shape,t,i,a,r),h=[l.dilationHeight,l.dilationWidth];c="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})).map((function(e){return e-1})),r=n.map((function(e){return Math.floor(e/2)})),a=n.map((function(e,t){return e-r[t]}));return n.map((function(e,t){return[r[t],a[t]]}))}([l.filterHeight,l.filterWidth],h):[[0,0],[0,0]];var p=1===h[0]&&1===h[1],d=_slicedToArray(function(e,t,n){var r=n.map((function(e){return e[0]})),a=n.map((function(e){return e[1]})),i=e.concat(r,a),o=t.map((function(e,t){return(e-i[t]%e)%e})),s=a.map((function(e,t){return e+o[t]}));return[t.map((function(e,t){return[r[t],s[t]]})),t.map((function(e,t){return[0,o[t]]}))]}([l.inHeight,l.inWidth],h,c),2),f=d[0],m=d[1],v=p?r:"valid",g=p?s:CC(s,h,f),y=("avg"===n?function(){return Ex(g,t,i,v)}:function(){return nC(g,t,i,v)})(),b=p?y:Lx(y,h,m);return u?Ax(b,[b.shape[1],b.shape[2],b.shape[3]]):b}}),SC=Qg({prelu_:function(e,t){var n=Xg(e,"x","prelu"),r=Xg(t,"alpha","prelu");return Ug.runKernel(av,{x:n,alpha:r})}}),IC=Qg({prod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Xg(e,"x","prod");return"bool"===r.dtype&&(r=Xy(r,"int32")),Ug.runKernel(iv,{x:r},{axis:t,keepDims:n})}}),TC=Qg({rand_:function(e,t,n){var r=vd(e),a=null;if(null==n||"float32"===n)a=new Float32Array(r);else if("int32"===n)a=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);a=new Uint8Array(r)}for(var i=0;i<r;i++)a[i]=t();return Ug.makeTensor(a,e,n)}}),NC=n("YSVl"),AC=function(){function e(t,n,r,a,i){_classCallCheck(this,e),this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=NC.alea(o.toString())}return _createClass(e,[{key:"nextValue",value:function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var a=void 0,i=void 0,o=void 0;do{o=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*a*s,n=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)}},{key:"convertValue",value:function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}},{key:"isValidTruncated",value:function(e){return e<=this.upper&&e>=this.lower}}]),e}(),EC=function(){function e(t,n,r,a){_classCallCheck(this,e),this.alpha=t,this.beta=1/n,this.dtype=r;var i=a||Math.random();this.randu=NC.alea(i.toString()),this.randn=new AC(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return _createClass(e,[{key:"nextValue",value:function(){for(var e,t,n,r,a,i;;){do{r=this.randn.nextValue(),i=1+this.c*r}while(i<=0);if(i*=i*i,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-i+Math.log(i)),(a=this.randu())<t||Math.log(a)<n)break}return i*=1/this.beta*this.d,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)}},{key:"convertValue",value:function(e){return"float32"===this.dtype?e:Math.round(e)}}]),e}(),RC=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(_classCallCheck(this,e),this.canReturnFloat=function(){return null==t.dtype||"float32"===t.dtype},this.min=n,this.range=r-n,this.dtype=a,null==i&&(i=Math.random()),"number"==typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(n," - ").concat(r," <= 1 and dtype is not float"));this.random=NC.alea(i)}return _createClass(e,[{key:"convertValue",value:function(e){return this.canReturnFloat()?e:Math.round(e)}},{key:"nextValue",value:function(){return this.convertValue(this.min+this.range*this.random())}}]),e}(),FC=Qg({randomGamma_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0;if(null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var i=new EC(t,n,r,a),o=Ky(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),DC=Qg({randomNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new AC(t,n,r,!1,a),o=Ky(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),OC=Qg({randomUniform_:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0,i=Ky(e,r),o=new RC(t,n,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}});function MC(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");return Ug.runKernel(ov,{},{start:e,stop:t,step:n,dtype:r})}var PC=Qg({real_:function(e){var t=Xg(e,"input","real");return Ug.runKernel(sv,{input:t})}}),LC=Qg({reciprocal_:function(e){var t=Xg(e,"x","reciprocal");return Ug.runKernel(uv,{x:t})}}),zC=Qg({relu_:function(e){var t=Xg(e,"x","relu");return Ug.runKernel(cv,{x:t})}}),BC=Qg({relu6_:function(e){var t=Xg(e,"x","relu6");return Ug.runKernel(mv,{x:t})}}),VC=Qg({reverse_:function(e,t){var n=Xg(e,"x","reverse");return Ug.runKernel(vv,{x:n},{dims:t})}}),UC=Qg({reverse1d_:function(e){var t=Xg(e,"x","reverse");return pd(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(t.rank,".")})),VC(t,0)}}),WC=Qg({reverse2d_:function(e,t){var n=Xg(e,"x","reverse");return pd(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(n.rank,".")})),VC(n,t)}}),GC=Qg({reverse3d_:function(e,t){var n=Xg(e,"x","reverse");return pd(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(n.rank,".")})),VC(n,t)}}),HC=Qg({reverse4d_:function(e,t){var n=Xg(e,"x","reverse");return pd(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(n.rank,".")})),VC(n,t)}}),jC=Qg({round_:function(e){var t=Xg(e,"x","round");return Ug.runKernel(gv,{x:t})}}),qC=Qg({rsqrt_:function(e){var t=Xg(e,"x","rsqrt");return Ug.runKernel(yv,{x:t})}}),KC=Qg({selu_:function(e){var t=Xg(e,"x","selu");return Ug.runKernel(xv,{x:t})}}),XC=Qg({separableConv2d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC",s=Xg(e,"x","separableConv2d"),u=Xg(t,"depthwiseFilter","separableConv2d"),c=Xg(n,"pointwiseFilter","separableConv2d"),l=s,h=!1;if(3===s.rank&&(h=!0,l=Ax(s,[1,s.shape[0],s.shape[1],s.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");pd(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank ".concat(l.rank,".")})),pd(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank ".concat(u.rank,".")})),pd(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank ".concat(u.rank,".")})),pd(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ".concat(c.shape[0],".")})),pd(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ".concat(c.shape[1],".")}));var p=u.shape[2],d=u.shape[3];pd(c.shape[2]===p*d,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be ".concat(p*d,", but got ").concat(c.shape[2],".")}));var f=uw(l,u,r,a,o,i),m=Zx(f,c,1,"valid",o);return h?Ax(m,[m.shape[1],m.shape[2],m.shape[3]]):m}}),YC=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,u,c,l,h,p,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Xg(t,"x","setdiff1d"),a=Xg(n,"y","setdiff1d"),pd(r.dtype===a.dtype,(function(){return"x and y should have the same dtype, but got x (".concat(r.dtype,") and y (").concat(a.dtype,").")})),pd(1===r.rank,(function(){return"x should be 1D tensor, but got x (".concat(r.shape,").")})),pd(1===a.rank,(function(){return"y should be 1D tensor, but got y (".concat(a.shape,").")})),e.next=4,r.data();case 4:return i=e.sent,e.next=7,a.data();case 7:for(o=e.sent,s=new Set(o),u=0,c=0;c<i.length;c++)s.has(i[c])||u++;for(l=new xg([u],r.dtype),h=new xg([u],"int32"),p=0,d=0;p<i.length;p++)s.has(i[p])||(l.values[d]=i[p],h.values[d]=p,d++);return e.abrupt("return",[l.toTensor(),h.toTensor()]);case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ZC=Qg({sign_:function(e){var t=Xg(e,"x","sign");return Ug.runKernel(Sv,{x:t})}}),QC=Qg({sin_:function(e){var t=Xg(e,"x","sin");return Ug.runKernel(Cv,{x:t})}}),JC=Qg({sinh_:function(e){var t=Xg(e,"x","sinh");return Ug.runKernel(_v,{x:t})}}),$C=Qg({slice1d_:function(e,t,n){var r=Xg(e,"x","slice1d");return pd(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")})),Ox(r,[t],[n])}}),e_=Qg({slice2d_:function(e,t,n){var r=Xg(e,"x","slice2d");return pd(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")})),Ox(r,t,n)}}),t_=Qg({slice3d_:function(e,t,n){var r=Xg(e,"x","slice3d");return pd(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")})),Ox(r,t,n)}}),n_=Qg({slice4d_:function(e,t,n){var r=Xg(e,"x","slice4d");return pd(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")})),Ox(r,t,n)}}),r_=Qg({softmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=Xg(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(n.rank," and dim was ").concat(t));return Ug.runKernel(Fv,{logits:n},{dim:t})}}),a_=Qg({fft_:function(e){return pd("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got ".concat(e.dtype,".")})),Ug.runKernel(im,{input:e})}}),i_=Qg({ifft_:function(e){return pd("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got ".concat(e.dtype,".")})),Ug.runKernel(vm,{input:e})}}),o_=Qg({irfft_:function(e){var t,n=e.shape[e.shape.length-1],r=e.size/n;if(n<=2){var a=Ax(e,[r,n]);t=i_(a)}else{var i=[r,2*(n-1)],o=Ax(PC(e),[r,n]),s=Ax(Iw(e),[r,n]),u=VC(Ox(o,[0,1],[r,n-2]),1),c=Ek(VC(Ox(s,[0,1],[r,n-2]),1),Uk(-1)),l=Fx([o,u],1),h=Fx([s,c],1),p=Ax(Jg(l,h),[i[0],i[1]]);t=i_(p)}if(t=PC(t),3===e.rank&&0!==e.shape[0]){var d=t,f=e.shape[0];t=Ax(t,[f,t.shape[0]/f,t.shape[1]]),d.dispose()}return t}}),s_=Qg({split_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Xg(e,"x","split");return Ug.runKernel(Rv,{x:r},{numOrSizeSplits:t,axis:n})}}),u_=Qg({rfft_:function(e,t){pd("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got "+e.dtype}));var n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){var i=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=Ox(e,i,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=Fx([e,fC(s)],e.shape.length-1),r=t}else n=e;var u=Dk(n),c=Ax(Jg(n,u),[a,r]),l=a_(c),h=Math.floor(r/2)+1,p=PC(l),d=Iw(l),f=s_(p,[h,r-h],p.shape.length-1),m=s_(d,[h,r-h],d.shape.length-1),v=n.shape.slice();return v[n.shape.length-1]=h,Ax(Jg(f[0],m[0]),v)}}),c_=Qg({squaredDifference_:function(e,t){var n,r=Xg(e,"a","squaredDifference"),a=Xg(t,"b","squaredDifference");return r=(n=_slicedToArray(Og(r,a),2))[0],a=n[1],Jk(r.shape,a.shape),Ug.runKernel(Dv,{a:r,b:a},{})}}),l_=Qg({squeeze_:function(e,t){var n=Xg(e,"x","squeeze");return Ax(n,Td(n.shape,t).newShape)}}),h_=Qg({stack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Yg(e,"tensors","stack");return pd(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),n.length>0&&pd(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"})),Ug.runKernel(ev,n,{axis:t})}}),p_=Qg({step_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Xg(e,"x","step");return Ug.runKernel(Kv,{x:n},{alpha:t})}}),d_=Qg({stridedSlice_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c=Xg(e,"x","stridedSlice");return Ug.runKernel(Lv,{x:c},{begin:t,end:n,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u})}}),f_=Qg({tan_:function(e){var t=Xg(e,"x","tan");return Ug.runKernel(zv,{x:t})}});function m_(e,t){fd(e);var n=qg(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return $g(e,null,n,t)}function v_(e,t,n){if(fd(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=qg(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return $g(e,t,r,n)}function g_(e,t,n){if(fd(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=qg(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return $g(e,t,r,n)}function y_(e,t,n){if(fd(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=qg(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return $g(e,t,r,n)}function b_(e,t,n){if(fd(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=qg(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return $g(e,t=t||r,r,n)}var k_=Qg({topk_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=Xg(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") but got ")+t);var i={x:r},o={k:t,sorted:n},s=Ug.runKernel(Uv,i,o),u=_slicedToArray(s,2),c=u[0],l=u[1];return{values:c,indices:l}}}),x_=Qg({truncatedNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var i=new AC(t,n,r,!0,a),o=Ky(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),w_=Qg({unique_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Xg(e,"x","unique",null);pd(n.rank>0,(function(){return"The input tensor must be at least 1D"}));var r={x:n},a={axis:t},i=Ug.runKernel(Gv,r,a),o=_slicedToArray(i,2),s=o[0],u=o[1];return{values:s,indices:u}}}),C_=Qg({unsortedSegmentSum_:function(e,t,n){var r=Xg(e,"x","unsortedSegmentSum"),a=Xg(t,"segmentIds","unsortedSegmentSum","int32");return pd(bd(n),(function(){return"numSegments must be of dtype int"})),Ug.runKernel(jv,{x:r,segmentIds:a},{numSegments:n})}}),__=Qg({unstack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Xg(e,"x","unstack");return pd(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")})),Ug.runKernel(Hv,{value:n},{axis:t})}});function S_(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return Ug.makeVariable(e,t,n,r)}function I_(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);for(var a=Ky(e,"int32"),i=Ky([n.length,e.length],"int32"),o=0;o<n.length;o++){var s=a.indexToLoc(n[o]);i.values.set(s,o*e.length)}return i.toTensor()}var T_=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Xg(t,"condition","whereAsync","bool"),e.next=3,n.data();case 3:return r=e.sent,a=I_(n.shape,r),e.abrupt("return",(t!==n&&n.dispose(),a));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N_=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a,i,o,s,u,c,l,h,p,d,f,m,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=Xg(t,"tensor","boolMask"),i=Xg(n,"mask","boolMask","bool"),o=null==r?0:r,s=i.rank,u=a.shape,pd(s>0,(function(){return"mask cannot be scalar"})),dd(u.slice(o,o+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,l=o;l<o+s;l++)c*=u[l];return h=u.slice(0,o).concat([c],u.slice(o+s)),p=Ax(a,h),d=Ax(i,[-1]),e.next=9,T_(d);case 9:return f=e.sent,m=l_(f,[1]),v=Cw(p,m,o),e.abrupt("return",(t!==a&&a.dispose(),n!==i&&i.dispose(),m.dispose(),p.dispose(),d.dispose(),f.dispose(),v));case 13:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),A_=Qg({equalStrict_:function(e,t){ck("strict variants of ops have been deprecated and will be removed in future");var n=Xg(e,"a","equalStrict"),r=Xg(t,"b","equalStrict");return dd(n.shape,r.shape,"Error in equalStrict: "),hw(n,r)}}),E_=Qg({greaterEqualStrict_:function(e,t){ck("strict variants of ops have been deprecated and will be removed in future");var n=Xg(e,"a","greaterEqualStrict"),r=Xg(t,"b","greaterEqualStrict");return dd(n.shape,r.shape,"Error in greaterEqualStrict: "),Sw(n,r)}}),R_=Qg({greaterStrict_:function(e,t){ck("strict variants of ops have been deprecated and will be removed in future");var n=Xg(e,"a","greaterStrict"),r=Xg(t,"b","greaterStrict");return dd(n.shape,r.shape,"Error in greaterStrict: "),_w(n,r)}}),F_=Qg({lessEqualStrict_:function(e,t){ck("strict variants of ops have been deprecated and will be removed in future");var n=Xg(e,"a","lessEqualStrict"),r=Xg(t,"b","lessEqualStrict");return dd(n.shape,r.shape,"Error in lessEqualStrict: "),Fw(n,r)}}),D_=Qg({lessStrict_:function(e,t){ck("strict variants of ops have been deprecated and will be removed in future");var n=Xg(e,"a","lessStrict"),r=Xg(t,"b","lessStrict");return dd(n.shape,r.shape,"Error in lessStrict: "),Rw(n,r)}}),O_=Qg({notEqualStrict_:function(e,t){ck("strict variants of ops have been deprecated and will be removed in future");var n=Xg(e,"a","notEqualStrict"),r=Xg(t,"b","notEqualStrict");return dd(n.shape,r.shape,"Error in notEqualStrict: "),dC(n,r)}}),M_=Qg({addStrict_:function(e,t){ck("strict variants of ops have been deprecated and will be removed in future");var n=Xg(e,"a","addStrict"),r=Xg(t,"b","addStrict");return dd(n.shape,r.shape,"Error in addStrict: "),Tk(n,r)}}),P_=Qg({divStrict_:function(e,t){ck("strict variants of ops have been deprecated and will be removed in future");var n=Xg(e,"a","div"),r=Xg(t,"b","div");return dd(n.shape,r.shape,"Error in divideStrict: "),Ak(n,r)}}),L_=Qg({maximumStrict_:function(e,t){ck("strict variants of ops have been deprecated and will be removed in future");var n=Xg(e,"a","maximumStrict"),r=Xg(t,"b","maximumStrict");return dd(n.shape,r.shape,"Error in maximumStrict: "),$k(n,r)}}),z_=Qg({minimumStrict_:function(e,t){ck("strict variants of ops have been deprecated and will be removed in future");var n=Xg(e,"a","minimumStrict"),r=Xg(t,"b","minimumStrict");return dd(n.shape,r.shape,"Error in minimumStrict: "),sC(n,r)}}),B_=Qg({modStrict_:function(e,t){ck("strict variants of ops have been deprecated and will be removed in future");var n=Xg(e,"a","modStrict"),r=Xg(t,"b","modStrict");return dd(n.shape,r.shape,"Error in modStrict: "),cC(n,r)}}),V_=Qg({mulStrict_:function(e,t){ck("strict variants of ops have been deprecated and will be removed in future");var n=Xg(e,"a","mul"),r=Xg(t,"b","mul");return dd(n.shape,r.shape,"Error in multiplyStrict: "),Ek(n,r)}}),U_=Qg({powStrict_:function(e,t){return ck("strict variants of ops have been deprecated and will be removed in future"),dd(e.shape,t.shape,"Error in powStrict: "),qk(e,t)}}),W_=Qg({squaredDifferenceStrict_:function(e,t){ck("strict variants of ops have been deprecated and will be removed in future");var n=Xg(e,"a","squaredDifferenceStrict"),r=Xg(t,"b","squaredDifferenceStrict");return dd(n.shape,r.shape,"Error in squaredDifferenceStrict: "),c_(n,r)}}),G_=Qg({subStrict_:function(e,t){ck("strict variants of ops have been deprecated and will be removed in future");var n=Xg(e,"a","subStrict"),r=Xg(t,"b","subStrict");return dd(n.shape,r.shape,"Error in subStrict: "),Kk(n,r)}}),H_=Qg({norm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===t.rank)return Yk(t);if(1!==t.rank&&null===r)return e(Ax(t,[-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return Uw(Yk(t),r);if(n===1/0)return Vw(Yk(t),r);if(n===-1/0)return oC(Yk(t),r);if("euclidean"===n||2===n)return Rk(Uw(qk(Yk(t),Uk(2,"int32")),r));throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return Vw(Uw(Yk(t),r[0]),r[1]-1);if(n===1/0)return Vw(Uw(Yk(t),r[1]),r[0]);if(n===-1/0)return oC(Uw(Yk(t),r[1]),r[0]);if("fro"===n||"euclidean"===n)return Rk(Uw(Fk(t),r));throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=Xg(e,"x","norm"),t,n),i=a.shape;if(r){var o=Id(n,e.shape);i=qw(a.shape,o)}return Ax(a,i)}}),j_=Qg({movingAverage_:function(e,t,n,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=Xg(e,"v","movingAverage"),o=Xg(t,"x","movingAverage"),s=Xg(n,"decay","movingAverage");Mg(i,o),pd(yd(i.shape,o.shape),(function(){return"Shape mismatch in v and x"}));var u=Uk(1),c=Kk(u,s),l=Ek(Kk(o,i),c);if(a){pd(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var h=Xg(r,"step","movingAverage");l=Ak(l,Kk(u,qk(s,h)))}return Tk(i,l)}}),q_=Qg({scatterND_:function(e,t,n){var r=Xg(e,"indices","scatterND","int32"),a=Xg(t,"updates","scatterND");return Tb(a,r,n),Ug.runKernel(bv,{indices:r,updates:a},{shape:n})}}),K_=Qg({sparseToDense_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=Xg(e,"sparseIndices","sparseToDense","int32"),i=Xg(t,"sparseValues","sparseToDense"),o=Xg(r,"defaultValue","sparseToDense",i.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was ".concat(e.dtype,"."));if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape ".concat(e.shape,"."));var a=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:, ".concat(n.length,", should be: ").concat(i,"."));if(0!==t.rank&&(1!==t.rank||t.size!==a))throw new Error("sparseValues has incorrect shape ".concat(t.shape,", should be [] or [").concat(a,"]"));if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(a,i,n,o),Ug.runKernel(Pv,{sparseIndices:a,sparseValues:i,defaultValue:o},{outputShape:n})}}),X_=Qg({gatherND_:function(e,t){var n=Xg(t,"indices","gatherND","int32"),r=Xg(e,"x","gatherND");return Ug.runKernel(pm,{params:r,indices:n})}}),Y_=Qg({dropout_:function(e,t,n,r){var a=Xg(e,"x","dropout");if(pd("float32"===a.dtype,(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a ".concat(a.dtype," tensor instead.")})),pd(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got ".concat(t,".")})),0===t)return e instanceof _g?a.clone():a;var i=function(e,t){if(null==t)return e.shape.slice();if(yd(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)n.push(null==t[r]&&null!=e.shape[r]?e.shape[r]:t[r]);return n}return t}(a,n),o=1-t,s=Ak(ww(Tk(OC(i,0,1,"float32",r),o)),o);return Ek(a,s)}});function Z_(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function Q_(e,t,n){for(var r=1-e%2,a=new Float32Array(e),i=0;i<e;++i){var o=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(o)}return m_(a,"float32")}var J_=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,u,c,l,h,p,d,f,m,v,g,y=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=y.length>2&&void 0!==y[2]?y[2]:1,a=Xg(t,"predictions","inTopK"),i=Xg(n,"targets","inTopK"),pd(a.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+a.rank})),pd(a.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank ".concat(a.rank," and targets rank ").concat(i.rank)})),dd(a.shape.slice(0,a.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=a.shape[a.shape.length-1],pd(r>0&&r<=o,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension (".concat(o,"), but got ").concat(r)})),e.next=7,a.data();case 7:return s=e.sent,e.next=10,i.data();case 10:u=e.sent,c=s.length/o,l=o,h=Nd("bool",c),p=0;case 15:if(!(p<c)){e.next=30;break}for(d=p*l,f=s.subarray(d,d+l),m=[],v=0;v<f.length;v++)m.push({value:f[v],index:v});m.sort((function(e,t){return t.value-e.value})),h[p]=0,g=0;case 20:if(!(g<r)){e.next=27;break}if(m[g].index!==u[p]){e.next=24;break}return h[p]=1,e.abrupt("break",27);case 24:g++,e.next=20;break;case 27:p++,e.next=15;break;case 30:return e.abrupt("return",(t!==a&&a.dispose(),n!==i&&i.dispose(),ey(h,i.shape,"bool")));case 31:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),$_=Qg({conv2DBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=Ax(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=Ax(t,[1,t.shape[0],t.shape[1],t.shape[2]])),pd(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."})),pd(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."})),pd(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."}));var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];return pd(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must match input depth in filter (").concat(n[2],".")})),pd(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must match output depth for filter (").concat(n[3],").")})),null!=o&&pd(bd(a),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(a,".")})),Ug.runKernel(Df,{x:s,dy:u},{strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:n})}});function eS(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return Ek(e,p_(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function tS(e,t){var n=t,r=Qk(e.shape,t.shape);return r.length>0&&(n=Uw(n,r)),Ax(n,e.shape)}function nS(e,t,n,r){if("linear"===t)return e;if("relu"===t)return zC(e);if("elu"===t)return mw(e);if("relu6"===t)return BC(e);if("prelu"===t)return SC(e,n);if("leakyrelu"===t)return Ew(e,r);throw new Error("Unknown fused activation ".concat(t,"."))}var rS=function(e,t){return!(e>0)||"linear"===t},aS=Qg({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,o=void 0===i?"NHWC":i,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,h=e.activation,p=void 0===h?"linear":h,d=e.preluActivationWeights,f=e.leakyreluAlpha;if(!1===rS(Ug.state.gradientDepth,p=p||"linear")){var m=Zx(t,n,r,a,o,u,c);return null!=l&&(m=Tk(m,l)),nS(m,p,d,f)}var v=Xg(t,"x","conv2d"),g=Xg(n,"filter","conv2d"),y=v,b=!1;3===v.rank&&(b=!0,y=Ax(v,[1,v.shape[0],v.shape[1],v.shape[2]])),pd(4===y.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+y.rank+"."})),pd(4===g.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+g.rank+"."})),null!=c&&pd(bd(a),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode ".concat(c," but got pad ").concat(a,".")})),pd(y.shape[3]===g.shape[2],(function(){return"Error in conv2d: depth of input (".concat(y.shape[3],") must match input depth for filter ").concat(g.shape[2],".")})),pd(Tx(r,u),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(r," and dilations '").concat(u,"'")})),pd("NHWC"===o,(function(){return"Error in conv2d: got dataFormat of ".concat(o," but only NHWC is currently supported.")}));var k,x,w=bx(y.shape,g.shape,r,u,a,c);null!=l&&(k=_slicedToArray(Og(k=Xg(l,"bias","fused conv2d"),v),1)[0],Jk(w.outShape,k.shape)),null!=d&&(x=Xg(d,"prelu weights","fused conv2d"));var C=function(e,t){var n=_slicedToArray(t,4),i=n[0],o=n[1],s=n[2],c=n[3],l=eS(e,s,p);pd(Ix(u),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(u,"'")}));var h=[Jx(o.shape,l,i,r,a),$_(o,l,i.shape,r,a)];if(null!=c){var d=tS(c,l);h.push(d)}return h},_={x:y,filter:g,bias:k,preluActivationWeights:x},S={strides:r,pad:a,dataFormat:o,dilations:u,dimRoundingMode:c,activation:p,leakyreluAlpha:f};return null==l?Bk((function(e,t,n){var r=Ug.runKernel(Qv,_,S);return n([t,e,r]),b&&(r=Ax(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:C}}))(y,g):Bk((function(e,t,n,r){var a=Ug.runKernel(Qv,_,S);return r([t,e,a,n]),b&&(a=Ax(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:C}}))(y,g,k)}}),iS=Qg({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=Ax(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;return 3===u.rank&&(u=Ax(t,[1,t.shape[0],t.shape[1],t.shape[2]])),Ug.runKernel(jf,{x:s,dy:u},{strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:n})}}),oS=Qg({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=t,u=!1;3===t.rank&&(u=!0,s=Ax(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c=Ug.runKernel(qf,{dy:s,filter:n},{strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:e});return u?Ax(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),sS=Qg({fusedDepthwiseConv2d_:function(e){var t,n=e.x,r=e.filter,a=e.strides,i=e.pad,o=e.dataFormat,s=void 0===o?"NHWC":o,u=e.dilations,c=void 0===u?[1,1]:u,l=e.dimRoundingMode,h=e.bias,p=e.activation,d=void 0===p?"linear":p,f=e.preluActivationWeights,m=e.leakyreluAlpha;if(!1===rS(Ug.state.gradientDepth,d)){var v=uw(n,r,a,i,s,c,l);return null!=h&&(v=Tk(v,h)),nS(v,d,f,m)}var g=Xg(n,"x","depthwiseConv2d"),y=Xg(r,"filter","depthwiseConv2d"),b=g,k=!1;3===g.rank&&(k=!0,b=Ax(g,[1,g.shape[0],g.shape[1],g.shape[2]])),pd(4===b.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank ".concat(b.rank,".")})),pd(4===y.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank ".concat(y.rank,".")})),pd(b.shape[3]===y.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels (".concat(b.shape[3],") must match the inChannels dimension in filter ").concat(y.shape[2],".")})),null==c&&(c=[1,1]),pd(Tx(a,c),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(a," and dilations '").concat(c,"'")})),null!=l&&pd(bd(i),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode ".concat(l," but got pad ").concat(i,".")}));var x,w,C=bx(b.shape,y.shape,a,c,i,l,!0);null!=h&&(t=_slicedToArray(Og(x=Xg(h,"bias","fused conv2d"),g),1),x=t[0],Jk(C.outShape,x.shape)),null!=f&&(w=Xg(f,"prelu weights","fused depthwiseConv2d"));var _=function(e,t){pd(Ix(c),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '".concat(c,"'")}));var n=_slicedToArray(t,4),r=n[0],o=n[1],s=n[2],u=n[3],h=eS(e,s,d),p=oS(o.shape,h,r,a,i,c,l),f=iS(o,h,r.shape,a,i,c,l);return null!=u?[p,f,tS(x,h)]:[p,f]},S={x:b,filter:y,bias:x,preluActivationWeights:w},I={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:d,leakyreluAlpha:m};return null==h?Bk((function(e,t,n){var r=Ug.runKernel(Jv,S,I);return n([t,e,r]),k&&(r=Ax(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:_}}))(b,y):Bk((function(e,t,n,r){var a=Ug.runKernel(Jv,S,I);return r([t,e,a,n]),k&&(a=Ax(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:_}}))(b,y,x)}}),uS=Qg({fusedMatMul_:function(e){var t=e.a,n=e.b,r=e.transposeA,a=void 0!==r&&r,i=e.transposeB,o=void 0!==i&&i,s=e.bias,u=e.activation,c=void 0===u?"linear":u,l=e.preluActivationWeights,h=e.leakyreluAlpha;if(!1===rS(Ug.state.gradientDepth,c)){var p=gb(t,n,a,o);return null!=s&&(p=Tk(p,s)),nS(p,c,l,h)}var d=Xg(t,"a","fused matMul"),f=Xg(n,"b","fused matMul"),m=_slicedToArray(Og(d,f),2);d=m[0],f=m[1];var v=a?d.shape[d.rank-2]:d.shape[d.rank-1],g=o?f.shape[f.rank-1]:f.shape[f.rank-2],y=a?d.shape[d.rank-1]:d.shape[d.rank-2],b=o?f.shape[f.rank-2]:f.shape[f.rank-1],k=d.shape.slice(0,-2),x=f.shape.slice(0,-2),w=vd(k),C=vd(x);pd(d.rank>=2&&f.rank>=2&&d.rank===f.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks ".concat(d.rank," and ").concat(f.rank,".")})),pd(yd(k,x),(function(){return"Error in fused matMul: outer dimensions (".concat(k,") and (").concat(x,") of Tensors with shapes ").concat(d.shape," and ")+f.shape+" must match."})),pd(v===g,(function(){return"Error in fused matMul: inner shapes (".concat(v,") and (").concat(g,") of Tensors with shapes ").concat(d.shape," and ").concat(f.shape," and transposeA=").concat(a," and transposeB=").concat(o," must match.")}));var _,S,I=d.shape.slice(0,-2).concat([y,b]),T=Ax(d,a?[w,v,y]:[w,y,v]),N=Ax(f,o?[C,b,g]:[C,g,b]);null!=s&&(_=_slicedToArray(Og(_=Xg(s,"bias","fused matMul"),d),1)[0],Jk(I,_.shape)),null!=l&&(S=Xg(l,"prelu weights","fused matMul"));var A=function(e,t){var n,r,i=_slicedToArray(t,4),u=i[0],l=i[1],h=i[2],p=i[3],d=eS(Ax(e,h.shape),h,c);return a||o?!a&&o?(n=gb(d,l,!1,!1),r=gb(d,u,!0,!1)):a&&!o?(n=gb(l,d,!1,!0),r=gb(u,d,!1,!1)):(n=gb(l,d,!0,!0),r=gb(d,u,!0,!0)):(n=gb(d,l,!1,!0),r=gb(u,d,!0,!1)),null!=s?[n,r,tS(p,d)]:[n,r]},E={a:T,b:N,bias:_,preluActivationWeights:S},R={transposeA:a,transposeB:o,activation:c,leakyreluAlpha:h};return null==s?Bk((function(e,t,n){var r=Ug.runKernel(Zv,E,R);return n([e,t,r]),{value:Ax(r,I),gradFunc:A}}))(T,N):Bk((function(e,t,n,r){var a=Ug.runKernel(Zv,E,R);return r([e,t,a,n]),{value:Ax(a,I),gradFunc:A}}))(T,N,_)}}),cS=Qg({hammingWindow_:function(e){return Q_(e,.54,.46)}}),lS=Qg({hannWindow_:function(e){return Q_(e,.5,.5)}}),hS=Qg({frame_:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=0,o=[];i+t<=e.size;)o.push(Ox(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=Fx([Ox(e,i,t-s),Hk([s],a)]);o.push(u),i+=n}return 0===o.length?v_([],[0,t]):Ax(Fx(o),[o.length,t])}}),pS=Qg({stft_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:lS;null==r&&(r=Z_(t));for(var i=hS(e,t,n),o=Ek(i,a(t)),s=[],u=0;u<i.shape[0];u++)s.push(u_(Ox(o,[u,0],[1,t]),r));return Fx(s)}}),dS=Qg({cropAndResize_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=Xg(e,"image","cropAndResize"),s=Xg(t,"boxes","cropAndResize","float32"),u=Xg(n,"boxInd","cropAndResize","int32"),c=s.shape[0];return pd(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank ".concat(o.rank,".")})),pd(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] but had shape ").concat(s.shape,".")})),pd(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] but had shape ").concat(s.shape,".")})),pd(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length ".concat(r.length,".")})),pd(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),pd("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was "+a})),Ug.runKernel(Uf,{image:o,boxes:s,boxInd:u},{method:a,extrapolationValue:i,cropSize:r})}}),fS=Qg({flipLeftRight_:function(e){var t=Xg(e,"image","flipLeftRight","float32");return pd(4===t.rank,(function(){return"Error in flipLeftRight: image must be rank 4,but got rank ".concat(t.rank,".")})),Ug.runKernel(sm,{image:t},{})}}),mS=Qg({rotateWithOffset_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=Xg(e,"image","rotateWithOffset","float32");return pd(4===a.rank,(function(){return"Error in rotateWithOffset: image must be rank 4,but got rank ".concat(a.rank,".")})),Ug.runKernel(Yv,{image:a},{radians:t,fillValue:n,center:r})}});function vS(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),pd(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")})),pd(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")})),pd(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]})),pd(1===t.rank,(function(){return"scores must be a 1D tensor"})),pd(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", but was ")+t.shape[0]})),pd(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}var gS=Qg({nonMaxSuppression_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=Xg(e,"boxes","nonMaxSuppression"),o=Xg(t,"scores","nonMaxSuppression"),s=vS(i,o,n,r,a);return Ug.runKernel(Ym,{boxes:i,scores:o},{maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:a=s.scoreThreshold})}});function yS(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,a=e.length,i=0,o=!1;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||bS)}(e,t,n);e.splice(r<0?-(r+1):r,0,t)}function bS(e,t){return e>t?1:e<t?-1:0}function kS(e,t,n,r,a){return CS(e,t,n,r,a,0)}function xS(e,t,n,r,a,i){return CS(e,t,n,r,a,0,!1,i,!0)}function wS(e,t,n,r,a,i){return CS(e,t,n,r,a,i,!0)}function CS(e,t,n,r,a,i){for(var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=[],l=0;l<t.length;l++)t[l]>a&&c.push({score:t[l],boxIndex:l,suppressBeginIndex:0});c.sort(IS);for(var h=i>0?-.5/i:0,p=[],d=[];p.length<n&&c.length>0;){var f=c.pop(),m=f.score,v=f.boxIndex,g=f.suppressBeginIndex;if(m<a)break;for(var y=!1,b=p.length-1;b>=g;--b){var k=_S(e,v,p[b]);if(k>=r){y=!0;break}if(f.score=f.score*SS(r,h,k),f.score<=a)break}f.suppressBeginIndex=p.length,y||(f.score===m?(p.push(v),d.push(f.score)):f.score>a&&yS(c,f,IS))}var x=p.length,w=n-x;s&&w>0&&(p.push.apply(p,_toConsumableArray(new Array(w).fill(0))),d.push.apply(d,_toConsumableArray(new Array(w).fill(0))));var C={selectedIndices:p};return o&&(C.selectedScores=d),u&&(C.validOutputs=x),C}function _S(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),h=Math.max(a[0],a[2]),p=Math.max(a[1],a[3]),d=(s-i)*(u-o),f=(h-c)*(p-l);if(d<=0||f<=0)return 0;var m=Math.max(i,c),v=Math.max(o,l),g=Math.min(s,h),y=Math.min(u,p),b=Math.max(g-m,0)*Math.max(y-v,0);return b/(d+f-b)}function SS(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function IS(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}var TS=Qg({nonMaxSuppressionWithScore_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=Xg(e,"boxes","nonMaxSuppression"),s=Xg(t,"scores","nonMaxSuppression"),u=vS(o,s,n,r,a,i),c=Ug.runKernel(Qm,{boxes:o,scores:s},{maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma});return{selectedIndices:c[0],selectedScores:c[1]}}}),NS=Qg({nonMaxSuppressionPadded_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=Xg(e,"boxes","nonMaxSuppression"),s=Xg(t,"scores","nonMaxSuppression"),u=vS(o,s,n,r,a,null),c=Ug.runKernel(Zm,{boxes:o,scores:s},{maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:i});return{selectedIndices:c[0],validOutputs:c[1]}}}),AS=Qg({resizeBilinear_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Xg(e,"images","resizeBilinear");pd(3===a.rank||4===a.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank ".concat(a.rank,".")})),pd(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."})),pd(!1===r||!1===n,(function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=Ax(a,[1,a.shape[0],a.shape[1],a.shape[2]]));_toArray(t);var s=Ug.runKernel(dv,{images:i},{alignCorners:n,halfPixelCenters:r,size:t});return o?Ax(s,[s.shape[1],s.shape[2],s.shape[3]]):s}}),ES=Qg({resizeNearestNeighbor_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Xg(e,"images","resizeNearestNeighbor");pd(3===a.rank||4===a.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ".concat(a.rank,".")})),pd(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."})),pd("float32"===a.dtype||"int32"===a.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"})),pd(!1===r||!1===n,(function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=Ax(a,[1,a.shape[0],a.shape[1],a.shape[2]]));_toArray(t);var s=Ug.runKernel(hv,{images:i},{alignCorners:n,halfPixelCenters:r,size:t});return o?Ax(s,[s.shape[1],s.shape[2],s.shape[3]]):s}}),RS=Qg({bandPart_:function(e,t,n){pd(t%1==0,(function(){return"bandPart(): numLower must be an integer, got ".concat(t,".")})),pd(n%1==0,(function(){return"bandPart(): numUpper must be an integer, got ".concat(n,".")}));var r=Xg(e,"a","bandPart");pd(r.rank>=2,(function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")}));var a=r.shape,i=_slicedToArray(r.shape.slice(-2),2),o=i[0],s=i[1];if(!(t<=o))throw new Error("bandPart(): numLower (".concat(t,") must not be greater than the number of rows (").concat(o,")."));if(!(n<=s))throw new Error("bandPart(): numUpper (".concat(n,") must not be greater than the number of columns (").concat(s,")."));t<0&&(t=o),n<0&&(n=s);var u=Ax(MC(0,o,1,"int32"),[-1,1]),c=MC(0,s,1,"int32"),l=Kk(u,c),h=Jw(Fw(l,Uk(+t,"int32")),Sw(l,Uk(-n,"int32"))),p=fC([o,s],r.dtype);return Ax(h_(__(Ax(r,[-1,o,s])).map((function(e){return pw(h,e,p)}))),a)}}),FS=Qg({gramSchmidt_:function(e){var t;Array.isArray(e)?function(){t=!1,pd(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){pd(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: (".concat(e[t].shape[0]," vs. ").concat(n,")")}))},a=1;a<e.length;++a)r(a)}():(t=!0,e=s_(e,e.shape[0],0).map((function(e){return l_(e,[0])}))),pd(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds number of dimensions (").concat(e[0].shape[0],").")}));for(var n=[],r=e,a=function(e){n.push(Ug.tidy((function(){var t=r[e];if(e>0)for(var a=0;a<e;++a){var i=Ek(Uw(Ek(n[a],t)),n[a]);t=Kk(t,i)}return Ak(t,H_(t,"euclidean"))})))},i=0;i<e.length;++i)a(i);return t?h_(n,0):n}});function DS(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Ug.tidy((function(){pd(2===e.shape.length,(function(){return"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor.")}));for(var n=e.shape[0],r=e.shape[1],a=xw(n),i=Yy(e),o=v_([[1]],[1,1]),s=Yy(o),u=n>=r?r:n,c=function(e){var t,u=i,c=s,l=a;t=_slicedToArray(Ug.tidy((function(){var t=Ox(i,[e,e],[n-e,1]),u=H_(t),c=Ox(i,[e,e],[1,1]),l=pw(_w(c,0),v_([[-1]]),v_([[1]])),h=Kk(c,Ek(l,u)),p=Ak(t,h);s=1===p.shape[0]?Yy(o):Fx([o,Ox(p,[1,0],[p.shape[0]-1,p.shape[1]])],0);var d=Lw(Ak(gb(l,h),u)),f=Ox(i,[e,0],[n-e,r]),m=Ek(d,s),v=bb(s);if(0===e)i=Kk(f,gb(m,gb(v,f)));else{var g=Kk(f,gb(m,gb(v,f)));i=Fx([Ox(i,[0,0],[e,r]),g],0)}var y=bb(m),b=Ox(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=Kk(b,gb(gb(b,s),y));else{var k=Kk(b,gb(gb(b,s),y));a=Fx([Ox(a,[0,0],[n,e]),k],1)}return[s,i,a]})),3),s=t[0],i=t[1],a=t[2],mk([u,c,l])},l=0;l<u;++l)c(l);return!t&&n>r&&(a=Ox(a,[0,0],[n,r]),i=Ox(i,[0,0],[r,r])),[a,i]}))}var OS,MS=Qg({qr_:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(pd(e.rank>=2,(function(){return"qr() requires input tensor to have a rank >= 2, but got rank "+e.rank})),2===e.rank)return DS(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=__(Ax(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];return r.forEach((function(e){var n=_slicedToArray(DS(e,t),2),r=n[0],o=n[1];a.push(r),i.push(o)})),[Ax(h_(a,0),e.shape),Ax(h_(i,0),e.shape)]}});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(OS||(OS={}));var PS,LS,zS,BS=Qg({computeWeightedLoss_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:OS.SUM_BY_NONZERO_WEIGHTS,r=Xg(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=Xg(t,"weights","computeWeightedLoss"));var i=null==a?r:Ek(r,a);if(n===OS.NONE)return i;if(n===OS.SUM)return Uw(i);if(n===OS.MEAN){if(null==a)return iC(i);var o=r.size/a.size,s=Ak(Uw(i),Uw(a));return o>1?Ak(s,Uk(o)):s}if(n===OS.SUM_BY_NONZERO_WEIGHTS){if(null==a)return Ak(Uw(i),Uk(r.size));var u=Ek(a,mC(r.shape)),c=Xy(Uw(dC(u,Uk(0))),"float32");return Ak(Uw(i),c)}throw Error("Unknown reduction: "+n)}}),VS=Qg({absoluteDifference_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:OS.SUM_BY_NONZERO_WEIGHTS,a=Xg(e,"labels","absoluteDifference"),i=Xg(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=Xg(n,"weights","absoluteDifference")),dd(a.shape,i.shape,"Error in absoluteDifference: ");var s=Yk(Kk(a,i));return BS(s,o,r)}}),US=Qg({cosineDistance_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:OS.SUM_BY_NONZERO_WEIGHTS,i=Xg(e,"labels","cosineDistance"),o=Xg(t,"predictions","cosineDistance"),s=null;null!=r&&(s=Xg(r,"weights","cosineDistance")),dd(i.shape,o.shape,"Error in cosineDistance: ");var u=Uk(1),c=Kk(u,Uw(Ek(i,o),n,!0));return BS(c,s,a)}}),WS=Qg({hingeLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:OS.SUM_BY_NONZERO_WEIGHTS,a=Xg(e,"labels","hingeLoss"),i=Xg(t,"predictions","hingeLoss"),o=null;null!=n&&(o=Xg(n,"weights","hingeLoss")),dd(a.shape,i.shape,"Error in hingeLoss: ");var s=Uk(1);a=Kk(Ek(Uk(2),a),s);var u=zC(Kk(s,Ek(a,i)));return BS(u,o,r)}}),GS=Qg({huberLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:OS.SUM_BY_NONZERO_WEIGHTS,i=Xg(e,"labels","huberLoss"),o=Xg(t,"predictions","huberLoss"),s=null;null!=n&&(s=Xg(n,"weights","huberLoss")),dd(i.shape,o.shape,"Error in huberLoss: ");var u=Uk(r),c=Yk(Kk(o,i)),l=sC(c,u),h=Kk(c,l),p=Tk(Ek(Uk(.5),Fk(l)),Ek(u,h));return BS(p,s,a)}}),HS=Qg({logLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-7,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:OS.SUM_BY_NONZERO_WEIGHTS,i=Xg(e,"labels","logLoss"),o=Xg(t,"predictions","logLoss"),s=null;null!=n&&(s=Xg(n,"weights","logLoss")),dd(i.shape,o.shape,"Error in logLoss: ");var u=Uk(1),c=Uk(r),l=Lw(Ek(i,Mw(Tk(o,c)))),h=Ek(Kk(u,i),Mw(Tk(Kk(u,o),c))),p=Kk(l,h);return BS(p,s,a)}}),jS=Qg({meanSquaredError_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:OS.SUM_BY_NONZERO_WEIGHTS,a=Xg(e,"labels","meanSquaredError"),i=Xg(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=Xg(n,"weights","meanSquaredError")),dd(a.shape,i.shape,"Error in meanSquaredError: ");var s=c_(a,i);return BS(s,o,r)}}),qS=Qg({sigmoidCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:OS.SUM_BY_NONZERO_WEIGHTS,i=Xg(e,"multiClassLabels","sigmoidCrossEntropy"),o=Xg(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=Xg(n,"weights","sigmoidCrossEntropy")),dd(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Uk(r),c=Uk(1),l=Uk(.5);i=Tk(Ek(i,Kk(c,u)),Ek(l,u))}var h=function(e,t){var n=Xg(e,"labels","sigmoidCrossEntropyWithLogits"),r=Xg(t,"logits","sigmoidCrossEntropyWithLogits");dd(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=zC(r),i=Ek(r,n),o=Pw(gw(Lw(Yk(r))));return Tk(Kk(a,i),o)}(i,o);return BS(h,s,a)}}),KS=Qg({softmaxCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:OS.SUM_BY_NONZERO_WEIGHTS,i=Xg(e,"onehotLabels","softmaxCrossEntropy"),o=Xg(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=Xg(n,"weights","softmaxCrossEntropy")),dd(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Uk(r),c=Uk(1),l=Uk(i.shape[1]);i=Tk(Ek(i,Kk(c,u)),Ak(u,l))}var h=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ".concat(t.rank," and dim was ")+n);return Bk((function(e,t,r){var a=Qw(t,[n],!0),i=Kk(Xy(t,"float32"),a);r([e,i]);var o=Lw(Ek(i,e));return{value:Uw(o,[n]),gradFunc:function(e,t){var r=_slicedToArray(t,2),a=r[0],i=r[1],o=qw(e.shape,[n]);return[Ek(Ax(e,o),Kk(Xy(a,"float32"),gw(i))),Ek(Ax(e,o),Kk(gw(i),Xy(a,"float32")))]}}}))(e,t)}(i,o);return BS(h,s,a)}}),XS={fft:a_,ifft:i_,rfft:u_,irfft:o_},YS={hammingWindow:cS,hannWindow:lS,frame:hS,stft:pS},ZS={flipLeftRight:fS,resizeNearestNeighbor:ES,resizeBilinear:AS,rotateWithOffset:mS,cropAndResize:dS,nonMaxSuppression:gS,nonMaxSuppressionAsync:(zS=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a,i,o,s,u,c,l,h,p,d,f=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=f.length>3&&void 0!==f[3]?f[3]:.5,i=f.length>4&&void 0!==f[4]?f[4]:Number.NEGATIVE_INFINITY,o=Xg(t,"boxes","nonMaxSuppressionAsync"),s=Xg(n,"scores","nonMaxSuppressionAsync"),u=vS(o,s,r,a,i),r=u.maxOutputSize,a=u.iouThreshold,i=u.scoreThreshold,e.next=6,Promise.all([o.data(),s.data()]);case 6:return c=e.sent,l=c[0],h=c[1],p=kS(l,h,r,a,i),d=p.selectedIndices,e.abrupt("return",(o!==t&&o.dispose(),s!==n&&s.dispose(),m_(d,"int32")));case 12:case"end":return e.stop()}}),e)}))),function(e,t,n){return zS.apply(this,arguments)}),nonMaxSuppressionWithScore:TS,nonMaxSuppressionWithScoreAsync:(LS=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a,i,o,s,u,c,l,h,p,d,f,m,v=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=v.length>3&&void 0!==v[3]?v[3]:.5,i=v.length>4&&void 0!==v[4]?v[4]:Number.NEGATIVE_INFINITY,o=v.length>5&&void 0!==v[5]?v[5]:0,s=Xg(t,"boxes","nonMaxSuppressionAsync"),u=Xg(n,"scores","nonMaxSuppressionAsync"),c=vS(s,u,r,a,i,o),r=c.maxOutputSize,a=c.iouThreshold,i=c.scoreThreshold,o=c.softNmsSigma,e.next=7,Promise.all([s.data(),u.data()]);case 7:return l=e.sent,h=l[0],p=l[1],d=wS(h,p,r,a,i,o),f=d.selectedIndices,m=d.selectedScores,e.abrupt("return",(s!==t&&s.dispose(),u!==n&&u.dispose(),{selectedIndices:m_(f,"int32"),selectedScores:m_(m)}));case 14:case"end":return e.stop()}}),e)}))),function(e,t,n){return LS.apply(this,arguments)}),nonMaxSuppressionPadded:NS,nonMaxSuppressionPaddedAsync:(PS=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a,i,o,s,u,c,l,h,p,d,f,m,v,g,y,b,k=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=k.length>3&&void 0!==k[3]?k[3]:.5,i=k.length>4&&void 0!==k[4]?k[4]:Number.NEGATIVE_INFINITY,o=k.length>5&&void 0!==k[5]&&k[5],s=Xg(t,"boxes","nonMaxSuppressionAsync"),u=Xg(n,"scores","nonMaxSuppressionAsync"),c=vS(s,u,r,a,i,null),l=c.maxOutputSize,h=c.iouThreshold,p=c.scoreThreshold,e.next=11,Promise.all([s.data(),u.data()]);case 11:return d=e.sent,f=_slicedToArray(d,2),m=f[0],v=f[1],g=xS(m,v,l,h,p,o),y=g.selectedIndices,b=g.validOutputs,e.abrupt("return",(s!==t&&s.dispose(),u!==n&&u.dispose(),{selectedIndices:m_(y,"int32"),validOutputs:Uk(b,"int32")}));case 19:case"end":return e.stop()}}),e)}))),function(e,t,n){return PS.apply(this,arguments)})},QS={bandPart:RS,gramSchmidt:FS,qr:MS},JS={absoluteDifference:VS,computeWeightedLoss:BS,cosineDistance:US,hingeLoss:WS,huberLoss:GS,logLoss:HS,meanSquaredError:jS,sigmoidCrossEntropy:qS,softmaxCrossEntropy:KS},$S=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"sgd",value:function(e){return new tx(e)}},{key:"momentum",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new nx(e,t,n)}},{key:"rmsprop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return new rx(e,t,n,r,a)}},{key:"adam",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new Xk(e,t,n,r)}},{key:"adadelta",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Gk(e,t,n)}},{key:"adamax",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return new ex(e,t,n,r,a)}},{key:"adagrad",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return new jk(e,t)}}]),e}(),eI={sgd:$S.sgd,momentum:$S.momentum,adadelta:$S.adadelta,adagrad:$S.adagrad,rmsprop:$S.rmsprop,adamax:$S.adamax,adam:$S.adam},tI="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:function(e){return e()};function nI(){return new Promise((function(e){return tI((function(){return e()}))}))}function rI(e,t){var n=e[0].length;e.forEach((function(e,t){pd(e.length===n,(function(){return"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same as the rank of the rest (").concat(n,")")}))})),pd(t>=0&&t<n,(function(){return"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")}));var r=e[0];e.forEach((function(e,a){for(var i=0;i<n;i++)pd(i===t||e[i]===r[i],(function(){return"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") does not match the shape of the rest (").concat(r,") along the non-concatenated axis ").concat(a,".")}))}))}function aI(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}var iI=30;function oI(e){return e<=iI?e:Ud(e,Math.floor(Math.sqrt(e)))}function sI(e,t,n){return[n*("number"==typeof e?e:e[0]),t*("number"==typeof e?e:e[1])]}function uI(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];if(r)(a=a.concat(t.slice(0))).push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);for(var i=t.length,o=0;o<i;++o)a=a.concat([e[o+1]/t[o],t[o]]);a=a.concat(e.slice(i+1))}return a}function cI(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=[];if(n){r.push(t);for(var a=t+1;a<e;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{for(var i=[],o=[],s=1;s<e;++s)s>=2*t+1||s%2==1?o.push(s):i.push(s);r.push.apply(r,i),r.push(0),r.push.apply(r,o)}return r}function lI(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];a.push(r?e[0]/n:e[0]*n);for(var i=1;i<e.length;++i)a.push(i<=t.length?r?t[i-1]*e[i]:e[i]/t[i-1]:e[i]);return a}function hI(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function pI(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}var dI=1.7580993408473768,fI=1.0507009873554805,mI=.3275911,vI=.254829592,gI=-.284496736,yI=1.421413741,bI=-1.453152027,kI=1.061405429;function xI(){var e;Jd().getBool("IS_TEST")||(e=console).warn.apply(e,arguments)}function wI(){var e;Jd().getBool("IS_TEST")||(e=console).log.apply(e,arguments)}function CI(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:".concat(e.length,", imag: ").concat(t.length,"."));for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function _I(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function SI(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function II(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function TI(e,t){return{real:e[2*t],imag:e[2*t+1]}}function NI(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function AI(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}function EI(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function RI(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"==typeof t)pd(e.shape[n]%t==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(e.shape[n]/t);else{pd(t.reduce((function(e,t){return-1===t&&(e+=1),e}),0)<=1,(function(){return"There should be only one negative value in split array."}));var a=t.indexOf(-1);if(-1!==a){var i=t.reduce((function(e,t){return t>0?e+t:e}));t[a]=e.shape[n]-i}pd(e.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t}return r}function FI(e,t){var n,r=!1;for(e<=iI?(n=e,r=!0):n=Ud(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Ud(e,n+1);return n}function DI(e,t,n){for(var r=[],a=e.length,i=0;i<a;i++)r.push(i!==t?e[i]:n);return r}function OI(e,t,n,r){var a=t.shape.length,i=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>i)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(i,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(var o=0;o<r;++o)if(e.shape[o]!==t.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(e.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(t.shape[o],"."));for(var s=e.shape[n],u=[],c=1,l=1,h=1,p=0;p<r;++p)u.push(e.shape[p]),c*=e.shape[p];for(var d=r;d<n;d++)u.push(e.shape[d]),l*=e.shape[d];for(var f=r;f<a;f++)u.push(t.shape[f]);for(var m=n+1;m<i;m++)u.push(e.shape[m]),h*=e.shape[m];return{batchSize:c,sliceSize:h,outerSize:l,dimSize:s,outputShape:u}}function MI(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=fC(e.shape),a=Xy(e,"float32"),i=n.complex(a,r);return r.dispose(),a.dispose(),i}if(!Fd(e.dtype,t))return Ug.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){var o=n.real(e),s=Xy(o,t);return o.dispose(),s}if("int32"===t)return n.int(e);if("bool"===t){var u=Uk(0,e.dtype),c=n.notEqual(e,u);return u.dispose(),c}throw new Error("Error in Cast: failed to cast ".concat(e.dtype," to ").concat(t))}function PI(e,t){return Ug.makeTensorFromDataId(e.dataId,t,e.dtype)}function LI(e){try{return e.map((function(e){return kg(e)}))}catch(UY){throw new Error("Failed to decode encoded string bytes into utf-8, error: "+UY)}}function zI(e){return e.map((function(e){return bg(e)}))}var BI={kernelName:rf,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Ek(e,p_(Xy(n,"float32"),-1))}}}},VI={kernelName:af,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){var t=Fk(Xy(n,"float32")),r=Rk(Kk(Uk(1),t));return Lw(Ak(e,r))}}}},UI={kernelName:of,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){var t=Rk(Kk(Fk(Xy(n,"float32")),1));return Ak(e,t)}}}},WI={kernelName:sf,inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray(t,2),r=n[0],a=n[1],i=Jk(r.shape,a.shape);return{a:function(){var t=e,n=Qk(r.shape,i);return n.length>0&&(t=Uw(t,n)),Ax(t,r.shape)},b:function(){var t=e,n=Qk(a.shape,i);return n.length>0&&(t=Uw(t,n)),Ax(t,a.shape)}}}},GI={kernelName:uf,saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}},HI={kernelName:hf,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Dk(n)}}}},jI={kernelName:pf,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Dk(n)}}}},qI={kernelName:df,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Ak(e,Rk(Kk(Uk(1),Fk(Xy(n,"float32")))))}}}},KI={kernelName:ff,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){var t=Rk(Tk(Uk(1),Fk(Xy(n,"float32"))));return Ak(e,t)}}}},XI={kernelName:gf,inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray(t,2),r=n[0],a=n[1],i=Jk(r.shape,a.shape);return{a:function(){var t=Tk(Fk(r),Fk(a)),n=Ek(e,Ak(a,t)),o=Qk(r.shape,i);return o.length>0&&(n=Uw(n,o)),Ax(n,r.shape)},b:function(){var t=Tk(Fk(r),Fk(a)),n=Lw(Ek(e,Ak(r,t))),o=Qk(a.shape,i);return o.length>0&&(n=Uw(n,o)),Ax(n,a.shape)}}}},YI={kernelName:mf,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Ak(e,Tk(Fk(Xy(n,"float32")),1))}}}},ZI={kernelName:vf,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Ak(e,Kk(Uk(1),Fk(Xy(n,"float32"))))}}}},QI=Qg({avgPool3dGrad_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1,1],i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=Xg(e,"dy","avgPool3dGrad"),u=Xg(t,"input","avgPool3dGrad"),c=s,l=u,h=!1;4===u.rank&&(h=!0,c=Ax(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),l=Ax(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),pd(5===c.rank,(function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank "+c.rank+"."})),pd(5===l.rank,(function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank "+l.rank+"."})),pd(Tx(r,a),(function(){return"Error in avgPool3dGrad: Either strides or dilations must be 1. Got strides ".concat(r," and dilations '").concat(a,"'")})),null!=o&&pd(bd(i),(function(){return"Error in avgPool3dGrad: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(i,".")}));var p=Ug.runKernel(xf,{dy:c,input:l},{filterSize:n,strides:r,dilations:a,pad:i,dimRoundingMode:o});return h?Ax(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}}),JI={kernelName:kf,inputsToSave:["x"],gradFunc:function(e,t,n){var r=_slicedToArray(t,1)[0],a=n.filterSize,i=n.strides,o=n.dilations,s=n.pad,u=n.dimRoundingMode,c=null==o?[1,1,1]:o;return{x:function(){return QI(e,r,a,i,c,s,u)}}}},$I=Qg({avgPoolGrad_:function(e,t,n,r,a){var i=Xg(e,"dy","avgPoolGrad"),o=Xg(t,"input","avgPoolGrad");pd(o.rank===i.rank,(function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")}));var s=o,u=i,c=!1;3===o.rank&&(c=!0,s=Ax(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=Ax(i,[1,i.shape[0],i.shape[1],i.shape[2]])),pd(4===u.rank,(function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank "+u.rank+"."})),pd(4===s.rank,(function(){return"Error in avgPoolGrad: input must be rank 4 but got rank "+s.rank+"."}));var l=Ug.runKernel(bf,{dy:u,input:s},{filterSize:n,strides:r,pad:a});return c?Ax(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),eT={kernelName:yf,inputsToSave:["x"],gradFunc:function(e,t,n){var r=_slicedToArray(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad;return{x:function(){return $I(e,r,a,i,o)}}}},tT={kernelName:wf,inputsToSave:["a","b"],gradFunc:function(e,t,n){var r=_slicedToArray(t,2),a=r[0],i=r[1],o=n.transposeA,s=n.transposeB;return o||s?!o&&s?{a:function(){return gb(e,i,!1,!1)},b:function(){return gb(e,a,!0,!1)}}:o&&!s?{a:function(){return gb(i,e,!1,!0)},b:function(){return gb(a,e,!1,!1)}}:{a:function(){return gb(i,e,!0,!0)},b:function(){return gb(e,a,!0,!0)}}:{a:function(){return gb(e,i,!1,!0)},b:function(){return gb(a,e,!0,!1)}}}},nT={kernelName:Cf,gradFunc:function(e,t,n){var r=n.blockShape,a=n.crops;return{x:function(){return CC(e,r,a)}}}},rT={kernelName:Sf,gradFunc:function(e,t,n){for(var r=n.inputShape,a=n.shape,i=Array.from(a),o=r.length-1;o>=0;o--)if(r[o]===a[o])i[o]=1;else if(1!==r[o])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(a,"]."));for(var s=[],u=0;u<i.length;u++)i[u]>1&&s.push(u);return{x:function(){return Uw(e,s,!0)}}}},aT={kernelName:If,gradFunc:function(e){return{x:function(){return e.clone()}}}},iT={kernelName:Tf,gradFunc:function(e){return{x:function(){return Dk(e)}}}},oT={kernelName:Nf,inputsToSave:["x"],gradFunc:function(e,t,n){var r=_slicedToArray(t,1)[0],a=n.clipValueMin,i=n.clipValueMax;return{x:function(){return pw(Jw(Sw(r,a),Fw(r,i)),e,Dk(e))}}}},sT={kernelName:Ef,inputsToSave:["x"],gradFunc:BI.gradFunc},uT={kernelName:Rf,saveAllInputs:!0,gradFunc:function(e,t,n){var r=t.map((function(e){return e.shape})),a=Id(n.axis,t[0].shape)[0],i=r.map((function(e){return e[a]}));return s_(e,i,a).map((function(e){return function(){return e}}))}},cT={kernelName:Ff,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=_slicedToArray(t,2),a=r[0],i=r[1],o=n.dilations,s=n.strides,u=n.pad,c=n.dataFormat;return pd(Ix(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(o,"'")})),{x:function(){return Jx(a.shape,e,i,s,u,c)},filter:function(){return $_(a,e,i.shape,s,u,c)}}}},lT={kernelName:Of,inputsToSave:["dy","filter"],gradFunc:function(e,t,n){var r=_slicedToArray(t,2),a=r[0],i=r[1],o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode;return{dy:function(){return Zx(e,i,o,s,u,1,c)},filter:function(){return $_(e,a,i.shape,o,s,u,c)}}}},hT=Qg({conv3DBackpropFilter_:function(e,t,n,r,a){var i=e;4===e.rank&&(i=Ax(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));var o=t;return 4===o.rank&&(o=Ax(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),pd(5===i.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+i.shape+"."})),pd(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+o.shape+"."})),pd(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."})),pd(i.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must match input depth in filter (").concat(n[3],".")})),pd(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must match output depth for filter (").concat(n[4],").")})),Ug.runKernel(Pf,{x:i,dy:o},{strides:r,pad:a,filterShape:n})}}),pT={kernelName:Mf,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad;pd(Ix(r),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(r,"'")}));var o=_slicedToArray(t,2),s=o[0],u=o[1];return{x:function(){return tw(s.shape,e,u,a,i)},filter:function(){return hT(s,e,u.shape,a,i)}}}},dT={kernelName:zf,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Ek(Lw(QC(Xy(n,"float32"))),e)}}}},fT={kernelName:Bf,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Ek(JC(Xy(n,"float32")),e)}}}},mT={kernelName:Vf,inputsToSave:["x"],gradFunc:function(e,t,n){var r=_slicedToArray(t,1)[0],a=n.axis,i=n.exclusive,o=n.reverse;return{x:function(){var t=Xw([a],r.rank),n=iw(e,a,i,!o);return null!=t&&(n=bb(n,t)),n}}}},vT={kernelName:Hf,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad,o=n.dimRoundingMode,s=null==r?[1,1]:r;pd(Ix(s),(function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '".concat(s,"'")}));var u=_slicedToArray(t,2),c=u[0],l=u[1];return pd(4===c.rank,(function(){return"Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ".concat(c.rank,".")})),pd(4===l.rank,(function(){return"Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ".concat(l.rank,".")})),pd(c.shape[3]===l.shape[2],(function(){return"Error in gradient of depthwiseConv2d: number of input channels (".concat(c.shape[3],") must match the inChannels dimension in filter ").concat(l.shape[2],".")})),pd(Tx(a,s),(function(){return"Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ".concat(a," and dilations '").concat(s,"'.")})),null!=o&&pd(bd(i),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(i,".")})),{x:function(){return oS(c.shape,e,l,a,i,r,o)},filter:function(){return iS(c,e,l.shape,a,i,r,o)}}}},gT={kernelName:Xf,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=_slicedToArray(t,2),a=r[0],i=r[1],o={x:a,filter:i,dy:e},s={x:a,filter:i,dy:e};return{x:function(){return Ug.runKernel(Yf,o,n)},filter:function(){return Ug.runKernel(Zf,s,n)}}}},yT={kernelName:Jf,outputsToSave:[!0],gradFunc:function(e,t){var n={dy:e,y:_slicedToArray(t,1)[0]};return{x:function(){return Ug.runKernel($f,n)}}}},bT={kernelName:em,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0],r=Ek(gw(Lw(Fk(n))),2/Math.sqrt(Math.PI));return{x:function(){return Ek(e,r)}}}},kT={kernelName:nm,outputsToSave:[!0],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Ek(e,n)}}}},xT={kernelName:rm,inputsToSave:["input"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{input:function(){return Ax(e,n.shape)}}}},wT={kernelName:am,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Ek(e,gw(n))}}}},CT={kernelName:um,gradFunc:function(e){return{x:function(){return Dk(e)}}}},_T={kernelName:cm,inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray(t,2),r=n[0],a=n[1],i=Jk(r.shape,a.shape);return{a:function(){var t=Ak(e,Xy(a,"float32")),n=Qk(r.shape,i);return n.length>0?Ax(Uw(t,n),r.shape):t},b:function(){var t=Ek(e,Xy(r,"float32")),n=Qk(a.shape,i);n.length>0&&(t=Ax(Uw(t,n),a.shape));var o=Fk(a);return Lw(Ak(t,Xy(o,"float32")))}}}},ST={kernelName:lm,inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,a=_slicedToArray(t,4),i=a[0],o=a[1],s=a[2],u=a[3],c=null==u?Uk(1):u,l=Qk(o.shape,i.shape),h=[];if(1===o.rank){for(var p=0;p<i.shape.length-1;++p)h.push(i.shape[p]);h.push(1)}var d=Kk(i,o),f=Ek(e,c),m=qC(Tk(s,Uk(r))),v=Ek(Ek(Ek(m,m),m),Uk(-.5));return{x:function(){return Ax(Ek(Ek(e,1===o.rank?kw(Ax(m,[1,1,1,o.shape[0]]),h):m),c),i.shape)},mean:function(){var e=Ek(Ek(m,Uk(-1)),f);return 1===o.rank&&(e=Uw(e,l)),Ax(e,o.shape)},variance:function(){var e=Ek(Ek(v,d),f);return 1===o.rank&&(e=Uw(e,l)),Ax(e,o.shape)},scale:function(){var t=Ek(d,m),n=Ek(e,t);return 1===o.rank&&(n=Uw(n,l)),Ax(n,o.shape)},offset:function(){var t=e;return 1===o.rank&&(t=Uw(t,l)),Ax(t,o.shape)}}}},IT={kernelName:hm,inputsToSave:["x","indices"],gradFunc:function(e,t,n){var r=_slicedToArray(t,2),a=r[0],i=r[1],o=n.axis,s=Id(o,a.shape)[0];return{x:function(){var t=a.shape,n=i.size,r=t.slice(0,s),u=r.length,c=t.slice(o,t.length).slice(1),l=c.length,h=TT(0,u),p=TT(u+1,u+1+l),d=NT([r,[n],c]),f=Ax(e,d),m=Ax(i,[n]),v=NT([[u],h,p]),g=bb(f,v),y=C_(g,m,a.shape[s]),b=Yw(v);return y=bb(y,b)},indices:function(){return i}}}};function TT(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function NT(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var AT={kernelName:fm,inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray(t,2),r=n[0],a=n[1];return{a:function(){return Dk(r)},b:function(){return Dk(a)}}}},ET={kernelName:mm,gradFunc:function(e){return{x:function(){return Xy(e,"float32")}}}},RT={kernelName:ym,gradFunc:function(e){return{x:function(){return Dk(e)}}}},FT={kernelName:bm,gradFunc:function(e){return{x:function(){return Dk(e)}}}},DT={kernelName:km,gradFunc:function(e){return{x:function(){return Dk(e)}}}},OT={kernelName:xm,inputsToSave:["x"],gradFunc:function(e,t,n){var r=_slicedToArray(t,1)[0],a=n.alpha,i=_w(r,0);return{x:function(){return pw(i,e,Ek(e,a))}}}},MT={kernelName:Im,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Ak(e,Tk(n,1))}}}},PT={kernelName:Sm,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Ak(e,Xy(n,"float32"))}}}},LT={kernelName:Em,inputsToSave:[],outputsToSave:[!0],gradFunc:function(e,t,n){var r=_slicedToArray(t,1)[0],a=n.axis;return{logits:function(){var t=gw(r);return Kk(e,Ek(Uw(e,a,!0),t))}}}},zT=Qg({localResponseNormalizationBackprop_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5;return Ug.runKernel(Fm,{x:e,y:t,dy:n},{depthRadius:r,bias:a,alpha:i,beta:o})}}),BT={kernelName:Rm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=_slicedToArray(t,2),a=r[0],i=r[1],o=n.depthRadius,s=n.bias,u=n.alpha,c=n.beta;return{x:function(){return zT(a,i,e,o,s,u,c)}}}};function VT(e,t,n,r){return t.rank<n.rank&&(t=Ax(t,qw(t.shape,r))),e.rank<n.rank&&(e=Ax(e,qw(e.shape,r))),{x:function(){return Ek(e,Xy(hw(n,t),e.dtype))}}}for(var UT,WT={kernelName:Dm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.reductionIndices,a=t[0],i=VT(e,t[1],a,Id(r,a.shape));return{x:function(){return i.x()}}}},GT={kernelName:Om,inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray(t,2),r=n[0],a=n[1];return{a:function(){return Ek(e,Xy(Sw(r,a),"float32"))},b:function(){return Ek(e,Xy(Rw(r,a),"float32"))}}}},HT=Qg({maxPool3dGrad_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0,u=Xg(e,"dy","maxPool3dGrad"),c=Xg(t,"input","maxPool3dGrad"),l=Xg(n,"output","maxPool3dGrad"),h=u,p=c,d=l,f=!1;4===c.rank&&(f=!0,h=Ax(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),p=Ax(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),d=Ax(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),pd(5===h.rank,(function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank "+h.rank+"."})),pd(5===p.rank,(function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank "+p.rank+"."})),pd(5===d.rank,(function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank "+d.rank+"."})),pd(Tx(a,i),(function(){return"Error in maxPool3dGrad: Either strides or dilations must be 1. Got strides ".concat(a," and dilations '").concat(i,"'")})),null!=s&&pd(bd(o),(function(){return"Error in maxPool3dGrad: pad must be an integer when using, dimRoundingMode ".concat(s," but got pad ").concat(o,".")}));var m=Ug.runKernel(zm,{dy:h,input:p,output:d},{filterSize:r,strides:a,dilations:i,pad:o,dimRoundingMode:s});return f?Ax(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}}),jT={kernelName:Lm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=_slicedToArray(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.dilations,c=n.pad,l=n.dimRoundingMode,h=null==u?[1,1,1]:u;return{x:function(){return HT(e,a,i,o,s,h,c,l)}}}},qT=Qg({maxPoolGrad_:function(e,t,n,r,a,i,o){var s=Xg(e,"dy","maxPoolGrad"),u=Xg(t,"input","maxPoolGrad"),c=Xg(n,"output","maxPoolGrad");return pd(u.rank===s.rank,(function(){return"Rank of input (".concat(u.rank,") does not match rank of dy (").concat(s.rank,")")})),pd(4===s.rank,(function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank "+s.rank+"."})),pd(4===u.rank,(function(){return"Error in maxPoolGrad: input must be rank 4 but got rank "+u.rank+"."})),null!=o&&pd(bd(i),(function(){return"Error in maxPoolGrad: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(i,".")})),Ug.runKernel(Pm,{dy:s,input:u,output:c},{filterSize:r,strides:a,pad:i,dimRoundingMode:o})}}),KT={kernelName:tv,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return Ox(e,a,r.shape)}}}},XT={kernelName:Ev,gradFunc:function(e,t,n){var r=n.blockShape,a=n.paddings;return{x:function(){return Lx(e,r,a)}}}},YT={kernelName:Rv,gradFunc:function(e,t,n){var r=n.axis;return{x:function(){return Fx(e,r)}}}},ZT=0,QT=[BI,VI,UI,WI,GI,HI,jI,qI,KI,XI,YI,ZI,JI,eT,tT,nT,rT,aT,iT,oT,sT,uT,lT,cT,pT,dT,fT,mT,vT,gT,{kernelName:Qf,inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray(t,2),r=n[0],a=n[1],i=Jk(r.shape,a.shape);return{a:function(){var t=Ak(e,Xy(a,"float32")),n=Qk(r.shape,i);return n.length>0?Ax(Uw(t,n),r.shape):t},b:function(){var t=Ek(e,Xy(r,"float32")),n=Qk(a.shape,i);n.length>0&&(t=Ax(Uw(t,n),a.shape));var o=Fk(a);return Lw(Ak(t,Xy(o,"float32")))}}}},yT,bT,kT,xT,wT,_T,CT,ST,IT,AT,ET,RT,FT,DT,OT,MT,PT,LT,BT,WT,WT,GT,jT,{kernelName:Mm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=_slicedToArray(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad;return{x:function(){return qT(e,a,i,o,s,u)}}}},{kernelName:Vm,inputsToSave:["x"],gradFunc:function(e,t,n){var r=_slicedToArray(t,1)[0],a=Id(n.axis,r.shape),i=vd(jw(r.shape,a)[1]);return{x:function(){var t=r.shape.slice();a.forEach((function(e){t[e]=1}));var n=Ax(e,t);return Ak(Ek(n,mC(r.shape,"float32")),i)}}}},{kernelName:Um,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.axis,a=_slicedToArray(t,2),i=a[0],o=VT(e,a[1],i,Id(r,i.shape));return{x:function(){return o.x()}}}},{kernelName:Wm,inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray(t,2),r=n[0],a=n[1];return{a:function(){return Ek(e,Xy(Fw(r,a),"float32"))},b:function(){return Ek(e,Xy(_w(r,a),"float32"))}}}},{kernelName:Gm,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return Ox(e,a,r.shape)}}}},{kernelName:Hm,inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray(t,2),r=n[0],a=n[1],i=Jk(r.shape,a.shape);return{a:function(){var t=Qk(r.shape,i);return t.length>0?Ax(Uw(e,t),r.shape):e},b:function(){var t=Ek(e,Lw(ww(Ak(r,a)))),n=Qk(a.shape,i);return n.length>0?Ax(Uw(t,n),a.shape):t}}}},{kernelName:qm,inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray(t,2),r=n[0],a=n[1],i=Jk(r.shape,a.shape);return{a:function(){var t=Ek(e,Xy(a,"float32")),n=Qk(r.shape,i);return n.length>0?Ax(Uw(t,n),r.shape):t},b:function(){var t=Ek(e,Xy(r,"float32")),n=Qk(a.shape,i);return n.length>0?Ax(Uw(t,n),a.shape):t}}}},{kernelName:Km,gradFunc:function(e){return{x:function(){return Lw(e)}}}},{kernelName:$m,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return fC(n.shape,"float32")}}}},{kernelName:Jm,gradFunc:function(e){return{x:function(){return Dk(e)}}}},{kernelName:ev,saveAllInputs:!0,gradFunc:function(e,t,n){var r=n.axis;return __(e,r).map((function(e){return function(){return e}}))}},KT,KT,{kernelName:rv,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(e,t){var n=_slicedToArray(t,3),r=n[0],a=n[1],i=n[2],o=r,s=a,u=Jk(o.shape,s.shape);return{a:function(){var t=Xy(s,"float32"),n=Ek(e,Ek(t,qk(o,Kk(t,Uk(1))))),r=Qk(o.shape,u);return r.length>0&&(n=Uw(n,r)),Ax(n,o.shape)},b:function(){var t=_w(o,0),n=pw(t,Mw(o),Dk(o)),r=Ek(e,Ek(i,n)),a=Qk(s.shape,u);return a.length>0&&(r=Uw(r,a)),Ax(r,s.shape)}}}},{kernelName:av,inputsToSave:["x","alpha"],gradFunc:function(e,t){var n=_slicedToArray(t,2),r=n[0],a=n[1],i=_w(r,0);return{x:function(){return pw(i,e,Ek(e,a))},alpha:function(){var t=pw(i,Dk(e),Ek(e,r)),n=Qk(a.shape,e.shape);return n.length>0&&(t=Uw(t,n)),Ax(t,a.shape)}}}},{kernelName:uv,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Ak(e,Lw(Fk(n)))}}}},{kernelName:mv,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0],r=Ek(Fw(n,6),p_(n));return{x:function(){return Ek(e,Xy(r,"float32"))}}}},{kernelName:cv,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Ek(e,Xy(p_(n),"float32"))}}}},{kernelName:lv,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Ax(e,n.shape)}}}},{kernelName:dv,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:_slicedToArray(t,1)[0]};return{images:function(){return Ug.runKernel(fv,r,n)}}}},{kernelName:hv,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:_slicedToArray(t,1)[0]};return{images:function(){return Ug.runKernel(pv,r,n)}}}},{kernelName:vv,gradFunc:function(e,t,n){var r=Id(n.dims,e.shape);return{x:function(){return VC(e,r)}}}},{kernelName:gv,gradFunc:function(e){return{x:function(){return Dk(e)}}}},{kernelName:yv,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Lw(Ak(e,Ek(qk(n,1.5),2)))}}}},{kernelName:kv,inputsToSave:["condition"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{condition:function(){return Xy(Dk(n),"float32")},t:function(){return Ek(e,Xy(n,e.dtype))},e:function(){return Ek(e,Xy($w(n),e.dtype))}}}},{kernelName:xv,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){var t=_w(n,Uk(0)),r=Uk(dI),a=Uk(fI),i=Ek(e,a),o=Ek(Ek(e,r),gw(Xy(n,"float32")));return pw(t,i,o)}}}},{kernelName:Iv,outputsToSave:[!0],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Ek(e,Ek(n,Kk(Uk(1),n)))}}}},{kernelName:Sv,gradFunc:function(e){return{x:function(){return Dk(e)}}}},{kernelName:Cv,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Ek(rw(Xy(n,"float32")),e)}}}},{kernelName:_v,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Ek(aw(Xy(n,"float32")),e)}}}},{kernelName:wv,inputsToSave:["x"],gradFunc:function(e,t,n){for(var r=_slicedToArray(t,1)[0],a=n.begin,i=n.size,o=r.shape,s=_slicedToArray(Gb(r,a,i),2),u=s[0],c=s[1],l=[],h=0;h<e.rank;h++)l.push([u[h],o[h]-u[h]-c[h]]);return{x:function(){return yC(e,l)}}}},{kernelName:Fv,outputsToSave:[!0],gradFunc:function(e,t,n){var r=_slicedToArray(t,1)[0],a=n.dim,i=Ek(e,r);return{logits:function(){return Kk(i,Ek(Uw(i,[a],!0),r))}}}},{kernelName:Tv,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Ek(e,Dx(n))}}}},XT,XT,YT,YT,{kernelName:Nv,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Ak(e,Ek(Rk(Xy(n,"float32")),2))}}}},{kernelName:Dv,inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray(t,2),r=n[0],a=n[1],i=Uk(2);return{a:function(){return Ek(e,Ek(i,Kk(r,a)))},b:function(){return Ek(e,Ek(i,Kk(a,r)))}}}},{kernelName:Ov,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Ek(e,Ek(Xy(n,"float32"),2))}}}},{kernelName:Kv,gradFunc:function(e){return{x:function(){return Dk(e)}}}},{kernelName:Mv,inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray(t,2),r=n[0],a=n[1],i=Jk(r.shape,a.shape);return{a:function(){var t=e,n=Qk(r.shape,i);return n.length>0&&(t=Uw(t,n)),Ax(t,r.shape)},b:function(){var t=e,n=Qk(a.shape,i);return n.length>0&&(t=Uw(t,n)),Ax(Lw(t),a.shape)}}}},{kernelName:Av,inputsToSave:["x"],gradFunc:function(e,t,n){var r=_slicedToArray(t,1)[0],a=r.shape.slice();Id(n.axis,r.shape).forEach((function(e){a[e]=1}));var i=Ax(e,a),o=Ek(i,mC(r.shape,"float32"));return{x:function(){return o}}}},{kernelName:zv,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Ak(e,Fk(rw(n)))}}}},{kernelName:Bv,outputsToSave:[!0],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Ek(Kk(Uk(1),Fk(n)),e)}}}},{kernelName:Vv,inputsToSave:["x"],gradFunc:function(e,t,n){var r=_slicedToArray(t,1)[0],a=n.reps;return{x:function(){var t=Dk(r);if(1===r.rank)for(var n=0;n<a[0];++n)t=Tk(t,Ox(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(var i=0;i<a[0];++i)for(var o=0;o<a[1];++o)t=Tk(t,Ox(e,[i*r.shape[0],o*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(var s=0;s<a[0];++s)for(var u=0;u<a[1];++u)for(var c=0;c<a[2];++c)t=Tk(t,Ox(e,[s*r.shape[0],u*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(var l=0;l<a[0];++l)for(var h=0;h<a[1];++h)for(var p=0;p<a[2];++p)for(var d=0;d<a[3];++d)t=Tk(t,Ox(e,[l*r.shape[0],h*r.shape[1],p*r.shape[2],d*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},{kernelName:Wv,gradFunc:function(e,t,n){var r=Yw(n.perm);return{x:function(){return bb(e,r)}}}},{kernelName:Hv,gradFunc:function(e,t,n){var r=n.axis;return{value:function(){return h_(e,r)}}}},{kernelName:jv,inputsToSave:["segmentIds"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return function(e,t){for(var n=$k(t,Dk(t)),r=Cw(e,n),a=Sw(t,Uk(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=yw(a,o+1);a=Jw(a,mC(r.shape,"bool"));var s=Dk(r);return pw(a,r,s)}(e,n)}}}},{kernelName:qv,gradFunc:function(e){return{x:function(){return Dk(e)}}}}];ZT<QT.length;ZT++){ig(QT[ZT])}function JT(){return null==UT&&(UT=Sk().epsilon()),UT}_g.prototype.abs=function(){return this.throwIfDisposed(),Yk(this)},_g.prototype.acos=function(){return this.throwIfDisposed(),ax(this)},_g.prototype.acosh=function(){return this.throwIfDisposed(),ix(this)},_g.prototype.addStrict=function(e){return this.throwIfDisposed(),M_(this,e)},_g.prototype.add=function(e){return this.throwIfDisposed(),Tk(this,e)},_g.prototype.all=function(e,t){return this.throwIfDisposed(),sx(this,e,t)},_g.prototype.any=function(e,t){return this.throwIfDisposed(),ux(this,e,t)},_g.prototype.argMax=function(e){return this.throwIfDisposed(),cx(this,e)},_g.prototype.argMin=function(e){return this.throwIfDisposed(),lx(this,e)},_g.prototype.asScalar=function(){return this.throwIfDisposed(),pd(1===this.size,(function(){return"The array must have only 1 element."})),Ax(this,[])},_g.prototype.asType=function(e){return this.throwIfDisposed(),Xy(this,e)},_g.prototype.as1D=function(){return this.throwIfDisposed(),Ax(this,[this.size])},_g.prototype.as2D=function(e,t){return this.throwIfDisposed(),Ax(this,[e,t])},_g.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),Ax(this,[e,t,n])},_g.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),Ax(this,[e,t,n,r])},_g.prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),Ax(this,[e,t,n,r,a])},_g.prototype.asin=function(){return this.throwIfDisposed(),hx(this)},_g.prototype.asinh=function(){return this.throwIfDisposed(),px(this)},_g.prototype.atan=function(){return this.throwIfDisposed(),dx(this)},_g.prototype.atan2=function(e){return this.throwIfDisposed(),fx(this,e)},_g.prototype.atanh=function(){return this.throwIfDisposed(),mx(this)},_g.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),Ex(this,e,t,n,r)},_g.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),Lx(this,e,t)},_g.prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),zx(this,e,t,n,r,a)},_g.prototype.broadcastTo=function(e){return this.throwIfDisposed(),Gx(this,e)},_g.prototype.cast=function(e){return this.throwIfDisposed(),Xy(this,e)},_g.prototype.ceil=function(){return this.throwIfDisposed(),Hx(this)},_g.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),jx(this,e,t)},_g.prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof _g&&(e=[e]),Fx([this].concat(_toConsumableArray(e)),t)},_g.prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Qx(this,e,t,n,r,a,i)},_g.prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),$x(this,e,t,n,r,a)},_g.prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Zx(this,e,t,n,r,a,i)},_g.prototype.cos=function(){return this.throwIfDisposed(),rw(this)},_g.prototype.cosh=function(){return this.throwIfDisposed(),aw(this)},_g.prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),iw(this,e,t,n)},_g.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),sw(this,e,t)},_g.prototype.depthwiseConv2D=function(e,t,n,r,a,i){return ck("depthwiseConv2D is deprecated, use depthwiseConv2d instead"),this.throwIfDisposed(),uw(this,e,t,n,r,a,i)},_g.prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),uw(this,e,t,n,r,a,i)},_g.prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),lw(this,e,t,n,r,a)},_g.prototype.divNoNan=function(e){return this.throwIfDisposed(),dw(this,e)},_g.prototype.divStrict=function(e){return this.throwIfDisposed(),P_(this,e)},_g.prototype.div=function(e){return this.throwIfDisposed(),Ak(this,e)},_g.prototype.dot=function(e){return this.throwIfDisposed(),fw(this,e)},_g.prototype.elu=function(){return this.throwIfDisposed(),mw(this)},_g.prototype.equalStrict=function(e){return this.throwIfDisposed(),A_(this,e)},_g.prototype.equal=function(e){return this.throwIfDisposed(),hw(this,e)},_g.prototype.erf=function(){return this.throwIfDisposed(),vw(this)},_g.prototype.exp=function(){return this.throwIfDisposed(),gw(this)},_g.prototype.expandDims=function(e){return this.throwIfDisposed(),yw(this,e)},_g.prototype.expm1=function(){return this.throwIfDisposed(),bw(this)},_g.prototype.fft=function(){return this.throwIfDisposed(),a_(this)},_g.prototype.flatten=function(){return this.throwIfDisposed(),Ax(this,[this.size])},_g.prototype.floor=function(){return this.throwIfDisposed(),ww(this)},_g.prototype.floorDiv=function(e){return this.throwIfDisposed(),Nk(this,e)},_g.prototype.gather=function(e,t){return this.throwIfDisposed(),Cw(this,e,t)},_g.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),E_(this,e)},_g.prototype.greaterEqual=function(e){return this.throwIfDisposed(),Sw(this,e)},_g.prototype.greaterStrict=function(e){return this.throwIfDisposed(),R_(this,e)},_g.prototype.greater=function(e){return this.throwIfDisposed(),_w(this,e)},_g.prototype.ifft=function(){return this.throwIfDisposed(),i_(this)},_g.prototype.irfft=function(){return this.throwIfDisposed(),o_(this)},_g.prototype.isFinite=function(){return this.throwIfDisposed(),Tw(this)},_g.prototype.isInf=function(){return this.throwIfDisposed(),Nw(this)},_g.prototype.isNaN=function(){return this.throwIfDisposed(),Aw(this)},_g.prototype.leakyRelu=function(e){return this.throwIfDisposed(),Ew(this,e)},_g.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),F_(this,e)},_g.prototype.lessEqual=function(e){return this.throwIfDisposed(),Fw(this,e)},_g.prototype.lessStrict=function(e){return this.throwIfDisposed(),D_(this,e)},_g.prototype.less=function(e){return this.throwIfDisposed(),Rw(this,e)},_g.prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),Ow(this,e,t,n,r)},_g.prototype.logSigmoid=function(){return this.throwIfDisposed(),Bw(this)},_g.prototype.logSoftmax=function(e){return this.throwIfDisposed(),Ww(this,e)},_g.prototype.logSumExp=function(e,t){return this.throwIfDisposed(),Qw(this,e,t)},_g.prototype.log=function(){return this.throwIfDisposed(),Mw(this)},_g.prototype.log1p=function(){return this.throwIfDisposed(),Pw(this)},_g.prototype.logicalAnd=function(e){return this.throwIfDisposed(),Jw(this,e)},_g.prototype.logicalNot=function(){return this.throwIfDisposed(),$w(this)},_g.prototype.logicalOr=function(e){return this.throwIfDisposed(),eC(this,e)},_g.prototype.logicalXor=function(e){return this.throwIfDisposed(),tC(this,e)},_g.prototype.matMul=function(e,t,n){return this.throwIfDisposed(),gb(this,e,t,n)},_g.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),nC(this,e,t,n,r)},_g.prototype.max=function(e,t){return this.throwIfDisposed(),Vw(this,e,t)},_g.prototype.maximumStrict=function(e){return this.throwIfDisposed(),L_(this,e)},_g.prototype.maximum=function(e){return this.throwIfDisposed(),$k(this,e)},_g.prototype.mean=function(e,t){return this.throwIfDisposed(),iC(this,e,t)},_g.prototype.min=function(e,t){return this.throwIfDisposed(),oC(this,e,t)},_g.prototype.minimumStrict=function(e){return this.throwIfDisposed(),z_(this,e)},_g.prototype.minimum=function(e){return this.throwIfDisposed(),sC(this,e)},_g.prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),uC(this,e,t)},_g.prototype.modStrict=function(e){return this.throwIfDisposed(),B_(this,e)},_g.prototype.mod=function(e){return this.throwIfDisposed(),cC(this,e)},_g.prototype.mulStrict=function(e){return this.throwIfDisposed(),V_(this,e)},_g.prototype.mul=function(e){return this.throwIfDisposed(),Ek(this,e)},_g.prototype.neg=function(){return this.throwIfDisposed(),Lw(this)},_g.prototype.norm=function(e,t,n){return this.throwIfDisposed(),H_(this,e,t,n)},_g.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),O_(this,e)},_g.prototype.notEqual=function(e){return this.throwIfDisposed(),dC(this,e)},_g.prototype.oneHot=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),yb(this,e,t,n)},_g.prototype.onesLike=function(){return this.throwIfDisposed(),vC(this)},_g.prototype.pad=function(e,t){return this.throwIfDisposed(),yC(this,e,t)},_g.prototype.pool=function(e,t,n,r,a){return this.throwIfDisposed(),_C(this,e,t,n,r,a)},_g.prototype.powStrict=function(e){return this.throwIfDisposed(),U_(this,e)},_g.prototype.pow=function(e){return this.throwIfDisposed(),qk(this,e)},_g.prototype.prelu=function(e){return this.throwIfDisposed(),SC(this,e)},_g.prototype.prod=function(e,t){return this.throwIfDisposed(),IC(this,e,t)},_g.prototype.reciprocal=function(){return this.throwIfDisposed(),LC(this)},_g.prototype.relu=function(){return this.throwIfDisposed(),zC(this)},_g.prototype.relu6=function(){return this.throwIfDisposed(),BC(this)},_g.prototype.reshapeAs=function(e){return this.throwIfDisposed(),Ax(this,e.shape)},_g.prototype.reshape=function(e){return this.throwIfDisposed(),Ax(this,e)},_g.prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),AS(this,e,t,n)},_g.prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),ES(this,e,t,n)},_g.prototype.reverse=function(e){return this.throwIfDisposed(),VC(this,e)},_g.prototype.rfft=function(){return this.throwIfDisposed(),u_(this)},_g.prototype.round=function(){return this.throwIfDisposed(),jC(this)},_g.prototype.rsqrt=function(){return this.throwIfDisposed(),qC(this)},_g.prototype.selu=function(){return this.throwIfDisposed(),KC(this)},_g.prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),XC(this,e,t,n,r,a,i)},_g.prototype.sigmoid=function(){return this.throwIfDisposed(),Dx(this)},_g.prototype.sign=function(){return this.throwIfDisposed(),ZC(this)},_g.prototype.sin=function(){return this.throwIfDisposed(),QC(this)},_g.prototype.sinh=function(){return this.throwIfDisposed(),JC(this)},_g.prototype.slice=function(e,t){return this.throwIfDisposed(),Ox(this,e,t)},_g.prototype.softmax=function(e){return this.throwIfDisposed(),r_(this,e)},_g.prototype.softplus=function(){return this.throwIfDisposed(),zw(this)},_g.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),CC(this,e,t)},_g.prototype.split=function(e,t){return this.throwIfDisposed(),s_(this,e,t)},_g.prototype.sqrt=function(){return this.throwIfDisposed(),Rk(this)},_g.prototype.square=function(){return this.throwIfDisposed(),Fk(this)},_g.prototype.squaredDifference=function(e){return this.throwIfDisposed(),c_(this,e)},_g.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),W_(this,e)},_g.prototype.squeeze=function(e){return this.throwIfDisposed(),l_(this,e)},_g.prototype.stack=function(e,t){this.throwIfDisposed();var n=e instanceof _g?[this,e]:[this].concat(_toConsumableArray(e));return h_(n,t)},_g.prototype.step=function(e){return this.throwIfDisposed(),p_(this,e)},_g.prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return this.throwIfDisposed(),d_(this,e,t,n,r,a,i,o,s)},_g.prototype.subStrict=function(e){return this.throwIfDisposed(),G_(this,e)},_g.prototype.sub=function(e){return this.throwIfDisposed(),Kk(this,e)},_g.prototype.sum=function(e,t){return this.throwIfDisposed(),Uw(this,e,t)},_g.prototype.tan=function(){return this.throwIfDisposed(),f_(this)},_g.prototype.tanh=function(){return this.throwIfDisposed(),Mx(this)},_g.prototype.tile=function(e){return this.throwIfDisposed(),kw(this,e)},_g.prototype.toBool=function(){return this.throwIfDisposed(),Xy(this,"bool")},_g.prototype.toFloat=function(){return this.throwIfDisposed(),Xy(this,"float32")},_g.prototype.toInt=function(){return this.throwIfDisposed(),Xy(this,"int32")},_g.prototype.topk=function(e,t){return this.throwIfDisposed(),k_(this,e,t)},_g.prototype.transpose=function(e){return this.throwIfDisposed(),bb(this,e)},_g.prototype.unique=function(e){return this.throwIfDisposed(),w_(this,e)},_g.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),C_(this,e,t)},_g.prototype.unstack=function(e){return this.throwIfDisposed(),__(this,e)},_g.prototype.where=function(e,t){return this.throwIfDisposed(),pw(e,this,t)},_g.prototype.zerosLike=function(){return this.throwIfDisposed(),Dk(this)};var $T=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),r=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(r),n.prototype),r}return n}(),eN=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),r=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(r),n.prototype),r}return n}(),tN=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),r=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(r),n.prototype),r}return n}(),nN=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),r=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(r),n.prototype),r}return n}(),rN=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),r=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(r),n.prototype),r}return n}();function aN(e,t){if(Array.isArray(e)){for(var n=[],r=0;r<t;r++)n=n.concat(e);return n}var a=new Array(t);return a.fill(e),a}function iN(e,t){if(!e)throw new rN(t)}function oN(e,t){var n,r=0,a=_createForOfIteratorHelper(e);try{for(a.s();!(n=a.n()).done;){n.value===t&&r++}}catch(UY){a.e(UY)}finally{a.f()}return r}function sN(e){return 1===e.length?e[0]:e}function uN(e){return Array.isArray(e)?e:[e]}function cN(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function lN(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(function(e,t){return t.toUpperCase()}))}Error;var hN={};function pN(e){if(null==e)return null;var t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function dN(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"==typeof e){var i,o=e;if(o in n)i=n[o];else if(o in hN)i=hN[o];else if(null==(i=t[o]))throw new tN("Unknown ".concat(r,": ").concat(e,". This may be due to one of the following reasons:\n1. The ").concat(r," is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ").concat(r," is defined in JavaScript, but is not registered properly with tf.serialization.registerClass()."));return i}var s,u,c,l=e;if(null==l.className||null==l.config)throw new tN(r+": Improper config format: "+JSON.stringify(l)+".\n'className' and 'config' must set.");var h,p,d=l.className;if(d in n?(h=(s=_slicedToArray(n[d],2))[0],p=s[1]):d in hN?(h=(u=_slicedToArray(hN.className,2))[0],p=u[1]):d in t&&(h=(c=_slicedToArray(t[d],2))[0],p=c[1]),null==h)throw new tN("Unknown ".concat(r,": ").concat(d,". This may be due to one of the following reasons:\n1. The ").concat(r," is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ").concat(r," is defined in JavaScript, but is not registered properly with tf.serialization.registerClass()."));if(null!=p){for(var f={},m=0,v=Object.keys(hN);m<v.length;m++){var g=v[m];f[g]=hN[g]}for(var y=0,b=Object.keys(n);y<b.length;y++){var k=b[y];f[k]=n[k]}l.config.customObjects=f;for(var x=Object.assign({},hN),w=0,C=Object.keys(n);w<C.length;w++){var _=C[w];hN[_]=n[_]}!function e(t){if(null!=t&&"object"==typeof t)if(Array.isArray(t))t.forEach((function(t){return e(t)}));else for(var n=0,r=Object.keys(t);n<r.length;n++){var a=r[n],i=t[a];null!=i&&"object"==typeof i&&(Array.isArray(i)||"ndarray"!==i.type||"number"!=typeof i.value?e(i):t[a]=i.value)}}(l.config);var S=p(h,l.config,n,a);return hN=Object.assign({},x),S}for(var I=Object.assign({},hN),T=0,N=Object.keys(n);T<N.length;T++){var A=N[T];hN[A]=n[A]}var E=new h(l.config);return hN=Object.assign({},I),E}function fN(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function mN(e){if(null==e)return e;var t,n=[],r=_createForOfIteratorHelper(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;-1===n.indexOf(a)&&n.push(a)}}catch(UY){r.e(UY)}finally{r.f()}return n}function vN(e){if(null==e)throw new tN("Invalid value in obj: "+JSON.stringify(e));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function gN(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new tN("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function yN(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return iN(n>=0),iN(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((function(e){return typeof e===t}))}function bN(e,t){Array.isArray(e)?(r.assert(e.length>0,(function(){return t+" is unexpectedly an empty array."})),e.forEach((function(e,n){return bN(e,"element ".concat(n+1," of ").concat(t))}))):r.assert(Number.isInteger(e)&&e>0,(function(){return"Expected ".concat(t," to be a positive integer, but got ")+function e(t){return null===t?"null":Array.isArray(t)?"["+t.map((function(t){return e(t)})).join(",")+"]":"string"==typeof t?'"'.concat(t,'"'):""+t}(e)+"."}))}function kN(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}function xN(e,t){return fk((function(){return Rk(Uw(Ek(e,e),t,!0))}))}var wN=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"getConfig",value:function(){return{}}}]),n}(p.Serializable),CN=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this)).defaultMaxValue=2,r.defaultAxis=0,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return _createClass(n,[{key:"apply",value:function(e){var t=this;return fk((function(){var n=xN(e,t.axis),r=jx(n,0,t.maxValue);return Ek(e,Ak(r,Tk(JT(),n)))}))}},{key:"getConfig",value:function(){return{maxValue:this.maxValue,axis:this.axis}}}]),n}(wN);CN.className="MaxNorm",p.registerClass(CN);var _N=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this)).defaultAxis=0,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return _createClass(n,[{key:"apply",value:function(e){var t=this;return fk((function(){return Ak(e,Tk(JT(),xN(e,t.axis)))}))}},{key:"getConfig",value:function(){return{axis:this.axis}}}]),n}(wN);_N.className="UnitNorm",p.registerClass(_N);var SN=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){return zC(e)}}]),n}(wN);SN.className="NonNeg",p.registerClass(SN);var IN=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this)).defaultMinValue=0,r.defaultMaxValue=1,r.defaultRate=1,r.defaultAxis=0,r.minValue=null!=e.minValue?e.minValue:r.defaultMinValue,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.rate=null!=e.rate?e.rate:r.defaultRate,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return _createClass(n,[{key:"apply",value:function(e){var t=this;return fk((function(){var n=xN(e,t.axis),r=Tk(Ek(t.rate,jx(n,t.minValue,t.maxValue)),Ek(1-t.rate,n));return Ek(e,Ak(r,Tk(JT(),n)))}))}},{key:"getConfig",value:function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}]),n}(wN);IN.className="MinMaxNorm",p.registerClass(IN);var TN={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function NN(e){return pN(e)}function AN(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return dN(e,p.SerializationMap.getMap().classNameMap,t,"constraint")}function EN(e){return null==e?null:"string"==typeof e?AN({className:e in TN?TN[e]:e,config:{}}):e instanceof wN?e:AN(e)}var RN=["channelsFirst","channelsLast"],FN=["nearest","bilinear"],DN=["valid","same","causal"],ON=["max","avg"],MN=["sum","mul","concat","ave"],PN=new Map;function LN(e){gN(RN,"DataFormat",e)}function zN(e){gN(DN,"PaddingMode",e)}function BN(e){gN(ON,"PoolMode",e)}var VN=[];function UN(e,t){VN.push(e);try{var n=t();return VN.pop(),n}catch(r){throw VN.pop(),r}}function WN(e){if(!jN(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===VN.length?"":VN.join("/")+"/")+e}function GN(e){if(!jN(e))throw new Error("Not a valid tensor name: '"+e+"'");PN.has(e)||PN.set(e,0);var t=PN.get(e);if(PN.set(e,PN.get(e)+1),t>0){var n="".concat(e,"_").concat(t);return PN.set(n,1),n}return e}var HN=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function jN(e){return!!e.match(HN)}function qN(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var r=1,a=t;a<n;++a)r*=e[a];return r}function KN(e){return m_(e=Array.isArray(e)?new Float32Array(e):e)}function XN(e){return oC(KN(e)).dataSync()[0]}function YN(e){return Vw(KN(e)).dataSync()[0]}function ZN(e,t){if(t<e)throw new tN("end (".concat(t,") < begin (").concat(e,") is forbidden."));for(var n=[],r=e;r<t;++r)n.push(r);return n}function QN(e,t){return e.asType(t)}function JN(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),e.reshape(n)}function $N(e,t,n){return fk((function(){switch(e.rank){case 1:return $C(e,t,n);case 2:return e_(e,[t,0],[n,e.shape[1]]);case 3:return t_(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return n_(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return Ox(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return Ox(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new tN("sliceAlongFirstAxis() received an unsupported tensor rank: "+e.rank)}}))}function eA(e,t,n){return fk((function(){switch(e.rank){case 1:return $C(e,t,n);case 2:return e_(e,[0,t],[e.shape[0],n]);case 3:return t_(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return n_(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new tN("sliceAlongLastAxis() received an unsupported tensor rank: "+e.rank)}}))}function tA(e,t,n,r){return fk((function(){switch(e.rank){case 1:return $C(e,t,n);case 2:switch(r){case 1:return $N(e,t,n);case 2:return eA(e,t,n);default:throw new tN("The axis is not within the rank of the tensor "+r)}case 3:switch(r){case 1:return $N(e,t,n);case 2:return t_(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return eA(e,t,n);default:throw new tN("The axis is not within the rank of the tensor "+r)}case 4:switch(r){case 1:return $N(e,t,n);case 2:return n_(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return n_(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return eA(e,t,n);default:throw new tN("The axis is not within the rank of the tensor "+r)}default:throw new tN("sliceAlongLastAxis() received an unsupported tensor rank: "+e.rank)}}))}function nA(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(n=0!==(t=e[0].rank)?t:0),n===e[0].rank&&(n=-1),Fx(e,n)}function rA(e,t){switch(e.rank){case 1:return qx([e,t]);case 2:return Kx([e,t],0);case 3:return Xx([e,t],0);case 4:return Yx([e,t],0);default:throw new tN("concatAlongFirstAxis() received an unsupported tensor rank: "+e.rank)}}function aA(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new tN("The length of input n (".concat(t.length,") does not match the number of dimensions in input x (").concat(e.rank,")"));return kw(e,t)}function iA(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return DC(e,t,n,r,a)}function oA(e,t,n,r){if(e.rank<2||t.rank<2)throw new nN("dot requires both inputs to be rank >= 2 but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3&&e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new nN("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ".concat(e.shape," and  y shape = ")+t.shape);if(2===e.rank&&2===t.rank)return f.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?cA(e.rank,r,"channelsLast"):null,activation:n});var a=e.shape.slice(),i=a.pop();e=e.reshape([-1,i]);var o=t.shape.slice(),s=o.pop(),u=o.pop(),c=[].concat(_toConsumableArray(o),[s]),l=Array.from({length:t.rank},(function(e,n){return 0===n?t.rank-2:n<=t.rank-2?n-1:n}));t=t.transpose(l).reshape([u,-1]);var h=[].concat(_toConsumableArray(a),_toConsumableArray(c));return f.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?cA(e.rank,r,"channelsLast"):null,activation:n}).reshape(h)}function sA(e,t,n){return fk((function(){return t=Array.isArray(t)?m_(t,"int32"):t.toInt(),Cw(e,t,n)}))}function uA(e){return Ek(e,e)}function cA(e,t,n){var r=t.shape;if(1!==t.rank&&t.rank!==e)throw new tN("Unexpected bias dimensions: "+t.rank+"; expected it to be 1 or "+e);if(5===e){if("channelsFirst"===n)return t.reshape(1===r.length?[1,r[0],1,1,1]:[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return t.reshape(1===r.length?[1,1,1,1,r[0]]:[1].concat(r))}else if(4===e){if("channelsFirst"===n)return t.reshape(1===r.length?[1,r[0],1,1]:[1,r[2],r[0],r[1]]);if("channelsLast"===n)return t.reshape(1===r.length?[1,1,1,r[0]]:[1].concat(r))}else if(3===e){if("channelsFirst"===n)return t.reshape(1===r.length?[1,r[0],1]:[1,r[1],r[0]]);if("channelsLast"===n)return t.reshape(1===r.length?[1,1,r[0]]:[1].concat(r))}else if(e<3)return t;throw new tN("Unsupported input rank by biasAdd: "+t.rank)}function lA(e,t,n){return fk((function(){return null==n&&(n="channelsLast"),LN(n),e.add(cA(e.rank,t,n))}))}function hA(e,t,n,r){return fk((function(){return Y_(e,t,n,r)}))}function pA(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n?e():t()}var dA=["fanIn","fanOut","fanAvg"],fA=["normal","uniform","truncatedNormal"],mA=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"fromConfigUsesCustomObjects",value:function(){return!1}},{key:"getConfig",value:function(){return{}}}]),n}(p.Serializable),vA=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e,t){return fC(e,t)}}]),n}(mA);vA.className="Zeros",p.registerClass(vA);var gA=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e,t){return mC(e,t)}}]),n}(mA);gA.className="Ones",p.registerClass(gA);var yA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),r=t.call(this),"object"!=typeof e)throw new tN("Expected argument of type ConstantConfig but got "+e);if(void 0===e.value)throw new tN("config must have value set but got "+e);return r.value=e.value,_possibleConstructorReturn(r)}return _createClass(n,[{key:"apply",value:function(e,t){var n=this;return fk((function(){return Ek(Uk(n.value),mC(e,t))}))}},{key:"getConfig",value:function(){return{value:this.value}}}]),n}(mA);yA.className="Constant",p.registerClass(yA);var bA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this)).DEFAULT_MINVAL=-.05,r.DEFAULT_MAXVAL=.05,r.minval=e.minval||r.DEFAULT_MINVAL,r.maxval=e.maxval||r.DEFAULT_MAXVAL,r.seed=e.seed,r}return _createClass(n,[{key:"apply",value:function(e,t){return OC(e,this.minval,this.maxval,t)}},{key:"getConfig",value:function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}]),n}(mA);bA.className="RandomUniform",p.registerClass(bA);var kA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return _createClass(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new nN("randomNormal does not support dType ".concat(t,"."));return iA(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(mA);kA.className="RandomNormal",p.registerClass(kA);var xA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return _createClass(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new nN("truncatedNormal does not support dType ".concat(t,"."));return x_(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(mA);xA.className="TruncatedNormal",p.registerClass(xA);var wA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this)).gain=null!=e.gain?e.gain:1,r}return _createClass(n,[{key:"apply",value:function(e,t){var n=this;return fk((function(){if(2!==e.length||e[0]!==e[1])throw new tN("Identity matrix initializer can only be used for 2D square matrices.");return Ek(n.gain,xw(e[0]))}))}},{key:"getConfig",value:function(){return{gain:this.gain}}}]),n}(mA);wA.className="Identity",p.registerClass(wA);var CA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r,a;if(_classCallCheck(this,n),r=t.call(this),e.scale<0)throw new tN("scale must be a positive float. Got: "+e.scale);return r.scale=null==e.scale?1:e.scale,r.mode=null==e.mode?"fanIn":e.mode,gN(dA,"FanMode",r.mode),r.distribution=null==e.distribution?"normal":e.distribution,a=r.distribution,gN(fA,"Distribution",a),r.seed=e.seed,_possibleConstructorReturn(r)}return _createClass(n,[{key:"apply",value:function(e,t){var n=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if(LN(r),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===r){var a=qN(e,2);t=e[1]*a,n=e[0]*a}else if("channelsLast"===r){var i=qN(e,0,e.length-2);t=e[e.length-2]*i,n=e[e.length-1]*i}}else{var o=qN(e);t=Math.sqrt(o),n=Math.sqrt(o)}return[t,n]}(e),r=n[0],a=n[1],i=this.scale;if(i/="fanIn"===this.mode?Math.max(1,r):"fanOut"===this.mode?Math.max(1,a):Math.max(1,(r+a)/2),"normal"===this.distribution){var o=Math.sqrt(i);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new nN("".concat(this.getClassName()," does not support dType ").concat(t,"."));return x_(e,0,o,t,this.seed)}var s=Math.sqrt(3*i);return OC(e,-s,s,t)}},{key:"getConfig",value:function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}]),n}(mA);CA.className="VarianceScaling",p.registerClass(CA);var _A=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}return _createClass(n,[{key:"getClassName",value:function(){return CA.className}}]),n}(CA);_A.className="GlorotUniform",p.registerClass(_A);var SA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}return _createClass(n,[{key:"getClassName",value:function(){return CA.className}}]),n}(CA);SA.className="GlorotNormal",p.registerClass(SA);var IA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return _createClass(n,[{key:"getClassName",value:function(){return CA.className}}]),n}(CA);IA.className="HeNormal",p.registerClass(IA);var TA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return _createClass(n,[{key:"getClassName",value:function(){return CA.className}}]),n}(CA);TA.className="HeUniform",p.registerClass(TA);var NA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return _createClass(n,[{key:"getClassName",value:function(){return CA.className}}]),n}(CA);NA.className="LeCunNormal",p.registerClass(NA);var AA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return _createClass(n,[{key:"getClassName",value:function(){return CA.className}}]),n}(CA);AA.className="LeCunNormal",p.registerClass(AA);var EA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),(r=t.call(this)).DEFAULT_GAIN=1,r.gain=null==e.gain?r.DEFAULT_GAIN:e.gain,r.seed=e.seed,null!=r.seed)throw new nN("Random seed is not implemented for Orthogonal Initializer yet.");return _possibleConstructorReturn(r)}return _createClass(n,[{key:"apply",value:function(e,t){var n=this;return fk((function(){if(e.length<2)throw new nN("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 (".concat(e[0]*e[1],") elements: Slowness may result."));var t=iA(e[0]>e[1]?[e[1],e[0]]:e,0,1,"float32"),r=QS.gramSchmidt(t);return e[0]>e[1]&&(r=r.transpose()),Ek(n.gain,r)}))}},{key:"getConfig",value:function(){return{gain:this.gain,seed:this.seed}}}]),n}(mA);EA.className="Orthogonal",p.registerClass(EA);var RA={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function FA(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return dN(e,p.SerializationMap.getMap().classNameMap,t,"initializer")}function DA(e){return pN(e)}function OA(e){if("string"==typeof e){var t=e in RA?RA[e]:e;if("GlorotNormal"===t)return new SA;if("GlorotUniform"===t)return new _A;if("HeNormal"===t)return new IA;if("HeUniform"===t)return new TA;if("LeCunNormal"===t)return new NA;if("LeCunUniform"===t)return new AA;var n={};return n.className=t,n.config={},FA(n)}return e instanceof mA?e:FA(e)}var MA=0;function PA(){return MA++}var LA={};function zA(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in LA||(LA[e]=0),LA[e]+=1,e+LA[e].toString()}function BA(e){return Array.isArray(e)&&Array.isArray(e[0])}function VA(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function UA(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new tN("Expected Tensor length to be 1; got "+e.length);t=e[0]}else t=e;return t}function WA(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return(e=e)[0];throw new tN("Expected exactly 1 Shape; got "+e.length)}return e}function GA(e){var t,n=0,r=_createForOfIteratorHelper(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n+=0===a.shape.length?1:a.shape.reduce((function(e,t){return e*t}))}}catch(UY){r.e(UY)}finally{r.f()}return n}var HA=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Variable",a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;_classCallCheck(this,e),this.dtype=null==n?"float32":n,this.shape=t.shape,this.id=PA(),this.originalName=WN(r=null==r?"Variable":r),this.name=GN(this.originalName),this.trainable_=a,this.constraint=i,this.val=S_(t,this.trainable_,this.name,this.dtype)}return _createClass(e,[{key:"read",value:function(){return this.assertNotDisposed(),this.val}},{key:"write",value:function(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}},{key:"dispose",value:function(){this.assertNotDisposed(),this.val.dispose()}},{key:"assertNotDisposed",value:function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e}}]),e}();function jA(e){return e.map((function(e){return e.read()}))}function qA(e){e.forEach((function(e){e[0].write(e[1])}))}var KA,XA=function e(t){_classCallCheck(this,e),this.dtype=t.dtype,this.shape=t.shape,this.ndim=null!=t.shape?t.shape.length:t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}},YA=function e(t,n,r,a,i,o,s){_classCallCheck(this,e),this.dtype=t,this.shape=n,this.sourceLayer=r,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=PA(),null!=o&&(this.originalName=WN(o),this.name=GN(this.originalName)),this.rank=n.length},ZA=0,QA=function(){function e(t,n){_classCallCheck(this,e),this.callArgs=n,this.id=ZA++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;var r,a=_createForOfIteratorHelper(t.inboundLayers);try{for(a.s();!(r=a.n()).done;){var i=r.value;null!=i&&i.outboundNodes.push(this)}}catch(UY){a.e(UY)}finally{a.f()}t.outboundLayer.inboundNodes.push(this)}return _createClass(e,[{key:"getConfig",value:function(){var e,t=[],n=_createForOfIteratorHelper(this.inboundLayers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push(null!=r?r.name:null)}}catch(UY){n.e(UY)}finally{n.f()}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}]),e}(),JA=0,$A=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,n),(e=t.call(this))._callHook=null,e._addedWeightNames=[],e._stateful=!1,e.id=JA++,e.activityRegularizer=null,e.inputSpec=null,e.supportsMasking=!1,e._trainableWeights=[],e._nonTrainableWeights=[],e._losses=[],e._updates=[],e._built=!1,e.inboundNodes=[],e.outboundNodes=[];var a=r.name;if(!a){var i=e.getClassName();a=cN(i)+"_"+zA(i)}if(e.name=a,e.trainable_=null==r.trainable||r.trainable,null!=r.inputShape||null!=r.batchInputShape){var o;if(null!=r.batchInputShape)o=r.batchInputShape;else if(null!=r.inputShape){var s=null;null!=r.batchSize&&(s=r.batchSize),o=[s].concat(r.inputShape)}e.batchInputShape=o;var u=r.dtype;null==u&&(u=r.inputDType),null==u&&(u="float32"),e.dtype=u}return e.initialWeights=null!=r.weights?r.weights:null,e._refCount=null,e.fastWeightInitDuringBuild=!1,e}return _createClass(n,[{key:"getNodeAtIndex",value:function(e,t){if(0===this.inboundNodes.length)throw new eN("The layer has never been called and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new tN("Asked to get ".concat(t," at node ").concat(e,", but the layer has only ").concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}},{key:"getInputAt",value:function(e){return sN(this.getNodeAtIndex(e,"input").inputTensors)}},{key:"getOutputAt",value:function(e){return sN(this.getNodeAtIndex(e,"output").outputTensors)}},{key:"calculateLosses",value:function(){return this.losses.map((function(e){return e()}))}},{key:"resetStates",value:function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}},{key:"assertInputCompatibility",value:function(e){if(e=uN(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=uN(this.inputSpec);if(e.length!==t.length)throw new tN("Layer ".concat(this.name," expects ").concat(t.length," inputs, but it received ").concat(e.length," input tensors. Input received: ")+e);for(var n=0;n<e.length;n++){var r=e[n],a=t[n];if(null!=a){var i=r.rank;if(null!=a.ndim&&i!==a.ndim)throw new tN("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected ndim=").concat(a.ndim,", found ndim=").concat(i));if(null!=a.maxNDim&&i>a.maxNDim)throw new tN("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected max_ndim=").concat(a.maxNDim,", found ndim=").concat(i));if(null!=a.minNDim&&i<a.minNDim)throw new tN("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected min_ndim=").concat(a.minNDim,", found ndim=").concat(i,"."));if(null!=a.dtype&&r.dtype!==a.dtype)throw new tN("Input ".concat(n," is incompatible with layer ").concat(this.name," : expected dtype=").concat(a.dtype,", found dtype=").concat(r.dtype,"."));if(a.axes){var o=r.shape;for(var s in a.axes){var u=Number(s),c=a.axes[s],l=u>=0?o[u]:o[o.length+u];if(null!=c&&-1===[c,null].indexOf(l))throw new tN("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected axis ").concat(u," of input shape to have value ").concat(c," but got shape ").concat(o,"."))}}if(null!=a.shape)for(var h=0;h<a.shape.length;++h){var p=a.shape[h],d=r.shape[h];if(null!=p&&null!=d&&p!==d)throw new tN("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected shape=").concat(a.shape,", found shape=").concat(r.shape,"."))}}}}}},{key:"call",value:function(e,t){return e}},{key:"invokeCallHook",value:function(e,t){null!=this._callHook&&this._callHook(e,t)}},{key:"setCallHook",value:function(e){this._callHook=e}},{key:"clearCallHook",value:function(){this._callHook=null}},{key:"apply",value:function(e,t){var n=this;t=t||{},this.assertNotDisposed();var r,a=uN(e),i=!0,o=_createForOfIteratorHelper(a);try{for(o.s();!(r=o.n()).done;){if(!(r.value instanceof YA)){i=!1;break}}}catch(UY){o.e(UY)}finally{o.f()}var s,u=!0,c=_createForOfIteratorHelper(a);try{for(c.s();!(s=c.n()).done;){if(s.value instanceof YA){u=!1;break}}}catch(UY){c.e(UY)}finally{c.f()}if(i===u)throw new tN("Arguments to apply() must be all SymbolicTensors or all Tensors");return UN(this.name,(function(){if(!n.built){n.assertInputCompatibility(e);var r,i=[],o=_createForOfIteratorHelper(uN(e));try{for(o.s();!(r=o.n()).done;){var s=r.value;i.push(s.shape)}}catch(UY){o.e(UY)}finally{o.f()}n.build(sN(i)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&u&&(n._refCount=1)}if(n.assertInputCompatibility(e),u){var c,l=n.call(e,t),h=[],p=_createForOfIteratorHelper(uN(l));try{for(p.s();!(c=p.n()).done;){var d=c.value;-1!==a.indexOf(d)&&(d=d.clone()),h.push(d)}}catch(UY){p.e(UY)}finally{p.f()}if(l=sN(h),null!=n.activityRegularizer)throw new nN("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}var f,m=function(e){var t,n=[],r=_createForOfIteratorHelper(e=uN(e));try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(a.shape)}}catch(UY){r.e(UY)}finally{r.f()}return sN(n)}(e),v=n.computeOutputShape(m);if(n.warnOnIncompatibleInputShape(Array.isArray(e)?m[0]:m),f=null!=v&&v.length>0&&Array.isArray(v[0])?v.map((function(r,a){return new YA("float32",r,n,uN(e),t,n.name,a)})):new YA("float32",v,n,uN(e),t,n.name),n.addInboundNode(e,f,null,null,m,v,t),n._refCount++,null!=n.activityRegularizer)throw new nN("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return f}))}},{key:"warnOnIncompatibleInputShape",value:function(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+JSON.stringify(e)+") does not match that of the "+"batchInputShape (".concat(JSON.stringify(this.batchInputShape),") of the layer ")+this.name);else{var t=!1;this.batchInputShape.forEach((function(n,r){null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn("The shape of the input tensor (".concat(JSON.stringify(e),") does not match the expectation of layer ").concat(this.name,": ")+JSON.stringify(this.batchInputShape))}}},{key:"countParams",value:function(){if(!this.built)throw new eN("You tried to call countParams() on ".concat(this.name,", but the layer is not built yet. Build it first by calling build(batchInputShape)."));return GA(this.weights)}},{key:"build",value:function(e){this.built=!0}},{key:"getWeights",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return jA(e?this.trainableWeights:this.weights)}},{key:"setWeights",value:function(e){var t=this;fk((function(){var n=t.weights;if(n.length!==e.length)throw new tN('You called setWeights(weights) on layer "'.concat(t.name,'" with a weight list of length ').concat(e.length,", but the layer was expecting ").concat(n.length," weights. Provided weights: ").concat(e,"..."));if(0!==n.length){for(var a=[],i=jA(n),o=0;o<i.length;++o){var s=i[o],u=n[o],c=e[o];if(!r.arraysEqual(s.shape,c.shape))throw new tN("Layer weight shape ".concat(s.shape," not compatible with provided weight shape ")+c.shape);a.push([u,c])}qA(a)}}))}},{key:"addWeight",value:function(e,t,n,r,a,i,o){if(-1!==this._addedWeightNames.indexOf(e))throw new tN("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=OA("zeros"));var s=r.apply(t,n),u=new HA(s,n,e,i,o);return s.dispose(),null!=a&&this.addLoss((function(){return a.apply(u.read())})),null==i&&(i=!0),i?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}},{key:"setFastWeightInitDuringBuild",value:function(e){this.fastWeightInitDuringBuild=e}},{key:"addLoss",value:function(e){var t;null==e||Array.isArray(e)&&0===e.length||(e=uN(e),null!=this._losses&&(t=this.losses).push.apply(t,_toConsumableArray(e)))}},{key:"computeOutputShape",value:function(e){return e}},{key:"computeMask",value:function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, but was passed an inputMask."));t.forEach((function(e){if(null!=e)throw new TypeError("Layer ".concat(n.name," does not support masking, but was passed an inputMask."))}))}return null}return t}},{key:"addInboundNode",value:function(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=uN(e);t=uN(t),n=uN(n),r=uN(r),a=VA(a),i=VA(i);var u,c=[],l=[],h=[],p=_createForOfIteratorHelper(s);try{for(p.s();!(u=p.n()).done;){var d=u.value;c.push(d.sourceLayer),l.push(d.nodeIndex),h.push(d.tensorIndex)}}catch(UY){p.e(UY)}finally{p.f()}new QA({outboundLayer:this,inboundLayers:c,nodeIndices:l,tensorIndices:h,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:i},o);for(var f=0;f<t.length;f++)t[f].sourceLayer=this,t[f].nodeIndex=this.inboundNodes.length-1,t[f].tensorIndex=f}},{key:"getConfig",value:function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}},{key:"disposeWeights",value:function(){return this.weights.forEach((function(e){return e.dispose()})),this.weights.length}},{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been built yet."));if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used yet."));this.assertNotDisposed();var e=0;return 0==--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}},{key:"input",get:function(){if(this.inboundNodes.length>1)throw new $T("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new $T("Layer "+this.name+" is not connected, no input to return.");return sN(this.getNodeAtIndex(0,"input").inputTensors)}},{key:"output",get:function(){if(0===this.inboundNodes.length)throw new $T("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new $T("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return sN(this.getNodeAtIndex(0,"output").outputTensors)}},{key:"losses",get:function(){return this._losses}},{key:"updates",get:function(){return this._updates}},{key:"built",get:function(){return this._built},set:function(e){this._built=e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this._trainableWeights.forEach((function(t){return t.trainable=e})),this.trainable_=e}},{key:"trainableWeights",get:function(){return this.trainable_?this._trainableWeights.filter((function(e){return e.trainable})):[]},set:function(e){this._trainableWeights=e}},{key:"nonTrainableWeights",get:function(){return this.trainable?this._trainableWeights.filter((function(e){return!e.trainable})).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"stateful",get:function(){return this._stateful}},{key:"outputShape",get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new $T("The layer ".concat(this.name," has never been called and thus has no defined output shape."));var e,t=[],n=_createForOfIteratorHelper(this.inboundNodes);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=JSON.stringify(r.outputShapes);-1===t.indexOf(a)&&t.push(a)}}catch(UY){n.e(UY)}finally{n.f()}if(1===t.length){var i=this.inboundNodes[0].outputShapes;return Array.isArray(i)&&Array.isArray(i[0])&&1===i.length?i[0]:i}throw new $T("The layer ".concat(this.name,' has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.'))}}],[{key:"nodeKey",value:function(e,t){return e.name+"_ib-"+t.toString()}}]),n}(p.Serializable),eE=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),r=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:zA("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),r.trainable=!1,r.built=!0,r.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new tN("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=e.batchInputShape;if(null==a){if(null==e.inputShape)throw new tN("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new tN("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=e.dtype||"float32";r.batchInputShape=a,r.dtype=i,r.inputSpec=[{shape:a}];var o=new YA(r.dtype,r.batchInputShape,_assertThisInitialized(r),[],{},r.name);return o.nodeIndex=0,o.tensorIndex=0,new QA({outboundLayer:_assertThisInitialized(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),_possibleConstructorReturn(r)}return _createClass(n,[{key:"apply",value:function(e,t){throw new tN("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)}},{key:"dispose",value:function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}},{key:"getConfig",value:function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}]),n}($A);function tE(e){return nE.apply(this,arguments)}function nE(){return(nE=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i,o,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return");case 2:for(i in n=[],r=[],a=[],t)"number"!=typeof(o=t[i])&&(s=o,n.push(s.data()),r.push(i),a.push(s));if(!(n.length>0)){e.next=10;break}return e.next=7,Promise.all(n);case 7:for(u=e.sent,c=0;c<u.length;++c)t[r[c]]=u[c][0];mk(a);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rE(e){if(null!=e)for(var t in e){var n=e[t];"number"!=typeof n&&n.dispose()}}eE.className="InputLayer",p.registerClass(eE),function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(KA||(KA={}));var aE=function(){function e(){_classCallCheck(this,e),this.validationData=null}var t,n,r,a,i,o;return _createClass(e,[{key:"setParams",value:function(e){this.params=e}},{key:"onEpochBegin",value:(o=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e,t){return o.apply(this,arguments)})},{key:"onEpochEnd",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"onBatchBegin",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e,t){return a.apply(this,arguments)})},{key:"onBatchEnd",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"onTrainBegin",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"onTrainEnd",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"setModel",value:function(e){}}]),e}(),iE=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;_classCallCheck(this,e),null==t&&(t=[]),this.callbacks=t,this.queueLength=n}var t,n,r,a,i,o;return _createClass(e,[{key:"append",value:function(e){this.callbacks.push(e)}},{key:"setParams",value:function(e){var t,n=_createForOfIteratorHelper(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setParams(e)}}catch(UY){n.e(UY)}finally{n.f()}}},{key:"setModel",value:function(e){var t,n=_createForOfIteratorHelper(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setModel(e)}}catch(UY){n.e(UY)}finally{n.f()}}},{key:"onEpochBegin",value:(o=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=_createForOfIteratorHelper(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))),function(e,t){return o.apply(this,arguments)})},{key:"onEpochEnd",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=_createForOfIteratorHelper(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))),function(e,t){return i.apply(this,arguments)})},{key:"onBatchBegin",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=_createForOfIteratorHelper(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))),function(e,t){return a.apply(this,arguments)})},{key:"onBatchEnd",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=_createForOfIteratorHelper(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))),function(e,t){return r.apply(this,arguments)})},{key:"onTrainBegin",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=_createForOfIteratorHelper(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainBegin(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))),function(e){return n.apply(this,arguments)})},{key:"onTrainEnd",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=_createForOfIteratorHelper(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainEnd(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))),function(e){return t.apply(this,arguments)})}]),e}(),oE=function(e){_inherits(i,e);var t,n,r,a=_createSuper(i);function i(){return _classCallCheck(this,i),a.call(this)}return _createClass(i,[{key:"onEpochBegin",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.seen=0,this.totals={};case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"onBatchEnd",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i in null==n&&(n={}),r=null==n.size?0:n.size,this.seen+=r,a=function(e){var t=n[e];if("number"==typeof t)o.totals.hasOwnProperty(e)||(o.totals[e]=0),o.totals[e]=o.totals[e]+t*r;else{var a;e in o.totals?a=o.totals[e]:o.totals[e]=0;var i=fk((function(){return Tk(o.totals[e],Ek(t,r))}));o.totals[e]=i,null!=a&&a.dispose()}},n)a(i);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"onEpochEnd",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n){r=_createForOfIteratorHelper(this.params.metrics);try{for(i=function(){var e=a.value;null!=o.totals[e]&&("number"==typeof o.totals[e]?n[e]=o.totals[e]/o.seen:fk((function(){var t=Ek(Ak(1,o.seen),o.totals[e]);n[e]=t,o.totals[e].dispose(),vk(n[e])})))},r.s();!(a=r.n()).done;)i()}catch(UY){r.e(UY)}finally{r.f()}}case 1:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),i}(aE),sE=function(e){_inherits(i,e);var t,n,r,a=_createSuper(i);function i(){return _classCallCheck(this,i),a.apply(this,arguments)}return _createClass(i,[{key:"onTrainBegin",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.epoch=[],this.history={};case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"onEpochEnd",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r in null==n&&(n={}),this.epoch.push(t),n)null==this.history[r]&&(this.history[r]=[]),this.history[r].push(n[r]);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"syncData",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a,i,o,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a in t=[],n=[],r=[],this.history)for(i=this.history[a],o=0;o<i.length;++o)"number"!=typeof i[o]&&(t.push(i[o].data()),n.push(a),r.push(o));return e.next=4,Promise.all(t);case 4:for(s=e.sent,u=0;u<s.length;++u)this.history[n[u]][r[u]].dispose(),this.history[n[u]][r[u]]=s[u][0];case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),i}(aE),uE=function(e){_inherits(l,e);var t,n,a,i,o,s,u,c=_createSuper(l);function l(e,t){var n,a,i,o,s;if(_classCallCheck(this,l),(n=c.call(this)).currentEpoch=0,n.yieldEvery=t||"auto","auto"===n.yieldEvery&&(n.yieldEvery=125),"never"===n.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return r.isNumber(n.yieldEvery)&&(n.maybeWait=(a=n.maybeWait.bind(_assertThisInitialized(n)),i=n.yieldEvery,s=r.now(),function(){var e=r.now();return e-s<i||(s=e,o=a.apply(void 0,arguments)),o})),n.trainBegin=e.onTrainBegin,n.trainEnd=e.onTrainEnd,n.epochBegin=e.onEpochBegin,n.epochEnd=e.onEpochEnd,n.batchBegin=e.onBatchBegin,n.batchEnd=e.onBatchEnd,n.yield=e.onYield,_possibleConstructorReturn(n)}return _createClass(l,[{key:"maybeWait",value:(u=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],e.t0=null!=this.yield,!e.t0){e.next=6;break}return e.next=5,tE(r);case 5:a.push(this.yield(t,n,r));case 6:return a.push(nI()),e.next=9,Promise.all(a);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return u.apply(this,arguments)})},{key:"onEpochBegin",value:(s=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentEpoch=t,e.t0=null!=this.epochBegin,!e.t0){e.next=7;break}return e.next=5,tE(n);case 5:return e.next=7,this.epochBegin(t,n);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"onEpochEnd",value:(o=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],e.t0=null!=this.epochEnd,!e.t0){e.next=6;break}return e.next=5,tE(n);case 5:r.push(this.epochEnd(t,n));case 6:return"epoch"===this.yieldEvery&&r.push(nI()),e.next=9,Promise.all(r);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"onBatchBegin",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.batchBegin,!e.t0){e.next=6;break}return e.next=4,tE(n);case 4:return e.next=6,this.batchBegin(t,n);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"onBatchEnd",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],e.t0=null!=this.batchEnd,!e.t0){e.next=6;break}return e.next=5,tE(n);case 5:a.push(this.batchEnd(t,n));case 6:return"batch"===this.yieldEvery?a.push(nI()):r.isNumber(this.yieldEvery)&&a.push(this.maybeWait(this.currentEpoch,t,n)),e.next=9,Promise.all(a);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"onTrainBegin",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.trainBegin,!e.t0){e.next=6;break}return e.next=4,tE(t);case 4:return e.next=6,this.trainBegin(t);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"onTrainEnd",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.trainEnd,!e.t0){e.next=6;break}return e.next=4,tE(t);case 4:return e.next=6,this.trainEnd(t);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),l}(aE);function cE(e,t){return null==e&&(e={}),e instanceof aE?[e]:Array.isArray(e)&&e[0]instanceof aE?e:uN(e).map((function(e){return new uE(e,t)}))}var lE=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"registerCallbackConstructor",value:function(t,n){r.assert(t>=0&&Number.isInteger(t),(function(){return"Verbosity level is expected to be an integer >= 0, but got "+t})),e.checkForDuplicate(n),null==e.constructors[t]&&(e.constructors[t]=[]),e.constructors[t].push(n)}},{key:"checkForDuplicate",value:function(t){for(var n in e.constructors)e.constructors[+n].forEach((function(e){if(e===t)throw new tN("Duplicate callback constructor.")}))}},{key:"clear",value:function(){e.constructors={}}},{key:"createCallbacks",value:function(t){var n=[];for(var r in e.constructors){var a=+r;t>=a&&n.push.apply(n,_toConsumableArray(e.constructors[a]))}return n.map((function(e){return new e}))}}]),e}();function hE(e,t,n,r,a,i,o,s,u){var c=new sE,l=[new oE].concat(_toConsumableArray(lE.createCallbacks(t)));null!=e&&l.push.apply(l,_toConsumableArray(e)),l.push(c);var h=new iE(l);return h.setParams({epochs:n,initialEpoch:r,samples:a,steps:i,batchSize:o,verbose:t,doValidation:s,metrics:u}),{callbackList:h,history:c}}function pE(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return dN(e,p.SerializationMap.getMap().classNameMap,t,"layer",n)}function dE(e,t){return fk((function(){"float32"!==e.dtype&&(e=e.asType("float32"));var n=Uw(uA(e),t,!0),r=Hk(n.shape,JT()),a=Rk($k(n,r));return Ak(e,a)}))}function fE(e,t){return fk((function(){return iC(uA(Kk(t,e)),-1)}))}function mE(e,t){return fk((function(){return iC(Yk(Kk(t,e)),-1)}))}function vE(e,t){return fk((function(){var n=Kk(e,t),r=jx(Yk(e),JT(),Number.MAX_VALUE),a=Yk(Ak(n,r));return Ek(100,iC(a,-1))}))}function gE(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return fk((function(){if(n)t=r_(t);else{var r=Uw(t,t.shape.length-1,!0);t=Ak(t,r)}return t=jx(t,JT(),1-JT()),Lw(Uw(Ek(e.toFloat(),Mw(t)),t.shape.length-1))}))}function yE(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return fk((function(){var r,a,i=ww((r=e,a=[qN(r.shape)],r.reshape(a))).toInt(),o=(t=jx(t,JT(),1-JT())).shape;return gE(yb(i,o[o.length-1]).reshape(o),t,n)}))}function bE(e,t){return fk((function(){var n;return n=jx(t,JT(),1-JT()),n=Mw(Ak(n,Kk(1,n))),iC(function(e,t){if(!r.arraysEqual(e.shape,t.shape))throw new tN("logits and labels must have the same shape, but got shapes ".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return fk((function(){var n=t.relu(),r=t.abs().neg();return n.sub(t.mul(e)).add(r.exp().log1p())}))}(e,n),-1)}))}function kE(e,t){return fk((function(){var n=dE(e,-1),r=dE(t,-1),a=Ek(n,r);return Lw(Uw(a,-1))}))}lE.constructors={};var xE={meanSquaredError:fE,meanAbsoluteError:mE,meanAbsolutePercentageError:vE,meanSquaredLogarithmicError:function(e,t){return fk((function(){var n=jx(t,JT(),Number.MAX_VALUE),r=Mw(Tk(1,n)),a=jx(e,JT(),Number.MAX_VALUE),i=Mw(Tk(1,a));return iC(uA(Kk(r,i)),-1)}))},squaredHinge:function(e,t){return fk((function(){var n=$k(0,Kk(1,Ek(e,t)));return iC(uA(n),-1)}))},hinge:function(e,t){return fk((function(){var n=$k(0,Kk(1,Ek(e,t)));return iC(n,-1)}))},categoricalHinge:function(e,t){return fk((function(){var n=Uw(Ek(e,t),-1),r=Vw(Ek(Kk(1,e),t),-1);return $k(0,Tk(1,Kk(r,n)))}))},logcosh:function(e,t){return fk((function(){var n=Math.log(2),r=Kk(t,e),a=Kk(Tk(r,zw(Ek(-2,r))),n);return iC(a,-1)}))},categoricalCrossentropy:gE,sparseCategoricalCrossentropy:yE,binaryCrossentropy:bE,kullbackLeiblerDivergence:function(e,t){return fk((function(){var n=jx(e,JT(),1),r=jx(t,JT(),1);return Uw(Ek(e,Mw(Ak(n,r))),-1)}))},poisson:function(e,t){return fk((function(){var n=Mw(Tk(JT(),t));return iC(Kk(t,Ek(e,n)),-1)}))},cosineProximity:kE};function wE(e){if("string"==typeof e){if(e in xE)return xE[e];var t="Unknown loss "+e;throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy')),new tN(t)}return e}function CE(e,t){return fk((function(){var n=Ek(.5,vC(t)),r=QN(_w(t,n),e.dtype);return iC(hw(e,r),-1)}))}function _E(e,t){return fk((function(){return QN(hw(cx(e,-1),cx(t,-1)),"float32")}))}function SE(e,t){return bE(e,t)}function IE(e,t){return e.rank===t.rank&&(e=e.squeeze([e.rank-1])),(t=t.argMax(-1)).dtype!==e.dtype&&(t=t.asType(e.dtype)),hw(e,t).asType("float32")}var TE=gE,NE=yE,AE={binaryAccuracy:CE,categoricalAccuracy:_E,precision:function(e,t){return fk((function(){var n=function(e,t){return fk((function(){return Jw(e.equal(1),t.equal(1)).sum().cast("float32")}))}(e,t),r=function(e,t){return fk((function(){return Jw(e.equal(0),t.equal(1)).sum().cast("float32")}))}(e,t),a=n.add(r);return pw(_w(a,0),n.div(a),0).cast("float32")}))},categoricalCrossentropy:TE,sparseCategoricalCrossentropy:NE,mse:fE,MSE:fE,mae:mE,MAE:mE,mape:vE,MAPE:vE,cosine:kE};function EE(e){if("string"==typeof e&&e in AE)return AE[e];if("string"!=typeof e&&null!=e)return e;throw new tN("Unknown metric "+e)}function RE(e){if(iN(null!==e,"Unknown LossOrMetricFn "+e),"string"==typeof e)return e;for(var t,n=0,r=Object.keys(xE);n<r.length;n++){var a=r[n];if(xE[a]===e){t=a;break}}if(void 0!==t)return t;for(var i=0,o=Object.keys(AE);i<o.length;i++){var s=o[i];if(AE[s]===e){t=s;break}}return void 0!==t?t:e.name}function FE(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!=typeof e||Object.getPrototypeOf(e)!==Object.prototype||!function e(t){if(null===t)return!0;if("object"==typeof t){if(Object.getPrototypeOf(t)===Object.prototype){for(var n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];if("string"!=typeof a)return!1;if(!e(t[a]))return!1}return!0}if(Array.isArray(t)){var i,o=_createForOfIteratorHelper(t);try{for(o.s();!(i=o.n()).done;){if(!e(i.value))return!1}}catch(UY){o.e(UY)}finally{o.f()}return!0}return!1}var s=typeof t;return"string"===s||"number"===s||"boolean"===s}(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){var r=JSON.stringify(e);r.length>1048576&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in size (length=').concat(r.length," when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576."))}}function DE(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,r="",a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=e[a]).slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function OE(e,t,n){var r;try{r=JSON.stringify(e.outputShape)}catch(UY){r="multiple"}DE(["".concat(e.name," (").concat(e.getClassName(),")"),r,e.countParams().toString()],t,n)}function ME(e,t,n,r){var a;try{a=JSON.stringify(e.outputShape)}catch(UY){a="multiple"}var i,o=[],s=_createForOfIteratorHelper(e.inboundNodes);try{for(s.s();!(i=s.n()).done;){var u=i.value;if(!(null!=n&&n.length>0&&-1===n.indexOf(u)))for(var c=0;c<u.inboundLayers.length;++c)o.push("".concat(u.inboundLayers[c].name,"[").concat(u.nodeIndices[c],"][").concat(u.tensorIndices[c],"]"))}}catch(UY){s.e(UY)}finally{s.f()}var l=e.name,h=e.getClassName(),p=0===o.length?"":o[0];DE(["".concat(l," (").concat(h,")"),a,e.countParams().toString(),p],t,r);for(var d=1;d<o.length;++d)DE(["","","",o[d]],t,r)}function PE(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}var LE=function(){function e(t){if(_classCallCheck(this,e),this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof e)for(var n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(null==t)return;var r,a=_createForOfIteratorHelper(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.add(i.key,i.value)}}catch(UY){a.e(UY)}finally{a.f()}}}return _createClass(e,[{key:"add",value:function(e,t,n){if(null!=this.id2Value[e.id])throw new tN("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return Xy(t,e.dtype)}catch(UY){throw new tN("The dtype of the feed (".concat(t.dtype,") can not be cast to the dtype of the key '").concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}},{key:"addFeed",value:function(e){this.add(e.key,e.value)}},{key:"hasKey",value:function(e){return null!=this.id2Value[e.id]}},{key:"names",value:function(){return Object.keys(this.name2Id)}},{key:"getValue",value:function(e){if(e instanceof YA){if(null==this.id2Value[e.id])throw new tN("Nonexistent key: "+e.name);return this.id2Value[e.id]}var t=this.name2Id[e];if(null==t)throw new tN("Feed dict has no SymbolicTensor name: "+e);return this.id2Value[t]}},{key:"getMask",value:function(e){if(e instanceof YA){if(null==this.id2Value[e.id])throw new tN("Nonexistent key: "+e.name);return this.id2Mask[e.id]}var t=this.name2Id[e];if(null==t)throw new tN("Feed dict has no SymbolicTensor name: "+e);return this.id2Mask[t]}},{key:"disposeMasks",value:function(){null!=this.id2Mask&&mk(this.id2Mask)}}]),e}(),zE={},BE={};function VE(e,t,n,a){var i,o=null!=n&&n.training,s=Array.isArray(e),u=s?e:[e],c=u.map((function(e){return e.name})),l=[],h=t.names(),p=_createForOfIteratorHelper(c);try{for(p.s();!(i=p.n()).done;){var d=i.value;-1!==h.indexOf(d)?l.push(t.getValue(d)):l.push(null)}}catch(UY){p.e(UY)}finally{p.f()}null!=a&&(a.maxNumTensors=-1/0,a.minNumTensors=1/0);var f,m,v=c.join(",")+"|"+t.names().join(",");if(null==zE[v]){var g=function(e,t){r.assert(null!=e&&e.length>0,(function(){return"Expected at least one fetch, got none"}));var n=[],a={};if(1===e.length){var i=WE(e[0],t);n=i.sorted,a=i.recipientMap}else{var o,s=new Set,u=_createForOfIteratorHelper(e);try{for(u.s();!(o=u.n()).done;){var c,l=WE(o.value,t),h=l.sorted,p=l.recipientMap,d=_createForOfIteratorHelper(h);try{for(d.s();!(c=d.n()).done;){var f=c.value;s.has(f.name)||(n.push(f),s.add(f.name))}}catch(UY){d.e(UY)}finally{d.f()}var m=function(e){null==a[e]&&(a[e]=new Set),p[e].forEach((function(t){return a[e].add(t)}))};for(var v in p)m(v)}}catch(UY){u.e(UY)}finally{u.f()}}return{sorted:n,recipientCounts:UE(a)}}(u,t);f=g.sorted,m=g.recipientCounts,zE[v]=f,BE[v]=m}f=zE[v],m={},o||Object.assign(m,BE[v]);for(var y=new LE(t),b=0;b<f.length;++b){if(null!=a){var k=pk().numTensors;k>a.maxNumTensors&&(a.maxNumTensors=k),k<a.minNumTensors&&(a.minNumTensors=k)}var x=f[b],w=x.sourceLayer;if(!(w instanceof eE)){var C,_=[],S=[],I=[],T=!1,N=_createForOfIteratorHelper(x.inputs);try{for(N.s();!(C=N.n()).done;){var A=C.value,E=y.getValue(A),R=y.getMask(A);_.push(E),S.push(R),null!=R&&(T=!0),o||(m[A.name]--,0!==m[A.name]||t.hasKey(A)||-1!==c.indexOf(A.name)||E.isDisposed||!0===A.sourceLayer.stateful||I.push(E))}}catch(UY){N.e(UY)}finally{N.f()}T&&((n=n||{}).mask=S[0]);var F=uN(w.apply(_,n)),D=null;w.supportsMasking&&(D=w.computeMask(_,S));for(var O=GE(x),M=Array.isArray(O)?O:[O],P=0;P<M.length;++P){y.hasKey(M[P])||y.add(M[P],F[P],Array.isArray(D)?D[0]:D);var L=c.indexOf(M[P].name);-1!==L&&(l[L]=F[P])}o||mk(I)}}return y.disposeMasks(),s?l:l[0]}function UE(e){var t={};for(var n in e)t[n]=e[n].size;return t}function WE(e,t){var n,r=new Set,a=[],i={},o=_createForOfIteratorHelper(t.names());try{for(o.s();!(n=o.n()).done;){var s=n.value;r.add(s)}}catch(UY){o.e(UY)}finally{o.f()}var u=[],c=[];for(u.push(e);u.length>0;){var l=u[u.length-1];if(r.has(l.name))u.pop();else{var h=c[c.length-1]===u.length-1;if(0===l.inputs.length||h)u.pop(),a.push(l),r.add(l.name),h&&c.pop();else{c.push(u.length-1);var p,d=_createForOfIteratorHelper(l.inputs);try{for(d.s();!(p=d.n()).done;){var f=p.value;null==i[f.name]&&(i[f.name]=new Set),i[f.name].add(l.name),r.has(f.name)||u.push(f)}}catch(UY){d.e(UY)}finally{d.f()}}}}return{sorted:a,recipientMap:i}}function GE(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,r=0;r<e.sourceLayer.inboundNodes.length;++r){var a,i=_createForOfIteratorHelper(e.sourceLayer.inboundNodes[r].outputTensors);try{for(i.s();!(a=i.n()).done;){if(a.value.id===e.id){n=r;break}}}catch(UY){i.e(UY)}finally{i.f()}}t=e.sourceLayer.getOutputAt(n)}return t}function HE(e,t){return function(e,t,n){var r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return null}));if(1===r)return Array.isArray(e)&&1===e.length?e:"object"==typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided classWeight is an array of ".concat(e.length," element(s), but the model has ").concat(r," outputs. Make sure a set of weights is provided for each model output."));return e}if("object"==typeof e&&Object.keys(e).length>0&&"object"==typeof e[Object.keys(e)[0]]){var a=[];return t.forEach((function(t){a.push(t in e?e[t]:null)})),a}throw new Error("The model has multiple (".concat(r,") outputs, so classWeight must be either an array with ").concat(r," elements or an object with ").concat(t," keys. Provided classWeight not understood: ").concat(JSON.stringify(e)))}(e,t)}function jE(e,t,n,r){return qE.apply(this,arguments)}function qE(){return(qE=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r,a){var i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&null==a){e.next=2;break}throw new Error("Support sampleWeight is not implemented yet");case 2:if(null==r){e.next=12;break}return i=fk((function(){if(1===t.shape.length)return t.clone();if(2===t.shape.length){if(t.shape[1]>1)return t.argMax(1);if(1===t.shape[1])return t.reshape([t.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(t.shape[1],") during handling of class weights. The size is expected to be >= 1."))}throw new Error("Unexpected rank of target (y) tensor (".concat(t.rank,") during handling of class weights. The rank is expected to be 1 or 2."))})),e.t0=Array,e.next=7,i.data();case 7:return e.t1=e.sent,o=e.t0.from.call(e.t0,e.t1),mk(i),s=[],e.abrupt("return",(o.forEach((function(e){if(null==r[e])throw new Error("classWeight must contain all classes in the training data. The class ".concat(e," exists in the data but not in classWeight"));s.push(r[e])})),m_(s,"float32")));case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function KE(e,t){return Ek(e,t)}function XE(e,t){var n,a;n=t.xs,a=t.ys,r.assert(null!=n&&null!=a,(function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+t}));var i=YE("input",e.inputNames,n),o=YE("output",e.outputNames,a),s=i[0].shape[0];r.assert(i.length===e.inputs.length,(function(){return"LayersModel has ".concat(e.inputs.length," inputs, but the dataset provides ").concat(i.length," inputs.  (Expected input keys: ")+JSON.stringify(e.inputNames)+")"})),r.assert(o.length===e.outputs.length,(function(){return"LayersModel has ".concat(e.outputs.length," outputs, but the dataset provides ").concat(o.length," outputs.  (Expected output keys: ")+JSON.stringify(e.outputNames)+")"}));for(var u=function(t){r.assert(i[t].shape[0]===s,(function(){return"Batch size mismatch: input ".concat(e.inputNames[t]," has ").concat(i[t].shape[0],"; expected  ").concat(s," based on input ").concat(e.inputNames[0],".")}))},c=0;c<i.length;c++)u(c);for(var l=function(t){r.assert(o[t].shape[0]===s,(function(){return"Batch size mismatch: output ".concat(e.outputNames[t]," has ").concat(o[t].shape[0],"; expected  ").concat(s," based on input ").concat(e.inputNames[0],".")}))},h=0;h<o.length;h++)l(h);return{xs:i,ys:o}}function YE(e,t,n){if(n instanceof _g)return[n];if(Array.isArray(n))return r.assert(n.length===t.length,(function(){return"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,".")})),n;var a,i=[],o=_createForOfIteratorHelper(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;if(null==n[s])throw new tN("The feature data generated by the dataset lacks the required ".concat(e," key '").concat(s,"'."));i.push(n[s])}}catch(UY){o.e(UY)}finally{o.f()}return i}function ZE(e){return"function"==typeof e.iterator}function QE(e){r.assert(e>0&&Number.isInteger(e),(function(){return"batchSize is required to be a positive integer, but got "+e}))}function JE(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((function(e){return $N(e,t,n-t)})):$N(e,t,n-t)}function $E(e,t){return fk((function(){return null==e?null:Array.isArray(e)?e.map((function(e){return $E(e,t)})):sA(e,"int32"===t.dtype?t:t.toInt())}))}function eR(e,t){for(var n=[],r=0,a=null;r<e;)(a=r+t)>=e&&(a=e),n.push([r,a]),r=a;return n}function tR(e){var t=[];e instanceof _g&&(e=[e]);for(var n=0;n<e.length;++n){var r=e[n];if(1===r.rank)t.push(JN(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function nR(e,t){if(null!=e){var n=[];if(t instanceof _g)n.push(t.id);else if(Array.isArray(t))t.forEach((function(e){return n.push(e.id)}));else if(null!=t)for(var r in t)n.push(t[r].id);var a=[];if(e instanceof _g)-1===n.indexOf(e.id)&&a.push(e);else if(Array.isArray(e))e.forEach((function(e){-1===n.indexOf(e.id)&&a.push(e)}));else if(null!=e)for(var i in e){var o=e[i];-1===n.indexOf(o.id)&&a.push(o)}a.forEach((function(e){e.isDisposed||e.dispose()}))}}function rR(e){return Array.isArray(e)}function aR(e){return!function(e){return e instanceof _g}(e)&&!rR(e)}function iR(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){var o=!1;if(rR(e)&&e.length>0)o=!0;else if(aR(e)){for(var s in e)if(e.hasOwnProperty(s)){o=!0;break}}else o=!0;if(o)throw new tN("Error when checking model ".concat(i," expected no data, but got ")+e)}return[]}if(null==e)return t.map((function(e){return null}));if(aR(e)){e=e,r=[];var u,c=_createForOfIteratorHelper(t);try{for(c.s();!(u=c.n()).done;){var l=u.value;if(null==e[l])throw new tN('No data provided for "'.concat(l,'". Need data for each key in: ')+t);r.push(e[l])}}catch(UY){c.e(UY)}finally{c.f()}}else if(rR(e)){if((e=e).length!==t.length)throw new tN("Error when checking model ".concat(i,": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ").concat(t.length," Tensor(s), but instead got the following list of Tensor(s): ")+e);r=e}else{if(e=e,t.length>1)throw new tN("The model ".concat(i," expects ").concat(t.length," Tensor(s), but only received one Tensor. Found: Tensor with shape ")+e.shape);r=[e]}if(r=tR(r),null!=n)for(var h=0;h<t.length;++h)if(null!=n[h]){var p=r[h];if(p.shape.length!==n[h].length)throw new tN("Error when checking ".concat(i,": expected ").concat(t[h]," to have ").concat(n[h].length," dimension(s). but got array with shape ")+p.shape);for(var d=0;d<n[h].length;++d)if(0!==d||a){var f=p.shape[d],m=n[h][d];if(null!=m&&m>=0&&f!==m)throw new tN("Error when checking ".concat(i,": expected ").concat(t[h]," to have shape [").concat(n[h],"], but got array with shape [").concat(p.shape,"]."))}}return r}function oR(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new tN("Error when checking model ".concat(i,": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ").concat(t.length," Tensor(s), but instead got ").concat(e.length," Tensors(s)."));r=e}else{if(t.length>1)throw new tN("The model expects ".concat(t.length," ").concat(i," Tensors, but only received one Tensor. Found: array with shape ")+JSON.stringify(e.shape)+".");r=[e]}if(null!=n)for(var o=0;o<t.length;++o)if(null!=n[o]){var s=r[o];if(s.shape.length!==n[o].length)throw new tN("Error when checking ".concat(i,": expected ").concat(t[o]," to have ").concat(n[o].length," dimension(s), but got array with shape ")+JSON.stringify(s.shape));for(var u=0;u<n[o].length;++u)if(0!==u||a){var c=s.shape[u],l=n[o][u];if(null!=l&&l!==c)throw new tN("Error when checking ".concat(i,": expected ").concat(t[o]," to have shape ").concat(JSON.stringify(n[o])," but got array with shape ").concat(JSON.stringify(s.shape),"."))}}}var sR=function(e){_inherits(l,e);var t,n,a,i,s,u,c=_createSuper(l);function l(e){var t;return _classCallCheck(this,l),(t=c.call(this,e)).isTraining=!1,t}return _createClass(l,[{key:"summary",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new tN("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");!function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log,i=function(e){var t=!0,n=[],r=[];for(var a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(var i=0,o=n;i<o.length;i++){var s=o[i];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){t=!1;break}r.push.apply(r,_toConsumableArray(s))}if(t){var u,c=_createForOfIteratorHelper(e.layers);try{for(c.s();!(u=c.n()).done;){var l,h=u.value,p=!1,d=_createForOfIteratorHelper(h.inboundNodes);try{for(d.s();!(l=d.n()).done;){var f=l.value;if(-1!==r.indexOf(f)){if(p){t=!1;break}p=!0}}}catch(UY){d.e(UY)}finally{d.f()}if(!t)break}}catch(UY){c.e(UY)}finally{c.f()}}return t}(e),o=["Layer (type)","Output shape","Param #"];if(i?(t=t||65,n=n||[.45,.85,1]):(t=t||98,n=n||[.33,.55,.67,1]),n[n.length-1]<=1&&(n=n.map((function(e){return Math.floor(t*e)}))),!i)for(var s in o.push("Receives inputs"),r=[],e.nodesByDepth){var u;(u=r).push.apply(u,_toConsumableArray(e.nodesByDepth[s]))}a("_".repeat(t)),DE(o,n,a),a("=".repeat(t));for(var c=e.layers,l=0;l<c.length;++l)i?OE(c[l],n,a):ME(c[l],n,r,a),a((l===c.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();var h=function(e){return GA(null!=e.collectedTrainableWeights?e.collectedTrainableWeights:e.trainableWeights)}(e),p=GA(e.nonTrainableWeights);a("Total params: "+(h+p)),a("Trainable params: "+h),a("Non-trainable params: "+p),a("_".repeat(t))}(this,e,t,n)}},{key:"compile",value:function(e){var t=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer_=function(e){var t={Adagrad:function(){return eI.adagrad(.01)},Adadelta:function(){return eI.adadelta(1,.95,JT())},Adam:function(){return eI.adam(.001,.9,.999,JT())},Adamax:function(){return eI.adamax(.002,.9,.999,JT(),0)},RMSProp:function(){return eI.rmsprop(.001,.9,0,JT())},SGD:function(){return eI.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new tN("Unknown Optimizer "+e)}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Wk))throw new tN("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}var n=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new tN("When passing an Array as loss, it should have one entry per model output. The model has ".concat(this.outputs.length," output(s), but you passed loss=").concat(e.loss,"."));n=e.loss.map((function(e){return wE(e)}))}else{var r=wE(e.loss);this.outputs.forEach((function(e){n.push(r)}))}else{for(var a in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(a))throw new tN('Unknown entry in loss dictionary: "'.concat(a,'". Only expected the following keys: ')+this.outputNames);var i,o=_createForOfIteratorHelper(this.outputNames);try{for(o.s();!(i=o.n()).done;){var s=i.value;null==e.loss[s]&&console.warn('Output "'.concat(s,'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ').concat(s," during training")),n.push(wE(e.loss[s]))}}catch(UY){o.e(UY)}finally{o.f()}}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var u=0;u<this.outputs.length;++u){var c=this.internalOutputShapes[u];this.feedOutputNames.push(this.outputNames[u]),this.feedOutputShapes.push(c),this.feedLossFns.push(this.lossFunctions[u])}var l=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],UN("loss",(function(){for(var e=0;e<t.outputs.length;++e)if(-1===l.indexOf(e)){var n=t.lossFunctions[e];t.outputs.length>1&&(t.metricsTensors.push([n,e]),t.metricsNames.push(t.outputNames[e]+"_loss"))}}));var h=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return[]}));var n;if("string"==typeof e||"function"==typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!=typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: "+e);n=e}if(Array.isArray(n))return t.map((function(e){return n}));var r,a=[],i=_createForOfIteratorHelper(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=n.hasOwnProperty(o)?n[o]:[];Array.isArray(s)||(s=[s]),a.push(s)}}catch(UY){i.e(UY)}finally{i.f()}return a}(e.metrics,this.outputNames),p=function(e,n,r){t.outputNames.length>1&&(n=t.outputNames[e]+"_"+n),t.metricsNames.push(n),t.metricsTensors.push([r,e])};UN("metric",(function(){for(var e=function(e){-1===l.indexOf(e)&&function(n){var r,a,i,o,s=_createForOfIteratorHelper(n);try{for(s.s();!(o=s.n()).done;){var u=o.value;if("string"==typeof u&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(u)){var c=t.internalOutputShapes[e],l=void 0;1===c[c.length-1]||t.lossFunctions[e]===bE?-1!==["accuracy","acc"].indexOf(u)?a=CE:-1!==["crossentropy","ce"].indexOf(u)&&(a=SE):t.lossFunctions[e]===yE?-1!==["accuracy","acc"].indexOf(u)?a=IE:-1!==["crossentropy","ce"].indexOf(u)&&(a=NE):-1!==["accuracy","acc"].indexOf(u)?a=_E:-1!==["crossentropy","ce"].indexOf(u)&&(a=TE),-1!==["accuracy","acc"].indexOf(u)?l="acc":-1!==["crossentropy","ce"].indexOf(u)&&(l="ce"),i=a,r=""+l}else{var h=EE(u);i=h,r=""+RE(u)}var d=void 0;UN(r,(function(){d=i})),p(e,r,d)}}catch(UY){s.e(UY)}finally{s.f()}}(h[e])},n=0;n<t.outputs.length;++n)e(n)})),this.collectedTrainableWeights=this.trainableWeights}},{key:"checkTrainableWeightsConsistency",value:function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=null==n.batchSize?32:n.batchSize;QE(r);var a=this.standardizeUserDataXY(e,t,!0,r);try{var i=a[0].concat(a[1]);return this.makeTestFunction(),sN(this.testLoop(this.testFunction,i,r,n.verbose,n.steps))}finally{nR(a[0],e),nR(a[1],t)}}},{key:"evaluateDataset",value:(u=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.makeTestFunction(),function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,a){var i,o,s,u,c,l,h,p,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null!=(a=a||{}).batches,o=t.testFunction,s=[],!(a.verbose>0)){e.next=4;break}throw new nN("Verbose mode is not implemented yet.");case 4:if(r.assert(!i||a.batches>0&&Number.isInteger(a.batches),(function(){return"Test loop expects `batches` to be a positive integer, but received "+JSON.stringify(a.batches)})),"function"!=typeof n.next){e.next=9;break}e.t0=n,e.next=12;break;case 9:return e.next=11,n.iterator();case 11:e.t0=e.sent;case 12:u=e.t0,c=0,l=0,h=regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.next();case 2:if(n=e.sent,s=fk((function(){return n.value&&function(){var e=XE(t,n.value),r=e.xs,a=e.ys,i=r.concat(a),u=fk((function(){return o(i)}));if(mk(i),0===l)for(var h=0;h<u.length;++h)s.push(Uk(0));for(var p=i[0].shape[0],d=function(e){var t=u[e],n=s[e];s[e]=fk((function(){return Tk(s[e],Ek(p,t))})),l>0&&mk(n)},f=0;f<u.length;++f)d(f);mk(u),c+=p,++l}(),s})),!n.done){e.next=6;break}return i&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, ".concat(a.batches," batches). You may need to use the repeat() function when building your dataset.")),e.abrupt("return","break");case 6:case"end":return e.stop()}}),e)}));case 15:if(i&&!(l<a.batches)){e.next=22;break}return e.delegateYield(h(),"t1",17);case 17:if("break"!==e.t1){e.next=20;break}return e.abrupt("break",22);case 20:e.next=15;break;case 22:for(p=0;p<s.length;++p)d=s[p],s[p]=Ak(s[p],c),mk(d);return e.abrupt("return",sN(s));case 24:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()(this,t,n)));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"checkNumSamples",value:function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(r=null,null!=t)throw new tN("If ".concat(a," is set, batchSize must be null or undefined.Got batchSize = ")+t)}else{if(null==e)throw new tN("Either the input data should have a defined shape, or "+a+" shoud be specified.");r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}},{key:"execute",value:function(e,t){if(Array.isArray(t)&&0===t.length)throw new tN("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(t),r=this.retrieveSymbolicTensors(n?t:[t]),a=new LE;if(e instanceof _g&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new tN("The number of inputs provided (".concat(e.length,") does not match the number of inputs of this model (").concat(this.inputs.length,")."));for(var i=0;i<this.inputs.length;++i)a.add(this.inputs[i],e[i])}else{var o,s=_createForOfIteratorHelper(this.inputs);try{for(s.s();!(o=s.n()).done;){var u=o.value,c=e[u.name];if(null==c)throw new tN("No value is provided for the model's input "+u.name);a.add(u,c)}}catch(UY){s.e(UY)}finally{s.f()}}var l=VE(r,a);return n?l:l[0]}},{key:"retrieveSymbolicTensors",value:function(e){var t,n=aN(null,e.length),r=e.length,a=_createForOfIteratorHelper(this.layers);try{for(a.s();!(t=a.n()).done;){for(var i=t.value,o=Array.isArray(i.output)?i.output:[i.output],s=o.map((function(e){return e.name})),u=0;u<e.length;++u){var c=s.indexOf(e[u]);if(-1!==c&&(n[u]=o[c],r--),0===r)break}if(0===r)break}}catch(UY){a.e(UY)}finally{a.f()}if(r>0){var l=[];throw n.forEach((function(t,n){null==t&&l.push(e[n])})),new tN("Cannot find SymbolicTensors for output name(s): "+JSON.stringify(l))}return n}},{key:"predictLoop",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return fk((function(){var a=t.checkNumSamples(e);if(r)throw new nN("Verbose predictLoop() is not implemented yet.");for(var i=eR(a,n),o=t.outputs.map((function(e){return[]})),s=function(n){fk((function(){var r=JE(e,i[n][0],i[n][1]),a=[];if(Array.isArray(r))for(var o=0;o<r.length;++o)a.push({key:t.inputs[o],value:r[o]});else a.push({key:t.inputs[0],value:r});var s=new LE(a);return VE(t.outputs,s)})).forEach((function(e,t){return o[t].push(e)}))},u=0;u<i.length;++u)s(u);return sN(o.map((function(e){return Fx(e,0)})))}))}},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=tR(e);oR(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==t.batchSize?32:t.batchSize;return QE(r),this.predictLoop(n,r)}finally{nR(n,e)}}},{key:"predictOnBatch",value:function(e){oR(e,this.inputNames,this.feedInputShapes,!0);var t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}},{key:"standardizeUserDataXY",value:function(e,t){!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new eN("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var a=[],i=0;i<this.feedOutputShapes.length;++i){var o=this.feedOutputShapes[i];a.push(this.feedLossFns[i]===yE?o.slice(0,o.length-1).concat([1]):o)}if(function(e,t,n){var a=mN(e.map((function(e){return e.shape[0]})));a.sort();var i=mN(t.map((function(e){return e.shape[0]})));if(i.sort(),a.length>1)throw new tN("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(e.map((function(e){return e.shape}))));if(i.length>1)throw new tN("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(t.map((function(e){return e.shape}))));if(a.length>0&&i.length>0&&!r.arraysEqual(a,i))throw new tN("Input Tensors should have the same number of samples as target Tensors. Found ".concat(a[0]," input sample(s) and ").concat(i[0]," target sample(s)."))}(e=iR(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=iR(t,this.feedOutputNames,a,!1,"target")),function(e,t,n){for(var r=[fE,bE,gE],a=0;a<e.length;++a){var i=e[a],o=t[a],s=n[a];if(null!=o){if(o===gE&&1===i.shape[i.shape.length-1])throw new tN("You are passing a target array of shape ".concat(i.shape," while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes]."));if(-1!==r.indexOf(o))for(var u=i.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var h=u[l],p=c[l];if(null!=p&&h!==p)throw new tN("A target Tensor with shape ".concat(i.shape," was passed for an output of shape ").concat(s,", while using a loss function that expects targets to have the same shape as the output."))}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!=0)throw new tN("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}},{key:"standardizeUserData",value:(s=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r,a){var i,o,s,u,c,l,h,p,d,f=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!(f.length>4&&void 0!==f[4])||f[4],o=f.length>5?f[5]:void 0,s=this.standardizeUserDataXY(t,n,i,o),u=_slicedToArray(s,2),c=u[0],l=u[1],null==r){e.next=5;break}throw new Error("sample weight is not supported yet.");case 5:if(h=null,null==a){e.next=19;break}p=HE(a,this.outputNames),h=[],d=0;case 10:if(!(d<p.length)){e.next=19;break}return e.t0=h,e.next=14,jE(l[d],null,p[d]);case 14:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 16:++d,e.next=10;break;case 19:return e.abrupt("return",[c,l,h]);case 20:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return s.apply(this,arguments)})},{key:"testLoop",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;return fk((function(){var o=r.checkNumSamples(t,n,i,"steps"),s=[];if(a>0)throw new nN("Verbose mode is not implemented yet.");if(null!=i)throw new nN("steps mode in testLoop() is not implemented yet");for(var u=eR(o,n),c=m_(ZN(0,o)),l=0;l<u.length;++l){var h=u[l][0],p=u[l][1],d=$N(c,h,p-h),f=$E(t,d),m=e(f);if(0===l)for(var v=0;v<m.length;++v)s.push(Uk(0));for(var g=0;g<m.length;++g)s[g]=Tk(s[g],Ek(p-h,m[g]))}for(var y=0;y<s.length;++y)s[y]=Ak(s[y],o);return s}))}},{key:"getDedupedMetricsNames",value:function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var r=e[n],a=r;oN(e,r)>1&&(a+="_"+oN(e.slice(0,n),r)),t.push(a)}return t}},{key:"makeTrainFunction",value:function(){var e=this;return function(t){var n=[],r=t.slice(0,e.inputs.length),a=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),i=t.slice(e.inputs.length+e.outputs.length,e.inputs.length+2*e.outputs.length),o=[],s=e.collectedTrainableWeights.map((function(e){return e.read()}));return[e.optimizer_.minimize((function(){for(var t=[],s=0;s<e.inputs.length;++s)t.push({key:e.inputs[s],value:r[s]});for(var u,c=new LE(t),l=VE(e.outputs,c,{training:!0}),h=0;h<e.lossFunctions.length;++h){var p=(0,e.lossFunctions[h])(a[h],l[h]);null!=i[h]&&(p=KE(p,i[h]));var d=iC(p);n.push(d),u=0===h?p:Tk(u,p)}for(var f=0;f<e.metricsTensors.length;++f){var m=void 0;if(e.outputs.length>1&&f<e.outputs.length)m=n[f];else{var v=e.metricsTensors[f][1];m=iC((0,e.metricsTensors[f][0])(a[v],l[v]))}vk(m),o.push(m)}return u=iC(u),e.calculateLosses().forEach((function(e){u=Tk(u,e)})),u}),!0,s)].concat(o)}}},{key:"makeTestFunction",value:function(){var e=this;this.testFunction=function(t){return fk((function(){for(var n,r=[],a=t.slice(0,e.inputs.length),i=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),o=[],s=0;s<e.inputs.length;++s)o.push({key:e.inputs[s],value:a[s]});for(var u=new LE(o),c=VE(e.outputs,u),l=0;l<e.lossFunctions.length;++l){var h=iC((0,e.lossFunctions[l])(i[l],c[l]));n=0===l?h:Tk(n,h),r.push(n)}for(var p=0;p<e.metricsTensors.length;++p){var d=e.metricsTensors[p][1],f=iC((0,e.metricsTensors[p][0])(i[d],c[d]));r.push(f)}return r}))}}},{key:"fit",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var a,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.length>2&&void 0!==i[2]?i[2]:{},e.abrupt("return",function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,a){var i,o,s,u,c,l,h,p,d,f,m,v,g,y,b,k,x,w,C,_,S,I,T,N=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=N.length>3&&void 0!==N[3]?N[3]:{},!t.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return t.isTraining=!0,e.prev=4,QE(d=null==i.batchSize?32:i.batchSize),f=!1,e.next=10,t.standardizeUserData(n,a,i.sampleWeight,i.classWeight,f,d);case 10:if(m=e.sent,o=m[0],s=m[1],p=m[2],g=!1,!(null!=i.validationData&&i.validationData.length>0)){e.next=24;break}if(g=!0,2===i.validationData.length){e.next=16;break}throw 3===i.validationData.length?new nN("validationData including sample weights is not supported yet."):new tN("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+i.validationData+" is invalid.");case 16:return u=i.validationData[0],c=i.validationData[1],y=!0,e.next=20,t.standardizeUserData(u,c,null,null,y,d);case 20:b=e.sent,l=b[0],h=b[1],v=l.concat(h),e.next=25;break;case 24:null!=i.validationSplit&&i.validationSplit>0&&i.validationSplit<1?(g=!0,k=Math.floor(o[0].shape[0]*(1-i.validationSplit)),x=o[0].shape[0],l=JE(o,k,x),o=JE(o,0,k),h=JE(s,k,x),s=JE(s,0,k),v=l.concat(h)):null!=i.validationSteps&&(g=!0);case 25:return w=o.concat(s).concat(p),t.checkTrainableWeightsConsistency(),C=t.makeTrainFunction(),_=t.getDedupedMetricsNames(),g?(t.makeTestFunction(),S=t.testFunction,I=_.slice().concat(_.map((function(e){return"val_"+e})))):(S=null,v=[],I=_.slice()),T=cE(i.callbacks,i.yieldEvery),e.next=32,function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,a,i,o,s,u,c,l,h,p,d,f,m,v){var g,y,b,k,x,w,C,_;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null==o&&(o=32),null==s&&(s=1),null==p&&(p=!0),null==f&&(f=0),g=!1,null!=l&&null!=h&&(g=!0),null!=(y=t.checkNumSamples(a,o,null,"steps_per_epoch"))&&(b=ZN(0,y)),null==u&&(u=1),k=hE(c,u,s,f,y,null,o,g,d),x=k.callbackList,w=k.history,x.setModel(t),t.history=w,e.next=10,x.onTrainBegin();case 10:t.stopTraining_=!1,C=regeneratorRuntime.mark((function e(s){var u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.onEpochBegin(s);case 2:return u={},e.delegateYield(regeneratorRuntime.mark((function e(){var s,c,d,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("batch"!==p){e.next=2;break}throw new nN("batch shuffling is not implemneted yet");case 2:p&&r.shuffle(b),s=m_(b),c=eR(y,o),d=regeneratorRuntime.mark((function e(r){var p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p={},e.next=3,x.onBatchBegin(r,p);case 3:return fk((function(){var e=c[r][0],d=c[r][1],f=$N(s,e,d-e);p.batch=r,p.size=d-e;for(var m=$E(a,f),v=n(m),y=0;y<i.length;++y){var b=v[y];p[i[y]]=b,vk(b)}if(r===c.length-1&&g)for(var k=t.testLoop(l,h,o),x=0;x<i.length;++x){var w=i[x],C=k[x];vk(C),u["val_"+w]=C}})),e.next=6,x.onBatchEnd(r,p);case 6:if(rE(p),!t.stopTraining_){e.next=9;break}return e.abrupt("return","break");case 9:case"end":return e.stop()}}),e)})),f=0;case 6:if(!(f<c.length)){e.next=14;break}return e.delegateYield(d(f),"t0",8);case 8:if("break"!==e.t0){e.next=11;break}return e.abrupt("break",14);case 11:++f,e.next=6;break;case 14:s.dispose();case 15:case"end":return e.stop()}}),e)}))(),"t0",4);case 4:return e.next=6,x.onEpochEnd(s,u);case 6:if(!t.stopTraining_){e.next=8;break}return e.abrupt("return","break");case 8:case"end":return e.stop()}}),e)})),_=f;case 13:if(!(_<s)){e.next=21;break}return e.delegateYield(C(_),"t0",15);case 15:if("break"!==e.t0){e.next=18;break}return e.abrupt("break",21);case 18:++_,e.next=13;break;case 21:return e.next=23,x.onTrainEnd();case 23:return e.next=25,t.history.syncData();case 25:return e.abrupt("return",t.history);case 26:case"end":return e.stop()}}),e)})));return function(t,n,r,a,i,o,s,u,c,l,h,p,d,f,m){return e.apply(this,arguments)}}()(t,C,w,_,d,i.epochs,i.verbose,T,S,v,i.shuffle,I,i.initialEpoch);case 32:return e.abrupt("return",e.sent);case 33:return e.prev=33,t.isTraining=!1,nR(o,n),nR(s,a),nR(l,u),nR(h,c),null!=p&&mk(p),e.finish(33);case 36:case"end":return e.stop()}}),e,null,[[4,,33,36]])})));return function(t,n,r){return e.apply(this,arguments)}}()(this,t,n,a));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"fitDataset",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,a){var i,o,s,u,c,l,h,p,d,f,m,v,g,y,b,k,x,w,C,_,S,I,T,N,A,E,R,F,D,O,M,P;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null!=a.batchesPerEpoch,r.assert(null!=t.optimizer,(function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."})),r.assert(null!=a,(function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."})),r.assert(null!=a.epochs&&a.epochs>0&&Number.isInteger(a.epochs),(function(){return"For fitDataset(), config.epochs is expected to be a positive integer, but got "+a.epochs})),r.assert(!i||a.batchesPerEpoch>0&&Number.isInteger(a.batchesPerEpoch),(function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got "+a.batchesPerEpoch})),r.assert(null==a.validationSplit,(function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."})),!t.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return t.isTraining=!0,e.prev=4,(o=null!=a.validationData)&&(ZE(a.validationData)?r.assert(null==a.validationBatches||a.validationBatches>0&&Number.isInteger(a.validationBatches),(function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got "+a.validationBatches})):(c=function(e){if(3===e.length)throw new nN("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}(a.validationData),s=c.xs,u=c.ys)),l=t.makeTrainFunction(),h=t.getDedupedMetricsNames(),p=o?h.slice().concat(h.map((function(e){return"val_"+e}))):h.slice(),d=cE(a.callbacks,a.yieldEvery),f=null==a.verbose?1:a.verbose,m=hE(d,f,a.epochs,null,null,function(e,t){var n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}(n,a),null,o,p),v=m.callbackList,g=m.history,v.setModel(t),t.history=g,e.next=14,v.onTrainBegin();case 14:return t.stopTraining_=!1,y=null==a.initialEpoch?0:a.initialEpoch,e.next=18,n.iterator();case 18:b=e.sent;case 19:if(!(y<a.epochs)){e.next=89;break}return k={},e.next=23,v.onEpochBegin(y);case 23:if(x=0,w=0,e.t0=i,e.t0){e.next=29;break}return e.next=28,n.iterator();case 28:b=e.sent;case 29:if(i&&!(x<a.batchesPerEpoch)){e.next=82;break}return e.next=32,b.next();case 32:if(C=e.sent,!i||!C.done){e.next=36;break}return console.warn("You provided `batchesPerEpoch` as "+a.batchesPerEpoch+", but your dataset iterator ran out of data after "+x+" batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+a.batchesPerEpoch*a.epochs+" batches). You may need to use the repeat() function when building your dataset."),e.abrupt("break",82);case 36:if(null==C.value){e.next=63;break}return _=XE(t,C.value),S=_.xs,I=_.ys,(T={}).batch=w,T.size=S[0].shape[0],e.next=42,v.onBatchBegin(w,T);case 42:if(N=[],null==a.classWeight){e.next=55;break}A=HE(a.classWeight,t.outputNames),E=0;case 46:if(!(E<A.length)){e.next=55;break}return e.t1=N,e.next=50,jE(I[E],null,A[E]);case 50:e.t2=e.sent,e.t1.push.call(e.t1,e.t2);case 52:++E,e.next=46;break;case 55:for(R=S.concat(I).concat(N),F=l(R),mk(R),D=0;D<h.length;++D)O=F[D],T[h[D]]=O,vk(O);return e.next=60,v.onBatchEnd(w,T);case 60:rE(T),w++,x++;case 63:if(!(i?x>=a.batchesPerEpoch:C.done)){e.next=78;break}if(!o){e.next=77;break}if(M=void 0,!ZE(a.validationData)){e.next=74;break}return e.t4=uN,e.next=70,t.evaluateDataset(a.validationData,{batches:a.validationBatches});case 70:e.t5=e.sent,e.t3=(0,e.t4)(e.t5),e.next=75;break;case 74:e.t3=uN(t.evaluate(s,u,{batchSize:null==a.validationBatchSize?32:a.validationBatchSize,verbose:0}));case 75:for(M=e.t3,P=0;P<t.metricsNames.length;++P)k["val_"+t.metricsNames[P]]=M[P];case 77:return e.abrupt("break",82);case 78:if(!t.stopTraining_){e.next=80;break}return e.abrupt("break",82);case 80:e.next=29;break;case 82:return e.next=84,v.onEpochEnd(y,k);case 84:if(y++,!t.stopTraining_){e.next=87;break}return e.abrupt("break",89);case 87:e.next=19;break;case 89:return e.next=91,v.onTrainEnd();case 91:return e.next=93,t.history.syncData();case 93:return e.abrupt("return",t.history);case 94:return e.prev=94,t.isTraining=!1,e.finish(94);case 97:case"end":return e.stop()}}),e,null,[[4,,94,97]])})));return function(t,n,r){return e.apply(this,arguments)}}()(this,t,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"trainOnBatch",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,u,c,l,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.standardizeUserData(t,n);case 2:r=e.sent,a=r[0],i=r[1],o=this.makeTrainFunction()(a.concat(i)),s=[],u=_createForOfIteratorHelper(o),e.prev=8,u.s();case 10:if((c=u.n()).done){e.next=18;break}return l=c.value,e.next=14,l.data();case 14:h=e.sent,s.push(h[0]);case 16:e.next=10;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(8),u.e(e.t0);case 23:return e.prev=23,u.f(),e.finish(23);case 26:return e.abrupt("return",(mk(o),sN(s)));case 27:case"end":return e.stop()}}),e,this,[[8,20,23,26]])}))),function(e,t){return n.apply(this,arguments)})},{key:"getNamedWeights",value:function(e){for(var t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n),i=0;i<r.length;++i)n&&!r[i].trainable||t.push({name:r[i].originalName,tensor:a[i]});return t}},{key:"dispose",value:function(){var e=_get(_getPrototypeOf(l.prototype),"dispose",this).call(this);if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){var t=pk().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-pk().numTensors}return e}},{key:"getLossIdentifiers",value:function(){var e;if("string"==typeof this.loss)e=cN(this.loss);else if(Array.isArray(this.loss)){var t,n=_createForOfIteratorHelper(this.loss);try{for(n.s();!(t=n.n()).done;){if("string"!=typeof t.value)throw new Error("Serialization of non-string loss is not supported.")}}catch(UY){n.e(UY)}finally{n.f()}e=this.loss.map((function(e){return cN(e)}))}else{var r=Object.keys(this.loss);e={};for(var a=this.loss,i=0,o=r;i<o.length;i++){var s=o[i];if("string"!=typeof a[s])throw new Error("Serialization of non-string loss is not supported.");e[s]=cN(a[s])}}return e}},{key:"getMetricIdentifiers",value:function(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[cN(RE(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((function(e){return cN(RE(e))}));var e={};for(var t in this.metrics)e[t]=cN(RE(this.metrics[t]));return e}},{key:"getTrainingConfig",value:function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}},{key:"loadTrainingConfig",value:function(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");var t,n,r=pE(function e(t,n){if(null===t)return null;if("string"==typeof t)return lN(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){for(var r=[],a=t.length,i=0;i<a;++i){var o=t[i];PE(n,i,o)?r.push(o):r.push(e(o,n))}return r}for(var s={},u=0,c=Object.keys(t);u<c.length;u++){var l=c[u],h=t[l];if("name"===l&&"string"==typeof h)s[l]=h;else{var p=lN(l);s[p]=e(h,p)}}return s}(e.optimizer_config));if("string"==typeof e.loss)t=lN(e.loss);else if(Array.isArray(e.loss))t=e.loss.map((function(e){return lN(e)}));else if(null!=e.loss)for(var a in t={},e.loss)t[a]=lN(e.loss[a]);if(Array.isArray(e.metrics))n=e.metrics.map((function(e){return lN(e)}));else if(null!=e.metrics)for(var i in n={},e.metrics)n[i]=lN(e.metrics[i]);this.compile({loss:t,metrics:n,optimizer:r})}},{key:"save",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,s,u,c,l,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=7;break}if(0!==(r=o.getSaveHandlers(t)).length){e.next=4;break}throw new tN("Cannot find any save handlers for URL '".concat(t,"'"));case 4:if(!(r.length>1)){e.next=6;break}throw new tN("Found more than one (".concat(r.length,") save handlers for URL '").concat(t,"'"));case 6:t=r[0];case 7:if(null!=t.save){e.next=9;break}throw new tN("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 9:return e.next=11,o.encodeWeights(this.getNamedWeights(n));case 11:if(a=e.sent,i={modelTopology:this.toJSON(null,!1),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v2.8.1",convertedBy:null},null==n||!n.includeOptimizer||null==this.optimizer){e.next=27;break}return i.trainingConfig=this.getTrainingConfig(),u="optimizer",e.t0=o,e.next=19,this.optimizer.getWeights();case 19:return e.t1=e.sent,e.t2=u,e.next=23,e.t0.encodeWeights.call(e.t0,e.t1,e.t2);case 23:c=e.sent,l=c.data,h=c.specs,(s=a.specs).push.apply(s,_toConsumableArray(h)),a.data=o.concatenateArrayBuffers([a.data,l]);case 27:return e.abrupt("return",(null!=this.userDefinedMetadata&&(FE(this.userDefinedMetadata,this.name,!0),i.userDefinedMetadata=this.userDefinedMetadata),i.weightData=a.data,i.weightSpecs=a.specs,t.save(i)));case 28:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"setUserDefinedMetadata",value:function(e){FE(e,this.name),this.userDefinedMetadata=e}},{key:"getUserDefinedMetadata",value:function(){return this.userDefinedMetadata}},{key:"stopTraining",set:function(e){this.stopTraining_=e},get:function(){return this.stopTraining_}},{key:"optimizer",get:function(){return this.optimizer_},set:function(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}}]),l}(function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),(r=t.call(this,{})).containerNodes=new Set,r.name=e.name,null==r.name){var a=r.getClassName().toLowerCase();r.name=zA(a)}if(r.supportsMasking=!1,r.trainable_=!0,r.inputs=Array.isArray(e.inputs)?e.inputs.slice():[e.inputs],r.outputs=Array.isArray(e.outputs)?e.outputs.slice():[e.outputs],mN(r.inputs).length!==r.inputs.length)throw new tN("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+r.inputs.map((function(e){return e.name})));mN(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+r.outputs.map((function(e){return e.name}))),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[],r.internalContainerRefs=[];var i,o=_createForOfIteratorHelper(r.outputs);try{for(o.s();!(i=o.n()).done;){var s=i.value,u=s.nodeIndex,c=s.tensorIndex;r.outputLayers.push(s.sourceLayer),r.outputLayersNodeIndices.push(u),r.outputLayersTensorIndices.push(c)}}catch(UY){o.e(UY)}finally{o.f()}var l,h=_createForOfIteratorHelper(r.inputs);try{for(h.s();!(l=h.n()).done;){var p=l.value,d=p.sourceLayer,f=p.nodeIndex,m=p.tensorIndex;iN(0===f,"input layer has >1 nodes"),iN(0===m,"input layer has >1 tensors"),r.inputLayers.push(d),r.inputLayersNodeIndices.push(f),r.inputLayersTensorIndices.push(m)}}catch(UY){h.e(UY)}finally{h.f()}r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var v=0;v<r.inputLayers.length;v++){var g=r.inputLayers[v];if(!(g instanceof eE))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. Received inputs: ".concat(e.inputs,". Input ").concat(v," (0-based) originates from layer type ").concat(g.getClassName(),"."));r.inputNames.push(g.name),r.feedInputShapes.push(g.batchInputShape),r.feedInputNames.push(g.name)}var y,b=_createForOfIteratorHelper(r.outputLayers);try{for(b.s();!(y=b.n()).done;){var k=y.value;r.outputNames.push(k.name)}}catch(UY){b.e(UY)}finally{b.f()}r.internalInputShapes=r.inputs.map((function(e){return e.shape})),r.internalOutputShapes=r.outputs.map((function(e){return e.shape}));var x,w={},C={},_={},S={},I={},T=[],N=function e(t,a,i,o,s,u){null!=o&&null!=s&&null!=u||(o=t.sourceLayer,s=t.nodeIndex,u=t.tensorIndex);var c=o.inboundNodes[s];if(-1!==i.indexOf(c))throw new eN("The tensor ".concat(t.name,' at layer "').concat(o.name,'" is part of a cycle.'));if(-1===a.indexOf(c)){r.containerNodes.add(n.nodeKey(o,s)),o.id in I||(I[o.id]=Object.keys(I).length),-1===i.indexOf(c)&&i.push(c);for(var l=c.inboundLayers.length,h=0;h<l;h++)e(c.inputTensors[h],a,i,c.inboundLayers[h],c.nodeIndices[h],c.tensorIndices[h]);for(a.push(c);i.indexOf(c)>=0;)i.splice(i.indexOf(c),1);T.push(c)}},A=[],E=[],R=_createForOfIteratorHelper(r.outputs);try{for(R.s();!(x=R.n()).done;){N(x.value,A,E)}}catch(UY){R.e(UY)}finally{R.f()}var F,D=_createForOfIteratorHelper(T.slice().reverse());try{for(D.s();!(F=D.n()).done;){var O=F.value;C[O.id]=O,O.id in w||(w[O.id]=0);var M=w[O.id];M=Math.max(M,null==_[O.outboundLayer.id]?0:_[O.outboundLayer.id]),_[O.outboundLayer.id]=M,S[O.outboundLayer.id]=O.outboundLayer,w[O.id]=M;for(var P=0;P<O.inboundLayers.length;P++){var L=O.inboundLayers[P].inboundNodes[O.nodeIndices[P]];w[L.id]=Math.max(M+1,null==w[L.id]?0:w[L.id]),C[L.id]=L}}}catch(UY){D.e(UY)}finally{D.f()}var z={};for(var B in w){var V=w[B];V in z||(z[V]=[]),z[V].push(C[B])}var U={};for(var W in _){var G=_[W];G in U||(U[G]=[]),U[G].push(S[W])}var H=Object.keys(U).map((function(e){return parseInt(e,10)})).sort(fN);r.layers=[];var j,q=_createForOfIteratorHelper(H);try{for(q.s();!(j=q.n()).done;){var K=U[j.value];K.sort((function(e,t){var n=I[e.id],r=I[t.id];return n<r?-1:n>r?1:0}));var X,Y=_createForOfIteratorHelper(K);try{for(Y.s();!(X=Y.n()).done;){var Z=X.value;Z instanceof n&&r.internalContainerRefs.push(Z),r.layers.push(Z)}}catch(UY){Y.e(UY)}finally{Y.f()}}}catch(UY){q.e(UY)}finally{q.f()}r.layersByDepth=U,H=Object.keys(z).map((function(e){return parseInt(e,10)})).sort(fN);var Q,J=r.inputs.slice(),$=[],ee=_createForOfIteratorHelper(H);try{for(ee.s();!(Q=ee.n()).done;){var te,ne=_createForOfIteratorHelper(z[Q.value]);try{for(ne.s();!(te=ne.n()).done;){var re=te.value,ae=re.outboundLayer;if(null!=ae){var ie,oe=_createForOfIteratorHelper(re.inputTensors);try{for(oe.s();!(ie=oe.n()).done;){var se=ie.value;if(-1===J.indexOf(se))throw new eN("Graph disconnected: cannot obtain value for tensor "+se+' at layer "'.concat(ae.name,'". The following previous layers were accessed without issue: ')+$)}}catch(UY){oe.e(UY)}finally{oe.f()}var ue,ce=_createForOfIteratorHelper(re.outputTensors);try{for(ce.s();!(ue=ce.n()).done;){var le=ue.value;J.push(le)}}catch(UY){ce.e(UY)}finally{ce.f()}$.push(ae.name)}}}catch(UY){ne.e(UY)}finally{ne.f()}}}catch(UY){ee.e(UY)}finally{ee.f()}r.nodesByDepth=z;var he,pe=r.layers.map((function(e){return e.name})),de=_createForOfIteratorHelper(pe);try{var fe=function(){var e=he.value,t=pe.filter((function(t){return t===e})).length;if(1!==t)throw new eN('The name "'.concat(e,'" is used ').concat(t," times in the model. All layer names should be unique. Layer names: ")+JSON.stringify(pe))};for(de.s();!(he=de.n()).done;)fe()}catch(UY){de.e(UY)}finally{de.f()}return r.outboundNodes=[],r.inboundNodes=[],new QA({outboundLayer:_assertThisInitialized(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map((function(e){return null})),outputMasks:r.outputs.map((function(e){return null})),inputShapes:r.inputs.map((function(e){return e.shape})),outputShapes:r.outputs.map((function(e){return e.shape}))}),r.built=!0,r._refCount=1,_possibleConstructorReturn(r)}return _createClass(n,[{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){this.assertNotDisposed();var e={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount){var t,n=_createForOfIteratorHelper(this.layers);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.numDisposedVariables+=r.dispose().numDisposedVariables}}catch(UY){n.e(UY)}finally{n.f()}var a,i=_createForOfIteratorHelper(this.internalContainerRefs);try{for(i.s();!(a=i.n()).done;){var o=a.value;e.numDisposedVariables+=o.dispose().numDisposedVariables}}catch(UY){i.e(UY)}finally{i.f()}}return e.refCountAfterDispose=this._refCount,e}},{key:"loadWeights",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r={},a=0,i=_createForOfIteratorHelper(this.layers);try{for(i.s();!(t=i.n()).done;){var o,s=t.value,u=_createForOfIteratorHelper(s.weights);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(null!=r[c.originalName])throw new tN("Duplicate weight name: "+c.originalName);r[c.originalName]=c,a++}}catch(UY){u.e(UY)}finally{u.f()}}}catch(UY){i.e(UY)}finally{i.f()}var l=[];for(var h in e){var p=h;if(null==r[h]){var d=h.split("/");p=d.slice(0,-2).concat([d[d.length-1]]).join("/")}if(null!=r[p])l.push([r[p],e[h]]);else if(n)throw new tN("Provided weight data has no target variable: "+h);delete r[p]}if(n){var f=[];for(var m in r)f.push(m);if(f.length>0)throw new tN("".concat(f.length," of ").concat(a," weights are not set: ")+f)}qA(l)}},{key:"updatedConfig",value:function(){var e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers 2.8.1",t.backend="TensorFlow.js",t}},{key:"toJSON",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=function e(t,n){if(null==t)return null;if("string"==typeof t)return cN(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){for(var r=[],a=t.length,i=0;i<a;++i){var o=t[i];PE(n,i,o)?r.push(o):r.push(e(o,n))}return r}for(var s={},u=0,c=Object.keys(t);u<c.length;u++){var l=c[u],h=t[l];s[cN(l)]="name"!==l&&"className"!==l||"string"!=typeof h?e(h,l):h}return s}(this.updatedConfig());return t?JSON.stringify(n):n}},{key:"call",value:function(e,t){var n=this;return fk((function(){e=uN(e);for(var r=new LE,a=0;a<n.inputs.length;++a)r.add(n.inputs[a],e[a]);return VE(n.outputs,r,t)}))}},{key:"computeMask",value:function(e,t){var n=this;return fk((function(){var r;return e=uN(e),r=null==t?aN(null,e.length):uN(t),n.runInternalGraph(e,r)[1]}))}},{key:"computeOutputShape",value:function(e){var t=VA(e);if(t.length!==this.inputLayers.length)throw new tN("Invalid inputShape argument ".concat(e,": model has ").concat(this.inputLayers.length," tensor inputs."));for(var n={},r=0;r<t.length;r++)n[this.inputLayers[r].name+"_0_0"]=t[r];var a=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(fN);if(a.length>1){var i,o=_createForOfIteratorHelper(a);try{for(o.s();!(i=o.n()).done;){var s,u=i.value,c=_createForOfIteratorHelper(this.nodesByDepth[u]);try{for(c.s();!(s=c.n()).done;){var l=s.value,h=l.outboundLayer;if(-1===this.inputLayers.map((function(e){return e.id})).indexOf(h.id)){for(var p=[],d=0;d<l.inboundLayers.length;d++)p.push(n["".concat(l.inboundLayers[d].name,"_").concat(l.nodeIndices[d],"_").concat(l.tensorIndices[d])]);for(var f=VA(h.computeOutputShape(sN(p))),m=h.inboundNodes.indexOf(l),v=0;v<f.length;v++)n["".concat(h.name,"_").concat(m,"_").concat(v)]=f[v]}}}catch(UY){c.e(UY)}finally{c.f()}}}catch(UY){o.e(UY)}finally{o.f()}}for(var g=[],y=[],b=0;b<this.outputLayers.length;b++)y.push("".concat(this.outputLayers[b].name,"_").concat(this.outputLayersNodeIndices[b],"_").concat(this.outputLayersTensorIndices[b]));for(var k=0;k<y.length;k++){var x=y[k];iN(x in n),g.push(n[x])}return sN(g)}},{key:"runInternalGraph",value:function(e,t){null==t&&(t=aN(null,e.length));for(var n={},r=0;r<this.inputs.length;++r)n[this.inputs[r].id]=[e[r],t[r]];var a,i=_createForOfIteratorHelper(Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(fN));try{for(i.s();!(a=i.n()).done;){var o,s=a.value,u=_createForOfIteratorHelper(this.nodesByDepth[s]);try{for(u.s();!(o=u.n()).done;){var c,l=o.value,h=l.outboundLayer,p=l.inputTensors,d=l.outputTensors,f=new Array,m=_createForOfIteratorHelper(p);try{for(m.s();!(c=m.n()).done;){var v=c.value;v.id in n&&f.push(n[v.id])}}catch(UY){m.e(UY)}finally{m.f()}if(f.length===p.length){var g=void 0,y=void 0,b=void 0,k=void 0,x={};if(null!=l.callArgs&&(x=l.callArgs),1===f.length){var w=_slicedToArray(f[0],2),C=w[0],_=w[1];null==x.mask&&(x.mask=_),b=uN(h.call(C,x)),k=uN(h.computeMask(C,_)),g=[C],y=[_]}else g=f.map((function(e){return e[0]})),y=f.map((function(e){return e[1]})),null==x.mask&&(x.mask=y),b=uN(h.call(g,x)),k=uN(h.computeMask(g,y));if(h.activityRegularizer)throw new nN("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var S=0;S<d.length;++S)n[d[S].id]=[b[S],k[S]]}}}catch(UY){u.e(UY)}finally{u.f()}}}catch(UY){i.e(UY)}finally{i.f()}var I,T=[],N=[],A=[],E=_createForOfIteratorHelper(this.outputs);try{for(E.s();!(I=E.n()).done;){var R=I.value;iN(R.id in n,"Could not compute output ".concat(R.name," : ").concat(R.id));var F=_slicedToArray(n[R.id],2),D=F[0],O=F[1];A.push(D.shape),T.push(D),N.push(O)}}catch(UY){E.e(UY)}finally{E.f()}return[T,N,A]}},{key:"buildNodeConversionMap",value:function(e){var t,r,a={},i=_createForOfIteratorHelper(this.layers);try{for(i.s();!(r=i.n()).done;){var o=r.value;t=o instanceof n?1:0;for(var s=0;s<o.inboundNodes.length;s++){var u=n.nodeKey(o,s);this.containerNodes.has(u)&&(a[u]=t,t+=1)}}}catch(UY){i.e(UY)}finally{i.f()}return a}},{key:"getLayer",value:function(e,t){if(null!=t){if(this.layers.length<=t)throw new tN("Was asked to retrieve layer at index ".concat(t,", but model only has ").concat(this.layers.length," layer(s)."));return this.layers[t]}if(null==e)throw new tN("Provide either a layer name or layer index");var n,r=_createForOfIteratorHelper(this.layers);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.name===e)return a}}catch(UY){r.e(UY)}finally{r.f()}throw new tN("No such layer: "+e)}},{key:"calculateLosses",value:function(){var e=this;return fk((function(){var t,r=[],a=_createForOfIteratorHelper(e.layers);try{for(a.s();!(t=a.n()).done;)for(var i=t.value,o=0;o<i.inboundNodes.length;++o){var s=n.nodeKey(i,o);e.containerNodes.has(s)&&r.push.apply(r,_toConsumableArray(i.calculateLosses()))}}catch(UY){a.e(UY)}finally{a.f()}return r}))}},{key:"getConfig",value:function(){var e,t={name:this.name},r=this.buildNodeConversionMap(this.layers),a=[],i=_createForOfIteratorHelper(this.layers);try{for(i.s();!(e=i.n()).done;){for(var o=e.value,s=o.getClassName(),u=o.getConfig(),c=[],l=0;l<o.inboundNodes.length;l++){var h=o.inboundNodes[l],p=n.nodeKey(o,l),d={};if(this.containerNodes.has(p)){if(h.callArgs)try{JSON.stringify(h.callArgs),d=h.callArgs}catch(UY){console.warn("Layer ".concat(o.name," was passed non-serializable keyword arguments: ")+h.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),d={}}if(h.inboundLayers.length>0){for(var f=[],m=0;m<h.inboundLayers.length;m++){var v=h.inboundLayers[m],g=h.tensorIndices[m],y=r[n.nodeKey(v,h.nodeIndices[m])];null==y&&(y=0),f.push([v.name,y,g,d])}c.push(f)}}}var b={};b.name=o.name,b.className=s,b.config=u,b.inboundNodes=c,a.push(b)}}catch(UY){i.e(UY)}finally{i.f()}t.layers=a;for(var k=[],x=0;x<this.inputLayers.length;x++){var w=this.inputLayers[x],C=n.nodeKey(w,this.inputLayersNodeIndices[x]);if(this.containerNodes.has(C)){var _=r[C];null==_&&(_=0),k.push([w.name,_,this.inputLayersTensorIndices[x]])}}t.inputLayers=k;for(var S=[],I=0;I<this.outputLayers.length;I++){var T=this.outputLayers[I],N=n.nodeKey(T,this.outputLayersNodeIndices[I]);if(this.containerNodes.has(N)){var A=r[N];null==A&&(A=0),S.push([T.name,A,this.outputLayersTensorIndices[I]])}}return t.outputLayers=S,t}},{key:"resetStates",value:function(){var e=this;fk((function(){e.layers.forEach((function(e){e.stateful&&e.resetStates()}))}))}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.layers.forEach((function(t){t._trainableWeights.forEach((function(t){return t.trainable=e}))})),this.trainable_=e}},{key:"trainableWeights",get:function(){if(this._trainableWeights.length>0)throw new tN("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var e,t=[],n=_createForOfIteratorHelper(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t=t.concat(r.trainableWeights)}}catch(UY){n.e(UY)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=_createForOfIteratorHelper(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,_toConsumableArray(r.nonTrainableWeights))}}catch(UY){n.e(UY)}finally{n.f()}if(!this.trainable){var a,i=[],o=_createForOfIteratorHelper(this.layers);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,_toConsumableArray(s.trainableWeights))}}catch(UY){o.e(UY)}finally{o.f()}return i.concat(t)}return t}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"stateful",get:function(){if(this._stateful)throw new tN("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");var e,t=_createForOfIteratorHelper(this.layers);try{for(t.s();!(e=t.n()).done;){if(e.value.stateful)return!0}}catch(UY){t.e(UY)}finally{t.f()}return!1}}],[{key:"fromConfig",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r={},a={};function i(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function o(e,t){var n,a,o=[],s=_createForOfIteratorHelper(t);try{for(s.s();!(a=s.n()).done;){var u=a.value,c=u[0],l=u[1],h=u[2];if(n=null==u[3]?{}:u[3],!(c in r))return void i(e,t);var p=r[c];if(p.inboundNodes.length<=l)return void i(e,t);o.push(p.inboundNodes[l].outputTensors[h])}}catch(UY){s.e(UY)}finally{s.f()}o.length>0&&e.apply(sN(o),n)}function s(e){var a=e.name,o=pE(e,null!=t.customObjects?t.customObjects:{});o.setFastWeightInitDuringBuild(n),r[a]=o,e.inboundNodes.forEach((function(e){if(!(e instanceof Array))throw new tN("Corrupted configuration, expected array for nodeData: "+e);i(o,e)}))}var u,c=t.name,l=t.layers,h=_createForOfIteratorHelper(l);try{for(h.s();!(u=h.n()).done;){var p=u.value;s(p)}}catch(UY){h.e(UY)}finally{h.f()}for(;!vN(a);){var d,f=_createForOfIteratorHelper(l);try{for(f.s();!(d=f.n()).done;){var m=d.value,v=r[m.name];if(v.name in a){var g=a[v.name];delete a[v.name];var y,b=_createForOfIteratorHelper(g);try{for(b.s();!(y=b.n()).done;){var k=y.value;o(v,k)}}catch(UY){b.e(UY)}finally{b.f()}}}}catch(UY){f.e(UY)}finally{f.f()}}var x,w=[],C=[],_=t.inputLayers,S=_createForOfIteratorHelper(_);try{for(S.s();!(x=S.n()).done;){var I=x.value,T=I[0],N=I[1],A=I[2];iN(T in r),w.push(r[T].inboundNodes[N].outputTensors[A])}}catch(UY){S.e(UY)}finally{S.f()}var E,R=t.outputLayers,F=_createForOfIteratorHelper(R);try{for(F.s();!(E=F.n()).done;){var D=E.value,O=D[0],M=D[1],P=D[2];iN(O in r),C.push(r[O].inboundNodes[M].outputTensors[P])}}catch(UY){F.e(UY)}finally{F.f()}return new e({inputs:w,outputs:C,name:c})}}]),n}($A));sR.className="Model",p.registerClass(sR);var uR=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return n}(sR);uR.className="Functional",p.registerClass(uR);var cR=function(e){_inherits(s,e);var t,n,a,i,o=_createSuper(s);function s(e){var t;if(_classCallCheck(this,s),e=e||{},(t=o.call(this,{inputs:[],outputs:[]})).trainable=!0,t.built=!1,t.name=null!=e.name?e.name:zA("sequential_"),null!=e.layers){var n,r=_createForOfIteratorHelper(e.layers);try{for(r.s();!(n=r.n()).done;){var a=n.value;t.add(a)}}catch(UY){r.e(UY)}finally{r.f()}}return _possibleConstructorReturn(t)}return _createClass(s,[{key:"checkShape",value:function(e){if(e.inboundNodes[0].outputTensors[0].shape.some((function(e){return e<0})))throw new tN("Negative dimension size caused by adding layer "+e.name+" with input shape ["+e.inboundNodes[0].inputTensors[0].shape+"]")}},{key:"add",value:function(e){var t,n=e instanceof s||e instanceof sR;if(n){if(1!==(t=e).outputs.length)throw new tN("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==t.inputs.length)throw new tN("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new tN("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var r=function(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new tN("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n="float32"),new eE({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(n)this.outputs=t.outputs,this.inputs=t.inputs;else{if(1!==e.inboundNodes.length)throw new tN("A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ".concat(e.name," which has ").concat(e.inboundNodes.length," pre-existing inbound connections."));if(1!==e.inboundNodes[0].outputTensors.length)throw new tN("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=function e(t,n,r){if((null==n||null!=r&&r>0)&&(n=t.sourceLayer,r=t.nodeIndex),0===n.inboundNodes.length)return[t];var a=n.inboundNodes[r];if(0===a.inboundLayers.length)return a.inputTensors;for(var i=[],o=0;o<a.inboundLayers.length;o++){var s,u=_createForOfIteratorHelper(e(a.inputTensors[o],a.inboundLayers[o],a.nodeIndices[o]));try{for(u.s();!(s=u.n()).done;){var c=s.value;-1===i.indexOf(c)&&i.push(c)}}catch(UY){u.e(UY)}finally{u.f()}}return i}(this.outputs[0])}this.inboundNodes=[],new QA({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:aN(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((function(e){return e.shape})),outputShapes:this.outputs[0].shape})}else{var a=e.apply(this.outputs[0]);if(Array.isArray(a))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[a],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}},{key:"pop",value:function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}},{key:"call",value:function(e,t){return null==this.model&&this.build(),this.model.call(e,t)}},{key:"build",value:function(e){if(WA(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new sR({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}},{key:"countParams",value:function(){return this.built||this.build(),_get(_getPrototypeOf(s.prototype),"countParams",this).call(this)}},{key:"summary",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),_get(_getPrototypeOf(s.prototype),"summary",this).call(this,e,t,n)}},{key:"setWeights",value:function(e){null==this.model&&this.build(),this.model.setWeights(e)}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new eN("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}},{key:"evaluateDataset",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new eN("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.evaluateDataset(t,n));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}},{key:"predictOnBatch",value:function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}},{key:"compile",value:function(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}},{key:"fit",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>2&&void 0!==a[2]?a[2]:{},this.built){e.next=3;break}throw new eN("The model needs to be compiled before being used.");case 3:return e.abrupt("return",this.model.fit(t,n,r));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"fitDataset",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new eN("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.fitDataset(t,n));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"trainOnBatch",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.model.trainOnBatch(t,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"getConfig",value:function(){var e,t=[],n=_createForOfIteratorHelper(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value,a={};a.className=r.getClassName(),a.config=r.getConfig(),t.push(a)}}catch(UY){n.e(UY)}finally{n.f()}return{name:this.name,layers:t}}},{key:"optimizer",get:function(){return null==this.model?void 0:this.model.optimizer},set:function(e){this.model.optimizer=e}},{key:"stopTraining",set:function(e){if(null==this.model)throw new tN("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e},get:function(){if(null==this.model)throw new tN("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}}],[{key:"fromConfig",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new tN("Legacy serialization format not supported yet.");n=t}else r.assert(null!=t.layers,(function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."})),n=t.layers,delete t.layers,i=t;var o=new e(i);if(!(o instanceof s))throw new nN("Sequential.fromConfig called on non-Sequential input: "+o);var u,c=_createForOfIteratorHelper(n);try{for(c.s();!(u=c.n()).done;){var l=u.value,h=pE(l,void 0,a);a&&h.setFastWeightInitDuringBuild(!0),o.add(h)}}catch(UY){c.e(UY)}finally{c.f()}return o}}]),s}(sR);cR.className="Sequential",p.registerClass(cR);var lR=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"getConfig",value:function(){return{}}}]),n}(p.Serializable),hR=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new nN("Support for alpha values other than 1 (".concat(t,") is not implemented yet."));return mw(e)}(e,t)}}]),n}(lR);hR.className="elu",p.registerClass(hR);var pR=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){return KC(e)}}]),n}(lR);pR.className="selu",p.registerClass(pR);var dR=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){return zC(e)}}]),n}(lR);dR.className="relu",p.registerClass(dR);var fR=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){return fk((function(){return sC(6,zC(e))}))}}]),n}(lR);fR.className="relu6",p.registerClass(fR);var mR=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){return e}}]),n}(lR);mR.className="linear",p.registerClass(mR);var vR=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){return Dx(e)}}]),n}(lR);vR.className="sigmoid",p.registerClass(vR);var gR=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){return function(e){return fk((function(){var t=Tk(.5,Ek(.2,e));return jx(t,0,1)}))}(e)}}]),n}(lR);gR.className="hardSigmoid",p.registerClass(gR);var yR=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){return zw(e)}}]),n}(lR);yR.className="softplus",p.registerClass(yR);var bR=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){return function(e){return fk((function(){return Ak(e,Yk(e).add(1))}))}(e)}}]),n}(lR);bR.className="softsign",p.registerClass(bR);var kR=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){return Mx(e)}}]),n}(lR);kR.className="tanh",p.registerClass(kR);var xR=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return r_(e,t)}}]),n}(lR);xR.className="softmax",p.registerClass(xR);var wR=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return Ww(e,t)}}]),n}(lR);wR.className="logSoftmax",p.registerClass(wR);var CR=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return fk((function(){return Dx(e.mul(t)).mul(e)}))}}]),n}(lR);function _R(e){return e.getClassName()}function SR(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return dN(e,p.SerializationMap.getMap().classNameMap,t,"activation")}function IR(e){if(null==e)return SR({className:"linear",config:{}});if("string"==typeof e){var t={};return t.className=e,t.config={},SR(t)}return e instanceof lR?e:SR(e)}CR.className="swish",p.registerClass(CR);var TR=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return n}(p.Serializable),NR=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),r=t.call(this),function(e){if(null!=e&&"object"!=typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: "+e)}(e),r.l1=null==e||null==e.l1?.01:e.l1,r.l2=null==e||null==e.l2?.01:e.l2,r.hasL1=0!==r.l1,r.hasL2=0!==r.l2,r}return _createClass(n,[{key:"apply",value:function(e){var t=this;return fk((function(){var n=fC([1]);return t.hasL1&&(n=Tk(n,Uw(Ek(t.l1,Yk(e))))),t.hasL2&&(n=Tk(n,Uw(Ek(t.l2,uA(e))))),n.asScalar()}))}},{key:"getConfig",value:function(){return{l1:this.l1,l2:this.l2}}}],[{key:"fromConfig",value:function(e,t){return new e({l1:t.l1,l2:t.l2})}}]),n}(TR);NR.className="L1L2",p.registerClass(NR);var AR={l1l2:"L1L2"};function ER(e){return pN(e)}function RR(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return dN(e,p.SerializationMap.getMap().classNameMap,t,"regularizer")}function FR(e){return null==e?null:"string"==typeof e?RR({className:e in AR?AR[e]:e,config:{}}):e instanceof TR?e:RR(e)}var DR=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,null!=e&&(r.maxValue=e.maxValue),r}return _createClass(n,[{key:"call",value:function(e,t){e=UA(e);var n=zC(e);return null!=this.maxValue&&(n=jx(n,0,this.maxValue)),n}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={maxValue:this.maxValue},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($A);DR.className="ReLU",p.registerClass(DR);var OR=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=.3,null==e&&(e={}),r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return _createClass(n,[{key:"call",value:function(e,t){var n=UA(e);return Ew(n,this.alpha)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($A);OR.className="LeakyReLU",p.registerClass(OR);var MR=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),r.supportsMasking=!0,r.alphaInitializer=OA(e.alphaInitializer||r.DEFAULT_ALPHA_INITIALIZER),r.alphaRegularizer=FR(e.alphaRegularizer),r.alphaConstraint=EN(e.alphaConstraint),null==e.sharedAxes)r.sharedAxes=null;else if(Array.isArray(e.sharedAxes))r.sharedAxes=e.sharedAxes;else{if("number"!=typeof e.sharedAxes)throw new tN("Expected sharedAxes to be a number or an array of numbers, but got "+e.sharedAxes);r.sharedAxes=[e.sharedAxes]}return _possibleConstructorReturn(r)}return _createClass(n,[{key:"build",value:function(e){var t=(e=WA(e)).slice(1);if(null!=this.sharedAxes){var n,r=_createForOfIteratorHelper(this.sharedAxes);try{for(r.s();!(n=r.n()).done;){t[n.value-1]=1}}catch(UY){r.e(UY)}finally{r.f()}}this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var a={};if(null!=this.sharedAxes)for(var i=1;i<e.length;++i)a[i]=e[i];this.inputSpec=[new XA({ndim:e.length,axes:a})],this.built=!0}},{key:"call",value:function(e,t){return e=UA(e),SC(e,this.alpha.read())}},{key:"getConfig",value:function(){var e={alphaInitializer:DA(this.alphaInitializer),alphaRegularizer:ER(this.alphaRegularizer),alphaConstraint:NN(this.alphaConstraint),sharedAxes:this.sharedAxes},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($A);MR.className="PReLU",p.registerClass(MR);var PR=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==r.DEFAULT_ALPHA)throw new nN("Non-default alpha value (".concat(e.alpha,") is not supported by the ELU layer yet."));return r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,_possibleConstructorReturn(r)}return _createClass(n,[{key:"call",value:function(e,t){var n=UA(e);return mw(n)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($A);PR.className="ELU",p.registerClass(PR);var LR=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_THETA=1,null==e&&(e={}),r.theta=null==e.theta?r.DEFAULT_THETA:e.theta,r}return _createClass(n,[{key:"call",value:function(e,t){var n=UA(e);return n.mul(QN(n.greater(this.theta),"float32"))}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={theta:this.theta},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($A);LR.className="ThresholdedReLU",p.registerClass(LR);var zR=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_AXIS=1,null==e&&(e={}),r.softmax=(new xR).apply,r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r}return _createClass(n,[{key:"call",value:function(e,t){var n=UA(e);return this.softmax(n,this.axis)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={axis:this.axis},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($A);function BR(e,t,n){if("number"==typeof e)return aN(e,t);if(e.length!==t)throw new tN("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers. Received: ").concat(e.length," elements."));for(var r=0;r<t;++r){var a=e[r];if((i=a)!==parseInt(i.toString(),10))throw new tN("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers. Received: ").concat(JSON.stringify(e)," including a non-integer number ")+a)}return e;var i}function VR(e,t,n,r){var a,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return null==e?e:(a="same"===n?e:e-(t+(t-1)*(i-1))+1,Math.floor((a+r-1)/r))}function UR(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+YN([n-t,0]);else{if("same"!==r)throw new tN("Unsupport padding mode: ".concat(r,"."));e*=t}return e}function WR(e,t){return fk((function(){return LN(t),"channelsFirst"===t?bb(e,[0,2,3,1]):e}))}function GR(e,t){return fk((function(){return LN(t),"channelsFirst"===t?bb(e,[0,2,3,4,1]):e}))}function HR(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return fk((function(){if(null==i&&(i="channelsLast"),LN(i),3!==e.rank&&4!==e.rank)throw new tN("conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new tN("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ".concat(e.rank,"."));var u=WR(e,i);if("causal"===a)throw new nN("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=f.conv2d({x:u,filter:t,strides:r,pad:"same"===a?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:s}),"channelsFirst"===i&&(u=bb(u,[0,3,1,2])),u}))}zR.className="Softmax",p.registerClass(zR);var jR=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;if(_classCallCheck(this,n),(a=t.call(this,r)).bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",n.verifyArgs(r),a.rank=e,bN(a.rank,"rank"),1!==a.rank&&2!==a.rank&&3!==a.rank)throw new nN("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is not implemented yet."));if(a.kernelSize=BR(r.kernelSize,e,"kernelSize"),a.strides=BR(null==r.strides?1:r.strides,e,"strides"),a.padding=null==r.padding?"valid":r.padding,zN(a.padding),a.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,LN(a.dataFormat),a.activation=IR(r.activation),a.useBias=null==r.useBias||r.useBias,a.biasInitializer=OA(r.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=EN(r.biasConstraint),a.biasRegularizer=FR(r.biasRegularizer),a.activityRegularizer=FR(r.activityRegularizer),a.dilationRate=BR(null==r.dilationRate?1:r.dilationRate,e,"dilationRate"),1===a.rank&&Array.isArray(a.dilationRate)&&1!==a.dilationRate.length)throw new tN("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(a.dilationRate));if(2===a.rank){if("number"==typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate];else if(2!==a.dilationRate.length)throw new tN("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(a.dilationRate))}else if(3===a.rank)if("number"==typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(3!==a.dilationRate.length)throw new tN("dilationRate must be a number or array of three numbers for 3D convolution, but received "+JSON.stringify(a.dilationRate));return _possibleConstructorReturn(a)}return _createClass(n,[{key:"getConfig",value:function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:_R(this.activation),useBias:this.useBias,biasInitializer:DA(this.biasInitializer),biasRegularizer:ER(this.biasRegularizer),activityRegularizer:ER(this.activityRegularizer),biasConstraint:NN(this.biasConstraint)},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(iN("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!=typeof e.kernelSize&&!yN(e.kernelSize,"number",1,3))throw new tN("BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}($A),qR=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this,e,r)).kernel=null,n.verifyArgs(r),a.filters=r.filters,bN(a.filters,"filters"),a.kernelInitializer=OA(r.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=EN(r.kernelConstraint),a.kernelRegularizer=FR(r.kernelRegularizer),a}return _createClass(n,[{key:"build",value:function(e){e=WA(e);var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new tN("The channel dimension of the input should be defined. Found "+e[t]);var n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:_defineProperty({},t,n)}],this.built=!0}},{key:"call",value:function(e,t){var n=this;return fk((function(){var t;e=UA(e);var r=null==n.bias?null:n.bias.read(),a=kN(n.activation.getClassName());if(null!=a&&2===n.rank)t=HR(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate,a);else{if(1===n.rank)t=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return fk((function(){if(null==i&&(i="channelsLast"),LN(i),3!==e.shape.length)throw new tN("The input of a conv1dWithBias operation should be 3, but is "+e.shape.length+" instead.");if(3!==t.shape.length)throw new tN("The kernel for a conv1dWithBias operation should be 3, but is "+t.shape.length+" instead");if(null!=n&&1!==n.shape.length)throw new tN("The bias for a conv1dWithBias operation should be 1, but is "+t.shape.length+" instead");if("channelsFirst"===i&&(e=bb(e,[0,2,1])),"causal"===a)throw new nN("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=Qx(e,t,r,"same"===a?"same":"valid","NWC",o);return null!=n&&(s=lA(s,n)),s}))}(e,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)t=HR(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else{if(3!==n.rank)throw new nN("convolutions greater than 3D are not implemented yet.");t=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;return fk((function(){if(null==i&&(i="channelsLast"),LN(i),4!==e.rank&&5!==e.rank)throw new tN("conv3dWithBias expects input to be of rank 4 or 5, but received "+e.rank+".");if(4!==t.rank&&5!==t.rank)throw new tN("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+e.rank+".");var s=GR(e,i);if("causal"===a)throw new nN("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=ew(s,t,r,"same"===a?"same":"valid","NDHWC",o),null!=n&&(s=lA(s,n)),"channelsFirst"===i&&(s=bb(s,[0,4,1,2,3])),s}))}(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate)}null!=n.activation&&(t=n.activation.apply(t))}return t}))}},{key:"computeOutputShape",value:function(e){e=WA(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),r=0;r<n.length;++r){var a=VR(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(a)}var i=[e[0]];return"channelsLast"===this.dataFormat?(i=i.concat(t)).push(this.filters):(i.push(this.filters),i=i.concat(t)),i}},{key:"getConfig",value:function(){var e={filters:this.filters,kernelInitializer:DA(this.kernelInitializer),kernelRegularizer:ER(this.kernelRegularizer),kernelConstraint:NN(this.kernelConstraint)},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(!("filters"in e)||"number"!=typeof e.filters||e.filters<1)throw new tN("Convolution layer expected config.filters to be a 'number' > 0 but got "+JSON.stringify(e.filters))}}]),n}(jR),KR=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),r=t.call(this,2,e),n.verifyArgs(e),r}return _createClass(n,[{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&!yN(e.kernelSize,"number",1,2))throw new tN("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(qR);KR.className="Conv2D",p.registerClass(KR);var XR=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),r=t.call(this,3,e),n.verifyArgs(e),r}return _createClass(n,[{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new tN("Conv3D expects config.kernelSize to be number or [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(qR);XR.className="Conv3D",p.registerClass(XR);var YR=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),(r=t.call(this,e)).inputSpec=[new XA({ndim:4})],"same"!==r.padding&&"valid"!==r.padding)throw new tN("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+r.padding);return _possibleConstructorReturn(r)}return _createClass(n,[{key:"build",value:function(e){if(4!==(e=WA(e)).length)throw new tN("Input should have rank 4; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new tN("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new XA({ndim:4,axes:_defineProperty({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return fk((function(){var t=UA(e);if(4!==t.shape.length)throw new tN("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+t.shape.length);var r,a,i=t.shape;"channelsFirst"===n.dataFormat?(r=2,a=3):(r=1,a=2);var o=i[a],s=n.kernelSize[1],u=n.strides[1],c=[i[0],UR(i[r],n.strides[0],n.kernelSize[0],n.padding),UR(o,u,s,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=bb(t,[0,2,3,1]));var l=$x(t,n.kernel.read(),c,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(l=bb(l,[0,3,1,2])),null!=n.bias&&(l=lA(l,n.bias.read(),n.dataFormat)),null!=n.activation&&(l=n.activation.apply(l)),l}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=(e=WA(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3):(t=3,n=1,r=2);var i=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return a[t]=this.filters,a[n]=UR(a[n],s,i,this.padding),a[r]=UR(a[r],u,o,this.padding),a}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(KR);YR.className="Conv2DTranspose",p.registerClass(YR);var ZR=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;if(_classCallCheck(this,n),(a=t.call(this,e,r)).DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,null==r.filters)throw new tN("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=r.kernelInitializer||null!=r.kernelRegularizer||null!=r.kernelConstraint)throw new tN("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=r.padding&&"same"!==r.padding&&"valid"!==r.padding)throw new tN("SeparableConv".concat(a.rank,"D supports only padding modes: 'same' and 'valid', but received ")+JSON.stringify(r.padding));return a.depthMultiplier=null==r.depthMultiplier?1:r.depthMultiplier,a.depthwiseInitializer=OA(r.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=FR(r.depthwiseRegularizer),a.depthwiseConstraint=EN(r.depthwiseConstraint),a.pointwiseInitializer=OA(r.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=FR(r.pointwiseRegularizer),a.pointwiseConstraint=EN(r.pointwiseConstraint),_possibleConstructorReturn(a)}return _createClass(n,[{key:"build",value:function(e){if((e=WA(e)).length<this.rank+2)throw new tN("Inputs to SeparableConv".concat(this.rank,"D should have rank ")+(this.rank+2)+", but received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new tN("The channel dimension of the inputs should be defined, but found "+JSON.stringify(e[t]));for(var n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),a=[],i=0;i<this.rank;++i)a.push(1);a.push(n*this.depthMultiplier,this.filters),this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,!0,this.pointwiseConstraint),this.bias=this.useBias?this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.inputSpec=[new XA({ndim:this.rank+2,axes:_defineProperty({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return fk((function(){var t;if(e=UA(e),1===n.rank)throw new nN("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(e=bb(e,[0,2,3,1])),t=XC(e,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(t=lA(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),"channelsFirst"===n.dataFormat&&(t=bb(t,[0,3,1,2])),t}))}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=DA(this.depthwiseInitializer),e.pointwiseInitializer=DA(this.pointwiseInitializer),e.depthwiseRegularizer=ER(this.depthwiseRegularizer),e.pointwiseRegularizer=ER(this.pointwiseRegularizer),e.depthwiseConstraint=NN(this.depthwiseConstraint),e.pointwiseConstraint=NN(this.pointwiseConstraint),e}}]),n}(qR);ZR.className="SeparableConv";var QR=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,2,e)}return n}(ZR);QR.className="SeparableConv2D",p.registerClass(QR);var JR=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),r=t.call(this,1,e),n.verifyArgs(e),r.inputSpec=[{ndim:3}],r}return _createClass(n,[{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.dataFormat,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&!yN(e.kernelSize,"number",1,1))throw new tN("Conv1D expects config.kernelSize to be number or number[] with length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(qR);JR.className="Conv1D",p.registerClass(JR);var $R=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).cropping="number"==typeof e.cropping?[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:e.cropping,r.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,r.inputSpec=[{ndim:4}],r}return _createClass(n,[{key:"computeOutputShape",value:function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}},{key:"call",value:function(e,t){var n=this;return fk((function(){if(e=UA(e),"channelsLast"===n.dataFormat){var t=tA(e,n.cropping[0][0],e.shape[1]-n.cropping[0][0]-n.cropping[0][1],2);return tA(t,n.cropping[1][0],e.shape[2]-n.cropping[1][1]-n.cropping[1][0],3)}var r=tA(e,n.cropping[0][0],e.shape[2]-n.cropping[0][0]-n.cropping[0][1],3);return tA(r,n.cropping[1][0],e.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)}))}},{key:"getConfig",value:function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($A);$R.className="Cropping2D",p.registerClass($R);var eF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).DEFAULT_SIZE=[2,2],r.inputSpec=[{ndim:4}],r.size=null==e.size?r.DEFAULT_SIZE:e.size,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,LN(r.dataFormat),r.interpolation=null==e.interpolation?"nearest":e.interpolation,gN(FN,"InterpolationFormat",r.interpolation),r}return _createClass(n,[{key:"computeOutputShape",value:function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],null==e[2]?null:this.size[0]*e[2],null==e[3]?null:this.size[1]*e[3]]:[e[0],null==e[1]?null:this.size[0]*e[1],null==e[2]?null:this.size[1]*e[2],e[3]]}},{key:"call",value:function(e,t){var n=this;return fk((function(){var t=UA(e),r=t.shape;if("channelsFirst"===n.dataFormat){t=bb(t,[0,2,3,1]);var a=n.size[0]*r[2],i=n.size[1]*r[3],o="nearest"===n.interpolation?t.resizeNearestNeighbor([a,i]):t.resizeBilinear([a,i]);return bb(o,[0,3,1,2])}var s=n.size[0]*r[1],u=n.size[1]*r[2];return"nearest"===n.interpolation?t.resizeNearestNeighbor([s,u]):t.resizeBilinear([s,u])}))}},{key:"getConfig",value:function(){var e={size:this.size,dataFormat:this.dataFormat},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($A);eF.className="UpSampling2D",p.registerClass(eF);var tF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,2,e)).depthwiseKernel=null,r.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,r.depthwiseInitializer=OA(e.depthwiseInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.depthwiseConstraint=EN(e.depthwiseConstraint),r.depthwiseRegularizer=FR(e.depthwiseRegularizer),r}return _createClass(n,[{key:"build",value:function(e){if((e=WA(e)).length<4)throw new tN("Inputs to DepthwiseConv2D should have rank 4. Received input shape: ".concat(JSON.stringify(e),"."));var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new tN("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (".concat(e[t],")."));var n=e[t];this.depthwiseKernel=this.addWeight("depthwise_kernel",[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier],null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.bias=this.useBias?this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return fk((function(){var t=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;return fk((function(){null==a&&(a="channelsLast"),LN(a);var o=WR(e,a);if(4!==e.rank)throw new tN("Input for depthwiseConv2d is required to be 4-D, but is instead "+e.rank+"-D");if(4!==t.rank)throw new tN("depthwiseKernel is required to be 4-D, but is instead "+t.rank+"-D");return o=uw(o,t,n,"same"===r?"same":"valid","NHWC",i),"channelsFirst"===a&&(o=bb(o,[0,3,1,2])),o}))}(e=UA(e),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat,null);return n.useBias&&(t=lA(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),t}))}},{key:"computeOutputShape",value:function(e){e=WA(e);var t="channelsFirst"===this.dataFormat?e[3]:e[2],n="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,r=VR("channelsFirst"===this.dataFormat?e[2]:e[1],this.kernelSize[0],this.padding,this.strides[0]),a=VR(t,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],n,r,a]:[e[0],r,a,n]}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=DA(this.depthwiseInitializer),e.depthwiseRegularizer=ER(this.depthwiseRegularizer),e.depthwiseConstraint=NN(this.depthwiseRegularizer),e}}]),n}(jR);function nF(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new tN("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=a(t),constants:n=a(n)}}function rF(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return fk((function(){var u=t.shape.length;if(u<3)throw new tN("Input should be at least 3D, but is ".concat(u,"D."));var c=[1,0].concat(ZN(2,u));if(t=bb(t,c),null!=i)throw new nN("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=a&&((a=a.asType("bool").asType("float32")).rank===u-1&&(a=yw(a,-1)),a=bb(a,c)),r&&(t=VC(t,0),null!=a&&(a=VC(a,0)));var l,h,p,d=[],f=n,m=t.shape[0],v=__(t);null!=a&&(h=__(a));for(var g=function(t){var n=v[t],r=fk((function(){return e(n,f)}));if(null==a)l=r[0],f=r[1];else{var i=fk((function(){var e=h[t],n=vC(e).sub(e);return{output:r[0].mul(e).add(f[0].mul(n)),newStates:f.map((function(t,a){return r[1][a].mul(e).add(t.mul(n))}))}}));l=i.output,f=i.newStates}s&&d.push(l)},y=0;y<m;++y)g(y);return s&&(p=h_(d,1)),[l,p,f]}))}tF.className="DepthwiseConv2D",p.registerClass(tF);var aF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r,a;if(_classCallCheck(this,n),r=t.call(this,e),null==e.cell)throw new tN("cell property is missing for the constructor of RNN.");if(null==(a=Array.isArray(e.cell)?new fF({cells:e.cell}):e.cell).stateSize)throw new tN("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=a,r.returnSequences=null!=e.returnSequences&&e.returnSequences,r.returnState=null!=e.returnState&&e.returnState,r.goBackwards=null!=e.goBackwards&&e.goBackwards,r._stateful=null!=e.stateful&&e.stateful,r.unroll=null!=e.unroll&&e.unroll,r.supportsMasking=!0,r.inputSpec=[new XA({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],_possibleConstructorReturn(r)}return _createClass(n,[{key:"getStates",value:function(){return null==this.states_?ZN(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((function(e){return null})):this.states_}},{key:"setStates",value:function(e){this.states_=e}},{key:"computeOutputShape",value:function(e){BA(e)&&(e=e[0]),e=e;var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,r=t[0];if(n=this.returnSequences?[e[0],e[1],r]:[e[0],r],this.returnState){var a,i=[],o=_createForOfIteratorHelper(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push([e[0],s])}}catch(UY){o.e(UY)}finally{o.f()}return[n].concat(i)}return n}},{key:"computeMask",value:function(e,t){var n=this;return fk((function(){Array.isArray(t)&&(t=t[0]);var e=n.returnSequences?t:null;if(n.returnState){var r=n.states.map((function(e){return null}));return[e].concat(r)}return e}))}},{key:"build",value:function(e){if(null!=this.numConstants)throw new nN("Constants support is not implemented in RNN yet.");BA(e)&&(e=e[0]),e=e;var t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new XA({shape:[t,null].concat(_toConsumableArray(n))});var a,i=[e[0]].concat(e.slice(2));if(this.cell.build(i),a=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!r.arraysEqual(this.stateSpec.map((function(e){return e.shape[e.shape.length-1]})),a))throw new tN("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; However cell.stateSize is ")+this.cell.stateSize)}else this.stateSpec=a.map((function(e){return new XA({shape:[null,e]})}));this.stateful&&this.resetStates()}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];fk((function(){if(!t.stateful)throw new $T("Cannot call resetStates() on an RNN Layer that is not stateful.");var a=t.inputSpec[0].shape[0];if(null==a)throw new tN("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.states_)t.states_=Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(e){return fC([a,e])})):[fC([a,t.cell.stateSize])];else if(null==e)mk(t.states_),null!=t.keptStates&&(mk(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return fC([a,e])})):t.states_[0]=fC([a,t.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new tN("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), but it received ").concat(e.length," state value(s). Input received: ")+e);!0===n?t.keptStates.push(t.states_.slice()):mk(t.states_);for(var i=0;i<t.states_.length;++i){var o=e[i],s=Array.isArray(t.cell.stateSize)?t.cell.stateSize[i]:t.cell.stateSize,u=[a,s];if(!r.arraysEqual(o.shape,u))throw new tN("State ".concat(i," is incompatible with layer ").concat(t.name,": expected shape=").concat(u,", received shape=").concat(o.shape));t.states_[i]=o}}t.states_=t.states_.map((function(e){return vk(e.clone())}))}))}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=nF(e,r,a,this.numConstants);e=i.inputs,r=i.initialState,a=i.constants;var o=[],s=[];if(null!=r){t.initialState=r,o=o.concat(r),this.stateSpec=[];var u,c=_createForOfIteratorHelper(r);try{for(c.s();!(u=c.n()).done;){var l=u.value;this.stateSpec.push(new XA({shape:l.shape}))}}catch(UY){c.e(UY)}finally{c.f()}s=s.concat(this.stateSpec)}if(null!=a&&(t.constants=a,o=o.concat(a),this.numConstants=a.length),o[0]instanceof YA){var h=[e].concat(o),p=this.inputSpec.concat(s),d=this.inputSpec;this.inputSpec=p;var f=_get(_getPrototypeOf(n.prototype),"apply",this).call(this,h,t);return this.inputSpec=d,f}return _get(_getPrototypeOf(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return fk((function(){var r=null==t?null:t.mask,a=null==t?null:t.training,i=null==t?null:t.initialState;e=UA(e),null==i&&(i=n.stateful?n.states_:n.getInitialState(e));var o=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(i.length!==o)throw new tN("RNN Layer has ".concat(o," state(s) but was passed ")+i.length+" initial state(s).");n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:a},u=rF((function(e,t){var r=n.cell.call([e].concat(t),s);return[r[0],r.slice(1)]}),e,i,n.goBackwards,r,null,n.unroll,n.returnSequences),c=u[0],l=u[1],h=u[2];n.stateful&&n.resetStates(h,a);var p=n.returnSequences?l:c;return n.returnState?[p].concat(h):p}))}},{key:"getInitialState",value:function(e){var t=this;return fk((function(){var n=fC(e.shape);return n=JN(n=Uw(n,[1,2])),Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(e){return e>1?aA(n,[1,e]):n})):t.cell.stateSize>1?[aA(n,[1,t.cell.stateSize])]:[n]}))}},{key:"setFastWeightInitDuringBuild",value:function(e){_get(_getPrototypeOf(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);var r=this.cell.getConfig();return this.getClassName()===n.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign({},r,e,t)}},{key:"states",get:function(){if(null==this.states_){for(var e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[],n=0;n<e;++n)t.push(null);return t}return this.states_},set:function(e){this.states_=e}},{key:"trainableWeights",get:function(){return this.trainable?this.cell.trainableWeights:[]}},{key:"nonTrainableWeights",get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=pE(t.cell,n);return new e(Object.assign(t,{cell:r}))}}]),n}($A);aF.className="RNN",p.registerClass(aF);var iF=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return n}($A),oF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,bN(r.units,"units"),r.activation=IR(null==e.activation?r.DEFAULT_ACTIVATION:e.activation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=OA(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=OA(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=OA(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=FR(e.kernelRegularizer),r.recurrentRegularizer=FR(e.recurrentRegularizer),r.biasRegularizer=FR(e.biasRegularizer),r.kernelConstraint=EN(e.kernelConstraint),r.recurrentConstraint=EN(e.recurrentConstraint),r.biasConstraint=EN(e.biasConstraint),r.dropout=XN([1,YN([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=XN([1,YN([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return _createClass(n,[{key:"build",value:function(e){e=WA(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.bias=this.useBias?this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return fk((function(){if(2!==(e=e).length)throw new tN("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));var r=e[1];e=e[0];var a,i=null!=t.training&&t.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=mF({ones:function(){return vC(e)},rate:n.dropout,training:i})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=mF({ones:function(){return vC(r)},rate:n.recurrentDropout,training:i}));var o=n.dropoutMask,s=n.recurrentDropoutMask;a=oA(null!=o?Ek(e,o):e,n.kernel.read()),null!=n.bias&&(a=lA(a,n.bias.read())),null!=s&&(r=Ek(r,s));var u=Tk(a,oA(r,n.recurrentKernel.read()));return null!=n.activation&&(u=n.activation.apply(u)),[u,u]}))}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:_R(this.activation),useBias:this.useBias,kernelInitializer:DA(this.kernelInitializer),recurrentInitializer:DA(this.recurrentInitializer),biasInitializer:DA(this.biasInitializer),kernelRegularizer:ER(this.kernelRegularizer),recurrentRegularizer:ER(this.recurrentRegularizer),biasRegularizer:ER(this.biasRegularizer),activityRegularizer:ER(this.activityRegularizer),kernelConstraint:NN(this.kernelConstraint),recurrentConstraint:NN(this.recurrentConstraint),biasConstraint:NN(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,t)}}]),n}(iF);oF.className="SimpleRNNCell",p.registerClass(oF);var sF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),e.cell=new oF(e),t.call(this,e)}return _createClass(n,[{key:"call",value:function(e,t){var r=this;return fk((function(){return null!=r.cell.dropoutMask&&(mk(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(mk(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),_get(_getPrototypeOf(n.prototype),"call",r).call(r,e,{mask:null==t?null:t.mask,training:null==t?null:t.training,initialState:null==t?null:t.initialState})}))}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(aF);sF.className="SimpleRNN",p.registerClass(sF);var uF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new tN("GRUCell does not support reset_after parameter set to true.");return r.units=e.units,bN(r.units,"units"),r.activation=IR(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=IR(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=OA(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=OA(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=OA(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=FR(e.kernelRegularizer),r.recurrentRegularizer=FR(e.recurrentRegularizer),r.biasRegularizer=FR(e.biasRegularizer),r.kernelConstraint=EN(e.kernelConstraint),r.recurrentConstraint=EN(e.recurrentConstraint),r.biasConstraint=EN(e.biasConstraint),r.dropout=XN([1,YN([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=XN([1,YN([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.implementation=e.implementation,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,_possibleConstructorReturn(r)}return _createClass(n,[{key:"build",value:function(e){e=WA(e),this.kernel=this.addWeight("kernel",[e[e.length-1],3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.bias=this.useBias?this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return fk((function(){if(2!==(e=e).length)throw new tN("GRUCell expects 2 input Tensors (inputs, h, c), got "+e.length+".");var r=null!=t.training&&t.training,a=e[1];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=mF({ones:function(){return vC(e)},rate:n.dropout,training:r,count:3})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=mF({ones:function(){return vC(a)},rate:n.recurrentDropout,training:r,count:3}));var i,o,s,u=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=Ek(e,n.dropoutMask[0]));var c=oA(e,n.kernel.read());n.useBias&&(c=lA(c,n.bias.read())),0<n.recurrentDropout&&n.recurrentDropout<1&&(a=Ek(a,u[0]));var l=n.recurrentKernel.read(),h=_slicedToArray(s_(l,[2*n.units,n.units],l.rank-1),2),p=h[0],d=h[1],f=oA(a,p),m=_slicedToArray(s_(c,3,c.rank-1),3),v=m[0],g=m[1],y=m[2],b=_slicedToArray(s_(f,2,f.rank-1),2),k=b[0],x=b[1];i=n.recurrentActivation.apply(Tk(v,k)),o=n.recurrentActivation.apply(Tk(g,x));var w=oA(Ek(o,a),d);s=n.activation.apply(Tk(y,w));var C=Tk(Ek(i,a),Ek(Tk(1,Lw(i)),s));return[C,C]}))}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:_R(this.activation),recurrentActivation:_R(this.recurrentActivation),useBias:this.useBias,kernelInitializer:DA(this.kernelInitializer),recurrentInitializer:DA(this.recurrentInitializer),biasInitializer:DA(this.biasInitializer),kernelRegularizer:ER(this.kernelRegularizer),recurrentRegularizer:ER(this.recurrentRegularizer),biasRegularizer:ER(this.biasRegularizer),activityRegularizer:ER(this.activityRegularizer),kernelConstraint:NN(this.kernelConstraint),recurrentConstraint:NN(this.recurrentConstraint),biasConstraint:NN(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,t)}}]),n}(iF);uF.className="GRUCell",p.registerClass(uF);var cF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new uF(e),t.call(this,e)}return _createClass(n,[{key:"call",value:function(e,t){var r=this;return fk((function(){return null!=r.cell.dropoutMask&&(mk(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(mk(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),_get(_getPrototypeOf(n.prototype),"call",r).call(r,e,{mask:null==t?null:t.mask,training:null==t?null:t.training,initialState:null==t?null:t.initialState})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(aF);cF.className="GRU",p.registerClass(cF);var lF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,bN(r.units,"units"),r.activation=IR(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=IR(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=OA(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=OA(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=OA(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.unitForgetBias=e.unitForgetBias,r.kernelRegularizer=FR(e.kernelRegularizer),r.recurrentRegularizer=FR(e.recurrentRegularizer),r.biasRegularizer=FR(e.biasRegularizer),r.kernelConstraint=EN(e.kernelConstraint),r.recurrentConstraint=EN(e.recurrentConstraint),r.biasConstraint=EN(e.biasConstraint),r.dropout=XN([1,YN([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=XN([1,YN([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.implementation=e.implementation,r.stateSize=[r.units,r.units],r.dropoutMask=null,r.recurrentDropoutMask=null,r}return _createClass(n,[{key:"build",value:function(e){var t,n;if(e=WA(e),this.kernel=this.addWeight("kernel",[e[e.length-1],4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var r=this.biasInitializer,a=this.units;n=new((t=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e,t){var n=r.apply([a]),i=(new gA).apply([a]),o=r.apply([2*a]);return rA(rA(n,i),o)}}]),n}(mA)).className="CustomInit",t)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}},{key:"call",value:function(e,t){var n=this;return fk((function(){var r=null!=t.training&&t.training;if(3!==(e=e).length)throw new tN("LSTMCell expects 3 input Tensors (inputs, h, c), got "+e.length+".");var a=e[1],i=e[2];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=mF({ones:function(){return vC(e)},rate:n.dropout,training:r,count:4})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=mF({ones:function(){return vC(a)},rate:n.recurrentDropout,training:r,count:4}));var o,s,u,c,l=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=Ek(e,n.dropoutMask[0]));var h=oA(e,n.kernel.read());0<n.recurrentDropout&&n.recurrentDropout<1&&(a=Ek(a,l[0])),h=Tk(h,oA(a,n.recurrentKernel.read())),n.useBias&&(h=lA(h,n.bias.read()));var p=_slicedToArray(s_(h,4,h.rank-1),4),d=p[0],f=p[1],m=p[2],v=p[3];o=n.recurrentActivation.apply(d),s=n.recurrentActivation.apply(f),u=Tk(Ek(s,i),Ek(o,n.activation.apply(m))),c=n.recurrentActivation.apply(v);var g=Ek(c,n.activation.apply(u));return[g,g,u]}))}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:_R(this.activation),recurrentActivation:_R(this.recurrentActivation),useBias:this.useBias,kernelInitializer:DA(this.kernelInitializer),recurrentInitializer:DA(this.recurrentInitializer),biasInitializer:DA(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:ER(this.kernelRegularizer),recurrentRegularizer:ER(this.recurrentRegularizer),biasRegularizer:ER(this.biasRegularizer),activityRegularizer:ER(this.activityRegularizer),kernelConstraint:NN(this.kernelConstraint),recurrentConstraint:NN(this.recurrentConstraint),biasConstraint:NN(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,t)}}]),n}(iF);lF.className="LSTMCell",p.registerClass(lF);var hF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new lF(e),t.call(this,e)}return _createClass(n,[{key:"call",value:function(e,t){var r=this;return fk((function(){return null!=r.cell.dropoutMask&&(mk(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(mk(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),_get(_getPrototypeOf(n.prototype),"call",r).call(r,e,{mask:null==t?null:t.mask,training:null==t?null:t.training,initialState:null==t?null:t.initialState})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(aF);hF.className="LSTM",p.registerClass(hF);var pF,dF,fF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).cells=e.cells,r}return _createClass(n,[{key:"call",value:function(e,t){var n=this;return fk((function(){var r,a=(e=e).slice(1),i=[],o=_createForOfIteratorHelper(n.cells.slice().reverse());try{for(o.s();!(r=o.n()).done;){var s=r.value;Array.isArray(s.stateSize)?i.push(a.splice(0,s.stateSize.length)):i.push(a.splice(0,1))}}catch(UY){o.e(UY)}finally{o.f()}i.reverse();for(var u,c=[],l=0;l<n.cells.length;++l){var h=n.cells[l];a=i[l],u=0===l?[e[0]].concat(a):[u[0]].concat(a),u=h.call(u,t),c.push(u.slice(1))}a=[];var p,d=_createForOfIteratorHelper(c.slice().reverse());try{for(d.s();!(p=d.n()).done;){var f,m=p.value;(f=a).push.apply(f,_toConsumableArray(m))}}catch(UY){d.e(UY)}finally{d.f()}return[u[0]].concat(a)}))}},{key:"build",value:function(e){var t;BA(e)&&(e=e[0]),e=e,this.cells.forEach((function(n,r){UN("RNNCell_"+r,(function(){n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this),t=this.cells.map((function(e){return{className:e.getClassName(),config:e.getConfig()}}));return Object.assign({},e,{cells:t})}},{key:"getWeights",value:function(){var e,t=[],n=_createForOfIteratorHelper(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,_toConsumableArray(r.weights))}}catch(UY){n.e(UY)}finally{n.f()}return jA(t)}},{key:"setWeights",value:function(e){var t,n=[],r=_createForOfIteratorHelper(this.cells);try{for(r.s();!(t=r.n()).done;)for(var a=t.value,i=e.splice(a.weights.length),o=0;o<a.weights.length;++o)n.push([a.weights[o],i[o]])}catch(UY){r.e(UY)}finally{r.f()}qA(n)}},{key:"stateSize",get:function(){var e,t=[],n=_createForOfIteratorHelper(this.cells.slice().reverse());try{for(n.s();!(e=n.n()).done;){var r=e.value;Array.isArray(r.stateSize)?t.push.apply(t,_toConsumableArray(r.stateSize)):t.push(r.stateSize)}}catch(UY){n.e(UY)}finally{n.f()}return t}},{key:"trainableWeights",get:function(){if(!this.trainable)return[];var e,t=[],n=_createForOfIteratorHelper(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,_toConsumableArray(r.trainableWeights))}}catch(UY){n.e(UY)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=_createForOfIteratorHelper(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,_toConsumableArray(r.nonTrainableWeights))}}catch(UY){n.e(UY)}finally{n.f()}if(!this.trainable){var a,i=[],o=_createForOfIteratorHelper(this.cells);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,_toConsumableArray(s.trainableWeights))}}catch(UY){o.e(UY)}finally{o.f()}return i.concat(t)}return t}}],[{key:"fromConfig",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=[],i=_createForOfIteratorHelper(t.cells);try{for(i.s();!(n=i.n()).done;){var o=n.value;a.push(pE(o,r))}}catch(UY){i.e(UY)}finally{i.f()}return new e({cells:a})}}]),n}(iF);function mF(e){var t=e.ones,n=e.rate,r=e.training,a=void 0!==r&&r,i=e.count,o=void 0===i?1:i,s=function(){return hA(t(),n)},u=function(){return pA(s,t,a)};return!o||o<=1?vk(u().clone()):Array(o).fill(void 0).map(u).map((function(e){return vk(e.clone())}))}fF.className="StackedRNNCells",p.registerClass(fF);var vF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),e.unroll)throw new nN("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new nN("It is not possible at the moment to stack convolutional cells.");return(r=t.call(this,e)).inputSpec=[new XA({ndim:5})],r}return _createClass(n,[{key:"call",value:function(e,t){var r=this;return fk((function(){if(null!=r.cell.dropoutMask&&(mk(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(mk(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),t&&t.constants)throw new tN("ConvRNN2D cell does not support constants");return _get(_getPrototypeOf(n.prototype),"call",r).call(r,e,{mask:null==t?null:t.mask,training:null==t?null:t.training,initialState:null==t?null:t.initialState})}))}},{key:"computeOutputShape",value:function(e){var t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0]].concat(_toConsumableArray(t.slice(2)))),this.returnState&&(t=[t].concat(_toConsumableArray(Array(2).fill([e[0]].concat(_toConsumableArray(t.slice(-3))))))),t}},{key:"getInitialState",value:function(e){var t=this;return fk((function(){var n=t.cell.stateSize,r=t.computeSingleOutputShape(e.shape),a=fC([r[0]].concat(_toConsumableArray(r.slice(2))));return Array.isArray(n)?Array(n.length).fill(a):[a]}))}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];fk((function(){if(!t.stateful)throw new $T("Cannot call resetStates() on an RNN Layer that is not stateful.");var a=t.inputSpec[0].shape,i=t.computeSingleOutputShape(a),o=[i[0]].concat(_toConsumableArray(i.slice(2)));if(null==a[0])throw new tN("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.getStates())t.states_=Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(){return fC(o)})):[fC(o)];else if(null==e)mk(t.states_),null!=t.keptStates&&(mk(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return fC(o)})):t.states_[0]=fC(o);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new tN("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), but it received ").concat(e.length," state value(s). Input received: ")+e);n?t.keptStates.push(t.states_.slice()):mk(t.states_);for(var s=0;s<t.states_.length;++s){var u=e[s],c=o;if(!r.arraysEqual(u.shape,c))throw new tN("State ".concat(s," is incompatible with layer ").concat(t.name,": expected shape=").concat(c,", received shape=").concat(u.shape));t.states_[s]=u}}t.states_=t.states_.map((function(e){return vk(e.clone())}))}))}},{key:"computeSingleOutputShape",value:function(e){var t=this.cell,n=t.dataFormat,r=t.filters,a=t.kernelSize,i=t.padding,o=t.strides,s=t.dilationRate,u="channelsFirst"===n,c=e[u?4:3],l=VR(e[u?3:2],a[0],i,o[0],s[0]),h=VR(c,a[1],i,o[1],s[1]);return[].concat(_toConsumableArray(e.slice(0,2)),_toConsumableArray(u?[r,l,h]:[l,h,r]))}}]),n}(aF);vF.className="ConvRNN2D";var gF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;_classCallCheck(this,n);var a=e.filters,i=e.kernelSize,o=e.strides,s=e.padding,u=e.dataFormat,c=e.dilationRate;return(r=t.call(this,Object.assign({},e,{units:a}))).filters=a,bN(r.filters,"filters"),r.kernelSize=BR(i,2,"kernelSize"),r.kernelSize.forEach((function(e){return bN(e,"kernelSize")})),r.strides=BR(o||1,2,"strides"),r.strides.forEach((function(e){return bN(e,"strides")})),r.padding=s||"valid",zN(r.padding),r.dataFormat=u||"channelsLast",LN(r.dataFormat),r.dilationRate=BR(c||1,2,"dilationRate"),r.dilationRate.forEach((function(e){return bN(e,"dilationRate")})),r}return _createClass(n,[{key:"build",value:function(e){var t;e=WA(e);var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new tN("The channel dimension of the input should be defined. Found "+e[n]);var r=this.kernelSize.concat([e[n],4*this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var a=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var i;if(this.unitForgetBias){var o=this.biasInitializer,s=this.filters;i=new((t=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e,t){return nA([o.apply([s]),mC([s]),o.apply([2*s])])}}]),n}(mA)).className="CustomInit",t)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,i,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}},{key:"call",value:function(e,t){var n=this;return fk((function(){if(3!==e.length)throw new tN("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+e.length+".");var r=t.training||!1,a=e[0],i=e[1],o=e[2];0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=mF({ones:function(){return vC(a)},rate:n.dropout,training:r,count:4}));var s=n.dropoutMask,u=function(e,t,n){return t&&t[n]?Ek(t[n],e):e},c=u(a,s,0),l=u(a,s,1),h=u(a,s,2),p=u(a,s,3);0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=mF({ones:function(){return vC(i)},rate:n.recurrentDropout,training:r,count:4}));var d=n.recurrentDropoutMask,f=u(i,d,0),m=u(i,d,1),v=u(i,d,2),g=u(i,d,3),y=_slicedToArray(s_(n.kernel.read(),4,3),4),b=y[0],k=y[1],x=y[2],w=y[3],C=_slicedToArray(n.useBias?s_(n.bias.read(),4):[null,null,null,null],4),_=C[0],S=C[1],I=C[2],T=C[3];c=n.inputConv(c,b,_,n.padding),l=n.inputConv(l,k,S,n.padding),h=n.inputConv(h,x,I,n.padding),p=n.inputConv(p,w,T,n.padding);var N=_slicedToArray(s_(n.recurrentKernel.read(),4,3),4),A=N[0],E=N[1],R=N[2],F=N[3];f=n.recurrentConv(f,A),m=n.recurrentConv(m,E),v=n.recurrentConv(v,R),g=n.recurrentConv(g,F);var D=n.recurrentActivation.apply(Tk(c,f)),O=n.recurrentActivation.apply(Tk(l,m)),M=Tk(Ek(O,o),Ek(D,n.activation.apply(Tk(h,v)))),P=Ek(n.recurrentActivation.apply(Tk(p,g)),n.activation.apply(M));return[P,P,M]}))}},{key:"getConfig",value:function(){var e=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}(_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this),["units"]);return Object.assign({},e,{filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides})}},{key:"inputConv",value:function(e,t,n,r){var a=Zx(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?lA(a,n,this.dataFormat):a}},{key:"recurrentConv",value:function(e,t){return Zx(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}]),n}(lF);gF.className="ConvLSTM2DCell",p.registerClass(gF);var yF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){_classCallCheck(this,n);var r=new gF(e);return t.call(this,Object.assign({},e,{cell:r}))}return _createClass(n,null,[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(vF);yF.className="ConvLSTM2D",p.registerClass(yF);var bF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).rate=Math.max(Math.min(e.rate,1),0),r.noiseShape=e.noiseShape,r.seed=e.seed,r.supportsMasking=!0,r}return _createClass(n,[{key:"getNoiseShape",value:function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}},{key:"call",value:function(e,t){var n=this;return fk((function(){n.invokeCallHook(e,t);var r=UA(e);if(0<n.rate&&n.rate<1){var a=null!=t.training&&t.training,i=n.getNoiseShape(r);return pA((function(){return hA(r,n.rate,i,n.seed)}),(function(){return r}),a)}return e}))}},{key:"getConfig",value:function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this)}}]),n}($A);bF.className="Dropout",p.registerClass(bF);var kF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).inputSpec=[{ndim:3}],r}return _createClass(n,[{key:"getNoiseShape",value:function(e){var t=e.shape;return[t[0],1,t[2]]}}]),n}(bF);kF.className="SpatialDropout1D",p.registerClass(kF);var xF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),(r=t.call(this,e)).activation=null,r.useBias=!0,r.kernel=null,r.bias=null,r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var a=null;null!=e.batchSize&&(a=e.batchSize),r.batchInputShape=[a,e.inputDim]}return r.units=e.units,bN(r.units,"units"),r.activation=IR(e.activation),null!=e.useBias&&(r.useBias=e.useBias),r.kernelInitializer=OA(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.biasInitializer=OA(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelConstraint=EN(e.kernelConstraint),r.biasConstraint=EN(e.biasConstraint),r.kernelRegularizer=FR(e.kernelRegularizer),r.biasRegularizer=FR(e.biasRegularizer),r.activityRegularizer=FR(e.activityRegularizer),r.supportsMasking=!0,r.inputSpec=[{minNDim:2}],_possibleConstructorReturn(r)}return _createClass(n,[{key:"build",value:function(e){var t=(e=WA(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:_defineProperty({},-1,t)}],this.built=!0}},{key:"computeOutputShape",value:function(e){var t=(e=WA(e)).slice();return t[t.length-1]=this.units,t}},{key:"call",value:function(e,t){var n=this;return fk((function(){n.invokeCallHook(e,t);var r,a=UA(e),i=kN(n.activation.getClassName());return null!=i?r=oA(a,n.kernel.read(),i,n.bias?n.bias.read():null):(r=oA(a,n.kernel.read()),null!=n.bias&&(r=lA(r,n.bias.read())),null!=n.activation&&(r=n.activation.apply(r))),r}))}},{key:"getConfig",value:function(){var e={units:this.units,activation:_R(this.activation),useBias:this.useBias,kernelInitializer:DA(this.kernelInitializer),biasInitializer:DA(this.biasInitializer),kernelRegularizer:ER(this.kernelRegularizer),biasRegularizer:ER(this.biasRegularizer),activityRegularizer:ER(this.activityRegularizer),kernelConstraint:NN(this.kernelConstraint),biasConstraint:NN(this.biasConstraint)},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($A);xF.className="Dense",p.registerClass(xF);var wF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e=e||{})).inputSpec=[{minNDim:3}],r.dataFormat=e.dataFormat,r}return _createClass(n,[{key:"computeOutputShape",value:function(e){var t,n=_createForOfIteratorHelper((e=WA(e)).slice(1));try{for(n.s();!(t=n.n()).done;){if(null==t.value)throw new tN('The shape of the input to "Flatten" is not fully defined (got '.concat(e.slice(1),'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.'))}}catch(UY){n.e(UY)}finally{n.f()}return[e[0],qN(e,1)]}},{key:"call",value:function(e,t){var n=this;return fk((function(){n.invokeCallHook(e,t);var r=UA(e);if("channelsFirst"===n.dataFormat&&r.rank>1){for(var a=[0],i=2;i<r.rank;++i)a.push(i);a.push(1),r=r.transpose(a)}return function(e){if(e.rank<=1)throw new tN("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));var t=[e.shape[0],qN(e.shape,1)];return e.reshape(t)}(r)}))}},{key:"getConfig",value:function(){var e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);var t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($A);wF.className="Flatten",p.registerClass(wF);var CF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).supportsMasking=!0,r.activation=IR(e.activation),r}return _createClass(n,[{key:"call",value:function(e,t){var n=this;return fk((function(){n.invokeCallHook(e,t);var r=UA(e);return n.activation.apply(r)}))}},{key:"getConfig",value:function(){var e={activation:_R(this.activation)},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($A);CF.className="Activation",p.registerClass(CF);var _F=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).n=e.n,r.inputSpec=[{ndim:2}],r}return _createClass(n,[{key:"computeOutputShape",value:function(e){return[e[0],this.n,e[1]]}},{key:"call",value:function(e,t){var n=this;return fk((function(){return e=UA(e),t=e,r=n.n,fk((function(){if(2!==t.shape.length)throw new tN("repeat() expects a rank-2 tensor, but received a rank-".concat(t.shape.length," tensor."));return aA(JN(t,1),[1,r,1])}));var t,r}))}},{key:"getConfig",value:function(){var e={n:this.n},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($A);_F.className="RepeatVector",p.registerClass(_F);var SF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;_classCallCheck(this,n),(r=t.call(this,e)).targetShape=e.targetShape;for(var a=0;a<r.targetShape.length;++a)r.isUnknown(r.targetShape[a])&&(r.targetShape[a]=null);return r}return _createClass(n,[{key:"isUnknown",value:function(e){return e<0||null==e}},{key:"fixUnknownDimension",value:function(e,t){for(var n="Total size of new array must be unchanged.",r=t.slice(),a=1,i=null,o=0;o<r.length;++o){var s=r[o];if(this.isUnknown(s)){if(null!==i)throw new tN("Can only specifiy one unknown dimension.");i=o}else a*=s}var u=qN(e);if(null!==i){if(0===a||u%a!=0)throw new tN(n);r[i]=u/a}else if(u!==a)throw new tN(n);return r}},{key:"computeOutputShape",value:function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}},{key:"call",value:function(e,t){var n=this;return fk((function(){n.invokeCallHook(e,t);var r=UA(e),a=r.shape,i=a.slice(0,1).concat(n.fixUnknownDimension(a.slice(1),n.targetShape));return r.reshape(i)}))}},{key:"getConfig",value:function(){var e={targetShape:this.targetShape},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($A);SF.className="Reshape",p.registerClass(SF);var IF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var a;if(_classCallCheck(this,n),a=t.call(this,e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+e.dims+" instead.");var i=ZN(1,e.dims.length+1);if(!r.arraysEqual(e.dims.slice().sort(),i))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");return a.dims=e.dims,a.dimsIncludingBatch=[0].concat(a.dims),a.inputSpec=[new XA({ndim:a.dims.length+1})],_possibleConstructorReturn(a)}return _createClass(n,[{key:"computeOutputShape",value:function(e){var t=(e=WA(e)).slice();return this.dims.forEach((function(n,r){t[r+1]=e[n]})),t}},{key:"call",value:function(e,t){return bb(UA(e),this.dimsIncludingBatch)}},{key:"getConfig",value:function(){var e={dims:this.dims},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($A);IF.className="Permute",p.registerClass(IF);var TF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,r.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0,r}return _createClass(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this),t={maskValue:this.maskValue};return Object.assign(t,e),t}},{key:"computeMask",value:function(e,t){var n=UA(e);return ux(dC(n,this.maskValue),-1)}},{key:"call",value:function(e,t){var n=this;return fk((function(){n.invokeCallHook(e,t);var r=UA(e),a=ux(dC(r,n.maskValue),-1,!0);return r.mul(a.asType(r.dtype))}))}}]),n}($A);TF.className="Masking",p.registerClass(TF);var NF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),(r=t.call(this,e)).embeddings=null,r.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var a=null;null!=e.batchSize&&(a=e.batchSize),r.batchInputShape=null==e.inputLength?[a,null]:[a].concat(uN(e.inputLength))}return r.inputDim=e.inputDim,bN(r.inputDim,"inputDim"),r.outputDim=e.outputDim,bN(r.outputDim,"outputDim"),r.embeddingsInitializer=OA(e.embeddingsInitializer||r.DEFAULT_EMBEDDINGS_INITIALIZER),r.embeddingsRegularizer=FR(e.embeddingsRegularizer),r.activityRegularizer=FR(e.activityRegularizer),r.embeddingsConstraint=EN(e.embeddingsConstraint),r.maskZero=e.maskZero,r.supportsMasking=e.maskZero,r.inputLength=e.inputLength,_possibleConstructorReturn(r)}return _createClass(n,[{key:"build",value:function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}},{key:"warnOnIncompatibleInputShape",value:function(e){}},{key:"computeMask",value:function(e,t){var n=this;return fk((function(){return n.maskZero?(e=UA(e),dC(e,Dk(e))):null}))}},{key:"computeOutputShape",value:function(e){if(e=WA(e),null==this.inputLength)return[].concat(_toConsumableArray(e),[this.outputDim]);var t=uN(this.inputLength);if(t.length!==e.length-1)throw new tN('"inputLength" is '.concat(this.inputLength,", but received input shape has shape ")+e);for(var n=0,r=0;r<t.length;++r){var a=t[r],i=e[r+1];if(null!=a&&null!=i&&a!==i)throw new tN('"inputLength" is '.concat(this.inputLength,", but received input shape has shape ")+e);null==a&&(t[n]=i),n++}return[e[0]].concat(_toConsumableArray(t),[this.outputDim])}},{key:"call",value:function(e,t){var n=this;return fk((function(){n.invokeCallHook(e,t);var r=UA(e);return"int32"!==r.dtype&&(r=QN(r,"int32")),sA(n.embeddings.read(),r.as1D()).reshape(WA(n.computeOutputShape(r.shape)))}))}},{key:"getConfig",value:function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:DA(this.embeddingsInitializer),embeddingsRegularizer:ER(this.embeddingsRegularizer),activityRegularizer:ER(this.activityRegularizer),embeddingsConstraint:NN(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($A);NF.className="Embedding",p.registerClass(NF);var AF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e||{})).supportsMasking=!0,r}return _createClass(n,[{key:"mergeFunction",value:function(e){throw new nN}},{key:"computeElementwiseOpOutputShape",value:function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),r=0;r<t.length;++r){var a=e[e.length-t.length+r],i=t[r];if(null==a||null==i||a<0||i<0)n.push(null);else if(1===a)n.push(i);else if(1===i)n.push(a);else{if(a!==i)throw new tN("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}},{key:"build",value:function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[WA(e)]),(e=e).length<2)throw new tN("A merge layer should be called on an Array of at least 2 inputs. Got ".concat(e.length," input(s)."));var t,n=[],r=_createForOfIteratorHelper(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;null!=a&&null!==a[0]&&n.push(a[0])}}catch(UY){r.e(UY)}finally{r.f()}if((n=mN(n)).length>1)throw new tN("Can not merge tensors with different batch sizes. Got tensors with shapes: ".concat(JSON.stringify(e),"."));for(var i=null==e[0]?null:e[0].slice(1),o=1;o<e.length;++o){var s=null==e[o]?null:e[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=e.map((function(e){return e.length}));this.reshapeRequired=-1!==e.indexOf(null)||1!==mN(u).length}},{key:"call",value:function(e,t){var n=this;return fk((function(){if(e=e,n.reshapeRequired){var t=[],r=e.map((function(e){return e.rank}));if(-1===r.indexOf(null)){var a,i=YN(r),o=_createForOfIteratorHelper(e);try{for(o.s();!(a=o.n()).done;){for(var s=a.value,u=s.rank,c=0;c<i-u;++c)s=JN(s,1);t.push(s)}}catch(UY){o.e(UY)}finally{o.f()}return n.mergeFunction(t)}var l,h=!1,p=_createForOfIteratorHelper(e);try{for(p.s();!(l=p.n()).done;){var d=l.value,f=d.rank;if(null==f){var m=d.shape,v=m[0],g=m.slice(1).concat([v]),y=d.reshape([v].concat(qN(m.slice(1))));y=(y=bb(y,[1,0])).reshape(g),t.push(y),h=!0}else if(f>1){var b=ZN(1,f).concat([0]);t.push(bb(d,b)),h=!0}else t.push(d)}}catch(UY){p.e(UY)}finally{p.f()}var k=n.mergeFunction(t),x=k.rank;if(h)if(null==x){var w=k.shape,C=w[w.length-1],_=[C].concat(w.slice(0,w.length-1));k=bb(k.reshape([-1,C]),[1,0]).reshape(_)}else if(x>1){var S=[x-1].concat(ZN(0,x-1));k=bb(k,S)}return k}return n.mergeFunction(e)}))}},{key:"computeOutputShape",value:function(e){var t;t=null==(e=e)[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}var a,i=[],o=_createForOfIteratorHelper(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;null!=s&&null!==s[0]&&i.push(s[0])}}catch(UY){o.e(UY)}finally{o.f()}return t=1===(i=mN(i)).length?i.concat(t):[null].concat(t)}},{key:"computeMask",value:function(e,t){return fk((function(){if(null==t)return null;if(!Array.isArray(t))throw new tN("`mask` should be an Array");if(!Array.isArray(e))throw new tN("`inputs` should be an Array");if(t.length!==e.length)throw new tN("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (".concat(e.length," vs ").concat(t.length,")"));if(t.every((function(e){return null==e})))return null;for(var n=(t=t.map((function(e){return null==e?e:yw(e,0)})))[0],r=1;r<t.length-1;++r)n=Jw(n,t[r]);return n}))}}]),n}($A),EF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"mergeFunction",value:function(e){return fk((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Tk(t,e[n]);return t}))}}]),n}(AF);EF.className="Add",p.registerClass(EF);var RF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"mergeFunction",value:function(e){return fk((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Ek(t,e[n]);return t}))}}]),n}(AF);RF.className="Multiply",p.registerClass(RF);var FF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"mergeFunction",value:function(e){return fk((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Tk(t,e[n]);return Ek(1/e.length,t)}))}}]),n}(AF);FF.className="Average",p.registerClass(FF);var DF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"mergeFunction",value:function(e){return fk((function(){for(var t=e[0],n=1;n<e.length;++n)t=$k(t,e[n]);return t}))}}]),n}(AF);DF.className="Maximum",p.registerClass(DF);var OF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"mergeFunction",value:function(e){return fk((function(){for(var t=e[0],n=1;n<e.length;++n)t=sC(t,e[n]);return t}))}}]),n}(AF);OF.className="Minimum",p.registerClass(OF);var MF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).DEFAULT_AXIS=-1,null==e&&(e={}),r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r.supportsMasking=!0,r.reshapeRequired=!1,r}return _createClass(n,[{key:"build",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new tN("A `Concatenate` layer should be called on a list of at least 2 inputs");var t,n=!0,a=_createForOfIteratorHelper(e=e);try{for(a.s();!(t=a.n()).done;){if(null!=t.value){n=!1;break}}}catch(UY){a.e(UY)}finally{a.f()}if(!n){for(var i=[],o=0;o<e.length;++o){var s=e[o].slice();s.splice(this.axis,1);var u,c=!1,l=_createForOfIteratorHelper(i);try{for(l.s();!(u=l.n()).done;){var h=u.value;if(r.arraysEqual(h,s)){c=!0;break}}}catch(UY){l.e(UY)}finally{l.f()}c||i.push(s)}if(i.length>1)throw new tN("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}}},{key:"mergeFunction",value:function(e){var t=this;return fk((function(){return nA(e,t.axis)}))}},{key:"computeOutputShape",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new tN("A `Concatenate` layer should be called on a list of inputs.");var t,n=e,r=n[0].slice(),a=this.axis<0?r.length+this.axis:this.axis,i=_createForOfIteratorHelper(n.slice(1));try{for(i.s();!(t=i.n()).done;){var o=t.value;if(null==r[a]||null==o[a]){r[a]=null;break}r[a]+=o[a]}}catch(UY){i.e(UY)}finally{i.f()}return r}},{key:"computeMask",value:function(e,t){var n=this;if(null==t)return null;if(!Array.isArray(t))throw new tN("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new tN("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new tN("Mismatch in the length of mask (".concat(t.length,") and the legnth of inputs (").concat(e.length,")"));return fk((function(){var r=!0;if(t.forEach((function(e){null==e||(r=!1)})),r)return null;for(var a=[],i=0;i<e.length;++i)a.push(null==t[i]?vC(e[i]).asType("bool"):t[i].rank<e[i].rank?yw(t[i],-1):t[i]);var o=Fx(a,n.axis);return sx(o,-1,!1)}))}},{key:"getConfig",value:function(){var e={axis:this.axis},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(AF);function PF(e,t){for(;e<0;)e+=t;return e}MF.className="Concatenate",p.registerClass(MF);var LF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).axes=e.axes,r.normalize=null!=e.normalize&&e.normalize,r.supportsMasking=!0,r.reshapeRequired=!1,r}return _createClass(n,[{key:"build",value:function(e){r.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0],n=e[1];if(t.length>3||n.length>3)throw new nN("Dot layer does not support tensors of 4D or higher rank yet.");var a=this.interpretAxes(t,n);if(t[a[0]]!==n[a[1]])throw new tN("Dimension incompatibility: ".concat(t[a[0]]," !== ").concat(n[a[1]]))}},{key:"mergeFunction",value:function(e){if(2!==e.length)throw new tN("A `Dot` layer must be called on exactly 2 inputs, but received ".concat(e.length," input(s)."));var t,n=e[0],a=e[1];return t=Array.isArray(this.axes)?this.axes.map((function(t,n){return PF(t,e[n].shape.length)})):[PF(this.axes,n.shape.length),PF(this.axes,a.shape.length)],this.normalize&&(n=dE(n,t[0]),a=dE(a,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new nN("batchDot is not implemented for tensors of 4D or higher rank yet");if(r.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of x to be >= 2, but got "+e.shape.length})),r.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of y to be >= 2, but got "+t.shape.length})),"number"==typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new nN("batchDot is not implemented for complex64-type Tensors yet.");var a=e.shape.length,i=t.shape.length;null==n&&(n=[a-1,i-2]);var o=n;return fk((function(){var n,r;if(a>i){n=a-i;for(var s=[],u=0;u<n;++u)s.push(1);t=t.reshape(t.shape.concat(s))}else if(i>a){n=i-a;for(var c=[],l=0;l<n;++l)c.push(1);e=e.reshape(e.shape.concat(c))}else n=0;if(r=2===e.shape.length&&2===t.shape.length?o[0]===o[1]?e.mul(t).sum(o[0]):e.transpose([1,0]).mul(t).sum(o[1]):e.matMul(t,o[0]!==e.shape.length-1,o[1]===t.shape.length-1),n>0){for(var h,p=[],d=h=a>i?a+i-3:a-1;d<h+n;++d)p.push(d);r=r.squeeze(p)}return 1===r.shape.length&&(r=r.expandDims(1)),r}))}(n,a,t)}},{key:"interpretAxes",value:function(e,t){return Array.isArray(this.axes)?this.axes:[PF(this.axes,e.length),PF(this.axes,t.length)]}},{key:"computeOutputShape",value:function(e){r.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new nN("Dot layer does not support tensors of 4D or higher rank yet.");var a=this.interpretAxes(t,n);t.splice(a[0],1),n.splice(a[1],1),n.splice(0,1);var i=t.concat(n);return 1===i.length&&i.push(1),i}},{key:"computeMask",value:function(e,t){return null}},{key:"getConfig",value:function(){var e={axes:this.axes,normalize:this.normalize},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(AF);LF.className="Dot",p.registerClass(LF);var zF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).supportsMasking=!0,r.stddev=e.stddev,r}return _createClass(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this),t={stddev:this.stddev};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return fk((function(){n.invokeCallHook(e,t);var r=UA(e);return pA((function(){return iA(r.shape,0,n.stddev).add(r)}),(function(){return r}),t.training||!1)}))}}]),n}($A);zF.className="GaussianNoise",p.registerClass(zF);var BF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r}return _createClass(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return fk((function(){n.invokeCallHook(e,t);var r=UA(e);return n.rate>0&&n.rate<1?pA((function(){var e=Math.sqrt(n.rate/(1-n.rate));return r.mul(iA(r.shape,1,e))}),(function(){return r}),t.training||!1):r}))}}]),n}($A);BF.className="GaussianDropout",p.registerClass(BF);var VF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r.noiseShape=e.noiseShape,r}return _createClass(n,[{key:"_getNoiseShape",value:function(e){return this.noiseShape||UA(e).shape}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return fk((function(){if(n.rate<1&&n.rate>0){var r=n._getNoiseShape(e);return pA((function(){var t=UA(e),a=-1.7580993408473766,i=Sw(OC(r),n.rate);i=QN(i,"float32");var o=Math.pow((1-n.rate)*(1+n.rate*Math.pow(a,2)),-.5),s=-o*a*n.rate;return t.mul(i).add(i.add(-1).mul(a)).mul(o).add(s)}),(function(){return UA(e)}),t.training||!1)}return e}))}}]),n}($A);function UF(e,t,n,r,a){var i,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)i=Bx(e,t,n,r,a,o);else if(3===e.rank)i=Vx(e,t,n,r,a,o);else{if(4!==e.rank)throw new nN("batchNormalization is not implemented for array of rank ".concat(e.rank," yet"));i=Ux(e,t,n,r,a,o)}return i}VF.className="AlphaDropout",p.registerClass(VF);var WF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),null==e&&(e={}),(r=t.call(this,e)).supportsMasking=!0,r.axis=null==e.axis?-1:e.axis,r.momentum=null==e.momentum?.99:e.momentum,r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=OA(e.betaInitializer||"zeros"),r.gammaInitializer=OA(e.gammaInitializer||"ones"),r.movingMeanInitializer=OA(e.movingMeanInitializer||"zeros"),r.movingVarianceInitializer=OA(e.movingVarianceInitializer||"ones"),r.betaConstraint=EN(e.betaConstraint),r.gammaConstraint=EN(e.gammaConstraint),r.betaRegularizer=FR(e.betaRegularizer),r.gammaRegularizer=FR(e.gammaRegularizer),r}return _createClass(n,[{key:"build",value:function(e){e=WA(e);var t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new tN("Axis ".concat(t," of input tensor should have a defined dimension but the layer received an input with shape ")+JSON.stringify(e)+".");this.inputSpec=[new XA({ndim:e.length,axes:_defineProperty({},t,n)})];var r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}},{key:"call",value:function(e,t){var n=this;return fk((function(){var a=null!=t.training&&t.training,i=UA(e),o=i.shape,s=o.length,u=ZN(0,s),c=n.axis>=0?n.axis:n.axis+s;u.splice(c,1);var l=aN(1,s);l[c]=o[c];var h=u.slice();h.sort();var p=!r.arraysEqual(h,ZN(0,s).slice(0,s-1));if(!a)return function(){if(p){var e=n.movingMean.read().reshape(l),t=n.movingVariance.read().reshape(l),r=n.center?n.beta.read().reshape(l):null,a=n.scale?n.gamma.read().reshape(l):null;return UF(i,e,t,r,a,n.epsilon)}return UF(i,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)}();var d=_slicedToArray(function(e,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return r.arraysEqual(a.slice().sort(),ZN(0,e.rank-1))?function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return fk((function(){var i=lC(e,r),o=i.mean,s=i.variance;return[UF(e,o,s,n,t,a),o,s]}))}(e,t,n,a,i):function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return fk((function(){var i,o=lC(e,r),s=o.mean,u=o.variance,c=[],l=_createForOfIteratorHelper(ZN(0,e.rank));try{for(l.s();!(i=l.n()).done;){var h=i.value;-1!==r.indexOf(h)?c.push(1):c.push(e.shape[h])}}catch(UY){l.e(UY)}finally{l.f()}var p=s.reshape(c),d=u.reshape(c),f=null==t?null:t.reshape(c),m=null==n?null:n.reshape(c);return[UF(e,p,d,m,f,a),s,u]}))}(e,t,n,a,i)}(i,n.gamma.read(),n.beta.read(),u,n.epsilon),3),f=d[0],m=d[1],v=d[2],g=function(e,t,n){fk((function(){var r=1-n,a=e.read(),i=a.sub(t).mul(r);e.write(a.sub(i))}))};return g(n.movingMean,m,n.momentum),g(n.movingVariance,v,n.momentum),f}))}},{key:"getConfig",value:function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:DA(this.betaInitializer),gammaInitializer:DA(this.gammaInitializer),movingMeanInitializer:DA(this.movingMeanInitializer),movingVarianceInitializer:DA(this.movingVarianceInitializer),betaRegularizer:ER(this.betaRegularizer),gammaRegularizer:ER(this.gammaRegularizer),betaConstraint:NN(this.betaConstraint),gammaConstraint:NN(this.gammaConstraint)},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($A);WF.className="BatchNormalization",p.registerClass(WF);var GF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),null==e&&(e={}),(r=t.call(this,e)).axis=null==e.axis?-1:e.axis,"number"==typeof r.axis){if(!Number.isInteger(r.axis))throw new Error("Expected axis to be an integer, but received "+r.axis)}else{if(!Array.isArray(r.axis))throw new Error("Expected axis to be an integer or an array of integers, but received "+JSON.stringify(r.axis));var a,i=_createForOfIteratorHelper(r.axis);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!Number.isInteger(o))throw new Error("Expected axis to be an array of integers, but received "+JSON.stringify(r.axis))}}catch(UY){i.e(UY)}finally{i.f()}}return r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=OA(e.betaInitializer||"zeros"),r.gammaInitializer=OA(e.gammaInitializer||"ones"),r.betaRegularizer=FR(e.betaRegularizer),r.gammaRegularizer=FR(e.gammaRegularizer),r.supportsMasking=!0,_possibleConstructorReturn(r)}return _createClass(n,[{key:"build",value:function(e){var t=(e=WA(e)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(var n=0;n<this.axis.length;++n)this.axis[n]<0&&(this.axis[n]+=t);var r,a=_createForOfIteratorHelper(this.axis);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i<0||i>=t)throw new Error("Invalid axis: "+i)}}catch(UY){a.e(UY)}finally{a.f()}if(this.axis.length!==mN(this.axis).length)throw new Error("Found duplicate axes in: "+this.axis);var o=this.axis.map((function(t){return e[t]}));this.gamma=this.scale?this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,!0):null,this.beta=this.center?this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,!0):null,this.built=!0}},{key:"call",value:function(e,t){var n=this,r=UA(e),a=r.shape,i=a.length;return fk((function(){var e,t=lC(r,n.axis,!0),o=t.mean,s=t.variance,u=aN(1,i),c=_createForOfIteratorHelper(n.axis);try{for(c.s();!(e=c.n()).done;){var l=e.value;u[l]=a[l]}}catch(UY){c.e(UY)}finally{c.f()}for(var h=function(e){return null!=e&&e.shape.length!==i&&n.axis!==[i-1]?e.reshape(u):e},p=h(n.gamma.read()),d=h(n.beta.read()),f=[],m=[],v=0;v<i;++v)-1!==n.axis.indexOf(v)?(f.push(a[v]),m.push(1)):(f.push(1),m.push(a[v]));return o=o.tile(f),s=s.tile(f),p=p.tile(m),d=d.tile(m),UF(r,o,s,d,p,n.epsilon)}))}},{key:"getConfig",value:function(){var e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:DA(this.betaInitializer),gammaInitializer:DA(this.gammaInitializer),betaRegularizer:ER(this.betaRegularizer),gammaRegularizer:ER(this.gammaRegularizer)},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($A);GF.className="LayerNormalization",p.registerClass(GF);var HF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),null==e&&(e={}),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)r.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)r.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new tN("ZeroPadding2D expects padding to be a length-2 array, but received a length-".concat(e.padding.length," array."));var a,i;if("number"==typeof e.padding[0])a=[e.padding[0],e.padding[0]],i=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new tN("ZeroPadding2D expects height padding to be a length-2 array, but received a length-".concat(e.padding[0].length," array."));if(a=e.padding[0],2!==e.padding[1].length)throw new tN("ZeroPadding2D expects width padding to be a length-2 array, but received a length-".concat(e.padding[1].length," array."));i=e.padding[1]}r.padding=[a,i]}return r.inputSpec=[new XA({ndim:4})],_possibleConstructorReturn(r)}return _createClass(n,[{key:"computeOutputShape",value:function(e){var t,n;return e=WA(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}},{key:"call",value:function(e,t){var n=this;return fk((function(){return t=UA(e),r=n.padding,a=n.dataFormat,fk((function(){if(4!==t.rank)throw new tN("temporalPadding expects input tensor to be 4-D, but received a "+t.rank+"-D tensor.");if(null==r&&(r=[[1,1],[1,1]]),2!==r.length||2!==r[0].length||2!==r[1].length)throw new tN("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==a&&(a="channelsLast"),"channelsLast"!==a&&"channelsFirst"!==a)throw new tN("Unknown data format: ".concat(a,". Supported data formats are 'channelsLast' and 'channelsFirst."));var e;return e="channelsFirst"===a?[[0,0],[0,0],r[0],r[1]]:[[0,0],r[0],r[1],[0,0]],yC(t,e)}));var t,r,a}))}},{key:"getConfig",value:function(){var e={padding:this.padding,dataFormat:this.dataFormat},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($A);function jF(e,t,n,r,a,i){return fk((function(){var o;LN(a),BN(i),zN(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=WR(e,a);var s="same"===r?"same":"valid";return o="max"===i?nC(e,t,n,s):Ex(e,t,n,s),"channelsFirst"===a&&(o=bb(o,[0,3,1,2])),o}))}function qF(e,t,n,r,a,i){return fk((function(){var o;LN(a),BN(i),zN(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=GR(e,a);var s="same"===r?"same":"valid";return o="max"===i?rC(e,t,n,s):Rx(e,t,n,s),"channelsFirst"===a&&(o=bb(o,[0,4,1,2,3])),o}))}HF.className="ZeroPadding2D",p.registerClass(HF);var KF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),null==e.poolSize&&(e.poolSize=2),r=t.call(this,e),"number"==typeof e.poolSize)r.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new tN("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.poolSize));r.poolSize=e.poolSize}if(bN(r.poolSize,"poolSize"),null==e.strides)r.strides=r.poolSize;else if("number"==typeof e.strides)r.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new tN("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.strides));r.strides=e.strides}return bN(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,zN(r.padding),r.inputSpec=[new XA({ndim:3})],_possibleConstructorReturn(r)}return _createClass(n,[{key:"computeOutputShape",value:function(e){var t=VR((e=WA(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}},{key:"call",value:function(e,t){var n=this;return fk((function(){n.invokeCallHook(e,t),e=JN(UA(e),2);var r=n.poolingFunction(UA(e),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return l_(r,[2])}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($A),XF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return LN(a),zN(r),jF(e,t,n,r,a,"max")}}]),n}(KF);XF.className="MaxPooling1D",p.registerClass(XF);var YF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return LN(a),zN(r),jF(e,t,n,r,a,"avg")}}]),n}(KF);YF.className="AveragePooling1D",p.registerClass(YF);var ZF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),null==e.poolSize&&(e.poolSize=[2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new tN("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+e.strides.length+".");r.strides=e.strides}else r.strides=[e.strides,e.strides];return bN(r.poolSize,"poolSize"),bN(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,LN(r.dataFormat),zN(r.padding),r.inputSpec=[new XA({ndim:4})],_possibleConstructorReturn(r)}return _createClass(n,[{key:"computeOutputShape",value:function(e){e=WA(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=VR(t,this.poolSize[0],this.padding,this.strides[0]),n=VR(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}},{key:"call",value:function(e,t){var n=this;return fk((function(){return n.invokeCallHook(e,t),n.poolingFunction(UA(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($A),QF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return LN(a),zN(r),jF(e,t,n,r,a,"max")}}]),n}(ZF);QF.className="MaxPooling2D",p.registerClass(QF);var JF=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return LN(a),zN(r),jF(e,t,n,r,a,"avg")}}]),n}(ZF);JF.className="AveragePooling2D",p.registerClass(JF);var $F=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),null==e.poolSize&&(e.poolSize=[2,2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new tN("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+e.strides.length+".");r.strides=e.strides}else r.strides=[e.strides,e.strides,e.strides];return bN(r.poolSize,"poolSize"),bN(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,LN(r.dataFormat),zN(r.padding),r.inputSpec=[new XA({ndim:5})],_possibleConstructorReturn(r)}return _createClass(n,[{key:"computeOutputShape",value:function(e){e=WA(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=VR(t,this.poolSize[0],this.padding,this.strides[0]),n=VR(n,this.poolSize[1],this.padding,this.strides[1]),r=VR(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}},{key:"call",value:function(e,t){var n=this;return fk((function(){return n.invokeCallHook(e,t),n.poolingFunction(UA(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($A),eD=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return LN(a),zN(r),qF(e,t,n,r,a,"max")}}]),n}($F);eD.className="MaxPooling3D",p.registerClass(eD);var tD=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return LN(a),zN(r),qF(e,t,n,r,a,"avg")}}]),n}($F);tD.className="AveragePooling3D",p.registerClass(tD);var nD=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).inputSpec=[new XA({ndim:3})],r}return _createClass(n,[{key:"computeOutputShape",value:function(e){return[e[0],e[2]]}},{key:"call",value:function(e,t){throw new nN}}]),n}($A),rD=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e||{})}return _createClass(n,[{key:"call",value:function(e,t){return fk((function(){var t=UA(e);return iC(t,1)}))}}]),n}(nD);rD.className="GlobalAveragePooling1D",p.registerClass(rD);var aD=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e||{})}return _createClass(n,[{key:"call",value:function(e,t){return fk((function(){var t=UA(e);return Vw(t,1)}))}}]),n}(nD);aD.className="GlobalMaxPooling1D",p.registerClass(aD);var iD=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,LN(r.dataFormat),r.inputSpec=[new XA({ndim:4})],r}return _createClass(n,[{key:"computeOutputShape",value:function(e){return e=e,"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}},{key:"call",value:function(e,t){throw new nN}},{key:"getConfig",value:function(){var e={dataFormat:this.dataFormat},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($A),oD=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"call",value:function(e,t){var n=this;return fk((function(){var t=UA(e);return iC(t,"channelsLast"===n.dataFormat?[1,2]:[2,3])}))}}]),n}(iD);oD.className="GlobalAveragePooling2D",p.registerClass(oD);var sD=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"call",value:function(e,t){var n=this;return fk((function(){var t=UA(e);return Vw(t,"channelsLast"===n.dataFormat?[1,2]:[2,3])}))}}]),n}(iD);sD.className="GlobalMaxPooling2D",p.registerClass(sD);var uD=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).layer=e.layer,r}return _createClass(n,[{key:"build",value:function(e){this.built=!0}},{key:"getWeights",value:function(){return this.layer.getWeights()}},{key:"setWeights",value:function(e){this.layer.setWeights(e)}},{key:"getConfig",value:function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"setFastWeightInitDuringBuild",value:function(e){_get(_getPrototypeOf(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}},{key:"trainable",get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)}},{key:"trainableWeights",get:function(){return this.layer.trainableWeights}},{key:"nonTrainableWeights",get:function(){return this.layer.nonTrainableWeights}},{key:"updates",get:function(){return this.layer._updates}},{key:"losses",get:function(){return this.layer.losses}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=pE(t.layer,n);delete t.layer;var a={layer:r};return Object.assign(a,t),new e(a)}}]),n}($A),cD=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).supportsMasking=!0,r}return _createClass(n,[{key:"build",value:function(e){if((e=WA(e)).length<3)throw new tN("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(e));this.inputSpec=[{shape:e}];var t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),_get(_getPrototypeOf(n.prototype),"build",this).call(this,e)}},{key:"computeOutputShape",value:function(e){var t=[(e=WA(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t);return[n[0],e[1]].concat(n.slice(1))}},{key:"call",value:function(e,t){var n=this;return fk((function(){return rF((function(e,r){return[UA(n.layer.call(e,t)),[]]}),e=UA(e),[],!1,null,null,!1,!0)[1]}))}}]),n}(uD);cD.className="TimeDistributed",p.registerClass(cD);var lD=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;_classCallCheck(this,n),r=t.call(this,e);var a=e.layer.getConfig(),i={};i.className=e.layer.getClassName(),i.config=a,r.forwardLayer=pE(i),a.goBackwards=!0!==a.goBackwards;var o={};if(o.className=e.layer.getClassName(),o.config=a,r.backwardLayer=pE(o),r.forwardLayer.name="forward_"+r.forwardLayer.name,r.backwardLayer.name="backward_"+r.backwardLayer.name,r.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,gN(MN,"BidirectionalMergeMode",r.mergeMode),e.weights)throw new nN("weights support is not implemented for Bidirectional layer yet.");return r._stateful=e.layer.stateful,r.returnSequences=e.layer.returnSequences,r.returnState=e.layer.returnState,r.supportsMasking=!0,r._trainable=!0,r.inputSpec=e.layer.inputSpec,r.numConstants=null,r}return _createClass(n,[{key:"getWeights",value:function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}},{key:"setWeights",value:function(e){var t=Math.floor(e.length/2);this.forwardLayer.setWeights(e.slice(0,t)),this.backwardLayer.setWeights(e.slice(t))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=this.forwardLayer.computeOutputShape(e);return Array.isArray(a)&&Array.isArray(a[0])||(a=[a]),a=a,this.returnState?(r=a.slice(1),t=a[0]):t=a[0],t=t,"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):sN(n)}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=nF(e,r,a,this.numConstants);if(e=i.inputs,r=i.initialState,a=i.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(null==r||0===r.length)&&null==a)return _get(_getPrototypeOf(n.prototype),"apply",this).call(this,e,t);var o=[],s=[];if(null!=r){var u=r.length;if(u%2>0)throw new tN("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,o.push.apply(o,_toConsumableArray(r));var c=r.map((function(e){return new XA({shape:e.shape})}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),s.push.apply(s,_toConsumableArray(c))}if(null!=a)throw new nN("Support for constants in Bidirectional layers is not implemented yet.");for(var l=o[0]instanceof YA,h=0,p=o;h<p.length;h++){if(p[h]instanceof YA!==l)throw new tN("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}if(l){var d=[e].concat(o),f=this.inputSpec.concat(s),m=this.inputSpec;this.inputSpec=f;var v=_get(_getPrototypeOf(n.prototype),"apply",this).call(this,d,t);return this.inputSpec=m,v}return _get(_getPrototypeOf(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return fk((function(){var r,a,i,o,s=t.initialState;if(null==s)r=n.forwardLayer.call(e,t),a=n.backwardLayer.call(e,t);else{var u=s.slice(0,s.length/2),c=s.slice(s.length/2);r=n.forwardLayer.call(e,Object.assign(t,{initialState:u})),a=n.backwardLayer.call(e,Object.assign(t,{initialState:c}))}return n.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),n.returnSequences&&(a=VC(a,1)),"concat"===n.mergeMode?o=nA([r,a]):"sum"===n.mergeMode?o=Tk(r,a):"ave"===n.mergeMode?o=Ek(.5,Tk(r,a)):"mul"===n.mergeMode?o=Ek(r,a):null==n.mergeMode&&(o=[r,a]),n.returnState?null==n.mergeMode?o.concat(i):[o].concat(i):o}))}},{key:"resetStates",value:function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}},{key:"build",value:function(e){var t=this;UN(this.forwardLayer.name,(function(){t.forwardLayer.build(e)})),UN(this.backwardLayer.name,(function(){t.backwardLayer.build(e)})),this.built=!0}},{key:"computeMask",value:function(e,t){var n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){var r=this.forwardLayer.states.map((function(e){return null}));return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}return n}},{key:"setFastWeightInitDuringBuild",value:function(e){_get(_getPrototypeOf(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e={mergeMode:this.mergeMode},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"trainable",get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}},{key:"trainableWeights",get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}},{key:"nonTrainableWeights",get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}}],[{key:"fromConfig",value:function(e,t){var n=pE(t.layer);if(delete t.layer,null!=t.numConstants)throw new nN("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=t;return r.layer=n,new e(r)}}]),n}(uD);lD.className="Bidirectional",p.registerClass(lD),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"}(pF||(pF={})),function(e){!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(dF||(dF={}));var hD={};function pD(e){return hD[e]}function dD(e,t,n,a,i){var o=t.inputParams[e];if(o&&void 0!==o.inputIndexStart){var s=o.inputIndexStart,u=0===o.inputIndexEnd?void 0:void 0===o.inputIndexEnd?s+1:o.inputIndexEnd;if("tensor"===o.type)return fD(t.inputNames[o.inputIndexStart],n,a,i);if("tensors"===o.type)return t.inputNames.slice(s,u).map((function(e){return fD(e,n,a,i)}));var c=fD(t.inputNames.slice(s)[0],n,a,i),l=c.dataSync();return"number"===o.type?l[0]:r.toNestedArray(c.shape,l)}var h=t.attrParams[e];return h&&h.value}function fD(e,t,n,r){var a=_slicedToArray(gD(e),2),i=a[0],o=a[1];if(null!=r){var s=r.getHashTableHandleByName(i);if(null!=s)return s}var u=n.currentContextIds.find((function(e){return!!t[vD(i,e)]}));return void 0!==u?t[vD(i,u)][o]:void 0}function mD(e,t){var n=_slicedToArray(gD(e),2),r=n[0],a=n[1];return[vD(r,t&&t.currentContextId),a]}function vD(e,t){return t?"".concat(e,"-").concat(t):e}function gD(e){var t=e.split(":");return 1===t.length?[e,0]:[t[0],Number(t[t.length-1])]}function yD(e,t,n){var r=dD("pad",e,t,n);if("explicit"===r){r=dD("explicitPaddings",e,t,n);for(var a=[[0,0],[0,0],[0,0],[0,0]],i=0;i<4;i++)a[i][0]=r[2*i],a[i][1]=r[2*i+1];return a}return r}function bD(e){return e.kept?e:Yy(e)}var kD=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],xD=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],wD=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]}],CD=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number"}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],_D=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],SD=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],ID=[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],TD=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],ND=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]}],AD=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}],ED=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],RD=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],FD=[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],DD=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],OD=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],MD=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],PD=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]}],LD=function(){function e(){var t;_classCallCheck(this,e);var n=(t=[]).concat.apply(t,_toConsumableArray([b,k,x,w,C,_,S,A,N,I,E,R,F,D,O,M,T].map((function(e){return e.json}))));this.opMappers=n.reduce((function(e,t){return e[t.tfOpName]=t,e}),{})}return _createClass(e,null,[{key:"Instance",get:function(){return this._instance||(this._instance=new this)}}]),_createClass(e,[{key:"transformGraph",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=[],a=[],i=[],o=e.node.reduce((function(e,n){return e[n.name]=t.mapNode(n),n.op.startsWith("Placeholder")?r.push(e[n.name]):"Const"===n.op?a.push(e[n.name]):null!=n.input&&0!==n.input.length||i.push(e[n.name]),e}),{}),s=[],u=[],c={},l={};null!=n&&(c=this.mapSignatureEntries(n.inputs),l=this.mapSignatureEntries(n.outputs));var h=Object.keys(o);h.forEach((function(e){var t=o[e];t.inputNames.forEach((function(e){var n=_slicedToArray(mD(e),1)[0];t.inputs.push(o[n]),o[n].children.push(t)}))})),0===Object.keys(l).length?h.forEach((function(e){var t=o[e];0===t.children.length&&u.push(t)})):Object.keys(l).forEach((function(e){var t=_slicedToArray(mD(e),1)[0],n=o[t];null!=n&&(n.signatureKey=l[e],u.push(n))})),Object.keys(c).length>0?Object.keys(c).forEach((function(e){var t=_slicedToArray(mD(e),1)[0],n=o[t];n&&(n.signatureKey=c[e],s.push(n))})):s=r;var p={};null!=e.library&&null!=e.library.function&&(p=e.library.function.reduce((function(e,n){return e[n.signature.name]=t.mapFunction(n),e}),{}));var d={nodes:o,inputs:s,outputs:u,weights:a,placeholders:r,signature:n,functions:p};return i.length>0&&(d.initNodes=i),d}},{key:"mapSignatureEntries",value:function(e){return Object.keys(e||{}).reduce((function(t,n){return t[e[n].name]=n,t}),{})}},{key:"mapNode",value:function(e){var t=pD(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map((function(e){return e.startsWith("^")?e.substr(1):e})),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr};return null!=t.inputs&&(n.inputParams=t.inputs.reduce((function(e,t){return e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e}),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce((function(t,n){var r=n.type,a=void 0;switch(n.type){case"string":void 0===(a=BD(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=BD(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":void 0===(a=YD(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=YD(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":void 0===(a=UD(e.attr,n.tfName,n.defaultValue||0))&&n.tfDeprecatedName&&(a=UD(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":void 0===(a=XD(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=XD(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":void 0===(a=VD(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=VD(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":void 0===(a=QD(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=QD(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":void 0===(a=KD(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=KD(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":void 0===(a=ZD(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=ZD(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":void 0===(a=HD(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=HD(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":void 0===(a=jD(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=jD(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":void 0===(a=GD(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=GD(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(n.type," for op: ").concat(e.op))}return t[n.name]={value:a,type:r},t}),{})),n}},{key:"mapFunction",value:function(e){var t=this,n=e.nodeDef,r=[],a={};null!=n&&(a=n.reduce((function(e,n){return e[n.name]=t.mapNode(n),"Const"===n.op&&r.push(e[n.name]),e}),{}));var i=[],o=[];e.signature.inputArg.forEach((function(e){var t=_slicedToArray(mD(e.name),1)[0],n={name:t,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:WD(e.type),type:"dtype"}},children:[]};n.signatureKey=e.name,i.push(n),a[t]=n})),Object.keys(a).forEach((function(e){var t=a[e];t.inputNames.forEach((function(e){var n=_slicedToArray(mD(e),1)[0];t.inputs.push(a[n]),a[n].children.push(t)}))}));var s=e.ret;e.signature.outputArg.forEach((function(e){var t=_slicedToArray(mD(s[e.name]),2),n=t[0],r=t[1],i=a[n];null!=i&&(i.defaultOutput=r,o.push(i))}));var u=this.mapArgsToSignature(e);return{nodes:a,inputs:i,outputs:o,weights:r,placeholders:[],signature:u}}},{key:"mapArgsToSignature",value:function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((function(e,n){return e[n.name]=t.mapArgToTensorInfo(n),e}),{}),outputs:e.signature.outputArg.reduce((function(n,r){return n[r.name]=t.mapArgToTensorInfo(r,e.ret),n}),{})}}},{key:"mapArgToTensorInfo",value:function(e,t){var n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}}]),e}();function zD(e,t){var n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){var t=Jd().global;if(void 0!==t.atob)return t.atob(e);if("undefined"!=typeof Buffer)return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(e);return t?n:n.toLowerCase()}function BD(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return null!=a?zD(a.s,r):n}function VD(e,t,n){var r=e[t];return r?r.b:n}function UD(e,t,n){var r=e[t]||{},a=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof a?a:parseInt(a,10)}function WD(e){switch("string"==typeof e&&(e=pF[e]),e){case pF.DT_FLOAT:return"float32";case pF.DT_INT32:case pF.DT_INT64:case pF.DT_INT8:case pF.DT_UINT8:return"int32";case pF.DT_BOOL:return"bool";case pF.DT_DOUBLE:return"float32";case pF.DT_STRING:return"string";default:return null}}function GD(e,t,n){var r=e[t];return r&&r.func?r.func.name:n}function HD(e,t,n){var r=e[t];return r&&r.type?WD(r.type):n}function jD(e,t,n){var r=e[t];return r&&r.list&&r.list.type?r.list.type.map((function(e){return WD(e)})):n}function qD(e){if(!e.unknownRank)return null!=e.dim?e.dim.map((function(e){return"number"==typeof e.size?e.size:parseInt(e.size,10)})):[]}function KD(e,t,n){var r=e[t];return r&&r.shape?qD(r.shape):n}function XD(e,t,n){var r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((function(e){return"number"==typeof e?e:parseInt(e,10)})):n}function YD(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return a&&a.list&&a.list.s?a.list.s.map((function(e){return zD(e,r)})):n}function ZD(e,t,n){var r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map((function(e){return qD(e)})):n}function QD(e,t,n){var r=e[t];return r&&r.list&&r.list.b?r.list.b:n}var JD=function(){function e(t,n,r){var a=this;_classCallCheck(this,e),this.node=t,this.tensorMap=n,this.context=r,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((function(e){return a.getInput(e)})),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce((function(e,t){return e[t]=a.getAttr(t),e}),{}))}return _createClass(e,[{key:"getInput",value:function(e){return fD(e,this.tensorMap,this.context)}},{key:"getAttr",value:function(e,t){var n=this.node.rawAttrs[e];if(null!=n.tensor)return fD(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return UD(this.node.rawAttrs,e,t);if(null!=n.s)return BD(this.node.rawAttrs,e,t);if(null!=n.b)return VD(this.node.rawAttrs,e,t);if(null!=n.shape)return KD(this.node.rawAttrs,e,t);if(null!=n.type)return HD(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return XD(this.node.rawAttrs,e,t);if(null!=n.list.s)return YD(this.node.rawAttrs,e,t);if(null!=n.list.shape)return ZD(this.node.rawAttrs,e,t);if(null!=n.list.b)return QD(this.node.rawAttrs,e,t);if(null!=n.list.type)return jD(this.node.rawAttrs,e,t)}return t}}]),e}();function $D(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";r.assert(function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(-1!==e[n]&&-1!==t[n]&&e[n]!==t[n])return!1;return!0}(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}var eO=function(){function e(t,n,r,a,i,o,s){_classCallCheck(this,e),this.name=t,this.dtype=n,this.maxSize=r,this.elementShape=a,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=Uk(0),vk(this.idTensor)}return _createClass(e,[{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){null!=e&&e.has(t.tensor.id)||t.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"read",value:function(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?)."));return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}},{key:"readMany",value:function(e){var t=this;return e.map((function(e){return t.read(e)}))}},{key:"write",value:function(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,",\n          because the value dtype is ").concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=t.shape),$D(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),n.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(n.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));n.tensor=t,vk(t),n.written=!0,this.tensors[e]=n}},{key:"writeMany",value:function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,because the index size: ").concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach((function(e,r){return n.write(e,t[r])}))}},{key:"gather",value:function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(var n=0;n<this.size();n++)e.push(n)}if(0===e.length)return ey([],[0].concat(this.elementShape));var r=this.readMany(e);return $D(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),h_(r,0)}},{key:"concat",value:function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(0===this.size())return ey([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var r=this.readMany(t);return $D(this.elementShape,r[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(r[0].shape,")")),Fx(r,0)}},{key:"scatter",value:function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));var n=Math.max.apply(Math,_toConsumableArray(e));if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size (".concat(n,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,__(t,0))}},{key:"split",value:function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));var r=0,a=e.map((function(e){return r+=e}));if(r!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), and the TensorArray is not marked as dynamically resizeable"));var i=0===r?0:t.size/r,o=[];fk((function(){t=Ax(t,[1,r,i]);for(var s=0;s<e.length;++s)o[s]=Ax(Ox(t,[0,0===s?0:a[s-1],0],[1,e[s],i]),n.elementShape);return o}));for(var s=[],u=0;u<e.length;u++)s[u]=u;this.writeMany(s,o)}},{key:"id",get:function(){return this.idTensor.id}},{key:"closed",get:function(){return this.closed_}}]),e}(),tO=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;_classCallCheck(this,e),this.tensors=t,this.elementShape=n,this.elementDtype=r,null!=t&&t.forEach((function(e){if(r!==e.dtype)throw new Error("Invalid data types; op elements ".concat(r,", but list elements ").concat(e.dtype));$D(n,e.shape,"TensorList shape mismatch: "),vk(e)})),this.idTensor=Uk(0),this.maxNumElements=a,vk(this.idTensor)}return _createClass(e,[{key:"copy",value:function(){return new e(_toConsumableArray(this.tensors),this.elementShape,this.elementDtype)}},{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){null!=e&&e.has(t.id)||t.dispose()})),this.tensors.length=0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"stack",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(-1!==r&&this.tensors.length!==r)throw new Error("Operation expected a list with ".concat(r," elements but got a list with ").concat(this.tensors.length," elements."));return $D(e,this.elementShape,"TensorList shape mismatch: "),fk((function(){var t=n.tensors.map((function(t){return Ax(t,e)}));return h_(t,0)}))}},{key:"popBack",value:function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(0===this.size())throw new Error("Trying to pop from an empty list.");var n=this.tensors.pop();return $D(n.shape,e,"TensorList shape mismatch: "),Ax(n,e)}},{key:"pushBack",value:function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if($D(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");vk(e),this.tensors.push(e)}},{key:"resize",value:function(e){if(e<0)throw new Error("TensorListResize expects size to be non-negative. Got: "+e);if(-1!==this.maxNumElements&&e>this.maxNumElements)throw new Error("TensorListResize input size ".concat(e," is greater maxNumElement ").concat(this.maxNumElements,"."));this.tensors.length=e}},{key:"getItem",value:function(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(null==this.tensors[e])throw new Error("element at index ".concat(e," is null."));return $D(this.tensors[e].shape,t,"TensorList shape mismatch: "),this.tensors[e]}},{key:"setItem",value:function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));$D(this.elementShape,t.shape,"TensorList shape mismatch: "),vk(t),this.tensors[e]=t}},{key:"gather",value:function(e,t,n){var r=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));return $D(this.elementShape,n,"TensorList shape mismatch: "),0===(e=e.slice(0,this.size())).length?ey([],[0].concat(this.elementShape)):fk((function(){var t=e.map((function(e){return Ax(r.tensors[e],n)}));return h_(t,0)}))}},{key:"concat",value:function(e,t){var n=this;if(e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));return $D(this.elementShape,t,"TensorList shape mismatch: "),0===this.size()?ey([],[0].concat(this.elementShape)):fk((function(){var e=n.tensors.map((function(e){return Ax(e,t)}));return Fx(e,0)}))}},{key:"id",get:function(){return this.idTensor.id}}]),e}();function nO(e,t,n){var r=_slicedToArray(dD("fusedOps",e,t,n),2),a=r[0],i=r[1],o="biasadd"===a,s="prelu"===i,u="fusedbatchnorm"===a,c=dD("numArgs",e,t,n);if(o){if(s&&2!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!s&&1!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(u)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported.");var l=dD("strides",e,t,n),h=yD(e,t,n),p=dD("dataFormat",e,t,n).toUpperCase(),d=dD("dilations",e,t,n),f=_slicedToArray(dD("args",e,t,n),2);return{stride:l,pad:h,dataFormat:p,dilations:d,biasArg:f[0],preluArg:f[1],activationFunc:i,leakyreluAlpha:dD("leakyreluAlpha",e,t,n)}}function rO(e,t,n){return{boxes:dD("boxes",e,t,n),scores:dD("scores",e,t,n),maxOutputSize:dD("maxOutputSize",e,t,n),iouThreshold:dD("iouThreshold",e,t,n),scoreThreshold:dD("scoreThreshold",e,t,n),softNmsSigma:dD("softNmsSigma",e,t,n)}}var aO=function(){function e(t,n){_classCallCheck(this,e),this.keyDType=t,this.valueDType=n,this.handle=Uk(0),this.tensorMap=new Map,vk(this.handle)}var t,n;return _createClass(e,[{key:"clearAndClose",value:function(){this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),this.handle.dispose()}},{key:"size",value:function(){return this.tensorMap.size}},{key:"import",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var a,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return a=e.sent,e.abrupt("return",(this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),fk((function(){var e=__(n),t=a.length,o=e.length;r.assert(t===o,(function(){return"The number of elements doesn't match, keys has ".concat(t," elements, the values has ").concat(o," elements.")}));for(var s=0;s<t;s++){var u=a[s],c=e[s];vk(c),i.tensorMap.set(u,c)}return i.handle}))));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"find",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,e.abrupt("return",fk((function(){for(var e=[],t=0;t<r.length;t++){var i=a.findWithDefault(r[t],n);e.push(i)}return h_(e)})));case 5:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"findWithDefault",value:function(e,t){var n=this.tensorMap.get(e);return null!=n?n:t}},{key:"checkKeyAndValueTensor",value:function(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ")+e.dtype);if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ")+t.dtype)}},{key:"id",get:function(){return this.handle.id}}]),e}();function iO(e,t,n,a){var i=function(e,t,n){switch(e.category){case"arithmetic":return fk((function(){return function(e,t,n){switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[Tk(dD("a",e,t,n),dD("b",e,t,n))];case"AddN":return[ox(dD("tensors",e,t,n))];case"FloorMod":case"Mod":return[cC(dD("a",e,t,n),dD("b",e,t,n))];case"Mul":return[Ek(dD("a",e,t,n),dD("b",e,t,n))];case"RealDiv":case"Div":return[Ak(dD("a",e,t,n),dD("b",e,t,n))];case"DivNoNan":return[dw(dD("a",e,t,n),dD("b",e,t,n))];case"FloorDiv":return[Nk(dD("a",e,t,n),dD("b",e,t,n))];case"Sub":return[Kk(dD("a",e,t,n),dD("b",e,t,n))];case"Minimum":return[sC(dD("a",e,t,n),dD("b",e,t,n))];case"Maximum":return[$k(dD("a",e,t,n),dD("b",e,t,n))];case"Pow":return[qk(dD("a",e,t,n),dD("b",e,t,n))];case"SquaredDifference":return[c_(dD("a",e,t,n),dD("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"basic_math":return fk((function(){return function(e,t,n){switch(e.op){case"Abs":case"ComplexAbs":return[Yk(dD("x",e,t,n))];case"Acos":return[ax(dD("x",e,t,n))];case"Acosh":return[ix(dD("x",e,t,n))];case"Asin":return[hx(dD("x",e,t,n))];case"Asinh":return[px(dD("x",e,t,n))];case"Atan":return[dx(dD("x",e,t,n))];case"Atan2":return[fx(dD("x",e,t,n),dD("y",e,t,n))];case"Atanh":return[mx(dD("x",e,t,n))];case"Ceil":return[Hx(dD("x",e,t,n))];case"Complex":return[Jg(dD("real",e,t,n),dD("imag",e,t,n))];case"Cos":return[rw(dD("x",e,t,n))];case"Cosh":return[aw(dD("x",e,t,n))];case"Elu":return[mw(dD("x",e,t,n))];case"Erf":return[vw(dD("x",e,t,n))];case"Exp":return[gw(dD("x",e,t,n))];case"Expm1":return[bw(dD("x",e,t,n))];case"Floor":return[ww(dD("x",e,t,n))];case"Log":return[Mw(dD("x",e,t,n))];case"Log1p":return[Pw(dD("x",e,t,n))];case"Imag":return[Iw(dD("x",e,t,n))];case"Neg":return[Lw(dD("x",e,t,n))];case"Reciprocal":return[LC(dD("x",e,t,n))];case"Real":return[PC(dD("x",e,t,n))];case"Relu":return[zC(dD("x",e,t,n))];case"Round":return[jC(dD("x",e,t,n))];case"Selu":return[KC(dD("x",e,t,n))];case"Sigmoid":return[Dx(dD("x",e,t,n))];case"Sin":return[QC(dD("x",e,t,n))];case"Sign":return[ZC(dD("x",e,t,n))];case"Sinh":return[JC(dD("x",e,t,n))];case"Softplus":return[zw(dD("x",e,t,n))];case"Sqrt":return[Rk(dD("x",e,t,n))];case"Square":return[Fk(dD("x",e,t,n))];case"Tanh":return[Mx(dD("x",e,t,n))];case"Tan":return[f_(dD("x",e,t,n))];case"ClipByValue":return[jx(dD("x",e,t,n),dD("clipValueMin",e,t,n),dD("clipValueMax",e,t,n))];case"Relu6":return[BC(dD("x",e,t,n))];case"Rsqrt":return[qC(fD(e.inputNames[0],t,n))];case"Prod":return[IC(dD("x",e,t,n),dD("axes",e,t,n))];case"LeakyRelu":return[Ew(dD("x",e,t,n),dD("alpha",e,t,n))];case"Prelu":return[SC(dD("x",e,t,n),dD("alpha",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"control":return(u=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a,i,o,s,u,c,l,h,p,d,f,m,v,g,y,b,k,x,w,C,_,S,I,T,N,A,E,R,F,D,O,M,P,L,z,B,V,U,W,G,H,j,q,K,X,Y,Z,Q,J,$,ee,te,ne,re,ae,ie,oe,se,ue,ce,le,he,pe,de,fe,me,ve,ge,ye,be,ke,xe,we,Ce,_e,Se,Ie,Te,Ne;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="If"===e.t0?3:"StatelessIf"===e.t0?3:"While"===e.t0?12:"StatelessWhile"===e.t0?12:"LoopCond"===e.t0?16:"Switch"===e.t0?17:"Merge"===e.t0?28:"Enter"===e.t0?30:"Exit"===e.t0?32:"NextIteration"===e.t0?34:"TensorArrayV3"===e.t0?36:"TensorArrayWriteV3"===e.t0?38:"TensorArrayReadV3"===e.t0?40:"TensorArrayGatherV3"===e.t0?42:"TensorArrayScatterV3"===e.t0?44:"TensorArrayConcatV3"===e.t0?46:"TensorArraySplitV3"===e.t0?48:"TensorArraySizeV3"===e.t0?50:"TensorArrayCloseV3"===e.t0?52:"TensorListSetItem"===e.t0?54:"TensorListGetItem"===e.t0?56:"TensorListScatterV2"===e.t0?58:"TensorListScatter"===e.t0?58:"TensorListReserve"===e.t0?60:"EmptyTensorList"===e.t0?60:"TensorListGather"===e.t0?64:"TensorListStack"===e.t0?66:"TensorListFromTensor"===e.t0?68:"TensorListConcat"===e.t0?70:"TensorListPushBack"===e.t0?72:"TensorListPopBack"===e.t0?74:"TensorListSplit"===e.t0?76:78;break;case 3:return a=dD("thenBranch",t,n,r),i=dD("elseBranch",t,n,r),o=dD("cond",t,n,r),s=dD("args",t,n,r),e.next=6,o.data();case 6:if(!e.sent[0]){e.next=10;break}e.t1=r.functionMap[a].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap),e.next=11;break;case 10:e.t1=r.functionMap[i].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap);case 11:return e.abrupt("return",e.t1);case 12:return e.delegateYield(regeneratorRuntime.mark((function e(){var a,i,o,s,u,c,l,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=dD("body",t,n,r),i=dD("cond",t,n,r),o=dD("args",t,n,r),e.next=5,r.functionMap[i].executeFunctionAsync(o,r.tensorArrayMap,r.tensorListMap);case 5:return s=e.sent,u=o.map((function(e){return e.id})),e.next=9,s[0].data();case 9:c=e.sent,s.forEach((function(e){e.kept||-1!==u.indexOf(e.id)||e.dispose()})),l=o,h=regeneratorRuntime.mark((function e(){var t,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l,e.next=3,r.functionMap[a].executeFunctionAsync(l,r.tensorArrayMap,r.tensorListMap);case 3:return l=e.sent,n=l.map((function(e){return e.id})),t.forEach((function(e){e.kept||-1!==u.indexOf(e.id)||-1!==n.indexOf(e.id)||e.dispose()})),e.next=8,r.functionMap[i].executeFunctionAsync(l,r.tensorArrayMap,r.tensorListMap);case 8:return o=e.sent,e.next=11,o[0].data();case 11:c=e.sent,o.forEach((function(e){e.kept||-1!==u.indexOf(e.id)||-1!==n.indexOf(e.id)||e.dispose()}));case 13:case"end":return e.stop()}}),e)}));case 13:if(!c[0]){e.next=17;break}return e.delegateYield(h(),"t0",15);case 15:e.next=13;break;case 17:return e.abrupt("return",{v:l});case 18:case"end":return e.stop()}}),e)}))(),"t2",13);case 13:if("object"!=typeof(u=e.t2)){e.next=16;break}return e.abrupt("return",u.v);case 16:return e.abrupt("return",[bD(dD("pred",t,n,r))]);case 17:return c=dD("pred",t,n,r),(l=dD("data",t,n,r)).kept||(l=bD(l)),e.next=22,c.data();case 22:if(!e.sent[0]){e.next=26;break}e.t3=[void 0,l],e.next=27;break;case 26:e.t3=[l,void 0];case 27:return e.abrupt("return",e.t3);case 28:return h=t.inputNames.find((function(e){return void 0!==fD(e,n,r)})),e.abrupt("return",h?[bD(fD(h,n,r))]:void 0);case 30:return p=dD("frameName",t,n,r),d=dD("tensor",t,n,r),e.abrupt("return",(r.enterFrame(p),[bD(d)]));case 32:return f=dD("tensor",t,n,r),e.abrupt("return",(r.exitFrame(),[bD(f)]));case 34:return m=dD("tensor",t,n,r),e.abrupt("return",(r.nextIteration(),[bD(m)]));case 36:return v=dD("size",t,n,r),g=dD("dtype",t,n,r),y=dD("elementShape",t,n,r),b=dD("dynamicSize",t,n,r),k=dD("clearAfterRead",t,n,r),x=dD("identicalElementShapes",t,n,r),w=dD("name",t,n,r),C=new eO(w,g,v,y,x,b,k),e.abrupt("return",(r.addTensorArray(C),[C.idTensor,Uk(1)]));case 38:return _=dD("tensorArrayId",t,n,r),S=dD("index",t,n,r),I=dD("tensor",t,n,r),T=r.getTensorArray(_.id),e.abrupt("return",(T.write(S,I),[T.idTensor]));case 40:return N=dD("tensorArrayId",t,n,r),A=dD("index",t,n,r),e.abrupt("return",[r.getTensorArray(N.id).read(A)]);case 42:return E=dD("tensorArrayId",t,n,r),R=dD("indices",t,n,r),F=dD("dtype",t,n,r),e.abrupt("return",[r.getTensorArray(E.id).gather(R,F)]);case 44:return D=dD("tensorArrayId",t,n,r),O=dD("indices",t,n,r),M=dD("tensor",t,n,r),P=r.getTensorArray(D.id),e.abrupt("return",(P.scatter(O,M),[P.idTensor]));case 46:return L=dD("tensorArrayId",t,n,r),z=r.getTensorArray(L.id),B=dD("dtype",t,n,r),e.abrupt("return",[z.concat(B)]);case 48:return V=dD("tensorArrayId",t,n,r),U=dD("tensor",t,n,r),W=dD("lengths",t,n,r),G=r.getTensorArray(V.id),e.abrupt("return",(G.split(W,U),[G.idTensor]));case 50:return H=dD("tensorArrayId",t,n,r),e.abrupt("return",[Uk(r.getTensorArray(H.id).size(),"int32")]);case 52:return j=dD("tensorArrayId",t,n,r),q=r.getTensorArray(j.id),e.abrupt("return",(q.clearAndClose(),[q.idTensor]));case 54:return K=dD("tensorListId",t,n,r),X=dD("index",t,n,r),Y=dD("tensor",t,n,r),Z=r.getTensorList(K.id),e.abrupt("return",(Z.setItem(X,Y),[Z.idTensor]));case 56:return Q=dD("tensorListId",t,n,r),J=dD("index",t,n,r),$=dD("elementShape",t,n,r),ee=dD("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(Q.id).getItem(J,$,ee)]);case 58:return te=dD("indices",t,n,r),ne=function(e,t,n,r){if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(t.length," vs. ").concat(e.shape[0]));var a=Math.max.apply(Math,_toConsumableArray(t));if(null!=r&&-1!==r&&a>=r)throw new Error("Max index must be < array size (".concat(a,"  vs. ").concat(r,")"));var i=new tO([],n,e.dtype,r),o=__(e,0);return t.forEach((function(e,t){i.setItem(e,o[t])})),i}(dD("tensor",t,n,r),te,dD("elementShape",t,n,r),dD("numElements",t,n,r)),e.abrupt("return",(r.addTensorList(ne),[ne.idTensor]));case 60:return re=dD("elementShape",t,n,r),ae=dD("elementDType",t,n,r),ie="TensorListReserve"===t.op?"numElements":"maxNumElements",oe=function(e,t,n){return new tO([],e,t,n)}(re,ae,dD(ie,t,n,r)),e.abrupt("return",(r.addTensorList(oe),[oe.idTensor]));case 64:return se=dD("tensorListId",t,n,r),ue=dD("indices",t,n,r),ce=dD("elementShape",t,n,r),le=dD("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(se.id).gather(ue,le,ce)]);case 66:return he=dD("tensorListId",t,n,r),pe=dD("elementShape",t,n,r),de=dD("elementDType",t,n,r),fe=dD("numElements",t,n,r),e.abrupt("return",[r.getTensorList(he.id).stack(pe,de,fe)]);case 68:return me=function(e,t,n){var r=e.dtype;if(e.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: "+e.shape);if(e.dtype!==n)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(n));$D(e.shape.slice(1),t,"TensorList shape mismatch: ");var a=__(e);return new tO(a,t,r)}(dD("tensor",t,n,r),dD("elementShape",t,n,r),dD("elementDType",t,n,r)),e.abrupt("return",(r.addTensorList(me),[me.idTensor]));case 70:return ve=dD("tensorListId",t,n,r),ge=r.getTensorList(ve.id),ye=dD("dtype",t,n,r),be=dD("elementShape",t,n,r),e.abrupt("return",[ge.concat(ye,be)]);case 72:return ke=dD("tensorListId",t,n,r),xe=dD("tensor",t,n,r),we=r.getTensorList(ke.id),e.abrupt("return",(we.pushBack(xe),[we.idTensor]));case 74:return Ce=dD("tensorListId",t,n,r),_e=dD("elementShape",t,n,r),Se=dD("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(Ce.id).popBack(_e,Se)]);case 76:return Ie=dD("tensor",t,n,r),Te=dD("elementShape",t,n,r),Ne=function(e,t,n){var r=0,a=t.map((function(e){return r+=e}));if(r!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(e.shape));for(var i=0===r?0:e.size/r,o=fk((function(){var o=[];e=Ax(e,[1,r,i]);for(var s=0;s<t.length;++s)o[s]=Ax(Ox(e,[0,0===s?0:a[s-1],0],[1,t[s],i]),n);return e.dispose(),o})),s=new tO([],n,e.dtype,t.length),u=0;u<o.length;u++)s.setItem(u,o[u]);return s}(Ie,dD("lengths",t,n,r),Te),e.abrupt("return",(r.addTensorList(Ne),[Ne.idTensor]));case 78:throw TypeError("Node type ".concat(t.op," is not implemented"));case 79:case"end":return e.stop()}}),e)}))),function(e,t,n){return u.apply(this,arguments)})(e,t,n);case"convolution":return fk((function(){return function(e,t,n){switch(e.op){case"Conv1D":var r=dD("stride",e,t,n),a=dD("pad",e,t,n),i=dD("dataFormat",e,t,n).toUpperCase(),o=dD("dilation",e,t,n);return[Qx(dD("x",e,t,n),dD("filter",e,t,n),r,a,i,o)];case"Conv2D":var s=dD("strides",e,t,n),u=yD(e,t,n),c=dD("dataFormat",e,t,n).toUpperCase(),l=dD("dilations",e,t,n);return[Zx(dD("x",e,t,n),dD("filter",e,t,n),[s[1],s[2]],u,c,[l[1],l[2]])];case"_FusedConv2D":var h=nO(e,t,n),p=h.stride,d=h.pad,m=h.dataFormat,v=h.dilations,g=h.biasArg,y=h.preluArg,b=h.activationFunc,k=h.leakyreluAlpha;return[f.conv2d({x:dD("x",e,t,n),filter:dD("filter",e,t,n),strides:[p[1],p[2]],pad:d,dataFormat:m,dilations:[v[1],v[2]],bias:g,activation:b,preluActivationWeights:y,leakyreluAlpha:k})];case"FusedDepthwiseConv2dNative":var x=nO(e,t,n),w=x.stride,C=x.pad,_=x.dataFormat,S=x.dilations,I=x.biasArg,T=x.preluArg,N=x.activationFunc,A=x.leakyreluAlpha;return[f.depthwiseConv2d({x:dD("x",e,t,n),filter:dD("filter",e,t,n),strides:[w[1],w[2]],pad:C,dataFormat:_,dilations:[S[1],S[2]],bias:I,activation:N,preluActivationWeights:T,leakyreluAlpha:A})];case"Conv2DBackpropInput":case"Conv2dTranspose":var E=dD("outputShape",e,t,n),R=dD("strides",e,t,n),F=yD(e,t,n);return[$x(dD("x",e,t,n),dD("filter",e,t,n),E,[R[1],R[2]],F)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":var D=dD("strides",e,t,n),O=yD(e,t,n),M=dD("dilations",e,t,n),P=dD("dataFormat",e,t,n).toUpperCase();return[uw(dD("input",e,t,n),dD("filter",e,t,n),[D[1],D[2]],O,P,[M[1],M[2]])];case"Conv3D":var L=dD("strides",e,t,n),z=dD("pad",e,t,n),B=dD("dataFormat",e,t,n).toUpperCase(),V=dD("dilations",e,t,n);return[ew(dD("x",e,t,n),dD("filter",e,t,n),[L[1],L[2],L[3]],z,B,[V[1],V[2],V[3]])];case"AvgPool":var U=dD("strides",e,t,n),W=dD("pad",e,t,n),G=dD("kernelSize",e,t,n);return[Ex(dD("x",e,t,n),[G[1],G[2]],[U[1],U[2]],W)];case"MaxPool":var H=dD("strides",e,t,n),j=dD("pad",e,t,n),q=dD("kernelSize",e,t,n);return[nC(dD("x",e,t,n),[q[1],q[2]],[H[1],H[2]],j)];case"MaxPoolWithArgmax":var K=dD("strides",e,t,n),X=dD("pad",e,t,n),Y=dD("kernelSize",e,t,n),Z=dD("includeBatchInIndex",e,t,n),Q=aC(dD("x",e,t,n),[Y[1],Y[2]],[K[1],K[2]],X,Z);return[Q.result,Q.indexes];case"AvgPool3D":var J=dD("strides",e,t,n),$=dD("pad",e,t,n),ee=dD("kernelSize",e,t,n);return[Rx(dD("x",e,t,n),[ee[1],ee[2],ee[3]],[J[1],J[2],J[3]],$)];case"MaxPool3D":var te=dD("strides",e,t,n),ne=dD("pad",e,t,n),re=dD("kernelSize",e,t,n);return[rC(dD("x",e,t,n),[re[1],re[2],re[3]],[te[1],te[2],te[3]],ne)];case"Dilation2D":var ae=dD("strides",e,t,n),ie=dD("pad",e,t,n),oe=dD("dilations",e,t,n),se=ae[1],ue=ae[2],ce=oe[1],le=oe[2];return[lw(dD("x",e,t,n),dD("filter",e,t,n),[se,ue],ie,[ce,le],"NHWC")];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"creation":return fk((function(){return function(e,t,n){switch(e.op){case"Fill":var r=dD("shape",e,t,n),a=dD("dtype",e,t,n);return[Hk(r,dD("value",e,t,n),a)];case"LinSpace":return[Dw(dD("start",e,t,n),dD("stop",e,t,n),dD("num",e,t,n))];case"Multinomial":var i=dD("logits",e,t,n),o=dD("numSamples",e,t,n),s=dD("seed",e,t,n);return[pC(i,o,s)];case"OneHot":var u=dD("indices",e,t,n),c=dD("depth",e,t,n),l=dD("onValue",e,t,n),h=dD("offValue",e,t,n);return[yb(u,c,l,h)];case"Ones":return[mC(dD("shape",e,t,n),dD("dtype",e,t,n))];case"OnesLike":return[vC(dD("x",e,t,n))];case"RandomUniform":return[OC(dD("shape",e,t,n),dD("minval",e,t,n),dD("maxval",e,t,n),dD("dtype",e,t,n))];case"Range":return[MC(dD("start",e,t,n),dD("stop",e,t,n),dD("step",e,t,n),dD("dtype",e,t,n))];case"TruncatedNormal":var p=dD("shape",e,t,n),d=dD("mean",e,t,n),f=dD("stdDev",e,t,n),m=dD("seed",e,t,n);return[x_(p,d,f,dD("dtype",e,t,n),m)];case"Zeros":return[fC(dD("shape",e,t,n),dD("dtype",e,t,n))];case"ZerosLike":return[Dk(dD("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"dynamic":return(s=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a,i,o,s,u,c,l,h,p,d,f,m,v,g,y,b,k,x,w,C,_,S,I,T;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="NonMaxSuppressionV5"===e.t0?3:"NonMaxSuppressionV4"===e.t0?14:"NonMaxSuppressionV3"===e.t0?25:"NonMaxSuppressionV2"===e.t0?25:"Where"===e.t0?30:"ListDiff"===e.t0?36:37;break;case 3:return a=rO(t,n,r),i=a.boxes,o=a.scores,s=a.maxOutputSize,u=a.iouThreshold,c=a.scoreThreshold,l=a.softNmsSigma,e.next=12,ZS.nonMaxSuppressionWithScoreAsync(i,o,s,u,c,l);case 12:return h=e.sent,e.abrupt("return",[h.selectedIndices,h.selectedScores]);case 14:return p=rO(t,n,r),d=p.boxes,f=p.scores,m=p.maxOutputSize,v=p.iouThreshold,g=p.scoreThreshold,y=dD("padToMaxOutputSize",t,n,r),e.next=23,ZS.nonMaxSuppressionPaddedAsync(d,f,m,v,g,y);case 23:return b=e.sent,e.abrupt("return",[b.selectedIndices,b.validOutputs]);case 25:return k=rO(t,n,r),x=k.boxes,w=k.scores,C=k.maxOutputSize,_=k.iouThreshold,S=k.scoreThreshold,e.next=28,ZS.nonMaxSuppressionAsync(x,w,C,_,S);case 28:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 30:return I=Xy(dD("condition",t,n,r),"bool"),e.next=33,T_(I);case 33:return e.t2=e.sent,T=[e.t2],e.abrupt("return",(I.dispose(),T));case 36:return e.abrupt("return",YC(dD("x",t,n,r),dD("y",t,n,r)));case 37:throw TypeError("Node type ".concat(t.op," is not implemented"));case 38:case"end":return e.stop()}}),e)}))),function(e,t,n){return s.apply(this,arguments)})(e,t,n);case"evaluation":return fk((function(){return function(e,t,n){switch(e.op){case"TopKV2":var r=dD("x",e,t,n),a=dD("k",e,t,n),i=dD("sorted",e,t,n),o=k_(r,a,i);return[o.values,o.indices];case"Unique":var s=dD("x",e,t,n),u=w_(s);return[u.values,u.indices];case"UniqueV2":var c=dD("x",e,t,n),l=dD("axis",e,t,n),h=w_(c,l);return[h.values,h.indices];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"image":return fk((function(){return function(e,t,n){switch(e.op){case"ResizeBilinear":var r=dD("images",e,t,n),a=dD("size",e,t,n),i=dD("alignCorners",e,t,n),o=dD("halfPixelCenters",e,t,n);return[ZS.resizeBilinear(r,[a[0],a[1]],i,o)];case"ResizeNearestNeighbor":var s=dD("images",e,t,n),u=dD("size",e,t,n),c=dD("alignCorners",e,t,n),l=dD("halfPixelCenters",e,t,n);return[ZS.resizeNearestNeighbor(s,[u[0],u[1]],c,l)];case"CropAndResize":var h=dD("image",e,t,n),p=dD("boxes",e,t,n),d=dD("boxInd",e,t,n),f=dD("cropSize",e,t,n),m=dD("method",e,t,n),v=dD("extrapolationValue",e,t,n);return[ZS.cropAndResize(h,p,d,f,m,v)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"graph":return fk((function(){return function(e,t,n){switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":var r=dD("default",e,t,n);return[fD(e.name,t,n)||r];case"Placeholder":return[fD(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[bD(dD("x",e,t,n))];case"IdentityN":return dD("x",e,t,n).map((function(e){return bD(e)}));case"Snapshot":return[bD(dD("x",e,t,n))];case"Shape":return[m_(dD("x",e,t,n).shape,"int32")];case"ShapeN":return dD("x",e,t,n).map((function(e){return m_(e.shape)}));case"Size":return[Uk(dD("x",e,t,n).size,"int32")];case"Rank":return[Uk(dD("x",e,t,n).rank,"int32")];case"NoOp":return[Uk(1)];case"Print":var a=dD("x",e,t,n),i=dD("data",e,t,n),o=dD("message",e,t,n),s=dD("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(o);for(var u=0;u<i.length;u++)console.log(Array.prototype.slice.call(i[u].dataSync()).slice(0,s));return[a];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"logical":return fk((function(){return function(e,t,n){switch(e.op){case"Equal":return[hw(dD("a",e,t,n),dD("b",e,t,n))];case"NotEqual":return[dC(dD("a",e,t,n),dD("b",e,t,n))];case"Greater":return[_w(dD("a",e,t,n),dD("b",e,t,n))];case"GreaterEqual":return[Sw(dD("a",e,t,n),dD("b",e,t,n))];case"Less":return[Rw(dD("a",e,t,n),dD("b",e,t,n))];case"LessEqual":return[Fw(dD("a",e,t,n),dD("b",e,t,n))];case"LogicalAnd":return[Jw(dD("a",e,t,n),dD("b",e,t,n))];case"LogicalNot":return[$w(dD("a",e,t,n))];case"LogicalOr":return[eC(dD("a",e,t,n),dD("b",e,t,n))];case"Select":case"SelectV2":return[pw(dD("condition",e,t,n),dD("a",e,t,n),dD("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"matrices":return fk((function(){return function(e,t,n){switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[gb(dD("a",e,t,n),dD("b",e,t,n),dD("transposeA",e,t,n),dD("transposeB",e,t,n))];case"Transpose":return[bb(dD("x",e,t,n),dD("perm",e,t,n))];case"_FusedMatMul":var r=_slicedToArray(dD("fusedOps",e,t,n),2),a=r[0],i=r[1],o="biasadd"===a,s="prelu"===i,u=dD("numArgs",e,t,n),c=dD("leakyreluAlpha",e,t,n);if(o){if(s&&2!==u)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!s&&1!==u)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var l=_slicedToArray(dD("args",e,t,n),2),h=l[0],p=l[1];return[f.matMul({a:dD("a",e,t,n),b:dD("b",e,t,n),transposeA:dD("transposeA",e,t,n),transposeB:dD("transposeB",e,t,n),bias:h,activation:i,preluActivationWeights:p,leakyreluAlpha:c})];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"normalization":return fk((function(){return function(e,t,n){switch(e.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[zx(dD("x",e,t,n),dD("mean",e,t,n),dD("variance",e,t,n),dD("offset",e,t,n),dD("scale",e,t,n),dD("epsilon",e,t,n))];case"LRN":return[Ow(dD("x",e,t,n),dD("radius",e,t,n),dD("bias",e,t,n),dD("alpha",e,t,n),dD("beta",e,t,n))];case"Softmax":return[r_(dD("x",e,t,n))];case"LogSoftmax":return[Ww(dD("x",e,t,n))];case"SparseToDense":return[K_(dD("sparseIndices",e,t,n),dD("outputShape",e,t,n),dD("sparseValues",e,t,n),dD("defaultValue",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"reduction":return fk((function(){return function(e,t,n){switch(e.op){case"Max":var r=dD("axis",e,t,n),a=dD("keepDims",e,t,n);return[Vw(dD("x",e,t,n),r,a)];case"Mean":var i=dD("axis",e,t,n),o=dD("keepDims",e,t,n);return[iC(dD("x",e,t,n),i,o)];case"Min":var s=dD("axis",e,t,n),u=dD("keepDims",e,t,n);return[oC(dD("x",e,t,n),s,u)];case"Sum":var c=dD("axis",e,t,n),l=dD("keepDims",e,t,n);return[Uw(dD("x",e,t,n),c,l)];case"All":var h=dD("axis",e,t,n),p=dD("keepDims",e,t,n);return[sx(dD("x",e,t,n),h,p)];case"Any":var d=dD("axis",e,t,n),f=dD("keepDims",e,t,n);return[ux(dD("x",e,t,n),d,f)];case"ArgMax":var m=dD("axis",e,t,n);return[cx(dD("x",e,t,n),m)];case"ArgMin":var v=dD("axis",e,t,n);return[lx(dD("x",e,t,n),v)];case"Prod":var g=dD("axis",e,t,n),y=dD("keepDims",e,t,n);return[IC(dD("x",e,t,n),g,y)];case"Cumsum":var b=dD("axis",e,t,n),k=dD("exclusive",e,t,n),x=dD("reverse",e,t,n);return[iw(dD("x",e,t,n),b,k,x)];case"Bincount":var w=dD("x",e,t,n),C=dD("weights",e,t,n),_=dD("size",e,t,n);return[Wx(w,C,_)];case"DenseBincount":var S=dD("x",e,t,n),I=dD("weights",e,t,n),T=dD("size",e,t,n),N=dD("binaryOutput",e,t,n);return[ow(S,I,T,N)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"slice_join":return fk((function(){return function(e,t,n){switch(e.op){case"ConcatV2":case"Concat":var a=dD("n",e,t,n),i=dD("axis",e,t,n),o=dD("tensors",e,t,n);return o=o.slice(0,a),[Fx(o,i)];case"Gather":var s=dD("x",e,t,n),u=dD("indices",e,t,n);return[Cw(s,Xy(u,"int32"),0)];case"GatherV2":var c=dD("axis",e,t,n),l=dD("batchDims",e,t,n),h=dD("x",e,t,n),p=dD("indices",e,t,n);return[Cw(h,Xy(p,"int32"),c,l)];case"Reverse":for(var d=dD("dims",e,t,n),f=[],m=0;m<d.length;m++)d[m]&&f.push(m);var v=dD("x",e,t,n);return[VC(v,f)];case"ReverseV2":var g=dD("axis",e,t,n),y=dD("x",e,t,n);return[VC(y,g)];case"Slice":var b=dD("begin",e,t,n),k=dD("size",e,t,n);return[Ox(dD("x",e,t,n),b,k)];case"StridedSlice":var x=dD("begin",e,t,n),w=dD("end",e,t,n),C=dD("strides",e,t,n),_=dD("beginMask",e,t,n),S=dD("endMask",e,t,n),I=dD("ellipsisMask",e,t,n),T=dD("newAxisMask",e,t,n),N=dD("shrinkAxisMask",e,t,n),A=dD("x",e,t,n);return[d_(A,x,w,C,_,S,I,T,N)];case"Pack":return fk((function(){var a=dD("axis",e,t,n),i=dD("tensors",e,t,n),o=i[0].shape,s=l_(i[0]).shape,u=i.map((function(e){var t=r.arraysEqual(e.shape,o);if(!t&&!r.arraysEqual(l_(e).shape,s))throw new Error("the input tensors shape does not match");return t?e:Ax(e,o)}));return[h_(u,a)]}));case"Unpack":var E=dD("axis",e,t,n),R=dD("tensor",e,t,n);return __(R,E);case"Tile":var F=dD("reps",e,t,n);return[kw(dD("x",e,t,n),F)];case"Split":case"SplitV":var D=dD("axis",e,t,n),O=dD("numOrSizeSplits",e,t,n),M=dD("x",e,t,n);return s_(M,O,D);case"ScatterNd":var P=dD("indices",e,t,n),L=dD("values",e,t,n),z=dD("shape",e,t,n);return[q_(P,L,z)];case"GatherNd":var B=dD("x",e,t,n),V=dD("indices",e,t,n);return[X_(B,V)];case"SparseToDense":var U=dD("sparseIndices",e,t,n),W=dD("outputShape",e,t,n),G=dD("sparseValues",e,t,n),H=dD("defaultValue",e,t,n);return[K_(U,G,W,G.dtype===H.dtype?H:Xy(H,G.dtype))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"spectral":return fk((function(){return function(e,t,n){switch(e.op){case"FFT":return[a_(dD("x",e,t,n))];case"IFFT":return[i_(dD("x",e,t,n))];case"RFFT":return[u_(dD("x",e,t,n))];case"IRFFT":return[o_(dD("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"transformation":return fk((function(){return function(e,t,n){switch(e.op){case"Cast":return[Xy(dD("x",e,t,n),dD("dtype",e,t,n))];case"ExpandDims":var r=dD("axis",e,t,n);return[yw(dD("x",e,t,n),r)];case"Squeeze":var a=dD("axis",e,t,n);return[l_(dD("x",e,t,n),a)];case"Reshape":return[Ax(dD("x",e,t,n),dD("shape",e,t,n))];case"MirrorPad":return[uC(dD("x",e,t,n),dD("padding",e,t,n),dD("mode",e,t,n))];case"PadV2":case"Pad":return[yC(dD("x",e,t,n),dD("padding",e,t,n),dD("constantValue",e,t,n))];case"SpaceToBatchND":var i=dD("blockShape",e,t,n),o=dD("paddings",e,t,n);return[CC(dD("x",e,t,n),i,o)];case"BatchToSpaceND":var s=dD("blockShape",e,t,n),u=dD("crops",e,t,n);return[Lx(dD("x",e,t,n),s,u)];case"DepthToSpace":var c=dD("blockSize",e,t,n),l=dD("dataFormat",e,t,n).toUpperCase();return[sw(dD("x",e,t,n),c,l)];case"BroadcastTo":return[Gx(dD("x",e,t,n),dD("shape",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"hash_table":return(o=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r,a){var i,o,s,u,c,l,h,p,d,f,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="HashTable"===e.t0?3:"HashTableV2"===e.t0?3:"LookupTableImport"===e.t0?5:"LookupTableImportV2"===e.t0?5:"LookupTableFind"===e.t0?10:"LookupTableFindV2"===e.t0?10:15;break;case 3:return i=dD("keyDType",t,n,r),o=dD("valueDType",t,n,r),s=new aO(i,o),e.abrupt("return",(a.addHashTable(t.name,s),[s.handle]));case 5:return u=dD("tableHandle",t,n,r,a),c=dD("keys",t,n,r),l=dD("values",t,n,r),h=a.getHashTableById(u.id),e.next=8,h.import(c,l);case 8:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 10:return p=dD("tableHandle",t,n,r,a),d=dD("keys",t,n,r),f=dD("defaultValue",t,n,r),m=a.getHashTableById(p.id),e.next=13,m.find(d,f);case 13:return e.t2=e.sent,e.abrupt("return",[e.t2]);case 15:throw TypeError("Node type ".concat(t.op," is not implemented"));case 16:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return o.apply(this,arguments)})(e,t,n,a);case"custom":var i=pD(e.op);if(i&&i.customExecutor)return i.customExecutor(new JD(e,t,n));throw TypeError("Custom op ".concat(e.op," is not registered."));default:throw TypeError("Unknown op '".concat(e.op,"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()"))}var o,s,u}(e,t,n);return r.isPromise(i)?i.then((function(e){return[].concat(e)})):[].concat(i)}var oO=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};_classCallCheck(this,e),this.weightMap=t,this.tensorArrayMap=n,this.tensorListMap=r,this.functionMap=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return _createClass(e,[{key:"newFrame",value:function(e,t){return{id:e,frameName:t,iterationId:0}}},{key:"generateCurrentContextIds",value:function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}},{key:"contextIdforContexts",value:function(e){return e?e.map((function(e){return 0===e.id&&0===e.iterationId?"":"".concat(e.frameName,"-").concat(e.iterationId)})).join("/"):""}},{key:"enterFrame",value:function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}},{key:"exitFrame",value:function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}},{key:"nextIteration",value:function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}},{key:"getWeight",value:function(e){return this.weightMap[e]}},{key:"addTensorArray",value:function(e){this.tensorArrayMap[e.id]=e}},{key:"getTensorArray",value:function(e){return this.tensorArrayMap[e]}},{key:"addTensorList",value:function(e){this.tensorListMap[e.id]=e}},{key:"getTensorList",value:function(e){return this.tensorListMap[e]}},{key:"dispose",value:function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var n in this.tensorListMap)this.tensorListMap[n].clearAndClose(e)}},{key:"currentContext",set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())},get:function(){return this.contexts}},{key:"currentContextId",get:function(){return this._currentContextIds[0]}},{key:"currentContextIds",get:function(){return this._currentContextIds}}]),e}();function sO(e,t,n,r){var a=new Set,i=[],o=null,s=null,u=new Set,c=Object.keys(e).map((function(e){return gD(e)[0]})),l=[];null!=r&&(l=r.map((function(e){return gD(e.name)[0]})));for(var h=_toConsumableArray(t);h.length>0;){var p=h.pop();(hO(p)||pO(p)||dO(p))&&null==o&&(s=(o=p).children.map((function(e){return e.name})).filter((function(e){return a.has(e)}))),a.add(p.name),null==n[p.name]&&-1===c.indexOf(p.name)&&-1===l.indexOf(p.name)&&(0!==p.inputs.length?p.inputs.forEach((function(e){u.has(e.name)||(u.add(e.name),h.push(e))})):i.push(p.name))}return{inputs:e,outputs:t,usedNodes:a,missingInputs:i,dynamicNode:o,syncInputs:s}}var uO=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],cO=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],lO=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2"];function hO(e){return uO.indexOf(e.op)>=0}function pO(e){return cO.indexOf(e.op)>=0}function dO(e){return lO.indexOf(e.op)>=0}var fO=function(){function e(t,n){var r=this;_classCallCheck(this,e),this.graph=t,this.parent=n,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((function(n){r._functionExecutorMap[n]=new e(t.functions[n],r)}))}var t,n,a,i;return _createClass(e,[{key:"getCompilationKey",value:function(e,t){var n=e.map((function(e){return e.name})).sort(),r=t.map((function(e){return e.name})).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}},{key:"compile",value:function(e,t){var n=sO(e,t,this.weightMap,this._initNodes),r=n.missingInputs,a=n.dynamicNode,i=n.syncInputs;if(null!=a)throw new Error("This execution contains the node '".concat(a.name,"', which has the dynamic op '").concat(a.op,"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [").concat(i,"]"));if(r.length>0){var o=t.map((function(e){return e.name})),s=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(o,"] from the provided inputs [").concat(s,"]. Missing the following inputs: [").concat(r,"]"))}return function(e,t,n){var r=n.usedNodes,a=n.inputs,i=[],o=Object.keys(a).map((function(e){return gD(e)[0]})).map((function(t){return e.nodes[t]})),s=e.initNodes;o.forEach((function(e){r.has(e.name)&&i.push(e)})),e.weights.forEach((function(e){r.has(e.name)&&i.push(e)})),null!=s&&s.forEach((function(e){r.has(e.name)&&i.push(e)}));for(var u=new Set,c=[];i.length>0;){var l=i.pop();u.add(l.name),t[l.name]||c.push(l),l.children.forEach((function(e){!u.has(e.name)&&r.has(e.name)&&e.inputs.every((function(e){return u.has(e.name)}))&&i.push(e)}))}return c}(this.graph,this.weightMap,n)}},{key:"execute",value:function(e,t){var n=this;e=this.mapInputs(e);var a=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var i=a.map((function(e){return n.graph.nodes[gD(e)[0]]})),o=t.map((function(e){return gD(e)[0]})),s=o.map((function(e){return n.graph.nodes[e]}));0===s.length&&(s=this._outputs);var u=this.getCompilationKey(i,s),c=this.compiledMap.get(u);null==c&&(c=this.compile(e,s),this.compiledMap.set(u,c));var l={},h={};return fk((function(){var a=new oO(n.weightMap,l,h,n.functionExecutorMap),i=Object.assign({},n.weightMap);Object.keys(e).forEach((function(t){var n=_slicedToArray(gD(t),2),r=n[0],a=[];a[n[1]]=e[t],i[r]=a}));for(var s=n.getFrozenTensorIds(i),u={},p=0;p<c.length;p++){var d=c[p];if(!i[d.name]){var f=iO(d,i,a,n._resourceManager);if(r.isPromise(f))throw new Error("The execution of the op '".concat(d.op,"' returned a promise. Please use model.executeAsync() instead."));i[d.name]=f,n.checkTensorForDisposal(d.name,d,i,a,s,o,u)}}return null==n.parent&&a.dispose(s),t.map((function(e){return fD(e,i,a)}))}))}},{key:"getFrozenTensorIds",value:function(e){var t=[].concat.apply([],Object.keys(e).map((function(t){return e[t]})).map((function(e){return e.map((function(e){return e.id}))})));return new Set(t)}},{key:"checkTensorForDisposal",value:function(e,t,n,r,a,i,o){"control"!==t.category&&-1===i.indexOf(e)&&(n[e].forEach((function(e){null!=e&&(o[e.id]=(o[e.id]||0)+t.children.length)})),t.inputs.forEach((function(e){if("control"!==e.category){var t=function(e,t,n){return t[vD(e,n.currentContextId)]}(e.name,n,r);null!=t&&t.forEach((function(e){if(e&&!a.has(e.id)){var t=o[e.id];1===t?(e.dispose(),delete o[e.id]):null!=t&&o[e.id]--}}))}})))}},{key:"executeAsync",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._executeAsync(t,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"_executeAsync",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,u,c,l,h,p=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=p.length>2&&void 0!==p[2]&&p[2],a=p.length>3&&void 0!==p[3]?p[3]:{},i=p.length>4&&void 0!==p[4]?p[4]:{},r||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),n=this.mapOutputs(n),this.checkOutputs(n)),o=new oO(this.weightMap,a,i,this.functionExecutorMap),e.next=7,this.executeWithControlFlow(t,o,n,r);case 7:return s=e.sent,u=n.map((function(e){return fD(e,s,o)})),c=u.map((function(e){return e.id})),l=Object.keys(t).map((function(e){return t[e].id})),h=new Set([].concat(_toConsumableArray(c),_toConsumableArray(l),_toConsumableArray(this.weightIds))),e.abrupt("return",(Object.keys(s).forEach((function(e){s[e].forEach((function(e){!e||e.isDisposed||h.has(e.id)||e.dispose()}))})),null==this.parent&&o.dispose(h),u));case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"executeFunctionAsync",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.reduce((function(e,t,n){return e[i.inputs[n].name]=t,e}),{}),e.abrupt("return",this._executeAsync(a,this.outputNodes,!0,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"executeWithControlFlow",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r,a){var i,o,s,u,c,l,h,p,d,f,m,v,g,y,b,k,x,w=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Object.keys(t),o=i.map((function(e){return w.graph.nodes[gD(e)[0]]})),s=r.map((function(e){return gD(e)[0]})),0===(u=s.map((function(e){return w.graph.nodes[e]}))).length&&(u=this._outputs),c=sO(t,u,this.weightMap,this._initNodes),l=c.usedNodes,h=c.missingInputs,p=c.dynamicNode,d=c.syncInputs,f=[].concat(_toConsumableArray(o),_toConsumableArray(this.graph.weights),_toConsumableArray(this._initNodes||[])).map((function(e){return{node:e,contexts:n.currentContext}})),m=Object.assign({},this.weightMap),Object.keys(t).forEach((function(e){var n=_slicedToArray(gD(e),2),r=n[0],a=[];a[n[1]]=t[e],m[r]=a})),v={},g=this.getFrozenTensorIds(m),y={};case 6:if(!(f.length>0)){e.next=12;break}return b=this.processStack(o,f,n,m,y,g,s,v,l),e.next=10,Promise.all(b);case 10:e.next=6;break;case 12:if(null!=p||a||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),!((k=u.filter((function(e){return!hO(e)&&!fD(e.name,m,n)})).map((function(e){return e.name}))).length>0)){e.next=17;break}throw x="",null!=p&&(x="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [".concat(d,"]")),new Error("Cannot compute the outputs [".concat(k,"] from the provided inputs [").concat(i,"]. Consider providing the following inputs: [").concat(h,"]. ").concat(x));case 17:return e.abrupt("return",m);case 18:case"end":return e.stop()}}),e,this)}))),function(e,n,r,a){return t.apply(this,arguments)})},{key:"processStack",value:function(e,t,n,a,i,o,s,u,c){for(var l=this,h=[],p=function(){var e,p=t.pop();n.currentContext=p.contexts;var d="";if("Enter"===p.node.op&&dD("isConstant",p.node,a,n)&&(e=_slicedToArray(mD(p.node.name,n),1),d=e[0]),null==a[p.node.name]){var f,m=iO(p.node,a,n,l._resourceManager);d||(f=_slicedToArray(mD(p.node.name,n),1),d=f[0]);var v=n.currentContext;r.isPromise(m)?h.push(m.then((function(e){return a[d]=e,n.currentContext=v,l.checkTensorForDisposal(d,p.node,a,n,o,s,u),l.processChildNodes(p.node,t,n,a,i,c),e}))):(a[d]=m,l.checkTensorForDisposal(d,p.node,a,n,o,s,u),l.processChildNodes(p.node,t,n,a,i,c))}else l.processChildNodes(p.node,t,n,a,i,c)};t.length>0;)p();return h}},{key:"processChildNodes",value:function(e,t,n,r,a,i){e.children.forEach((function(e){var o=_slicedToArray(mD(e.name,n),1)[0];!a[o]&&i.has(e.name)&&("Merge"===e.op?e.inputNames.some((function(e){return!!fD(e,r,n)}))&&(a[o]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every((function(e){return!!fD(e,r,n)}))&&(a[o]=!0,t.push({contexts:n.currentContext,node:e})))}))}},{key:"dispose",value:function(){var e=this;Object.keys(this.weightMap).forEach((function(t){return e.weightMap[t].forEach((function(e){return e.dispose()}))}))}},{key:"checkInputShapeAndType",value:function(e){var t=this;Object.keys(e).forEach((function(n){var a=e[n],i=_slicedToArray(gD(n),1)[0],o=t.graph.nodes[i];if(o.attrParams.shape&&o.attrParams.shape.value){var s=o.attrParams.shape.value,u=s.length===a.shape.length&&a.shape.every((function(e,t){return-1===s[t]||s[t]===e}));r.assert(u,(function(){return"The shape of dict['".concat(o.name,"'] provided in model.execute(dict) must be [").concat(s,"], but was [").concat(a.shape,"]")}))}o.attrParams.dtype&&o.attrParams.dtype.value&&r.assert(a.dtype===o.attrParams.dtype.value,(function(){return"The dtype of dict['".concat(o.name,"'] provided in model.execute(dict) must be ").concat(o.attrParams.dtype.value,", but was ").concat(a.dtype)}))}))}},{key:"mapInputs",value:function(e){var t={};for(var n in e)null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n]?t[this._signature.inputs[n].name]=e[n]:t[n]=e[n];return t}},{key:"checkInputs",value:function(e){var t=this,n=Object.keys(e).filter((function(e){var n=_slicedToArray(gD(e),1)[0];return null==t.graph.nodes[n]}));if(n.length>0)throw new Error("The dict provided in model.execute(dict) has keys: [".concat(n,"] that are not part of graph"))}},{key:"mapOutputs",value:function(e){var t=this;return e.map((function(e){return null!=t._signature&&null!=t._signature.outputs&&null!=t._signature.outputs[e]?t._signature.outputs[e].name:e}),{})}},{key:"checkOutputs",value:function(e){var t=this;e.forEach((function(e){var n=_slicedToArray(gD(e),1)[0];if(!t.graph.nodes[n])throw new Error("The output '".concat(e,"' is not found in the graph"))}))}},{key:"weightIds",get:function(){return this.parent?this.parent.weightIds:this._weightIds}},{key:"functionExecutorMap",get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}},{key:"weightMap",get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t,n=Object.keys(e).map((function(t){return e[t].map((function(e){return e.id}))}));this._weightIds=(t=[]).concat.apply(t,_toConsumableArray(n)),this._weightMap=e}},{key:"resourceManager",set:function(e){this._resourceManager=e}},{key:"inputs",get:function(){return this._inputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"outputs",get:function(){return this._outputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"inputNodes",get:function(){return this._inputs.map((function(e){return e.signatureKey||e.name}))}},{key:"outputNodes",get:function(){return this._outputs.map((function(e){var t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t}))}},{key:"functions",get:function(){var e=this;return Object.keys(this._functions).reduce((function(t,n){return t[n]=e._functions[n].signature,t}),{})}}]),e}(),mO=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,e),this.hashTableNameToHandle=t,this.hashTableMap=n}return _createClass(e,[{key:"addHashTable",value:function(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}},{key:"getHashTableHandleByName",value:function(e){return this.hashTableNameToHandle[e]}},{key:"getHashTableById",value:function(e){return this.hashTableMap[e]}},{key:"dispose",value:function(){for(var e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(var t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}]),e}(),vO=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,e),this.modelUrl=t,this.loadOptions=n,this.version="n/a",null==n&&(this.loadOptions={}),this.resourceManager=new mO}var t,n,r;return _createClass(e,[{key:"findIOHandler",value:function(){var e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=o.browserHTTPRequest(e,this.loadOptions);else{var t=o.getLoadHandlers(e,this.loadOptions);if(0===t.length)t.push(o.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one (".concat(t.length,") load handlers for URL '").concat([e],"'"));this.handler=t[0]}}},{key:"load",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.findIOHandler(),null!=this.handler.load){e.next=2;break}throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");case 2:return e.next=4,this.handler.load();case 4:return t=e.sent,e.abrupt("return",this.loadSync(t));case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"loadSync",value:function(e){this.artifacts=e;var t,n=this.artifacts.modelTopology;this.isOldVersion(e.convertedBy)?null!=this.artifacts.userDefinedMetadata&&(t=this.artifacts.userDefinedMetadata.signature):t=this.artifacts.signature,this.version="".concat(n.versions.producer,".").concat(n.versions.minConsumer);var r=o.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new fO(LD.Instance.transformGraph(n,t)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer&&null!=e.modelInitializer.node){var a=LD.Instance.transformGraph(e.modelInitializer);this.initializer=new fO(a),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}},{key:"isOldVersion",value:function(e){if(e){var t=e.split("TensorFlow.js Converter v");t=t[0].split(".");var n=parseInt(t[0],10),r=parseInt(t[1],10);return n<=1||2===n&&r<=7}return!0}},{key:"save",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=7;break}if(0!==(r=o.getSaveHandlers(t)).length){e.next=4;break}throw new Error("Cannot find any save handlers for URL '".concat(t,"'"));case 4:if(!(r.length>1)){e.next=6;break}throw new Error("Found more than one (".concat(r.length,") save handlers for URL '").concat(t,"'"));case 6:t=r[0];case 7:if(null!=t.save){e.next=9;break}throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 9:return e.abrupt("return",t.save(this.artifacts));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"predict",value:function(e,t){return this.execute(e,this.outputNodes)}},{key:"normalizeInputs",value:function(e){if(!(e instanceof _g||Array.isArray(e)))return e;if((e=Array.isArray(e)?e:[e]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the graph model has ".concat(this.inputNodes.length," placeholders, while there are ").concat(e.length," input tensors."));return this.inputNodes.reduce((function(t,n,r){return t[n]=e[r],t}),{})}},{key:"normalizeOutputs",value:function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}},{key:"execute",value:function(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]}},{key:"executeAsync",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.normalizeInputs(t),n=this.normalizeOutputs(n),e.next=3,this.executor.executeAsync(t,n);case 3:return r=e.sent,e.abrupt("return",r.length>1?r:r[0]);case 5:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"convertTensorMapToTensorsMap",value:function(e){return Object.keys(e).reduce((function(t,n){return t[n]=[e[n]],t}),{})}},{key:"dispose",value:function(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}},{key:"modelVersion",get:function(){return this.version}},{key:"inputNodes",get:function(){return this.executor.inputNodes}},{key:"outputNodes",get:function(){return this.executor.outputNodes}},{key:"inputs",get:function(){return this.executor.inputs}},{key:"outputs",get:function(){return this.executor.outputs}},{key:"weights",get:function(){return this.executor.weightMap}},{key:"metadata",get:function(){return this.artifacts.userDefinedMetadata}}]),e}();function gO(e){return yO.apply(this,arguments)}function yO(){return(yO=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:{},null!=t){e.next=3;break}throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");case 3:return null==n&&(n={}),n.fromTFHub&&null==t.load&&(t.endsWith("/")||(t+="/"),t+="model.json?tfjs-format=file"),r=new vO(t,n),e.next=7,r.load();case 7:return e.abrupt("return",r);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function bO(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(null==e)return null;if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse){if(CO(e)){var i=Array.isArray(e)?[]:{};for(var o in r.add(e),e){var s=bO(e[o],t,n,r);i[o]=s}return r.delete(e),i}throw new Error("Can't recurse into non-iterable type: "+e)}return n.set(e,a.value),a.value}function kO(e){return null===e?null:CO(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function xO(e,t){return wO.apply(this,arguments)}function wO(){return(wO=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var a,i,o,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=new Map,bO(t,n,a),i=0,o=Array.from(a.keys());case 3:if(!(i<o.length)){e.next=14;break}if(s=o[i],u=a.get(s),!r.isPromise(u)){e.next=11;break}return e.next=9,u;case 9:c=e.sent,a.set(s,c);case 11:i++,e.next=3;break;case 14:return e.abrupt("return",bO(t,n,a));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function CO(e){return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"==typeof e&&!(e instanceof _g))}function _O(e){return e instanceof _g?{value:e.clone(),recurse:!1}:CO(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}var SO=function(){function e(t){if(_classCallCheck(this,e),this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}return _createClass(e,[{key:"wrap",value:function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}},{key:"get",value:function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}},{key:"set",value:function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}},{key:"length",value:function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}},{key:"isFull",value:function(){return this.length()===this.capacity}},{key:"isEmpty",value:function(){return 0===this.length()}},{key:"push",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}},{key:"pushAll",value:function(e){var t,n=_createForOfIteratorHelper(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.push(r)}}catch(UY){n.e(UY)}finally{n.f()}}},{key:"pop",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e}},{key:"unshift",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}},{key:"shift",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}},{key:"shuffleExcise",value:function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}]),e}(),IO=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.call(this,n.INITIAL_CAPACITY)}return _createClass(n,[{key:"isFull",value:function(){return!1}},{key:"push",value:function(e){_get(_getPrototypeOf(n.prototype),"isFull",this).call(this)&&this.expand(),_get(_getPrototypeOf(n.prototype),"push",this).call(this,e)}},{key:"unshift",value:function(e){_get(_getPrototypeOf(n.prototype),"isFull",this).call(this)&&this.expand(),_get(_getPrototypeOf(n.prototype),"unshift",this).call(this,e)}},{key:"expand",value:function(){for(var e=2*this.capacity,t=new Array(e),n=this.length(),r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}]),n}(SO);function TO(e){return new RO(e)}function NO(e){return new FO(e)}IO.INITIAL_CAPACITY=32;var AO,EO=function(){function e(){_classCallCheck(this,e)}var t,n,r,a,i,o;return _createClass(e,[{key:"toArray",value:(o=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,this.next();case 3:n=e.sent;case 4:if(n.done){e.next=11;break}return t.push(n.value),e.next=8,this.next();case 8:n=e.sent;case 9:e.next=4;break;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"toArrayForTest",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.prefetch(100),n=[],e.next=3,t.next();case 3:r=e.sent;case 4:if(r.done){e.next=11;break}return n.push(r.value),e.next=8,t.next();case 8:r=e.sent;case 9:e.next=4;break;case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"resolveFully",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:t=e.sent;case 3:if(t.done){e.next=9;break}return e.next=6,this.next();case 6:t=e.sent;case 7:e.next=3;break;case 9:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"resolveWhile",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:n=e.sent,r=t(n.value);case 4:if(n.done||!r){e.next=11;break}return e.next=7,this.next();case 7:n=e.sent,r=t(n.value);case 9:e.next=4;break;case 11:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"handleErrors",value:function(e){return new BO(this,e)}},{key:"filter",value:function(e){return new LO(this,e)}},{key:"map",value:function(e){return new zO(this,e)}},{key:"mapAsync",value:function(e){return new VO(this,e)}},{key:"serialMapAsync",value:function(e){return new VO(this,e).serial()}},{key:"flatmap",value:function(e){return new WO(this,e)}},{key:"forEachAsync",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.map(t).resolveFully());case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"serialForEach",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.serialMapAsync(t).resolveWhile((function(e){return!0===e})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"rowMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new PO(this,e,t)}},{key:"columnMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:kO;return this.rowMajorBatch(e,t).map((function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kO;return function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set,a=t[0];if(r.has(a))throw new Error("Circular references are not supported.");var i=n(t);if(i.recurse&&null!==i.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(i.recurse){if(CO(a)){var o=Array.isArray(a)?[]:{};r.add(a);var s=function(a){var i=e(t.map((function(e){return e[a]})),n,r);o[a]=i};for(var u in a)s(u);return r.delete(a),o}throw new Error("Can't recurse into non-iterable type: "+a)}return i.value}(e,t)}(e,n)}))}},{key:"concatenate",value:function(e,t){return new GO(TO([this,e]),t)}},{key:"take",value:function(e){return e<0||null==e?this:new MO(this,e)}},{key:"skip",value:function(e){return e<0||null==e?this:new OO(this,e)}},{key:"prefetch",value:function(e){return new jO(this,e)}},{key:"shuffle",value:function(e,t){return new qO(this,e,t)}},{key:"serial",value:function(){return new DO(this)}}]),e}(),RO=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e){var t;return _classCallCheck(this,r),(t=n.call(this)).items=e,t.trav=0,t}return _createClass(r,[{key:"summary",value:function(){return"Array of ".concat(this.items.length," items")}},{key:"next",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.trav>=this.items.length)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return t=this.items[this.trav],e.abrupt("return",(this.trav++,{value:(n=t,bO(n,_O)),done:!1}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(EO),FO=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e){var t;return _classCallCheck(this,r),(t=n.call(this)).nextFn=e,t}return _createClass(r,[{key:"summary",value:function(){return"Function call"}},{key:"next",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",this.nextFn());case 4:throw e.prev=4,e.t0=e.catch(0),e.t0.message="Error thrown while iterating through a dataset: "+e.t0.message,e.t0;case 7:case"end":return e.stop()}}),e,this,[[0,4]])}))),function(){return t.apply(this,arguments)})}]),r}(EO),DO=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e){var t;return _classCallCheck(this,a),(t=r.call(this)).upstream=e,t.lastRead=Promise.resolve({value:null,done:!1}),t}return _createClass(a,[{key:"summary",value:function(){return this.upstream.summary()+" -> Serial"}},{key:"next",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"serialNext",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.upstream.next());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(EO),OO=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t){var n;return _classCallCheck(this,a),(n=r.call(this)).upstream=e,n.maxCount=t,n.count=0,n.lastRead=Promise.resolve({value:null,done:!1}),n}return _createClass(a,[{key:"summary",value:function(){return this.upstream.summary()+" -> Skip"}},{key:"next",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"serialNext",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++<this.maxCount)){e.next=9;break}return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done){e.next=6;break}return e.abrupt("return",t);case 6:mk(t.value);case 7:e.next=0;break;case 9:return e.abrupt("return",this.upstream.next());case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(EO),MO=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e,t){var a;return _classCallCheck(this,r),(a=n.call(this)).upstream=e,a.maxCount=t,a.count=0,a}return _createClass(r,[{key:"summary",value:function(){return this.upstream.summary()+" -> Take"}},{key:"next",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(EO),PO=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t){var n,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return _classCallCheck(this,a),(n=r.call(this)).upstream=e,n.batchSize=t,n.enableSmallLastBatch=i,n.lastRead=Promise.resolve({value:null,done:!1}),n}return _createClass(a,[{key:"summary",value:function(){return this.upstream.summary()+" -> RowMajorBatch"}},{key:"next",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"serialNext",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[];case 1:if(!(t.length<this.batchSize)){e.next=10;break}return e.next=4,this.upstream.next();case 4:if(!(n=e.sent).done){e.next=7;break}return e.abrupt("return",this.enableSmallLastBatch&&t.length>0?{value:t,done:!1}:{value:null,done:!0});case 7:t.push(n.value);case 8:e.next=1;break;case 10:return e.abrupt("return",{value:t,done:!1});case 11:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(EO),LO=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t){var n;return _classCallCheck(this,a),(n=r.call(this)).upstream=e,n.predicate=t,n.lastRead=Promise.resolve({value:null,done:!1}),n}return _createClass(a,[{key:"summary",value:function(){return this.upstream.summary()+" -> Filter"}},{key:"next",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"serialNext",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done&&!this.predicate(t.value)){e.next=5;break}return e.abrupt("return",t);case 5:mk(t.value);case 6:e.next=0;break;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(EO),zO=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e,t){var a;return _classCallCheck(this,r),(a=n.call(this)).upstream=e,a.transform=t,a}return _createClass(r,[{key:"summary",value:function(){return this.upstream.summary()+" -> Map"}},{key:"next",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,i,o,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:n=a.getTensorsInContainer(t.value),r=this.transform(t.value),i=a.getTensorsInContainer(r),o=_createForOfIteratorHelper(n);try{for(o.s();!(s=o.n()).done;)u=s.value,a.isTensorInList(u,i)||u.dispose()}catch(UY){o.e(UY)}finally{o.f()}return e.abrupt("return",{value:r,done:!1});case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(EO),BO=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t){var n;return _classCallCheck(this,a),(n=r.call(this)).upstream=e,n.handler=t,n.count=0,n.lastRead=Promise.resolve({value:null,done:!1}),n}return _createClass(a,[{key:"summary",value:function(){return this.upstream.summary()+" -> handleErrors"}},{key:"next",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"serialNext",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.upstream.next();case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),this.handler(e.t0)){e.next=10;break}return e.abrupt("return",{value:null,done:!0});case 10:e.next=0;break;case 12:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return t.apply(this,arguments)})}]),a}(EO),VO=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e,t){var a;return _classCallCheck(this,r),(a=n.call(this)).upstream=e,a.transform=t,a}return _createClass(r,[{key:"summary",value:function(){return this.upstream.summary()+" -> AsyncMap"}},{key:"next",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,i,o,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:return n=a.getTensorsInContainer(t.value),e.next=8,this.transform(t.value);case 8:r=e.sent,i=a.getTensorsInContainer(r),o=_createForOfIteratorHelper(n);try{for(o.s();!(s=o.n()).done;)u=s.value,a.isTensorInList(u,i)||u.dispose()}catch(UY){o.e(UY)}finally{o.f()}return e.abrupt("return",{value:r,done:!1});case 13:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(EO),UO=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(){var e;return _classCallCheck(this,a),(e=r.call(this)).outputQueue=new IO,e.lastRead=Promise.resolve({value:null,done:!1}),e}return _createClass(a,[{key:"next",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"serialNext",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.outputQueue.length()){e.next=7;break}return e.next=3,this.pump();case 3:if(e.sent){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:e.next=0;break;case 7:return e.abrupt("return",{value:this.outputQueue.shift(),done:!1});case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(EO),WO=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e,t){var a;return _classCallCheck(this,r),(a=n.call(this)).upstream=e,a.transform=t,a}return _createClass(r,[{key:"summary",value:function(){return this.upstream.summary()+" -> Flatmap"}},{key:"pump",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,i,o,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",!1);case 5:n=a.getTensorsInContainer(t.value),r=this.transform(t.value),i=a.getTensorsInContainer(r),this.outputQueue.pushAll(r),o=_createForOfIteratorHelper(n);try{for(o.s();!(s=o.n()).done;)u=s.value,a.isTensorInList(u,i)||u.dispose()}catch(UY){o.e(UY)}finally{o.f()}return e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(UO),GO=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t){var n;return _classCallCheck(this,a),(n=r.call(this)).baseErrorHandler=t,n.lastRead=null,n.iterator=null,n.moreIterators=e,n}return _createClass(a,[{key:"summary",value:function(){return"TODO: fill in upstream of chained summaries -> Chained"}},{key:"next",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.readFromChain(this.lastRead),this.lastRead));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"readFromChain",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(null!=this.iterator){e.next=9;break}return e.next=5,this.moreIterators.next();case 5:if(!(n=e.sent).done){e.next=8;break}return e.abrupt("return",{value:null,done:!0});case 8:this.iterator=n.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler));case 9:return e.next=11,this.iterator.next();case 11:return r=e.sent,e.abrupt("return",r.done?(this.iterator=null,this.readFromChain(t)):r);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),a}(EO);!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(AO||(AO={}));var HO=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:AO.FAIL;return _classCallCheck(this,a),(t=r.call(this)).iterators=e,t.mismatchMode=n,t.count=0,t.currentPromise=null,t}return _createClass(a,[{key:"summary",value:function(){return"{TODO: fill in upstream of zip summaries} -> Zip"}},{key:"nextState",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:return n=0,r=0,e.next=5,xO(this.iterators,(function(e){return e instanceof EO?{value:e.next().then((function(e){return n++,e.done&&r++,e.value})),recurse:!1}:{value:null,recurse:!0}}));case 5:if(a=e.sent,n!==r){e.next=8;break}return e.abrupt("return",{value:null,done:!0});case 8:if(!(r>0)){e.next=14;break}e.t0=this.mismatchMode,e.next=e.t0===AO.FAIL?12:e.t0===AO.SHORTEST?13:14;break;case 12:throw new Error("Zipped streams should have the same length. Mismatched at element ".concat(this.count,"."));case 13:return e.abrupt("return",{value:null,done:!0});case 14:return e.abrupt("return",(this.count++,{value:a,done:!1}));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"next",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.currentPromise=this.nextState(this.currentPromise),this.currentPromise));case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(EO),jO=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this)).upstream=e,a.bufferSize=r,a.buffer=new SO(r),a}return _createClass(n,[{key:"summary",value:function(){return this.upstream.summary()+" -> Prefetch"}},{key:"refill",value:function(){for(;!this.buffer.isFull();){var e=this.upstream.next();this.buffer.push(e)}}},{key:"next",value:function(){return this.refill(),this.buffer.shift()}}]),n}(EO),qO=function(e){_inherits(i,e);var t,n,a=_createSuper(i);function i(e,t,n){var o;return _classCallCheck(this,i),(o=a.call(this,e,t)).upstream=e,o.windowSize=t,o.upstreamExhausted=!1,o.random=NC.alea(n||r.now().toString()),o.lastRead=Promise.resolve({value:null,done:!1}),o}return _createClass(i,[{key:"next",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"randomInt",value:function(e){return Math.floor(this.random()*e)}},{key:"chooseIndex",value:function(){return this.randomInt(this.buffer.length())}},{key:"serialNext",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.upstreamExhausted||this.refill();case 1:if(this.buffer.isEmpty()){e.next=11;break}return t=this.chooseIndex(),e.next=5,this.buffer.shuffleExcise(t);case 5:if((n=e.sent).done){e.next=8;break}return e.abrupt("return",(this.refill(),n));case 8:this.upstreamExhausted=!0;case 9:e.next=1;break;case 11:return e.abrupt("return",{value:null,done:!0});case 12:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),i}(jO),KO=function(){function e(){_classCallCheck(this,e),this.size=null}var t,n,a;return _createClass(e,[{key:"batch",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this;return r.assert(e>0,(function(){return"batchSize needs to be positive, but it is\n      "+e})),t=this.size===1/0||null==this.size?this.size:n?Math.ceil(this.size/e):Math.floor(this.size/e),XO(_asyncToGenerator(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.iterator();case 2:return t.abrupt("return",t.sent.columnMajorBatch(e,n,QO));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"concatenate",value:function(e){var t,n=this;return t=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,XO(_asyncToGenerator(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.t0=t.sent,t.next=5,e.iterator();case 5:return t.t1=t.sent,t.abrupt("return",t.t0.concatenate.call(t.t0,t.t1));case 7:case"end":return t.stop()}}),t)}))),t)}},{key:"filter",value:function(e){var t,n=this;return t=this.size===1/0?1/0:null,XO(_asyncToGenerator(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.filter((function(t){return fk((function(){return e(t)}))})));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"forEachAsync",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.iterator();case 2:return e.abrupt("return",e.sent.forEachAsync(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"map",value:function(e){var t=this;return XO(_asyncToGenerator(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.map((function(t){return fk((function(){return e(t)}))})));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"mapAsync",value:function(e){var t=this;return XO(_asyncToGenerator(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.mapAsync(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"prefetch",value:function(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var t=this;return XO(_asyncToGenerator(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.prefetch(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"repeat",value:function(e){var t,n=this;return t=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,XO(_asyncToGenerator(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(r=NO(_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.iterator();case 2:return e.t0=e.sent,e.t1=!1,e.abrupt("return",{value:e.t0,done:e.t1});case 5:case"end":return e.stop()}}),e)})))).take(e),new GO(r,void 0)));case 1:case"end":return t.stop()}}),t)}))),t)}},{key:"skip",value:function(e){var t,n=this;return t=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,XO(_asyncToGenerator(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.skip(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"shuffle",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting bufferSize to the dataset size (".concat(this.size," elements)"));var a=this,i=NC.alea(t||r.now().toString());return XO(_asyncToGenerator(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.int32(),n&&(r+=i.int32()),t.next=4,a.iterator();case 4:return t.abrupt("return",t.sent.shuffle(e,r.toString()));case 5:case"end":return t.stop()}}),t)}))),this.size)}},{key:"take",value:function(e){var t,n=this;return t=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,XO(_asyncToGenerator(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.take(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"toArray",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArray());case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"toArrayForTest",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArrayForTest());case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();function XO(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new(function(n){_inherits(i,n);var r,a=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=a.apply(this,arguments)).size=t,e}return _createClass(i,[{key:"iterator",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e());case 1:case"end":return t.stop()}}),t)}))),function(){return r.apply(this,arguments)})}]),i}(KO))}function YO(e){return XO(_asyncToGenerator(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",TO(e));case 1:case"end":return t.stop()}}),t)}))),e.length)}function ZO(e){if(!CO(e))throw new Error("The argument to zip() must be an object or array.");var t;if(Array.isArray(e))for(var n=0;n<e.length;n++)t=null==t?e[n].size:Math.min(t,e[n].size);else if(e instanceof Object)for(var r in e)t=null==t?e[r].size:Math.min(t,e[r].size);return XO(_asyncToGenerator(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:AO.FAIL;return new HO(e,t)},t.next=3,xO(e,(function(e){if(e instanceof KO)return{value:e.iterator(),recurse:!1};if(CO(e))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")}));case 3:return t.t1=t.sent,t.t2=AO.SHORTEST,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)}))),t)}function QO(e){return null===e?null:null==(t=e[0])||null===(n=t)||"object"!=typeof n&&"function"!=typeof n||Array.isArray(t)||"object"==typeof t&&t instanceof _g||r.isTypedArray(t)?{value:function(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof _g?h_(e):ey(e)}(e),recurse:!1}:{value:null,recurse:!0};var t,n}KO.MAX_BUFFER_SIZE=1e4;var JO=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e){var t;return _classCallCheck(this,r),(t=n.call(this)).input=e,t}return _createClass(r,[{key:"iterator",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.input.iterator();case 2:return e.abrupt("return",e.sent.decodeUTF8().split("\n").map((function(e){return e.endsWith("\r")&&(e=e.slice(0,-1)),e})));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(KO),$O=Symbol("out"),eM=Symbol("field"),tM=Symbol("quote"),nM=Symbol("quoteafterquote"),rM=Symbol("quoteinquote"),aM=function(e){_inherits(s,e);var t,n,a,i,o=_createSuper(s);function s(e,t){var n;return _classCallCheck(this,s),(n=o.call(this)).input=e,n.hasHeader=!0,n.fullColumnNames=null,n.columnNamesValidated=!1,n.columnConfigs=null,n.configuredColumnsOnly=!1,n.delimiter=",",n.delimWhitespace=!1,n.base=new JO(e),t||(t={}),n.hasHeader=!1!==t.hasHeader,n.fullColumnNames=t.columnNames,n.columnConfigs=t.columnConfigs,n.configuredColumnsOnly=t.configuredColumnsOnly,t.delimWhitespace?(r.assert(null==t.delimiter,(function(){return"Delimiter should not be provided when delimWhitespace is true."})),n.delimWhitespace=!0,n.delimiter=" "):n.delimiter=t.delimiter?t.delimiter:",",n}return _createClass(s,[{key:"columnNames",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.columnNamesValidated,e.t0){e.next=4;break}return e.next=4,this.setColumnNames();case 4:return e.abrupt("return",this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames);case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"setColumnNames",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,a,i,o,s,u=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.maybeReadHeaderLine();case 2:if(t=e.sent,this.fullColumnNames||t){e.next=5;break}throw new Error("Column names must be provided if there is no header line.");case 5:if(this.fullColumnNames&&t&&r.assert(t.length===this.fullColumnNames.length,(function(){return"The length of provided columnNames ("+u.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."})),this.fullColumnNames||(this.fullColumnNames=t),n=this.fullColumnNames.reduce((function(e,t){return e[t]=e[t]+1||1,e}),{}),a=Object.keys(n).filter((function(e){return n[e]>1})),r.assert(0===a.length,(function(){return"Duplicate column names found: "+a.toString()})),!this.columnConfigs){e.next=16;break}i=0,o=Object.keys(this.columnConfigs);case 9:if(!(i<o.length)){e.next=16;break}if(s=o[i],-1!==this.fullColumnNames.indexOf(s)){e.next=13;break}throw new Error('The key "'+s+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").");case 13:i++,e.next=9;break;case 16:this.columnNamesValidated=!0;case 17:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"maybeReadHeaderLine",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasHeader){e.next=10;break}return e.next=3,this.base.iterator();case 3:return t=e.sent,e.next=6,t.next();case 6:if(!(n=e.sent).done){e.next=9;break}throw new Error("No data was found for CSV parsing.");case 9:return e.abrupt("return",this.parseRow(n.value,!1));case 10:return e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"iterator",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.columnNamesValidated,e.t0){e.next=4;break}return e.next=4,this.setColumnNames();case 4:return e.next=6,this.base.iterator();case 6:return t=e.sent,e.abrupt("return",(this.hasHeader&&(t=t.skip(1)),t.map((function(e){return n.makeDataElement(e)}))));case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"makeDataElement",value:function(e){for(var t=this.parseRow(e),n={},r={},a=0;a<this.fullColumnNames.length;a++){var i=this.fullColumnNames[a],o=this.columnConfigs?this.columnConfigs[i]:null;if(!this.configuredColumnsOnly||o){var s=t[a],u=null;if(""===s)if(o&&void 0!==o.default)u=o.default;else{if(o&&(o.required||o.isLabel))throw new Error("Required column ".concat(i," is empty in this line: ").concat(e));u=void 0}else{var c=Number(s);if(isNaN(c))u=o&&"bool"===o.dtype?this.getBoolean(s):s;else if(o&&o.dtype)switch(o.dtype){case"float32":u=c;break;case"int32":u=Math.floor(c);break;case"bool":u=this.getBoolean(s);break;default:u=c}else u=c}o&&o.isLabel?r[i]=u:n[i]=u}}return 0===Object.keys(r).length?n:{xs:n,ys:r}}},{key:"getBoolean",value:function(e){return"1"===e||"true"===e.toLowerCase()?1:0}},{key:"parseRow",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[],r=0,a=e.length,i=$O,o=0;o<a;o++)switch(i){case $O:switch(e.charAt(o)){case'"':r=o+1,i=tM;break;case this.delimiter:if(r=o+1," "===this.delimiter&&this.delimWhitespace)break;n.push(""),i=$O;break;default:i=eM,r=o}break;case eM:switch(e.charAt(o)){case this.delimiter:n.push(e.substring(r,o)),i=$O,r=o+1}break;case tM:switch(e.charAt(o)){case'"':i=nM}break;case nM:switch(e.charAt(o)){case this.delimiter:n.push(e.substring(r,o-1)),i=$O,r=o+1;break;case'"':i=tM;break;default:i=rM}break;case rM:switch(e.charAt(o)){case'"':i=tM}}if(n.push(i===nM?e.substring(r,a-1):e.substring(r)),t&&n.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have ".concat(this.fullColumnNames.length," elements in a row, but got ").concat(n));return n}}]),s}(KO),iM=function(e){_inherits(u,e);var t,n,a,i,o,s=_createSuper(u);function u(e){var t;_classCallCheck(this,u),(t=s.call(this)).microphoneConfig=e,t.isClosed=!1,t.fftSize=e.fftSize||1024;var n=Math.log2(t.fftSize);if(t.fftSize<0||n<4||n>14||!Number.isInteger(n))throw new Error("Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got "+t.fftSize);if(t.numFrames=e.numFramesPerSpectrogram||43,t.sampleRateHz=e.sampleRateHz,t.columnTruncateLength=e.columnTruncateLength||t.fftSize,t.audioTrackConstraints=e.audioTrackConstraints,t.smoothingTimeConstant=e.smoothingTimeConstant||0,t.includeSpectrogram=!1!==e.includeSpectrogram,t.includeWaveform=!0===e.includeWaveform,!t.includeSpectrogram&&!t.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return t}return _createClass(u,[{key:"summary",value:function(){return"microphone"}},{key:"start",value:(o=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:null==this.audioTrackConstraints||this.audioTrackConstraints,video:!1});case 3:this.stream=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),new Error("Error thrown while initializing video stream: "+e.t0.message);case 9:if(this.stream){e.next=11;break}throw new Error("Could not obtain audio from microphone.");case 11:if(t=window.AudioContext||window.webkitAudioContext,this.audioContext=new t,!this.sampleRateHz){e.next=17;break}if(this.audioContext.sampleRate===this.sampleRateHz){e.next=15;break}throw new Error("Mismatch in sampling rate: Expected: ".concat(this.sampleRateHz,"; Actual: ")+this.audioContext.sampleRate);case 15:e.next=18;break;case 17:this.sampleRateHz=this.audioContext.sampleRate;case 18:n=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,n.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize);case 20:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return o.apply(this,arguments)})},{key:"next",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isClosed){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return e.next=4,this.getAudioData();case 4:return r=e.sent,this.includeSpectrogram&&(a=this.flattenQueue(r.freqDataQueue),t=this.getTensorFromAudioDataArray(a,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(i=this.flattenQueue(r.timeDataQueue),n=this.getTensorFromAudioDataArray(i,[this.numFrames*this.fftSize,1])),e.abrupt("return",{value:{spectrogram:t,waveform:n},done:!1});case 8:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"capture",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:return e.abrupt("return",e.sent.value);case 3:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getAudioData",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],n=[],r=0,e.abrupt("return",new Promise((function(e){var i=setInterval((function(){a.includeSpectrogram&&(a.analyser.getFloatFrequencyData(a.freqData),a.freqData[0]===-1/0&&e({freqDataQueue:t,timeDataQueue:n}),t.push(a.freqData.slice(0,a.columnTruncateLength))),a.includeWaveform&&(a.analyser.getFloatTimeDomainData(a.timeData),n.push(a.timeData.slice())),++r===a.numFrames&&(clearInterval(i),e({freqDataQueue:t,timeDataQueue:n}))}),a.fftSize/a.sampleRateHz*1e3)})));case 3:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"stop",value:function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),null!=this.stream&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}},{key:"toArray",value:function(){throw new Error("Can not convert infinite audio stream to array.")}},{key:"getSampleRate",value:function(){return this.sampleRateHz}},{key:"flattenQueue",value:function(e){var t=e[0].length,n=new Float32Array(e.length*t);return e.forEach((function(e,r){return n.set(e,r*t)})),n}},{key:"getTensorFromAudioDataArray",value:function(e,t){var n=new Float32Array(r.sizeFromShape(t));return n.set(e,n.length-e.length),ey(n,t)}}],[{key:"create",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:{},!Jd().get("IS_NODE")){e.next=3;break}throw new Error("microphone API is only supported in browser environment.");case 3:return n=new u(t),e.next=6,n.start();case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),u}(EO),oM=function(e){_inherits(s,e);var t,n,a,i,o=_createSuper(s);function s(e,t){var n;if(_classCallCheck(this,s),(n=o.call(this)).webcamVideoElement=e,n.webcamConfig=t,n.isClosed=!0,n.resize=!1,n.needToResize())if(n.resize=!0,n.cropSize=[n.webcamConfig.resizeHeight,n.webcamConfig.resizeWidth],n.cropBoxInd=m_([0],"int32"),n.webcamConfig.centerCrop){var r=1*n.webcamConfig.resizeWidth/n.webcamVideoElement.width,a=1*n.webcamConfig.resizeHeight/n.webcamVideoElement.height,i=(1-r)/2,u=(1-a)/2;n.cropBox=v_([u,i,a+u,i+r],[1,4])}else n.cropBox=v_([0,0,1,1],[1,4]);return _possibleConstructorReturn(n)}return _createClass(s,[{key:"summary",value:function(){return"webcam"}},{key:"start",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.webcamConfig.facingMode&&r.assert("user"===this.webcamConfig.facingMode||"environment"===this.webcamConfig.facingMode,(function(){return"Invalid webcam facing mode: ".concat(t.webcamConfig.facingMode,". Please provide 'user' or 'environment'")})),e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}});case 4:this.stream=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),e.t0.message="Error thrown while initializing video stream: "+e.t0.message,e.t0;case 10:if(this.stream){e.next=12;break}throw new Error("Could not obtain video from webcam.");case 12:try{this.webcamVideoElement.srcObject=this.stream}catch(n){console.log(n),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return e.abrupt("return",(this.webcamVideoElement.play(),this.isClosed=!1,new Promise((function(e){t.webcamVideoElement.onloadedmetadata=function(){e()}}))));case 14:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(){return i.apply(this,arguments)})},{key:"next",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isClosed){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:e.prev=2,t=u.fromPixels(this.webcamVideoElement),e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),new Error("Error thrown converting video to pixels: "+JSON.stringify(e.t0));case 9:if(this.resize){e.next=11;break}return e.abrupt("return",{value:t,done:!1});case 11:return e.prev=11,e.abrupt("return",{value:this.cropAndResizeFrame(t),done:!1});case 15:throw e.prev=15,e.t1=e.catch(11),new Error("Error thrown cropping the video: "+e.t1.message);case 18:return e.prev=18,t.dispose(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[2,6],[11,15,18,21]])}))),function(){return a.apply(this,arguments)})},{key:"needToResize",value:function(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)}},{key:"cropAndResizeFrame",value:function(e){var t=this;return fk((function(){var n,r=e.toFloat().expandDims(0);return(n=ZS.cropAndResize(r,t.cropBox,t.cropBoxInd,t.cropSize,"bilinear")).reshape(n.shape.slice(1))}))}},{key:"capture",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:return e.abrupt("return",e.sent.value);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"stop",value:function(){this.stream.getTracks().forEach((function(e){return e.stop()}));try{this.webcamVideoElement.srcObject=null}catch(e){console.log(e),this.webcamVideoElement.src=null}this.isClosed=!0}},{key:"toArray",value:function(){throw new Error("Can not convert infinite video stream to array.")}}],[{key:"create",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:{},!Jd().get("IS_NODE")){e.next=3;break}throw new Error("tf.data.webcam is only supported in browser environment.");case 3:if(t){e.next=7;break}if(t=document.createElement("video"),n.resizeWidth&&n.resizeHeight){e.next=6;break}throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");case 6:t.width=n.resizeWidth,t.height=n.resizeHeight;case 7:return r=new s(t,n),e.next=10,r.start();case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),s}(EO),sM=function e(){_classCallCheck(this,e)},uM=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"split",value:function(e){return new cM(this,e)}}]),n}(EO),cM=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e,t){var a;return _classCallCheck(this,r),(a=n.call(this)).upstream=e,a.impl=new lM(e,t),a}return _createClass(r,[{key:"summary",value:function(){return this.impl.summary()}},{key:"next",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.impl.next());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(uM),lM=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e,t){var a;return _classCallCheck(this,r),(a=n.call(this)).upstream=e,a.separator=t,a.carryover="",a}return _createClass(r,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Split('").concat(this.separator,"')")}},{key:"pump",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",""!==this.carryover&&(this.outputQueue.push(this.carryover),this.carryover="",!0));case 5:(n=t.value.split(this.separator))[0]=this.carryover+n[0],r=_createForOfIteratorHelper(n.slice(0,-1));try{for(r.s();!(a=r.n()).done;)i=a.value,this.outputQueue.push(i)}catch(UY){r.e(UY)}finally{r.f()}return e.abrupt("return",(this.carryover=n[n.length-1],!0));case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(UO),hM=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"decodeUTF8",value:function(){return new pM(this)}}]),n}(EO),pM=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e){var t;return _classCallCheck(this,r),(t=n.call(this)).upstream=e,t.impl=new dM(e),t}return _createClass(r,[{key:"summary",value:function(){return this.impl.summary()}},{key:"next",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.impl.next());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(uM),dM=function(e){_inherits(a,e);var t,r=_createSuper(a);function a(e){var t;if(_classCallCheck(this,a),(t=r.call(this)).upstream=e,Jd().get("IS_BROWSER"))t.decoder=new TextDecoder("utf-8");else{var i=n(5).StringDecoder;t.decoder=new i("utf8")}return _possibleConstructorReturn(t)}return _createClass(a,[{key:"summary",value:function(){return this.upstream.summary()+" -> Utf8"}},{key:"pump",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:return t=e.sent,e.abrupt("return",!t.done&&(n=t.value,r=Jd().get("IS_BROWSER")?this.decoder.decode(n,{stream:!0}):this.decoder.write(Buffer.from(n.buffer)),this.outputQueue.push(r),!0));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(UO),fM=function(e){_inherits(a,e);var t,n=_createSuper(a);function a(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck(this,a),(t=n.call(this)).file=e,t.options=i,r.assert(e instanceof Uint8Array||!!Jd().get("IS_BROWSER")&&(e instanceof File||e instanceof Blob),(function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."})),t.offset=i.offset||0,t.chunkSize=i.chunkSize||1048576,t}return _createClass(a,[{key:"summary",value:function(){return"FileChunks "+this.file}},{key:"next",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size))){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return t=new Promise((function(e,t){var r=n.offset+n.chunkSize;if(n.file instanceof Uint8Array)e(new Uint8Array(n.file.slice(n.offset,r)));else{var a=new FileReader;a.onload=function(n){var r=a.result;if(r instanceof ArrayBuffer&&(r=new Uint8Array(r)),!(r instanceof Uint8Array))return t(new TypeError("FileReader returned unknown type."));e(r)},a.onabort=function(e){return t(new Error("Aborted"))},a.onerror=function(e){return t(new Error(e.type))};var i=n.file.slice(n.offset,r);a.readAsArrayBuffer(i)}n.offset=r})),e.next=5,t;case 5:return e.t0=e.sent,e.t1=!1,e.abrupt("return",{value:e.t0,done:e.t1});case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(hM);function mM(e){return"string"==typeof e&&"file://"===e.substr(0,7)}var vM=function(e){_inherits(a,e);var t,r=_createSuper(a);function a(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck(this,a),(t=r.call(this)).input=e,t.options=n,t}return _createClass(a,[{key:"iterator",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return mM(this.input)&&Jd().get("IS_NODE")&&(t=n(6),this.input=t.readFileSync(this.input.substr(7))),e.abrupt("return",new fM(this.input,this.options));case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(sM),gM=function(e){_inherits(a,e);var t,n=_createSuper(a);function a(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck(this,a),(t=n.call(this)).url=e,t.fileOptions=r,t}return _createClass(a,[{key:"iterator",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",mM(this.url)?new vM(this.url,this.fileOptions).iterator():function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,a,i,o,s,u,c=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:{},"string"==typeof t?a=t:(a=t.url,i={method:(o=t).method,headers:o.headers,body:o.body,mode:o.mode,credentials:o.credentials,cache:o.cache,redirect:o.redirect,referrer:o.referrer,integrity:o.integrity}),e.next=4,r.fetch(a,i);case 4:if(!(s=e.sent).ok){e.next=12;break}return e.t0=Uint8Array,e.next=9,s.arrayBuffer();case 9:return e.t1=e.sent,u=new e.t0(e.t1),e.abrupt("return",new fM(u,n));case 12:throw new Error(s.statusText);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(this.url,this.fileOptions));case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(sM);function yM(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new aM(new gM(e),t)}function bM(e){var t=NO(e);return XO(_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)}))))}function kM(e){return XO(_asyncToGenerator(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:return n=t.sent,t.abrupt("return",NO((function(){return n.next()})));case 4:case"end":return t.stop()}}),t)}))))}function xM(e,t){return wM.apply(this,arguments)}function wM(){return(wM=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",oM.create(t,n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function CM(e){return _M.apply(this,arguments)}function _M(){return(_M=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",iM.create(t));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var SM="2.8.1";function IM(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&r.assert("complex64"!==e.dtype,(function(){return t+" does not support complex64 tensors in the CPU backend."}))}))}var TM=g.whereImpl,NM=function(e){_inherits(i,e);var t,n,a=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=a.call(this)).blockSize=48,e.firstUse=!0,e.data=new rd(_assertThisInitialized(e),hk()),e}return _createClass(i,[{key:"write",value:function(e,t,n){this.firstUse&&(this.firstUse=!1,Jd().get("IS_NODE")&&v.warn("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}},{key:"makeTensorInfo",value:function(e,t,n){var a;if("string"===t&&null!=n&&n.length>0&&r.isString(n[0])){var i=n.map((function(e){return r.encodeString(e)}));a=this.write(i,e,t)}else a=this.write(n,e,t);return{dataId:a,shape:e,dtype:t}}},{key:"incRef",value:function(e){this.data.get(e).refCount++}},{key:"decRef",value:function(e){this.data.has(e)&&this.data.get(e).refCount--}},{key:"move",value:function(e,t,n,r){this.data.set(e,{values:t,dtype:r,refCount:1})}},{key:"numDataIds",value:function(){return this.data.numDataIds()}},{key:"read",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readSync(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"readSync",value:function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensorInfos;if("complex64"===n){var a=this.readSync(r.real.dataId),i=this.readSync(r.imag.dataId);return v.mergeRealAndImagArrays(a,i)}return this.data.get(e).values}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map((function(e){return r.decodeString(e)}))}catch(a){throw new Error("Failed to decode encoded string bytes into utf-8")}return Ky(e.shape,e.dtype,n)}},{key:"makeOutput",value:function(e,t,n){var r=this.write(e,t,n);return hk().makeTensorFromDataId(r,t,n,this)}},{key:"disposeData",value:function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensorInfos;null!=t&&(this.disposeData(t.real.dataId),this.disposeData(t.imag.dataId)),this.data.delete(e)}}},{key:"disposeIntermediateTensorInfo",value:function(e){var t=e.dataId;if(this.data.has(t)){var n=this.data.get(t);n.refCount--,n.refCount<1&&this.disposeData(t)}}},{key:"time",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.now(),e.abrupt("return",(t(),{kernelMs:r.now()-n}));case 2:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"memory",value:function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}},{key:"where",value:function(e){IM([e],"where");var t=this.readSync(e.dataId);return TM(e.shape,t)}},{key:"dispose",value:function(){}},{key:"floatPrecision",value:function(){return 32}},{key:"epsilon",value:function(){return _get(_getPrototypeOf(i.prototype),"epsilon",this).call(this)}}]),i}(ad);function AM(e,t,n){return function(a){var i=a.inputs,o=a.attrs,s=a.backend,u=i.x;if(IM(u,e),"string"===u.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");for(var c=s,l=c.data.get(u.dataId).values,h=r.sizeFromShape(u.shape),p=n||u.dtype,d=r.getArrayFromDType(p,h),f=0;f<h;++f)d[f]=t(l[f],o);return c.makeTensorInfo(u.shape,p,d)}}function EM(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(IM(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");var u=o,c=u.data.get(s.dataId).values,l=n||s.dtype,h=t(c,l,i);return u.makeTensorInfo(s.shape,l,h)}}_k("cpu",(function(){return new NM}),1);var RM=AM(Jf,(function(e){return e>=0?e:Math.exp(e)-1})),FM={kernelName:Jf,backendName:"cpu",kernelFunc:RM};function DM(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var OM={kernelName:mm,backendName:"cpu",kernelFunc:DM};function MM(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.alpha;IM([i],"leakyRelu");for(var s=r.sizeFromShape(i.shape),u=n.data.get(i.dataId).values,c=r.getTypedArrayFromDType("float32",s),l=0;l<u.length;l++)c[l]=u[l]<0?o*u[l]:u[l];return n.makeTensorInfo(i.shape,"float32",c)}var PM={kernelName:xm,backendName:"cpu",kernelFunc:MM};function LM(e){return function(t,n,a,i,o){var s=v.assertAndGetBroadcastShape(t,n),u=s.length,c=r.computeStrides(s),l=r.sizeFromShape(s),h=r.getTypedArrayFromDType(o,l),p=t.length,d=n.length,f=r.computeStrides(t),m=r.computeStrides(n),g=v.getBroadcastDims(t,s),y=v.getBroadcastDims(n,s);if(g.length+y.length===0)for(var b=0;b<h.length;++b)h[b]=e(a[b%a.length],i[b%i.length]);else for(var k=function(t){var n=r.indexToLoc(t,u,c),o=n.slice(-p);g.forEach((function(e){return o[e]=0}));var s=r.locToIndex(o,p,f),l=n.slice(-d);y.forEach((function(e){return l[e]=0}));var v=r.locToIndex(l,d,m);h[t]=e(a[s],i[v])},x=0;x<h.length;++x)k(x);return[h,s]}}var zM=LM((function(e,t){return e<0?t*e:e}));function BM(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha;IM([r,a],"prelu");var i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=_slicedToArray(zM(r.shape,a.shape,i,o,r.dtype),2),u=s[0],c=s[1];return n.makeTensorInfo(c,r.dtype,u)}var VM={kernelName:av,backendName:"cpu",kernelFunc:BM},UM=AM(cv,(function(e){return Math.max(0,e)})),WM={kernelName:cv,backendName:"cpu",kernelFunc:UM},GM=AM(mv,(function(e){return Math.min(Math.max(0,e),6)})),HM={kernelName:mv,backendName:"cpu",kernelFunc:GM};function jM(e,t,n,r,a){if("linear"===n)return DM({inputs:{x:t},backend:e});if("relu"===n)return UM({inputs:{x:t},backend:e});if("elu"===n)return RM({inputs:{x:t},backend:e});if("relu6"===n)return GM({inputs:{x:t},backend:e});if("prelu"===n)return BM({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return MM({inputs:{x:t},backend:e,attrs:{alpha:a}});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function qM(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=n.makeTensorInfo(r.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",i),imag:n.makeTensorInfo(a.shape,"float32",o)},s}var KM={kernelName:Af,backendName:"cpu",kernelFunc:qM};function XM(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n)return qM({inputs:{real:XM(e,t,"float32"),imag:XM(e,t,"float32")},backend:e});var a=r.makeZerosTypedArray(r.sizeFromShape(t),n);return e.makeTensorInfo(t,n,a)}function YM(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.real,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var ZM={kernelName:sv,backendName:"cpu",kernelFunc:YM};function QM(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.dtype;if("complex64"===o){if("complex64"===i.dtype)return DM({inputs:{x:i},backend:n});var s=XM(n,i.shape,i.dtype),u=QM({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),c=qM({inputs:{real:u,imag:s},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),c}if("complex64"===i.dtype){var l=YM({inputs:{input:i},backend:n}),h=QM({inputs:{x:l},backend:n,attrs:{dtype:o}});return n.disposeIntermediateTensorInfo(l),h}if(!r.hasEncodingLoss(i.dtype,o)){var p=DM({inputs:{x:i},backend:n});return{dataId:p.dataId,shape:p.shape,dtype:o}}if("int32"===o){var d=n.data.get(i.dataId).values,f=Int32Array.from(d);return n.makeTensorInfo(i.shape,"int32",f)}if("bool"===o){var m=n.data.get(i.dataId).values,v=r.toTypedArray([0],i.dtype),g=_slicedToArray(LM((function(e,t){return e!==t?1:0}))(i.shape,[],m,v,"bool"),2),y=g[0],b=g[1];return n.makeTensorInfo(b,"bool",y)}throw new Error("Error in Cast: failed to cast ".concat(i.dtype," to ").concat(o))}var JM={kernelName:If,backendName:"cpu",kernelFunc:QM};function $M(e,t,n,r){return null==n?function(n){var a=n.inputs,i=n.backend,o=a.a,s=a.b,u=i;IM([o,s],e);var c=u.data.get(o.dataId).values,l=u.data.get(s.dataId).values,h=r||o.dtype,p=_slicedToArray(t(o.shape,s.shape,c,l,h),2),d=p[0],f=p[1];return u.makeTensorInfo(f,h,d)}:function(e){var a=e.inputs,i=e.backend,o=a.a,s=a.b,u=i;if("complex64"===o.dtype||"complex64"===s.dtype){var c=QM({inputs:{x:o},backend:u,attrs:{dtype:"complex64"}}),l=u.data.get(c.dataId),h=l.complexTensorInfos.imag,p=u.data.get(l.complexTensorInfos.real.dataId).values,d=u.data.get(h.dataId).values,f=QM({inputs:{x:s},backend:u,attrs:{dtype:"complex64"}}),m=u.data.get(f.dataId),v=m.complexTensorInfos.imag,g=u.data.get(m.complexTensorInfos.real.dataId).values,y=u.data.get(v.dataId).values,b=_slicedToArray(n(o.shape,s.shape,p,d,g,y),3),k=b[0],x=b[1],w=b[2],C=u.makeTensorInfo(w,"float32",k),_=u.makeTensorInfo(w,"float32",x),S=qM({inputs:{real:C,imag:_},backend:u});return u.disposeIntermediateTensorInfo(c),u.disposeIntermediateTensorInfo(f),u.disposeIntermediateTensorInfo(C),u.disposeIntermediateTensorInfo(_),S}var I=u.data.get(o.dataId).values,T=u.data.get(s.dataId).values,N=r||o.dtype,A=_slicedToArray(t(o.shape,s.shape,I,T,N),2),E=A[0],R=A[1];return u.makeTensorInfo(R,N,E)}}function eP(e){return function(t,n,a,i,o,s){var u=v.assertAndGetBroadcastShape(t,n),c=r.sizeFromShape(u),l=u.length,h=r.computeStrides(u),p=r.getTypedArrayFromDType("float32",c),d=r.getTypedArrayFromDType("float32",c),f=v.getBroadcastDims(t,u),m=v.getBroadcastDims(n,u),g=v.mergeRealAndImagArrays(a,i),y=v.mergeRealAndImagArrays(o,s),b=t.length,k=r.computeStrides(t),x=n.length,w=r.computeStrides(n);if(f.length+m.length===0)for(var C=0;C<p.length;C++){var _=C%g.length,S=C%y.length,I=e(g[2*_],g[2*_+1],y[2*S],y[2*S+1]);p[C]=I.real,d[C]=I.imag}else for(var T=function(t){var n=r.indexToLoc(t,l,h),a=n.slice(-b);f.forEach((function(e){return a[e]=0}));var i=r.locToIndex(a,b,k),o=n.slice(-x);m.forEach((function(e){return o[e]=0}));var s=r.locToIndex(o,x,w),u=e(g[2*i],g[2*i+1],y[2*s],y[2*s+1]);p[t]=u.real,d[t]=u.imag},N=0;N<p.length;N++)T(N);return[p,d,u]}}var tP=LM((function(e,t){return e+t})),nP=eP((function(e,t,n,r){return{real:e+n,imag:t+r}})),rP=$M(sf,tP,nP),aP={kernelName:sf,backendName:"cpu",kernelFunc:rP};function iP(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.shape,s=r.sizeFromShape(i.shape),u=r.inferFromImplicitShape(o,s),c=r.sizeFromShape(u);r.assert(s===c,(function(){return"The new shape (".concat(u,") has ").concat(c," elements and the old shape (").concat(i.shape,") has ").concat(s," elements. The new shape and old shape must have the same number of elements.")})),n.incRef(i.dataId);var l=n.data.get(i.dataId);if(null!=l.complexTensorInfos){var h=l.complexTensorInfos.imag;l.complexTensorInfos.real.shape=u,h.shape=u}return{dataId:i.dataId,shape:u,dtype:i.dtype}}var oP={kernelName:lv,backendName:"cpu",kernelFunc:iP};function sP(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.a,o=t.b,s=a.transposeA,u=a.transposeB;IM([i,o],"matMul");var c=i.shape.length,l=o.shape.length,h=s?i.shape[c-2]:i.shape[c-1],p=u?o.shape[l-1]:o.shape[l-2],d=s?i.shape[c-1]:i.shape[c-2],f=u?o.shape[l-2]:o.shape[l-1],m=i.shape.slice(0,-2),v=o.shape.slice(0,-2),g=r.sizeFromShape(m),y=r.sizeFromShape(v);r.assert(c>=2&&l>=2&&(g===y||1===g||1===y),(function(){return"Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (".concat(m,") and (").concat(v,").")}));var b=(g>y?i.shape.slice(0,-2):o.shape.slice(0,-2)).concat([d,f]);r.assert(h===p,(function(){return"Error in matMul: inner shapes (".concat(h,") and (").concat(p,") of Tensors with shapes ").concat(i.shape," and ").concat(o.shape," and transposeA=").concat(s," and transposeB=").concat(u," must match.")}));for(var k=u?[y,f,p]:[y,p,f],x=iP({inputs:{x:i},backend:n,attrs:{shape:s?[g,h,d]:[g,d,h]}}),w=iP({inputs:{x:o},backend:n,attrs:{shape:k}}),C=s?x.shape[1]:x.shape[2],_=s?x.shape[2]:x.shape[1],S=u?w.shape[1]:w.shape[2],I=Math.max(g,y),T=n.data.get(x.dataId).values,N=n.data.get(w.dataId).values,A=r.computeStrides(x.shape),E=r.computeStrides(w.shape),R=_slicedToArray(s?[A[0],1,A[1]]:[A[0],A[1],1],3),F=R[0],D=R[1],O=R[2],M=_slicedToArray(u?[1,E[1],E[0]]:[E[1],1,E[0]],3),P=M[0],L=M[1],z=M[2],B=_*S,V=Ky([I,_,S],x.dtype),U=V.values,W=n.blockSize,G=0;G<I;G++)for(var H=0;H<_;H+=W)for(var j=0;j<S;j+=W)for(var q=0;q<C;q+=W)for(var K=Math.min(H+W,_),X=Math.min(j+W,S),Y=Math.min(q+W,C),Z=H;Z<K;Z++)for(var Q=j;Q<X;Q++){for(var J=0,$=q;$<Y;$++){var ee=Math.min(G,g-1)*F,te=Math.min(G,y-1)*z;J+=T[ee+Z*D+$*O]*N[$*P+Q*L+te]}U[G*B+(Z*S+Q)]+=J}return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(w),n.makeTensorInfo(b,V.dtype,V.values)}var uP={kernelName:wf,backendName:"cpu",kernelFunc:sP},cP={kernelName:Zv,backendName:"cpu",kernelFunc:function(e){var t,n,r,a=e.inputs,i=e.backend,o=e.attrs,s=a.a,u=a.b,c=a.bias,l=a.preluActivationWeights,h=o.transposeA,p=o.transposeB,d=o.activation,f=o.leakyreluAlpha,m=[];t=sP({inputs:{a:s,b:u},attrs:{transposeA:h,transposeB:p},backend:i}),c&&(n=rP({inputs:{a:t,b:c},backend:i}),m.push(t),t=n),d&&(r=jM(i,t,d,l,f),m.push(t),t=r);for(var v=0,g=m;v<g.length;v++){var y=g[v];i.disposeIntermediateTensorInfo(y)}return t}};function lP(e){for(var t=new Float32Array(e.length),n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}var hP={kernelName:rf,backendName:"cpu",kernelFunc:function(e){var t=e.inputs.x,n=e.backend;IM(t,"abs");var a=new Float32Array(r.sizeFromShape(t.shape));return a=lP(n.data.get(t.dataId).values),n.makeOutput(a,t.shape,"float32")}},pP=AM(af,(function(e){return Math.acos(e)})),dP={kernelName:af,backendName:"cpu",kernelFunc:pP},fP=AM(of,(function(e){return Math.acosh(e)})),mP={kernelName:of,backendName:"cpu",kernelFunc:fP},vP={kernelName:uf,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t;IM(t,"addN");for(var a=r.map((function(e){return n.data.get(e.dataId).values})),i=Ky(r[0].shape,r[0].dtype),o=i.values,s=0;s<r.length;s++)for(var u=a[s],c=0;c<o.length;c++)o[c]+=u[c];return n.makeTensorInfo(i.shape,i.dtype,i.values)}};function gP(e,t,n,a,i){for(var o=t.length,s=r.sizeFromShape(t),u=r.computeStrides(t),c=r.computeStrides(i),l=r.getTypedArrayFromDType(n,r.sizeFromShape(i)),h=0;h<s;++h){for(var p=r.indexToLoc(h,o,u),d=new Array(p.length),f=0;f<d.length;f++)d[f]=p[a[f]];l[r.locToIndex(d,o,c)]=e[h]}return l}function yP(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.perm;IM(a,"transpose");for(var o=new Array(a.shape.length),s=0;s<o.length;s++)o[s]=a.shape[i[s]];var u=gP(r.data.get(a.dataId).values,a.shape,a.dtype,i,o);return{dataId:r.write(u,o,a.dtype),shape:o,dtype:a.dtype}}var bP={kernelName:Wv,backendName:"cpu",kernelFunc:yP},kP={kernelName:cf,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.axis,s=a.keepDims;IM(i,"all");var u=r.parseAxisParam(o,i.shape),c=u,l=v.getAxesPermutation(c,i.shape.length),h=i;null!=l&&(h=yP({inputs:{x:i},backend:n,attrs:{perm:l}}),c=v.getInnerMostAxes(c.length,i.shape.length)),v.assertAxesAreInnerMostDims("all",c,h.shape.length);for(var p=_slicedToArray(v.computeOutAndReduceShapes(h.shape,c),2),d=p[0],f=p[1],m=r.sizeFromShape(f),g=r.makeZerosTypedArray(r.sizeFromShape(d),h.dtype),y=n.data.get(h.dataId).values,b=0;b<g.length;++b){for(var k=b*m,x=y[k],w=0;w<m;++w){var C=y[k+w];x=x&&C}g[b]=x}null!=l&&n.disposeIntermediateTensorInfo(h);var _=n.makeTensorInfo(d,h.dtype,g);if(s){var S=iP({inputs:{x:_},backend:n,attrs:{shape:v.expandShapeToKeepDim(d,u)}});return n.disposeIntermediateTensorInfo(_),S}return _}},xP={kernelName:lf,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.axis,s=a.keepDims;IM(i,"any");var u=r.parseAxisParam(o,i.shape),c=u,l=v.getAxesPermutation(c,i.shape.length),h=i;null!=l&&(h=yP({inputs:{x:i},backend:n,attrs:{perm:l}}),c=v.getInnerMostAxes(c.length,i.shape.length)),v.assertAxesAreInnerMostDims("any",c,h.shape.length);for(var p=_slicedToArray(v.computeOutAndReduceShapes(h.shape,c),2),d=p[0],f=p[1],m=r.sizeFromShape(f),g=r.makeZerosTypedArray(r.sizeFromShape(d),h.dtype),y=n.data.get(h.dataId).values,b=0;b<g.length;++b){for(var k=b*m,x=y[k],w=0;w<m;++w){var C=y[k+w];x=x||C}g[b]=x}null!=l&&n.disposeIntermediateTensorInfo(h);var _=n.makeTensorInfo(d,h.dtype,g);if(s){var S=iP({inputs:{x:_},backend:n,attrs:{shape:v.expandShapeToKeepDim(d,u)}});return n.disposeIntermediateTensorInfo(_),S}return _}},wP={kernelName:hf,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.axis;IM(i,"argMax");var s=r.parseAxisParam(o,i.shape),u=v.getAxesPermutation(s,i.shape.length),c=i,l=[];null!=u&&(c=yP({inputs:{x:i},backend:n,attrs:{perm:u}}),l.push(c),s=v.getInnerMostAxes(s.length,c.shape.length)),s=[s[0]],v.assertAxesAreInnerMostDims("argMax",s,c.shape.length);for(var h=_slicedToArray(v.computeOutAndReduceShapes(c.shape,s),2),p=h[0],d=h[1],f=r.sizeFromShape(p),m=r.makeZerosTypedArray(f,"int32"),g=r.sizeFromShape(d),y=n.data.get(c.dataId).values,b=0;b<m.length;++b){for(var k=b*g,x=y[k],w=0,C=0;C<g;++C){var _=y[k+C];_>x&&(x=_,w=C)}m[b]=w}return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(p,"int32",m)}},CP={kernelName:pf,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.axis;IM(i,"argMin");var s=r.parseAxisParam(o,i.shape),u=v.getAxesPermutation(s,i.shape.length),c=i,l=[];null!=u&&(c=yP({inputs:{x:i},backend:n,attrs:{perm:u}}),l.push(c),s=v.getInnerMostAxes(s.length,c.shape.length)),s=[s[0]],v.assertAxesAreInnerMostDims("argMin",s,c.shape.length);for(var h=_slicedToArray(v.computeOutAndReduceShapes(c.shape,s),2),p=h[0],d=h[1],f=r.sizeFromShape(p),m=r.makeZerosTypedArray(f,"int32"),g=r.sizeFromShape(d),y=n.data.get(c.dataId).values,b=0;b<m.length;++b){for(var k=b*g,x=y[k],w=0,C=0;C<g;++C){var _=y[k+C];_<x&&(x=_,w=C)}m[b]=w}return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(p,"int32",m)}},_P=AM(df,(function(e){return Math.asin(e)})),SP={kernelName:df,backendName:"cpu",kernelFunc:_P},IP=AM(ff,(function(e){return Math.asinh(e)})),TP={kernelName:ff,backendName:"cpu",kernelFunc:IP},NP=AM(mf,(function(e){return Math.atan(e)})),AP={kernelName:mf,backendName:"cpu",kernelFunc:NP},EP=LM((function(e,t){return Math.atan2(e,t)})),RP=$M(gf,EP),FP={kernelName:gf,backendName:"cpu",kernelFunc:RP},DP=AM(vf,(function(e){return Math.atanh(e)})),OP={kernelName:vf,backendName:"cpu",kernelFunc:DP};function MP(e,t,n,r,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,c=a.dilationWidth,l=a.effectiveFilterHeight,h=a.effectiveFilterWidth,p=a.padInfo.top,d=a.padInfo.left,f="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=Ky(a.outShape,n),v=m.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],b=a.outShape[3],k=0;k<a.batchSize;++k)for(var x=k*g,w=k*r[0],C=0;C<a.inChannels;++C)for(var _=0;_<a.outHeight;++_)for(var S=_*o-p,I=Math.max(0,S),T=Math.min(a.inHeight,l+S),N=x+_*y,A=0;A<a.outWidth;++A){for(var E=A*s-d,R=Math.max(0,E),F=Math.min(a.inWidth,h+E),D=f,O=0,M=0,P=I;P<T;P+=u){for(var L=w+P*r[1],z=R;z<F;z+=c){var B=e[L+z*r[2]+C];"max"===i&&B>D?D=B:"avg"===i&&(O+=B,M++)}if(isNaN(D))break}v[N+A*b+C]="avg"===i?O/M:D}return m}function PP(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=Ky(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,h=r.effectiveFilterHeight,p=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,m=Ky(t,n,e),v=0;v<r.batchSize;++v)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.outHeight;++y){for(var b=y*s-d,k=b;k<0;)k+=c;for(var x=Math.min(r.inHeight,h+b),w=0;w<r.outWidth;++w){for(var C=w*u-f,_=C;_<0;)_+=l;for(var S=Math.min(r.inWidth,p+C),I=Number.NEGATIVE_INFINITY,T=-1,N=k;N<x;N+=c)for(var A=N-b,E=_;E<S;E+=l){var R=E-C,F=m.get(v,N,E,g);F>I&&(I=F,T=a?i?((v*r.inHeight+N)*r.inWidth+E)*r.inChannels+g:(N*r.inWidth+E)*r.inChannels+g:A*p+R)}o.set(T,v,y,w,g)}}return o}function LP(e,t,n,r,a,i){for(var o=a.strideDepth,s=a.strideHeight,u=a.strideWidth,c=a.dilationDepth,l=a.dilationHeight,h=a.dilationWidth,p=a.effectiveFilterDepth,d=a.effectiveFilterHeight,f=a.effectiveFilterWidth,m=a.padInfo.front,v=a.padInfo.top,g=a.padInfo.left,y="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=Ky(a.outShape,n),k=b.values,x=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],w=a.outShape[2]*a.outShape[3]*a.outShape[4],C=a.outShape[3]*a.outShape[4],_=a.outShape[4],S=0;S<a.batchSize;++S)for(var I=S*x,T=S*r[0],N=0;N<a.inChannels;++N)for(var A=0;A<a.outDepth;++A){for(var E=A*o-m,R=E;R<0;)R+=c;for(var F=Math.min(a.inDepth,p+E),D=I+A*w,O=0;O<a.outHeight;++O){for(var M=O*s-v,P=M;P<0;)P+=l;for(var L=Math.min(a.inHeight,d+M),z=D+O*C,B=0;B<a.outWidth;++B){for(var V=B*u-g,U=V;U<0;)U+=h;for(var W=Math.min(a.inWidth,f+V),G=z+B*_,H=y,j=0,q=0,K=R;K<F;K+=c){for(var X=T+K*r[1],Y=P;Y<L;Y+=l){for(var Z=X+Y*r[2],Q=U;Q<W;Q+=h){var J=e[Z+Q*r[3]+N];if("max"===i&&J>H?H=J:"avg"===i&&(j+=J,q++),isNaN(H))break}if(isNaN(H))break}if(isNaN(H))break}k[G+N]="avg"===i?j/q:H}}}return b}var zP={kernelName:yf,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x;IM(i,"avgPool");var o=a.filterSize,s=a.strides,u=a.pad,c=a.dimRoundingMode;r.assert(v.eitherStridesOrDilationsAreOne(s,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '1'")}));var l,h=v.computePool2DInfo(i.shape,o,s,1,u,c);if(1===h.filterWidth&&1===h.filterHeight&&r.arraysEqual(h.inShape,h.outShape))l=DM({inputs:{x:i},backend:n});else{var p=n.data.get(i.dataId).values,d=r.computeStrides(i.shape),f=MP(p,0,i.dtype,d,h,"avg");l=n.makeTensorInfo(h.outShape,i.dtype,f.values)}return l}},BP={kernelName:kf,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.filterSize,s=a.strides,u=a.pad,c=a.dimRoundingMode,l=a.dataFormat,h=a.dilations;IM(i,"avgPool3d");var p=h;null==p&&(p=[1,1,1]);var d=v.computePool3DInfo(i.shape,o,s,p,u,c,l),f=LP(n.data.get(i.dataId).values,0,i.dtype,r.computeStrides(i.shape),d,"avg");return n.makeTensorInfo(f.shape,"float32",f.values)}},VP={kernelName:xf,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dilations,l=r.dimRoundingMode;IM([a,i],"avgPool3DGrad");for(var h=v.computePool3DInfo(i.shape,o,s,c,u,l),p=h.strideDepth,d=h.strideHeight,f=h.strideWidth,m=h.filterDepth,g=h.filterHeight,y=h.filterWidth,b=h.dilationDepth,k=h.dilationHeight,x=h.dilationWidth,w=h.effectiveFilterDepth,C=h.effectiveFilterHeight,_=h.effectiveFilterWidth,S=w-1-h.padInfo.front,I=_-1-h.padInfo.left,T=C-1-h.padInfo.top,N=Ky(i.shape,"float32"),A=1/(m*g*y),E=n.bufferSync(a),R=0;R<h.batchSize;++R)for(var F=0;F<h.inChannels;++F)for(var D=0;D<h.inDepth;++D)for(var O=0;O<h.inHeight;++O)for(var M=0;M<h.inWidth;++M){for(var P=D-S,L=O-T,z=M-I,B=0,V=0;V<w;V+=b){var U=(P+V)/p;if(!(U<0||U>=h.outDepth||Math.floor(U)!==U))for(var W=0;W<C;W+=k){var G=(L+W)/d;if(!(G<0||G>=h.outHeight||Math.floor(G)!==G))for(var H=0;H<_;H+=x){var j=(z+H)/f;j<0||j>=h.outWidth||Math.floor(j)!==j||(B+=E.get(R,U,G,j,F))}}}N.set(B*A,R,D,O,M,F)}return n.makeTensorInfo(N.shape,N.dtype,N.values)}},UP={kernelName:bf,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;IM([a,i],"avgPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=v.computePool2DInfo(o.shape,s,u,1,c),h=l.strideHeight,p=l.strideWidth,d=l.filterHeight,f=l.filterWidth,m=l.dilationHeight,g=l.dilationWidth,y=l.effectiveFilterHeight,b=l.effectiveFilterWidth,k=b-1-l.padInfo.left,x=y-1-l.padInfo.top,w=Ky(o.shape,"float32"),C=1/(d*f),_=n.data.get(a.dataId).values,S=Ky(a.shape,"float32",_),I=0;I<l.batchSize;++I)for(var T=0;T<l.inChannels;++T)for(var N=0;N<l.inHeight;++N)for(var A=0;A<l.inWidth;++A){for(var E=N-x,R=A-k,F=0,D=0;D<y;D+=m){var O=(E+D)/h;if(!(O<0||O>=l.outHeight||Math.floor(O)!==O))for(var M=0;M<b;M+=g){var P=(R+M)/p;P<0||P>=l.outWidth||Math.floor(P)!==P||(F+=S.get(I,O,P,T))}}w.set(F*C,I,N,A,T)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}},WP={kernelName:lm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.scale,s=t.offset,u=t.mean,c=t.variance;r.assert(u.shape.length===c.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),r.assert(null==s||u.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),r.assert(null==o||u.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),IM([i,u,c,o,s],"batchNorm");var l=a.varianceEpsilon;null==l&&(l=.001);for(var h=n.data.get(i.dataId).values,p=n.data.get(u.dataId).values,d=n.data.get(c.dataId).values,f=o?n.data.get(o.dataId).values:new Float32Array([1]),m=s?n.data.get(s.dataId).values:new Float32Array([0]),v=new Float32Array(h.length),g=m.length,y=f.length,b=d.length,k=p.length,x=0,w=0,C=0,_=0,S=0;S<h.length;++S)v[S]=m[x++]+(h[S]-p[w++])*f[C++]/Math.sqrt(d[_++]+l),x>=g&&(x=0),w>=k&&(w=0),C>=y&&(C=0),_>=b&&(_=0);return n.makeTensorInfo(i.shape,i.dtype,v)}};function GP(e,t,n,a,i){var o=h.isSliceContinous(a,t,n),s=r.sizeFromShape(n),u=r.computeStrides(a);if(o){var c=h.computeFlatOffset(t,u);return"string"===i?e.slice(c,c+s):e.subarray(c,c+s)}for(var l=Ky(a,i,"string"===i?v.fromUint8ToStringArray(e):e),p=Ky(n,i),d=0;d<p.size;++d){var f=p.indexToLoc(d),m=f.map((function(e,n){return e+t[n]}));p.set.apply(p,[l.get.apply(l,_toConsumableArray(m))].concat(_toConsumableArray(f)))}return"string"===i?v.fromStringArrayToUint8(p.values):p.values}function HP(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.size;IM(a,"slice");var s=_slicedToArray(h.parseSliceParams(a,i,o),2),u=s[0],c=s[1];h.assertParamsValid(a,u,c);var l=GP(n.data.get(a.dataId).values,u,c,a.shape,a.dtype);return n.makeTensorInfo(c,a.dtype,l)}var jP={kernelName:wv,backendName:"cpu",kernelFunc:HP},qP={kernelName:Cf,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;IM([a],"batchToSpaceND");var s=i.reduce((function(e,t){return e*t})),u=v.getReshaped(a.shape,i,s),c=v.getPermuted(u.length,i.length),l=v.getReshapedPermuted(a.shape,i,s),h=v.getSliceBeginCoords(o,i.length),p=v.getSliceSize(l,o,i.length),d=iP({inputs:{x:a},backend:n,attrs:{shape:u}}),f=yP({inputs:{x:d},backend:n,attrs:{perm:c}}),m=iP({inputs:{x:f},backend:n,attrs:{shape:l}}),g=HP({inputs:{x:m},backend:n,attrs:{begin:h,size:p}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}};function KP(e,t,n,a,i){for(var o=r.sizeFromShape(a),s=r.makeZerosTypedArray(i,n),u=0;u<e.length;u++){var c=e[u];if(c<0)throw new Error("Input x must be non-negative!");c>=i||(s[c]+=o>0?t[u]:1)}return s}function XP(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.shape[0],i=e.shape[1],o=Ky([a,n],t.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=e.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=n||o.set(r?1:t.size>0?o.get(s,c)+t.get(s,u):o.get(s,c)+1,s,c)}return o}var YP={kernelName:_f,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=KP(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,s)}};function ZP(e){return function(t,n,a){for(var i=r.getTypedArrayFromDType(n,t.length),o=0;o<t.length;++o)i[o]=e(t[o],a);return i}}var QP=ZP((function(e){return Math.ceil(e)})),JP=EM(Tf,QP),$P={kernelName:Tf,backendName:"cpu",kernelFunc:JP},eL=AM(Nf,(function(e,t){return e>t.clipValueMax?t.clipValueMax:e<t.clipValueMin?t.clipValueMin:e})),tL={kernelName:Nf,backendName:"cpu",kernelFunc:eL},nL={kernelName:Ef,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs.x,n=e.backend,a=new Float32Array(r.sizeFromShape(t.shape)),i=n.data.get(t.dataId),o=i.complexTensorInfos.imag,s=n.data.get(i.complexTensorInfos.real.dataId).values,u=n.data.get(o.dataId).values,c=0;c<s.length;c++)a[c]=Math.hypot(s[c],u[c]);return n.makeOutput(a,t.shape,"float32")}};function rL(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.imag,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var aL={kernelName:gm,backendName:"cpu",kernelFunc:rL};function iL(e){var t=e.inputs,n=e.backend,a=e.attrs.axis,i=r.parseAxisParam(a,t[0].shape)[0],o=v.computeOutShape(t.map((function(e){return e.shape})),i);if(0===r.sizeFromShape(o))return n.makeTensorInfo(o,t[0].dtype,[]);var s=t.filter((function(e){return r.sizeFromShape(e.shape)>0}));if(1===s.length)return DM({inputs:{x:s[0]},backend:n});var u=s.map((function(e){return e.shape}));if(v.assertParamsConsistent(u,i),"complex64"===s[0].dtype){var c=s.map((function(e){return YM({inputs:{input:e},backend:n})})),l=s.map((function(e){return rL({inputs:{input:e},backend:n})})),h=iL({inputs:c,backend:n,attrs:{axis:i}}),p=iL({inputs:l,backend:n,attrs:{axis:i}}),d=qM({inputs:{real:h,imag:p},backend:n});return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),d}var f=s.map((function(e){var t=r.sizeFromShape(e.shape.slice(i));return iP({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})}));o=v.computeOutShape(f.map((function(e){return e.shape})),1);var m=r.getTypedArrayFromDType(s[0].dtype,r.sizeFromShape(o));if(1===f[0].shape[0]){var g=0;f.forEach((function(e){var t=n.data.get(e.dataId).values,a=r.sizeFromShape(e.shape);m.set(t,g),g+=a}))}else{var y=0;f.forEach((function(e){for(var t=n.data.get(e.dataId).values,r=0,a=0;a<e.shape[0];++a)for(var i=a*o[1]+y,s=0;s<e.shape[1];++s)m[i+s]=t[r++];y+=e.shape[1]}))}var b=v.computeOutShape(s.map((function(e){return e.shape})),i),k=n.makeTensorInfo(b,t[0].dtype,m);return f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),k}var oL={kernelName:Rf,backendName:"cpu",kernelFunc:iL};function sL(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.filter,s=a.strides,u=a.pad,c=a.dataFormat,l=a.dilations,h=a.dimRoundingMode;IM([i,o],"conv2d");for(var p=v.convertConv2DDataFormat(c),d=v.computeConv2DInfo(i.shape,o.shape,s,l,u,h,!1,p),f=d.filterHeight,m=d.filterWidth,g=d.dilationHeight,y=d.dilationWidth,b=d.padInfo.left,k=d.padInfo.top,x="channelsLast"===d.dataFormat,w=new xg(d.outShape,i.dtype),C=r.computeStrides(i.shape),_=r.computeStrides(o.shape),S=C[0],I=x?C[1]:C[2],T=x?C[2]:1,N=x?1:C[1],A=w.strides[0],E=x?w.strides[1]:w.strides[2],R=x?w.strides[2]:1,F=x?1:w.strides[1],D=n.data.get(i.dataId).values,O=n.data.get(o.dataId).values,M=w.values,P=0;P<d.batchSize;++P)for(var L=P*S,z=P*A,B=0;B<d.outHeight;++B)for(var V=z+B*E,U=B*d.strideHeight-k,W=0;W<f;++W){var G=U+W*g;if(!(G<0||G>=d.inHeight))for(var H=W*_[0],j=L+G*I,q=0;q<d.outWidth;++q)for(var K=V+q*R,X=q*d.strideWidth-b,Y=0;Y<m;++Y){var Z=X+Y*y;if(!(Z<0||Z>=d.inWidth))for(var Q=j+Z*T,J=H+Y*_[1],$=0;$<d.inChannels;++$){for(var ee=D[Q+$*N],te=0;te<d.outChannels;++te)M[K+te*F]+=ee*O[J+te];J+=d.outChannels}}}return n.makeTensorInfo(w.shape,w.dtype,M)}var uL={kernelName:Ff,backendName:"cpu",kernelFunc:sL},cL={kernelName:Df,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape;IM([a,i],"conv2dBackpropFilter");for(var h=v.convertConv2DDataFormat(u),p=v.computeConv2DInfo(a.shape,l,o,1,s,c,!1,h),d=p.strideHeight,f=p.strideWidth,m=p.filterHeight,g=p.filterWidth,y="channelsLast"===p.dataFormat,b=new xg(p.filterShape,"float32"),k=p.padInfo.left,x=p.padInfo.top,w=n.data.get(a.dataId).values,C=n.data.get(i.dataId).values,_=new xg(a.shape,a.dtype,w),S=new xg(i.shape,i.dtype,C),I=0;I<m;++I)for(var T=Math.max(0,Math.ceil((x-I)/d)),N=Math.min(p.outHeight,(p.inHeight+x-I)/d),A=0;A<g;++A)for(var E=Math.max(0,Math.ceil((k-A)/f)),R=Math.min(p.outWidth,(p.inWidth+k-A)/f),F=0;F<p.inChannels;++F)for(var D=0;D<p.outChannels;++D){for(var O=0,M=0;M<p.batchSize;++M)for(var P=T;P<N;++P)for(var L=I+P*d-x,z=E;z<R;++z){var B=A+z*f-k;O+=y?_.get(M,L,B,F)*S.get(M,P,z,D):_.get(M,F,L,B)*S.get(M,D,P,z)}b.set(O,I,A,F,D)}return n.makeTensorInfo(b.shape,b.dtype,b.values)}},lL={kernelName:Of,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.dy,o=t.filter,s=a.inputShape,u=a.strides,c=a.pad,l=a.dataFormat,h=a.dimRoundingMode;IM([i,o],"conv2dBackpropInput");var p=r.computeStrides(o.shape),d=r.computeStrides(i.shape),f=v.convertConv2DDataFormat(l),m=v.computeConv2DInfo(s,o.shape,u,1,c,h,!1,f),g=new xg(m.inShape,"float32"),y=g.values,b=n.data.get(i.dataId).values,k=n.data.get(o.dataId).values,x=_slicedToArray(p,3),w=x[0],C=x[1],_=x[2],S=m.batchSize,I=m.filterHeight,T=m.filterWidth,N=m.inChannels,A=m.inHeight,E=m.inWidth,R=m.outChannels,F=m.outHeight,D=m.outWidth,O=m.strideHeight,M=m.strideWidth;f=m.dataFormat;for(var P=I-1-m.padInfo.top,L=T-1-m.padInfo.left,z="channelsLast"===f,B=g.strides[0],V=z?g.strides[1]:g.strides[2],U=z?g.strides[2]:1,W=z?1:g.strides[1],G=d[0],H=z?d[1]:d[2],j=z?d[2]:1,q=z?1:d[1],K=0;K<S;++K)for(var X=0;X<N;++X)for(var Y=0;Y<A;++Y)for(var Z=Y-P,Q=Math.max(0,Math.ceil(Z/O)),J=Math.min(F,(I+Z)/O),$=0;$<E;++$){for(var ee=$-L,te=Math.max(0,Math.ceil(ee/M)),ne=Math.min(D,(T+ee)/M),re=0,ae=Q;ae<J;++ae)for(var ie=ae*O-Z,oe=te;oe<ne;++oe)for(var se=G*K+H*ae+j*oe,ue=w*(I-1-ie)+C*(T-1-(oe*M-ee))+_*X,ce=0;ce<R;++ce)re+=b[se+q*ce]*k[ue+ce];y[B*K+V*Y+U*$+W*X]=re}return n.makeTensorInfo(g.shape,g.dtype,g.values)}},hL={kernelName:Mf,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.filter,s=a.strides,u=a.pad,c=a.dilations;IM([i,o],"conv3d");for(var l=v.computeConv3DInfo(i.shape,o.shape,s,c,u),h=l.filterDepth,p=l.filterHeight,d=l.filterWidth,f=l.dilationDepth,m=l.dilationHeight,g=l.dilationWidth,y=l.padInfo,b=y.front,k=y.left,x=y.top,w=new xg(l.outShape,i.dtype),C=n.data.get(i.dataId).values,_=n.data.get(o.dataId).values,S=w.values,I=r.computeStrides(i.shape),T=r.computeStrides(o.shape),N=0;N<l.batchSize;++N)for(var A=N*I[0],E=N*w.strides[0],R=0;R<l.outDepth;++R)for(var F=E+R*w.strides[1],D=R*l.strideDepth-b,O=0;O<h;++O){var M=D+O*f;if(!(M<0||M>=l.inDepth))for(var P=O*T[0],L=A+M*I[1],z=0;z<l.outHeight;++z)for(var B=F+z*w.strides[2],V=z*l.strideHeight-x,U=0;U<p;++U){var W=V+U*m;if(!(W<0||W>=l.inHeight))for(var G=P+U*T[1],H=L+W*I[2],j=0;j<l.outWidth;++j)for(var q=B+j*l.outChannels,K=j*l.strideWidth-k,X=0;X<d;++X){var Y=K+X*g;if(!(Y<0||Y>=l.inWidth))for(var Z=H+Y*l.inChannels,Q=G+X*T[2],J=0;J<l.inChannels;++J){for(var $=C[Z+J],ee=0;ee<l.outChannels;++ee)S[q+ee]+=$*_[Q+ee];Q+=l.outChannels}}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}},pL={kernelName:Pf,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.dy,s=a.strides,u=a.pad,c=a.filterShape;IM([i,o],"conv3dBackpropFilterV2");for(var l=r.computeStrides(i.shape),h=r.computeStrides(o.shape),p=v.computeConv3DInfo(i.shape,c,s,1,u),d=p.strideDepth,f=p.strideHeight,m=p.strideWidth,g=p.filterDepth,y=p.filterHeight,b=p.filterWidth,k=new xg(p.filterShape,"float32"),x=k.values,w=_slicedToArray(k.strides,4),C=w[0],_=w[1],S=w[2],I=w[3],T=n.data.get(o.dataId).values,N=_slicedToArray(h,4),A=N[0],E=N[1],R=N[2],F=N[3],D=n.data.get(i.dataId).values,O=_slicedToArray(l,4),M=O[0],P=O[1],L=O[2],z=O[3],B=p.padInfo.front,V=p.padInfo.left,U=p.padInfo.top,W=0;W<g;++W)for(var G=Math.max(0,Math.ceil((B-W)/d)),H=Math.min(p.outDepth,(p.inDepth+B-W)/d),j=W*C,q=0;q<y;++q)for(var K=Math.max(0,Math.ceil((U-q)/f)),X=Math.min(p.outHeight,(p.inHeight+U-q)/f),Y=q*_+j,Z=0;Z<b;++Z)for(var Q=Math.max(0,Math.ceil((V-Z)/m)),J=Math.min(p.outWidth,(p.inWidth+V-Z)/m),$=Z*S+Y,ee=0;ee<p.inChannels;++ee)for(var te=ee*I+$,ne=0;ne<p.outChannels;++ne){for(var re=0,ae=0;ae<p.batchSize;++ae)for(var ie=ae*M,oe=ae*A,se=G;se<H;++se)for(var ue=(W+se*d-B)*P+ie,ce=se*E+oe,le=K;le<X;++le)for(var he=(q+le*f-U)*L+ue,pe=le*R+ce,de=Q;de<J;++de)re+=D[(Z+de*m-V)*z+he+ee]*T[de*F+pe+ne];x[te+ne]=re}return n.makeTensorInfo(k.shape,k.dtype,k.values)}},dL={kernelName:Lf,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.dy,o=t.filter,s=a.pad,u=a.strides,c=a.inputShape;IM([i],"conv3dBackpropInputV2");for(var l=r.computeStrides(i.shape),h=r.computeStrides(o.shape),p=v.computeConv3DInfo(c,o.shape,u,1,s),d=new xg(p.inShape,"float32"),f=d.values,m=_slicedToArray(d.strides,4),g=m[0],y=m[1],b=m[2],k=m[3],x=n.data.get(i.dataId).values,w=_slicedToArray(l,4),C=w[0],_=w[1],S=w[2],I=w[3],T=n.data.get(o.dataId).values,N=_slicedToArray(h,4),A=N[0],E=N[1],R=N[2],F=N[3],D=p.batchSize,O=p.filterDepth,M=p.filterHeight,P=p.filterWidth,L=p.inChannels,z=p.inDepth,B=p.inHeight,V=p.inWidth,U=p.outChannels,W=p.outDepth,G=p.outHeight,H=p.outWidth,j=p.strideDepth,q=p.strideHeight,K=p.strideWidth,X=O-1-p.padInfo.front,Y=M-1-p.padInfo.top,Z=P-1-p.padInfo.left,Q=0;Q<D;++Q)for(var J=0;J<L;++J)for(var $=0;$<z;++$)for(var ee=$-X,te=Math.max(0,Math.ceil(ee/j)),ne=Math.min(W,(O+ee)/j),re=0;re<B;++re)for(var ae=re-Y,ie=Math.max(0,Math.ceil(ae/q)),oe=Math.min(G,(M+ae)/q),se=0;se<V;++se){for(var ue=se-Z,ce=Math.max(0,Math.ceil(ue/K)),le=Math.min(H,(P+ue)/K),he=0,pe=te;pe<ne;++pe)for(var de=pe*j-ee,fe=ie;fe<oe;++fe)for(var me=fe*q-ae,ve=ce;ve<le;++ve)for(var ge=C*Q+_*pe+S*fe+I*ve,ye=A*(O-1-de)+E*(M-1-me)+R*(P-1-(ve*K-ue))+F*J,be=0;be<U;++be)he+=x[ge+be]*T[ye+be];f[g*Q+y*$+b*re+k*se+J]=he}return n.makeTensorInfo(d.shape,d.dtype,d.values)}},fL=AM(zf,(function(e){return Math.cos(e)})),mL={kernelName:zf,backendName:"cpu",kernelFunc:fL},vL=AM(Bf,(function(e){return Math.cosh(e)})),gL={kernelName:Bf,backendName:"cpu",kernelFunc:vL},yL={kernelName:Uf,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,a=e.attrs,i=t.image,o=t.boxes,s=t.boxInd,u=a.cropSize,c=a.method,l=a.extrapolationValue,h=_slicedToArray(i.shape,4),p=h[0],d=h[1],f=h[2],m=h[3],v=o.shape[0],g=_slicedToArray(u,2),y=g[0],b=g[1],k=Ky([v,y,b,m],"float32"),x=n.data.get(o.dataId).values,w=n.data.get(s.dataId).values,C=n.data.get(i.dataId).values,_=r.computeStrides(i.shape),S=r.computeStrides(k.shape),I=0;I<v;I++){var T=4*I,N=x[T],A=x[T+1],E=x[T+2],R=x[T+3],F=w[I];if(!(F>=p))for(var D=y>1?(E-N)*(d-1)/(y-1):0,O=b>1?(R-A)*(f-1)/(b-1):0,M=0;M<y;M++){var P=y>1?N*(d-1)+M*D:.5*(N+E)*(d-1);if(P<0||P>d-1)for(var L=0;L<b;L++)for(var z=0;z<m;z++)k.values[z+L*S[2]+M*S[1]+I*S[0]]=l;else if("bilinear"===c)for(var B=Math.floor(P),V=Math.ceil(P),U=P-B,W=0;W<b;W++){var G=b>1?A*(f-1)+W*O:.5*(A+R)*(f-1);if(G<0||G>f-1)for(var H=0;H<m;H++)k.values[H+W*S[2]+M*S[1]+I*S[0]]=l;else for(var j=Math.floor(G),q=Math.ceil(G),K=G-j,X=0;X<m;X++){var Y=X+j*_[2]+B*_[1]+F*_[0],Z=C[Y],Q=C[Y=X+q*_[2]+B*_[1]+F*_[0]],J=C[Y=X+j*_[2]+V*_[1]+F*_[0]],$=C[Y=X+q*_[2]+V*_[1]+F*_[0]],ee=Z+(Q-Z)*K;Y=X+W*S[2]+M*S[1]+I*S[0],k.values[Y]=ee+(J+($-J)*K-ee)*U}}else for(var te=0;te<b;++te){var ne=b>1?A*(f-1)+te*O:.5*(A+R)*(f-1);if(ne<0||ne>f-1)for(var re=0;re<m;re++)k.values[re+te*S[2]+M*S[1]+I*S[0]]=l;else for(var ae=Math.round(ne),ie=Math.round(P),oe=0;oe<m;oe++)k.values[oe+te*S[2]+M*S[1]+I*S[0]]=C[oe+ae*_[2]+ie*_[1]+F*_[0]]}}}return n.makeTensorInfo(k.shape,k.dtype,k.values)}},bL={kernelName:Vf,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.axis,s=a.exclusive,u=a.reverse;IM(i,"cumsum");var c=v.getAxesPermutation([o],i.shape.length),l=i;null!=c&&(l=yP({inputs:{x:i},backend:n,attrs:{perm:c}}));var h=v.getInnerMostAxes(1,i.shape.length)[0];if(h!==l.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most axis=".concat(l.shape.length-1," but got axis=").concat(h));for(var p=Fg(l.dtype,"int32"),d=r.makeZerosTypedArray(r.sizeFromShape(l.shape),p),f=n.data.get(l.dataId).values,m=l.shape[l.shape.length-1],g=u?function(e,t){return e+m-t-1}:function(e,t){return e+t},y=0;y<f.length;y+=m)for(var b=0;b<m;b++){var k=g(y,b);if(0===b)d[k]=s?0:f[k];else{var x=g(y,b-1);d[k]=s?f[x]+d[x]:f[k]+d[x]}}var w=n.makeTensorInfo(l.shape,p,d);if(null!=c){var C=yP({inputs:{x:w},backend:n,attrs:{perm:v.getUndoAxesPermutation(c)}});return n.disposeIntermediateTensorInfo(w),n.disposeIntermediateTensorInfo(l),C}return w}},kL={kernelName:Wf,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=KP(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}if(2===a.shape.length){var c=XP(n.bufferSync(a),n.bufferSync(i),o,s);return n.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+a.shape.length+".")}},xL={kernelName:Gf,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.blockSize,s=a.dataFormat;r.assert("NHWC"===s,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+s})),r.assert(o>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+o}));for(var u=i.shape[0],c=i.shape[1],l=i.shape[2],h=i.shape[3],p=c*o,d=l*o,f=h/(o*o),m=n.data.get(i.dataId).values,v=new Float32Array(u*p*d*f),g=0,y=0;y<u;++y)for(var b=0;b<p;++b)for(var k=Math.floor(b/o),x=b%o,w=0;w<d;++w)for(var C=Math.floor(w/o),_=(x*o+w%o)*f,S=0;S<f;++S)v[g++]=m[S+_+h*(C+l*(k+c*y))];return n.makeTensorInfo([u,p,d,f],i.dtype,v)}};function wL(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.filter,s=a.strides,u=a.pad,c=a.dilations,l=a.dimRoundingMode;IM([i,o],"depthwiseConv2DNative");var h=r.computeStrides(i.shape),p=r.computeStrides(o.shape),d=c;null==d&&(d=[1,1]),r.assert(v.eitherStridesOrDilationsAreOne(s,d),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '").concat(d,"'")}));for(var f=v.computeConv2DInfo(i.shape,o.shape,s,d,u,l,!0),m=f.filterHeight,g=f.filterWidth,y=f.dilationHeight,b=f.dilationWidth,k=f.padInfo,x=k.left,w=k.top,C=f.outChannels/f.inChannels,_=new xg(f.outShape,i.dtype),S=n.data.get(i.dataId).values,I=n.data.get(o.dataId).values,T=_.values,N=0;N<f.batchSize;++N)for(var A=N*h[0],E=N*_.strides[0],R=0;R<f.outHeight;++R)for(var F=E+R*_.strides[1],D=R*f.strideHeight-x,O=0;O<m;++O){var M=D+O*y;if(!(M<0||M>=f.inHeight))for(var P=O*p[0],L=A+M*h[1],z=0;z<f.outWidth;++z)for(var B=F+z*_.strides[2],V=z*f.strideWidth-w,U=0;U<g;++U){var W=V+U*b;if(!(W<0||W>=f.inWidth))for(var G=L+W*f.inChannels,H=B,j=P+U*p[1],q=0;q<f.inChannels;++q){for(var K=S[G+q],X=0;X<C;++X)T[H+X]+=K*I[j+X];H+=C,j+=C}}}return n.makeTensorInfo(_.shape,_.dtype,_.values)}var CL={kernelName:Hf,backendName:"cpu",kernelFunc:wL},_L={kernelName:jf,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape;IM([a,i],"depthwiseConv2dNativeBackpropFilter");for(var h=v.computeConv2DInfo(a.shape,l,o,s,u,c,!0),p=h.strideHeight,d=h.strideWidth,f=h.filterHeight,m=h.filterWidth,g=new xg(h.filterShape,"float32"),y=h.padInfo.left,b=h.padInfo.top,k=h.outChannels/h.inChannels,x=n.data.get(a.dataId).values,w=new xg(a.shape,a.dtype,x),C=n.data.get(i.dataId).values,_=new xg(i.shape,i.dtype,C),S=0;S<f;++S)for(var I=Math.max(0,Math.ceil((b-S)/p)),T=Math.min(h.outHeight,(h.inHeight+b-S)/p),N=0;N<m;++N)for(var A=Math.max(0,Math.ceil((y-N)/d)),E=Math.min(h.outWidth,(h.inWidth+y-N)/d),R=0;R<h.outChannels;++R){for(var F=Math.trunc(R/k),D=R%k,O=0,M=0;M<h.batchSize;++M)for(var P=I;P<T;++P)for(var L=S+P*p-b,z=A;z<E;++z)O+=w.get(M,L,N+z*d-y,F)*_.get(M,P,z,R);g.set(O,S,N,F,D)}return n.makeTensorInfo(g.shape,g.dtype,g.values)}},SL={kernelName:qf,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.dy,o=t.filter,s=a.strides,u=a.dilations,c=a.pad,l=a.dimRoundingMode,h=a.inputShape;IM([i,o],"depthwiseConv2DNativeBackpropInput");for(var p=r.computeStrides(i.shape),d=r.computeStrides(o.shape),f=v.computeConv2DInfo(h,o.shape,s,u,c,l,!0),m=new xg(f.inShape,"float32"),g=m.values,y=_slicedToArray(m.strides,3),b=y[0],k=y[1],x=y[2],w=n.data.get(i.dataId).values,C=_slicedToArray(p,3),_=C[0],S=C[1],I=C[2],T=n.data.get(o.dataId).values,N=_slicedToArray(d,3),A=N[0],E=N[1],R=N[2],F=f.batchSize,D=f.filterHeight,O=f.filterWidth,M=f.inChannels,P=f.inHeight,L=f.inWidth,z=f.outChannels,B=f.outHeight,V=f.outWidth,U=f.strideHeight,W=f.strideWidth,G=D-1-f.padInfo.top,H=O-1-f.padInfo.left,j=z/M,q=0;q<F;++q)for(var K=0;K<M;++K)for(var X=0;X<P;++X)for(var Y=X-G,Z=Math.max(0,Math.ceil(Y/U)),Q=Math.min(B,(D+Y)/U),J=0;J<L;++J){for(var $=J-H,ee=Math.max(0,Math.ceil($/W)),te=Math.min(V,(O+$)/W),ne=0,re=Z;re<Q;++re)for(var ae=re*U-Y,ie=ee;ie<te;++ie)for(var oe=_*q+S*re+I*ie,se=A*(D-1-ae)+E*(O-1-(ie*W-$))+R*K,ue=0;ue<j;++ue)ne+=w[oe+(K*j+ue)]*T[se+ue];g[b*q+k*X+x*J+K]=ne}return n.makeTensorInfo(m.shape,m.dtype,m.values)}},IL={kernelName:Kf,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,a=t.x,i=r.sizeFromShape(a.shape),o=n.data.get(a.dataId).values,s=Ky([i,i],a.dtype),u=s.values,c=0;c<o.length;c++)u[c*i+c]=o[c];var l=[].concat(_toConsumableArray(a.shape),_toConsumableArray(a.shape));return n.makeTensorInfo(l,s.dtype,s.values)}},TL={kernelName:Xf,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.filter,s=a.strides,u=a.pad,c=a.dilations,l=n,h=l.data.get(i.dataId).values,p=i.shape.length,d=l.data.get(o.dataId).values,f=o.shape.length,m=v.computeDilation2DInfo(i.shape,o.shape,s,u,"NHWC",c),g=m.batchSize,y=m.inHeight,b=m.inWidth,k=m.inChannels,x=m.outHeight,w=m.outWidth,C=m.padInfo,_=m.strideHeight,S=m.strideWidth,I=m.filterHeight,T=m.filterWidth,N=m.dilationHeight,A=m.dilationWidth,E=m.outShape,R=r.sizeFromShape(E),F=E.length,D=r.getArrayFromDType(i.dtype,R),O=0;O<g;++O)for(var M=0;M<x;++M)for(var P=M*_-C.top,L=0;L<w;++L)for(var z=L*S-C.left,B=0;B<k;++B){for(var V=Number.MIN_SAFE_INTEGER,U=0;U<I;++U){var W=P+U*N;if(W>=0&&W<y)for(var G=0;G<T;++G){var H=z+G*A;if(H>=0&&H<b){var j=r.locToIndex([O,W,H,B],p,r.computeStrides(i.shape)),q=r.locToIndex([U,G,B],f,r.computeStrides(o.shape)),K=h[j]+d[q];K>V&&(V=K)}}}D[r.locToIndex([O,M,L,B],F,r.computeStrides(E))]=V}return{dataId:l.write(r.toTypedArray(D,i.dtype),E,i.dtype),shape:E,dtype:i.dtype}}},NL={kernelName:Zf,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.filter,s=t.dy,u=a.strides,c=a.pad,l=a.dilations,h=n,p=r.toNestedArray(i.shape,h.data.get(i.dataId).values),d=r.toNestedArray(o.shape,h.data.get(o.dataId).values),f=v.computeDilation2DInfo(i.shape,o.shape,u,c,"NHWC",l),m=f.batchSize,g=f.inHeight,y=f.inWidth,b=f.inChannels,k=f.outHeight,x=f.outWidth,w=f.padInfo,C=f.strideHeight,_=f.strideWidth,S=f.filterHeight,I=f.filterWidth,T=f.dilationHeight,N=f.dilationWidth,A=f.outShape;r.assert(s.rank===A.length,(function(){return"Error in ".concat(Zf,", dy must have the same rank as output ").concat(A.length,", but got ")+s.rank}));for(var E=r.toNestedArray(A,h.data.get(s.dataId).values),R=r.makeZerosNestedTypedArray(o.shape,o.dtype),F=0;F<m;++F)for(var D=0;D<k;++D)for(var O=D*C-w.top,M=0;M<x;++M)for(var P=M*_-w.left,L=0;L<b;++L){for(var z=Number.MIN_SAFE_INTEGER,B=0,V=0,U=0;U<S;++U){var W=O+U*T;if(W>=0&&W<g)for(var G=0;G<I;++G){var H=P+G*N;if(H>=0&&H<y){var j=p[F][W][H][L]+d[U][G][L];j>z&&(z=j,B=U,V=G)}}}R[B][V][L]+=E[F][D][M][L]}return{dataId:h.write(r.toTypedArray(R,i.dtype),o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}},AL={kernelName:Yf,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.filter,s=t.dy,u=a.strides,c=a.pad,l=a.dilations,h=n,p=r.toNestedArray(i.shape,h.data.get(i.dataId).values),d=r.toNestedArray(o.shape,h.data.get(o.dataId).values),f=v.computeDilation2DInfo(i.shape,o.shape,u,c,"NHWC",l),m=f.batchSize,g=f.inHeight,y=f.inWidth,b=f.inChannels,k=f.outHeight,x=f.outWidth,w=f.padInfo,C=f.strideHeight,_=f.strideWidth,S=f.filterHeight,I=f.filterWidth,T=f.dilationHeight,N=f.dilationWidth,A=f.outShape;r.assert(s.rank===A.length,(function(){return"Error in ".concat(Yf,", dy must have the same rank as output ").concat(A.length,", but got ")+s.rank}));for(var E=r.toNestedArray(A,h.data.get(s.dataId).values),R=r.makeZerosNestedTypedArray(i.shape,i.dtype),F=0;F<m;++F)for(var D=0;D<k;++D)for(var O=D*C-w.top,M=0;M<x;++M)for(var P=M*_-w.left,L=0;L<b;++L){for(var z=Number.MIN_SAFE_INTEGER,B=O<0?0:O,V=P<0?0:P,U=0;U<S;++U){var W=O+U*T;if(W>=0&&W<g)for(var G=0;G<I;++G){var H=P+G*N;if(H>=0&&H<y){var j=p[F][W][H][L]+d[U][G][L];j>z&&(z=j,B=W,V=H)}}}R[F][B][V][L]+=E[F][D][M][L]}return{dataId:h.write(r.toTypedArray(R,i.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},EL={kernelName:$f,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=t.dy,i=t.y;IM([a,i],"eluGrad");for(var o=new Float32Array(r.sizeFromShape(i.shape)),s=n.data.get(i.dataId).values,u=n.data.get(a.dataId).values,c=0;c<s.length;++c){var l=s[c];o[c]=l>=1?u[c]:u[c]*(l+1)}return n.makeTensorInfo(i.shape,"float32",o)}},RL=LM((function(e,t){return e===t?1:0})),FL=$M(tm,RL,null,"bool"),DL={kernelName:tm,backendName:"cpu",kernelFunc:FL},OL=v.ERF_P,ML=v.ERF_A1,PL=v.ERF_A2,LL=v.ERF_A3,zL=v.ERF_A4,BL=v.ERF_A5,VL=AM(em,(function(e){var t=Math.sign(e),n=Math.abs(e),r=1/(1+OL*n);return t*(1-((((BL*r+zL)*r+LL)*r+PL)*r+ML)*r*Math.exp(-n*n))})),UL={kernelName:em,backendName:"cpu",kernelFunc:VL},WL=ZP((function(e){return Math.exp(e)})),GL=EM(nm,WL),HL={kernelName:nm,backendName:"cpu",kernelFunc:GL};function jL(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.input,o=a.dim,s=i.shape.length,u=i.shape.slice(),c=o;return o<0&&(r.assert(-(s+1)<=o,(function(){return"Axis must be in the interval [".concat(-(s+1),", ").concat(s,"]")})),c=s+o+1),u.splice(c,0,1),iP({inputs:{x:i},backend:n,attrs:{shape:u}})}var qL={kernelName:rm,backendName:"cpu",kernelFunc:jL},KL=ZP((function(e){return Math.expm1(e)})),XL=EM(am,KL),YL={kernelName:am,backendName:"cpu",kernelFunc:XL},ZL=LM((function(e,t){return e*t})),QL=eP((function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})),JL=$M(qm,ZL,QL),$L={kernelName:qm,backendName:"cpu",kernelFunc:JL},ez=LM((function(e,t){return e/t})),tz=$M(Qf,ez),nz={kernelName:Qf,backendName:"cpu",kernelFunc:tz},rz=LM((function(e,t){return e-t})),az=eP((function(e,t,n,r){return{real:e-n,imag:t-r}})),iz=$M(Mv,rz,az),oz={kernelName:Mv,backendName:"cpu",kernelFunc:iz};function sz(e,t,n){for(var a=e.shape,i=a[0],o=a[1],s=n.data.get(e.dataId),u=s.complexTensorInfos.real,c=s.complexTensorInfos.imag,l=[i,o],h=r.sizeFromShape(l),p=r.getTypedArrayFromDType("float32",h),d=r.getTypedArrayFromDType("float32",h),f=0;f<i;f++){for(var m=HP({inputs:{x:u},backend:n,attrs:{begin:[f,0],size:[1,o]}}),g=HP({inputs:{x:c},backend:n,attrs:{begin:[f,0],size:[1,o]}}),y=qM({inputs:{real:m,imag:g},backend:n}),b=uz(y,t,n),k=b.real,x=b.imag,w=v.mergeRealAndImagArrays(k,x),C=0;C<o;C++){var _=v.getComplexWithIndex(w,C);p[f*o+C]=_.real,d[f*o+C]=_.imag}n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y)}var S=n.makeTensorInfo(l,"float32",p),I=n.makeTensorInfo(l,"float32",d),T=qM({inputs:{real:S,imag:I},backend:n});return n.disposeIntermediateTensorInfo(S),n.disposeIntermediateTensorInfo(I),T}function uz(e,t,n){var a=r.sizeFromShape(e.shape),i=n.data.get(e.dataId),o=n.data.get(i.complexTensorInfos.real.dataId).values,s=n.data.get(i.complexTensorInfos.imag.dataId).values;if(0==((b=a)&b-1)){var u=function e(t,n,r,a,i){if(1===r)return{real:t,imag:n};var o=v.mergeRealAndImagArrays(t,n),s=r/2,u=v.complexWithEvenIndex(o),c=u.real,l=u.imag,h=[c.length],p=i.makeTensorInfo(h,"float32",c),d=i.makeTensorInfo(h,"float32",l),f=qM({inputs:{real:p,imag:d},backend:i}),m=v.complexWithOddIndex(o),g=m.real,y=m.imag,b=[g.length],k=i.makeTensorInfo(b,"float32",g),x=i.makeTensorInfo(b,"float32",y),w=qM({inputs:{real:k,imag:x},backend:i}),C=e(c,l,s,a,i),_=C.real,S=C.imag,I=[_.length],T=i.makeTensorInfo(I,"float32",_),N=i.makeTensorInfo(I,"float32",S),A=qM({inputs:{real:T,imag:N},backend:i}),E=e(g,y,s,a,i),R=E.real,F=E.imag,D=[R.length],O=i.makeTensorInfo(D,"float32",R),M=i.makeTensorInfo(D,"float32",F),P=qM({inputs:{real:O,imag:M},backend:i}),L=v.exponents(r,a),z=[L.real.length],B=i.makeTensorInfo(z,"float32",L.real),V=i.makeTensorInfo(z,"float32",L.imag),U=qM({inputs:{real:B,imag:V},backend:i}),W=JL({inputs:{a:U,b:P},backend:i}),G=rP({inputs:{a:A,b:W},backend:i}),H=iz({inputs:{a:A,b:W},backend:i}),j=YM({inputs:{input:G},backend:i}),q=YM({inputs:{input:H},backend:i}),K=rL({inputs:{input:G},backend:i}),X=rL({inputs:{input:H},backend:i}),Y=iL({inputs:[j,q],backend:i,attrs:{axis:0}}),Z=iL({inputs:[K,X],backend:i,attrs:{axis:0}}),Q=i.data.get(Y.dataId).values,J=i.data.get(Z.dataId).values;return i.disposeIntermediateTensorInfo(p),i.disposeIntermediateTensorInfo(d),i.disposeIntermediateTensorInfo(f),i.disposeIntermediateTensorInfo(k),i.disposeIntermediateTensorInfo(x),i.disposeIntermediateTensorInfo(w),i.disposeIntermediateTensorInfo(T),i.disposeIntermediateTensorInfo(N),i.disposeIntermediateTensorInfo(A),i.disposeIntermediateTensorInfo(O),i.disposeIntermediateTensorInfo(M),i.disposeIntermediateTensorInfo(P),i.disposeIntermediateTensorInfo(B),i.disposeIntermediateTensorInfo(V),i.disposeIntermediateTensorInfo(U),i.disposeIntermediateTensorInfo(W),i.disposeIntermediateTensorInfo(G),i.disposeIntermediateTensorInfo(H),i.disposeIntermediateTensorInfo(j),i.disposeIntermediateTensorInfo(K),i.disposeIntermediateTensorInfo(q),i.disposeIntermediateTensorInfo(X),i.disposeIntermediateTensorInfo(Y),i.disposeIntermediateTensorInfo(Z),{real:Q,imag:J}}(o,s,a,t,n),c=[e.shape[0],e.shape[1]];if(t){var l=n.makeTensorInfo(c,"float32",u.real),h=n.makeTensorInfo(c,"float32",u.imag),p=n.makeTensorInfo([],"float32",r.createScalarValue(a,"float32")),d=DM({inputs:{x:p},backend:n}),f=nz.kernelFunc({inputs:{a:l,b:p},backend:n}),m=nz.kernelFunc({inputs:{a:h,b:d},backend:n}),g=n.data.get(f.dataId).values,y=n.data.get(m.dataId).values;return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),{real:g,imag:y}}return u}var b,k=function(e,t,n){for(var r=new Float32Array(2*t),a=0;a<t;a++){for(var i=0,o=0,s=0;s<t;s++){var u=v.exponent(a*s,t,n),c=v.getComplexWithIndex(e,s);i+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}n&&(i/=t,o/=t),v.assignToTypedArray(r,i,o,a)}return r}(v.mergeRealAndImagArrays(o,s),a,t);return v.splitRealAndImagArrays(k)}var cz={kernelName:im,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=t.input,i=r.sizeFromShape(a.shape),o=a.shape[a.shape.length-1],s=iP({inputs:{x:a},backend:n,attrs:{shape:[i/o,o]}}),u=sz(s,!1,n),c=iP({inputs:{x:u},backend:n,attrs:{shape:a.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),c}};function lz(e){var t=e.backend,n=e.attrs,a=n.shape,i=n.value,o=n.dtype||r.inferDtype(i),s=r.getArrayFromDType(o,r.sizeFromShape(a));return function(e,t,n){e.fill(t)}(s,i),t.makeTensorInfo(a,o,s)}var hz={kernelName:om,backendName:"cpu",kernelFunc:lz},pz={kernelName:sm,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,a=t.image,i=n,o=r.getTypedArrayFromDType(a.dtype,r.sizeFromShape(a.shape)),s=_slicedToArray(a.shape,4),u=s[0],c=s[1],l=s[2],h=s[3],p=i.data.get(a.dataId).values,d=0;d<u;d++)for(var f=d*l*c*h,m=0;m<c;m++)for(var v=m*(l*h),g=0;g<l;g++)for(var y=g*h,b=0;b<h;b++){var k=Math.round(l-[u,m,g,b][2]),x=f+v+y+b,w=p[x];k>=0&&k<l&&(w=p[f+v+k*h+b]),o[x]=w}return{dataId:i.write(o,a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},dz=ZP((function(e){return Math.floor(e)})),fz=EM(um,dz),mz={kernelName:um,backendName:"cpu",kernelFunc:fz},vz=LM((function(e,t){return Math.floor(e/t)})),gz=$M(cm,vz,null,"int32"),yz={kernelName:cm,backendName:"cpu",kernelFunc:gz},bz={kernelName:Qv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,h=r.dilations,p=r.dimRoundingMode,d=r.activation,f=r.leakyreluAlpha,m=sL({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:h,dimRoundingMode:p}});if(o){var v=m;m=rP({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(v)}if(d){var g=m;m=jM(n,m,d,s,f),n.disposeIntermediateTensorInfo(g)}return m}},kz={kernelName:Jv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,h=r.dilations,p=r.dimRoundingMode,d=r.activation,f=r.leakyreluAlpha,m=wL({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:h,dimRoundingMode:p}});if(o){var v=m;m=rP({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(v)}if(d){var g=m;m=jM(n,m,d,s,f),n.disposeIntermediateTensorInfo(g)}return m}},xz={kernelName:pm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=t.params,i=t.indices,o=r.sizeFromShape(a.shape),s=i.shape,u=s[s.length-1],c=_slicedToArray(v.prepareAndValidate(a,i),4),l=c[0],h=c[1],p=c[2],d=c[3];if(0===h)return n.makeTensorInfo(l,a.dtype,[]);for(var f=Ky([h,p],a.dtype),m=n.data.get(i.dataId).values,g=n.data.get(a.dataId).values,y=0;y<h;y++){for(var b=[],k=0,x=0;x<u;x++){var w=m[y*u+x];k+=w*d[x],b.push(w)}if(k<0||k>=o/p)throw new Error("Invalid indices: ".concat(b," does not index into ").concat(a.shape));for(var C=0;C<p;C++)f.values[y*p+C]=g[k*p+C]}return n.makeTensorInfo(l,f.dtype,f.values)}};function wz(e,t,n){for(var r=Ky(n,e.dtype),a=0;a<r.size;++a){var i=r.indexToLoc(a).slice(),o=t.locToIndex([i[0],i[2]]);i[2]=t.values[o];var s=e.locToIndex(i);r.values[a]=e.values[s]}return r}var Cz={kernelName:hm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.indices,s=a.axis,u=a.batchDims;IM([i,o],"gatherV2");var c=u;null==u&&(c=0);var l=r.sizeFromShape(o.shape),h=r.parseAxisParam(s,i.shape)[0],p=v.segment_util.collectGatherOpShapeInfo(i,o,h,c),d=iP({inputs:{x:i},backend:n,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),f=iP({inputs:{x:o},backend:n,attrs:{shape:[p.batchSize,l/p.batchSize]}}),m=[p.batchSize,p.outerSize,l/p.batchSize,p.sliceSize],g=n.bufferSync(f),y=wz(n.bufferSync(d),g,m);return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.makeTensorInfo(p.outputShape,y.dtype,y.values)}},_z=LM((function(e,t){return e>t?1:0})),Sz=$M(dm,_z,null,"bool"),Iz={kernelName:dm,backendName:"cpu",kernelFunc:Sz},Tz=LM((function(e,t){return e>=t?1:0})),Nz=$M(fm,Tz,null,"bool"),Az={kernelName:fm,backendName:"cpu",kernelFunc:Nz},Ez={kernelName:vm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=t.input,i=r.sizeFromShape(a.shape),o=a.shape[a.shape.length-1],s=iP({inputs:{x:a},backend:n,attrs:{shape:[i/o,o]}}),u=sz(s,!0,n),c=iP({inputs:{x:u},backend:n,attrs:{shape:a.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),c}},Rz=AM(ym,(function(e){return Number.isFinite(e)?1:0}),"bool"),Fz={kernelName:ym,backendName:"cpu",kernelFunc:Rz},Dz=AM(bm,(function(e){return Math.abs(e)===1/0?1:0}),"bool"),Oz={kernelName:bm,backendName:"cpu",kernelFunc:Dz},Mz=AM(km,(function(e){return Number.isNaN(e)?1:0}),"bool"),Pz={kernelName:km,backendName:"cpu",kernelFunc:Mz},Lz=LM((function(e,t){return e<t?1:0})),zz=$M(wm,Lz,null,"bool"),Bz={kernelName:wm,backendName:"cpu",kernelFunc:zz},Vz=LM((function(e,t){return e<=t?1:0})),Uz=$M(Cm,Vz,null,"bool"),Wz={kernelName:Cm,backendName:"cpu",kernelFunc:Uz};function Gz(e,t,n){var a=(t-e)/(n-1),i=r.makeZerosTypedArray(n,"float32");i[0]=e;for(var o=1;o<i.length;o++)i[o]=i[o-1]+a;return i}var Hz={kernelName:_m,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=Gz(n.start,n.stop,n.num);return t.makeTensorInfo([r.length],"float32",r)}},jz=ZP((function(e){return Math.log(e)})),qz=EM(Sm,jz),Kz={kernelName:Sm,backendName:"cpu",kernelFunc:qz},Xz=AM(Im,(function(e){return Math.log1p(e)})),Yz={kernelName:Im,backendName:"cpu",kernelFunc:Xz},Zz=LM((function(e,t){return e&&t})),Qz=$M(Tm,Zz,null,"bool"),Jz={kernelName:Tm,backendName:"cpu",kernelFunc:Qz},$z=AM(Nm,(function(e){return e?0:1}),"bool"),eB={kernelName:Nm,backendName:"cpu",kernelFunc:$z},tB=LM((function(e,t){return e||t})),nB=$M(Am,tB,null,"bool"),rB={kernelName:Am,backendName:"cpu",kernelFunc:nB},aB={kernelName:Rm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.depthRadius,s=a.bias,u=a.alpha,c=a.beta;IM(i,"LRN");var l=i.shape[3],h=l-1,p=n.data.get(i.dataId).values,d=r.sizeFromShape(i.shape),f=new Float32Array(d);function m(e){for(var t=e%l,n=e-t+Math.max(0,t-o),r=e-t+Math.min(t+o,h),a=0;n<=r;n++){var i=p[n];a+=i*i}return a}for(var v=0;v<d;v++){var g=m(v),y=p[v]*Math.pow(s+u*g,-c);f[v]=y}return n.makeTensorInfo(i.shape,i.dtype,f)}},iB={kernelName:Fm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.y,s=t.dy,u=a.depthRadius,c=a.bias,l=a.alpha,h=a.beta;IM(s,"LRNGrad");for(var p=r.sizeFromShape(s.shape),d=s.shape[3],f=n.data.get(s.dataId).values,m=n.data.get(i.dataId).values,v=n.data.get(o.dataId).values,g=new Float32Array(p),y=p,b=0;b<y;b++){for(var k=b%d,x=b-k+Math.max(0,k-u),w=b-k+Math.min(d,k+u+1),C=0,_=x;_<w;_++)C+=Math.pow(m[_],2);C=l*C+c;for(var S=x;S<w;S++){var I=-2*l*h*m[S]*v[b]/C;b===S&&(I+=Math.pow(C,-h)),I*=f[b],g[S]+=I}}return n.makeTensorInfo(s.shape,i.dtype,g)}};function oB(e,t,n,a){for(var i=r.getTypedArrayFromDType(a,r.sizeFromShape(n)),o=0;o<i.length;++o){for(var s=o*t,u=e[s],c=0;c<t;++c){var l=e[s+c];l>u&&(u=l)}i[o]=u}return i}function sB(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.reductionIndices,s=a.keepDims,u=n,c=i.shape,l=c.length,h=r.parseAxisParam(o,c),p=h,d=v.getAxesPermutation(p,l),f=u.data.get(i.dataId).values;if(null!=d){for(var m=new Array(l),g=0;g<m.length;g++)m[g]=c[d[g]];f=gP(f,c,i.dtype,d,m),p=v.getInnerMostAxes(p.length,l),c=m}IM(i,"max"),v.assertAxesAreInnerMostDims("max",p,l);var y=_slicedToArray(v.computeOutAndReduceShapes(c,p),2),b=y[0],k=y[1],x=oB(f,r.sizeFromShape(k),b,i.dtype),w=u.write(x,b,i.dtype),C=b;return s&&(C=v.expandShapeToKeepDim(b,h)),{dataId:w,shape:C,dtype:i.dtype}}var uB={kernelName:Dm,backendName:"cpu",kernelFunc:sB},cB=LM((function(e,t){return Math.max(e,t)})),lB=$M(Om,cB),hB={kernelName:Om,backendName:"cpu",kernelFunc:lB},pB={kernelName:Mm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x;IM(i,"maxPool");var o=a.filterSize,s=a.strides,u=a.pad,c=a.dimRoundingMode;r.assert(v.eitherStridesOrDilationsAreOne(s,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '1'")}));var l,h=v.computePool2DInfo(i.shape,o,s,1,u,c);if(1===h.filterWidth&&1===h.filterHeight&&r.arraysEqual(h.inShape,h.outShape))l=DM({inputs:{x:i},backend:n});else{var p=n.data.get(i.dataId).values,d=r.computeStrides(i.shape),f=MP(p,0,i.dtype,d,h,"max");l=n.makeTensorInfo(h.outShape,i.dtype,f.values)}return l}},dB={kernelName:Lm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.filterSize,s=a.strides,u=a.pad,c=a.dimRoundingMode,l=a.dataFormat,h=a.dilations;IM(i,"maxPool3d");var p=h;null==p&&(p=[1,1,1]);var d=v.computePool3DInfo(i.shape,o,s,p,u,c,l),f=LP(n.data.get(i.dataId).values,0,i.dtype,r.computeStrides(i.shape),d,"max");return n.makeTensorInfo(f.shape,"float32",f.values)}},fB={kernelName:zm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dilations,l=r.dimRoundingMode;IM([a,i],"maxPool3DGrad");for(var h=v.computePool3DInfo(i.shape,o,s,c,u,l),p=function(e,t){for(var n=Ky(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,h=t.effectiveFilterWidth,p=t.padInfo.front,d=t.padInfo.top,f=t.padInfo.left,m=0;m<t.batchSize;++m)for(var v=0;v<t.inChannels;++v)for(var g=0;g<t.outDepth;++g){for(var y=g*r-p,b=y;b<0;)b+=o;for(var k=Math.min(t.inDepth,c+y),x=0;x<t.outHeight;++x){for(var w=x*a-d,C=w;C<0;)C+=s;for(var _=Math.min(t.inHeight,l+w),S=0;S<t.outWidth;++S){for(var I=S*i-f,T=I;T<0;)T+=u;for(var N=Math.min(t.inWidth,h+I),A=Number.NEGATIVE_INFINITY,E=-1,R=b;R<k;R+=o)for(var F=R-y,D=C;D<_;D+=s)for(var O=D-w,M=T;M<N;M+=u){var P=M-I,L=e.get(m,R,D,M,v);L>=A&&(A=L,E=F*l*h+O*l+P)}n.set(E,m,g,x,S,v)}}}return n}(n.bufferSync(i),h),d=h.strideDepth,f=h.strideHeight,m=h.strideWidth,g=h.dilationDepth,y=h.dilationHeight,b=h.dilationWidth,k=h.effectiveFilterDepth,x=h.effectiveFilterHeight,w=h.effectiveFilterWidth,C=k-1-h.padInfo.front,_=w-1-h.padInfo.left,S=x-1-h.padInfo.top,I=Ky(i.shape,"float32"),T=n.bufferSync(a),N=0;N<h.batchSize;++N)for(var A=0;A<h.inChannels;++A)for(var E=0;E<h.inDepth;++E)for(var R=0;R<h.inHeight;++R)for(var F=0;F<h.inWidth;++F){for(var D=E-C,O=R-S,M=F-_,P=0,L=0;L<k;L+=g){var z=(D+L)/d;if(!(z<0||z>=h.outDepth||Math.floor(z)!==z))for(var B=0;B<x;B+=y){var V=(O+B)/f;if(!(V<0||V>=h.outHeight||Math.floor(V)!==V))for(var U=0;U<w;U+=b){var W=(M+U)/m;if(!(W<0||W>=h.outWidth||Math.floor(W)!==W)){var G=k*x*w-1-p.get(N,z,V,W,A)===L*x*w+B*w+U?1:0;0!==G&&(P+=T.get(N,z,V,W,A)*G)}}}}I.set(P,N,E,R,F,A)}return n.makeTensorInfo(I.shape,I.dtype,I.values)}},mB={kernelName:Pm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;IM([i,t.output],"maxPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,h=v.computePool2DInfo(o.shape,s,u,1,c,l),p=n.data.get(o.dataId).values,d=Ky(h.outShape,o.dtype,PP(p,o.shape,o.dtype,h).values),f=h.strideHeight,m=h.strideWidth,g=h.dilationHeight,y=h.dilationWidth,b=h.effectiveFilterHeight,k=h.effectiveFilterWidth,x=k-1-h.padInfo.left,w=b-1-h.padInfo.top,C=Ky(o.shape,"float32"),_=n.data.get(a.dataId).values,S=Ky(a.shape,"float32",_),I=0;I<h.batchSize;++I)for(var T=0;T<h.inChannels;++T)for(var N=0;N<h.inHeight;++N)for(var A=0;A<h.inWidth;++A){for(var E=N-w,R=A-x,F=0,D=0;D<b;D+=g){var O=(E+D)/f;if(!(O<0||O>=h.outHeight||Math.floor(O)!==O))for(var M=0;M<k;M+=y){var P=(R+M)/m;if(!(P<0||P>=h.outWidth||Math.floor(P)!==P)){var L=b*k-1-d.get(I,O,P,T)===D*k+M?1:0;0!==L&&(F+=S.get(I,O,P,T)*L)}}}C.set(F,I,N,A,T)}return n.makeTensorInfo(C.shape,C.dtype,C.values)}},vB={kernelName:Bm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,a=e.backend,i=t.x,o=n.filterSize,s=n.strides,u=n.pad,c=n.includeBatchInIndex,l=a;IM(i,"MaxPoolWithArgmax");var h=l.data.get(i.dataId).values,p=v.computePool2DInfo(i.shape,o,s,[1,1],u),d=_slicedToArray(function(e,t,n,a,i){var o=MP(e,0,n,r.computeStrides(t),i,"max"),s=PP(e,t,n,i,!0,a);return[o.values,s.values]}(h,i.shape,i.dtype,c,p),2),f=d[0],m=d[1],g=l.write(f,p.outShape,i.dtype),y=l.write(m,p.outShape,i.dtype);return[{dataId:g,shape:p.outShape,dtype:i.dtype},{dataId:y,shape:p.outShape,dtype:"int32"}]}};function gB(e){var t,n=e.inputs,a=e.backend,i=e.attrs,o=n.x,s=i.axis,u=i.keepDims;IM(o,"sum");var c=(t="bool"===o.dtype?QM({inputs:{x:o},backend:a,attrs:{dtype:"int32"}}):DM({inputs:{x:o},backend:a})).shape.length,l=r.parseAxisParam(s,t.shape),h=v.getAxesPermutation(l,c),p=l,d=t;null!=h&&(d=yP({inputs:{x:t},backend:a,attrs:{perm:h}}),p=v.getInnerMostAxes(p.length,c)),v.assertAxesAreInnerMostDims("sum",p,d.shape.length);for(var f=_slicedToArray(v.computeOutAndReduceShapes(d.shape,p),2),m=f[0],g=f[1],y=XM(a,m,v.upcastType(d.dtype,"int32")),b=r.sizeFromShape(g),k=a.data.get(y.dataId).values,x=a.data.get(d.dataId).values,w=0;w<k.length;++w){for(var C=w*b,_=0,S=0;S<b;++S)_+=x[C+S];k[w]=_}if(u){var I=y;y=iP({inputs:{x:y},backend:a,attrs:{shape:v.expandShapeToKeepDim(y.shape,l)}}),a.disposeIntermediateTensorInfo(I)}return a.disposeIntermediateTensorInfo(t),null!=h&&a.disposeIntermediateTensorInfo(d),y}var yB={kernelName:Av,backendName:"cpu",kernelFunc:gB},bB={kernelName:Vm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.axis,s=a.keepDims,u=r.parseAxisParam(o,i.shape),c=v.computeOutAndReduceShapes(i.shape,u),l=r.sizeFromShape(c[1]),h=[],p=n.makeTensorInfo([],"float32",new Float32Array([l]));h.push(p);var d=QM({inputs:{x:i},backend:n,attrs:{dtype:"float32"}});h.push(d);var f=tz({inputs:{a:d,b:p},backend:n});h.push(f);var m=gB({inputs:{x:f},backend:n,attrs:{axis:o,keepDims:s}});return h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),m}},kB={kernelName:Um,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.axis,s=a.keepDims;IM(i,"min");var u=r.parseAxisParam(o,i.shape),c=u,l=v.getAxesPermutation(c,i.shape.length),h=i;null!=l&&(h=yP({inputs:{x:i},backend:n,attrs:{perm:l}}),c=v.getInnerMostAxes(c.length,i.shape.length)),v.assertAxesAreInnerMostDims("min",c,h.shape.length);for(var p=_slicedToArray(v.computeOutAndReduceShapes(h.shape,c),2),d=p[0],f=p[1],m=r.sizeFromShape(f),g=r.makeZerosTypedArray(r.sizeFromShape(d),h.dtype),y=n.data.get(h.dataId).values,b=0;b<g.length;++b){for(var k=b*m,x=y[k],w=0;w<m;++w){var C=y[k+w];C<x&&(x=C)}g[b]=x}null!=l&&n.disposeIntermediateTensorInfo(h);var _=n.makeTensorInfo(d,h.dtype,g);if(s){var S=iP({inputs:{x:_},backend:n,attrs:{shape:v.expandShapeToKeepDim(d,u)}});return n.disposeIntermediateTensorInfo(_),S}return _}},xB=LM((function(e,t){return Math.min(e,t)})),wB=$M(Wm,xB),CB={kernelName:Wm,backendName:"cpu",kernelFunc:wB},_B={kernelName:Gm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.paddings,s=a.mode;IM(i,"mirrorPad");for(var u=o.map((function(e,t){return e[0]+i.shape[t]+e[1]})),c=o.map((function(e){return e[0]})),l=o.map((function(e,t){return e[0]+i.shape[t]})),h="reflect"===s?0:1,p=n.data.get(i.dataId).values,d=i.shape.length,f=r.computeStrides(i.shape),m=r.sizeFromShape(u),v=u.length,g=r.computeStrides(u),y=r.getTypedArrayFromDType(i.dtype,m),b=0;b<m;b++){for(var k=r.indexToLoc(b,v,g),x=0;x<v;x++)k[x]<c[x]?k[x]=2*c[x]-k[x]-h:k[x]>=l[x]&&(k[x]=2*(l[x]-1)-k[x]+h);k=k.map((function(e,t){return e-c[t]}));var w=r.locToIndex(k,d,f);y[b]=p[w]}return{dataId:n.write(y,u,i.dtype),shape:u,dtype:i.dtype}}},SB=LM((function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})),IB=$M(Hm,SB),TB={kernelName:Hm,backendName:"cpu",kernelFunc:IB};function NB(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.logits,o=a.dim,s=i.shape.length,u=o;if(-1===u&&(u=s-1),u!==s-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(s," and dim was ").concat(u));var c=r.parseAxisParam([u],i.shape),l=sB({inputs:{x:i},backend:n,attrs:{reductionIndices:c,keepDims:!1}}),h=v.expandShapeToKeepDim(l.shape,c),p=iP({inputs:{x:l},backend:n,attrs:{shape:h}}),d=iz({inputs:{a:i,b:p},backend:n}),f=GL({inputs:{x:d},backend:n}),m=gB({inputs:{x:f},backend:n,attrs:{axis:c,keepDims:!1}}),g=iP({inputs:{x:m},backend:n,attrs:{shape:h}}),y=tz({inputs:{a:f,b:g},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),y}var AB={kernelName:Fv,backendName:"cpu",kernelFunc:NB},EB={kernelName:jm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.logits,o=a.numSamples,s=a.seed,u=a.normalized;IM(i,"multinomial");for(var c=u?i:NB({inputs:{logits:i},backend:n,attrs:{dim:-1}}),l=c.shape[0],h=c.shape[1],p=n.data.get(c.dataId).values,d=[l,o],f=r.makeZerosTypedArray(r.sizeFromShape(d),"int32"),m=0;m<l;++m){var v=m*h,g=new Float32Array(h-1);g[0]=p[v];for(var y=1;y<g.length;++y)g[y]=g[y-1]+p[v+y];for(var b=NC.alea(s.toString()),k=m*o,x=0;x<o;++x){var w=b();f[k+x]=g.length;for(var C=0;C<g.length;C++)if(w<g[C]){f[k+x]=C;break}}}return u||n.disposeIntermediateTensorInfo(c),n.makeTensorInfo(d,"int32",f)}};function RB(e,t,n){var a=r.createScalarValue(-1,n);return ZL([],t,a,e,n)}var FB={kernelName:Km,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x;IM(r,"neg");var a=_slicedToArray(RB(n.data.get(r.dataId).values,r.shape,r.dtype),2),i=a[0],o=a[1];return n.makeTensorInfo(o,r.dtype,i)}},DB=g.nonMaxSuppressionV3Impl,OB={kernelName:Ym,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold;IM(a,"NonMaxSuppression");var c=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,h=DB(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},MB=g.nonMaxSuppressionV4Impl,PB={kernelName:Zm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize;IM(a,"NonMaxSuppressionPadded");var l=n.data.get(a.dataId).values,h=n.data.get(i.dataId).values,p=MB(l,h,o,s,u,c),d=p.selectedIndices,f=p.validOutputs;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}},LB=g.nonMaxSuppressionV5Impl,zB={kernelName:Qm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma;IM(a,"NonMaxSuppressionWithScore");var l=n.data.get(a.dataId).values,h=n.data.get(i.dataId).values,p=LB(l,h,o,s,u,c),d=p.selectedIndices,f=p.selectedScores;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([f.length],"float32",new Float32Array(f))]}},BB=LM((function(e,t){return e!==t?1:0})),VB=$M(Xm,BB,null,"bool"),UB={kernelName:Xm,backendName:"cpu",kernelFunc:VB},WB={kernelName:$m,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.indices,o=a.depth,s=a.onValue,u=a.offValue;IM(i,"oneHot");var c=r.sizeFromShape(i.shape),l=new Float32Array(c*o);l.fill(u);for(var h=n.data.get(i.dataId).values,p=0;p<c;++p)h[p]>=0&&h[p]<o&&(l[p*o+h[p]]=s);return n.makeTensorInfo([].concat(_toConsumableArray(i.shape),[o]),"int32",l)}};function GB(e){var t=e.inputs,n=e.backend,r=t.x;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){var a=YM({inputs:{input:r},backend:n}),i=GB({inputs:{x:a},backend:n}),o=rL({inputs:{input:r},backend:n}),s=GB({inputs:{x:o},backend:n}),u=qM({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return lz({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var HB={kernelName:qv,backendName:"cpu",kernelFunc:GB},jB={kernelName:Jm,backendName:"cpu",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===a.dtype){var i=YM({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=rL({inputs:{input:a},backend:r}),u=GB({inputs:{x:s},backend:r}),c=qM({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return lz({backend:r,attrs:{shape:a.shape,value:1,dtype:a.dtype}})}};function qB(e){var t=e.inputs,n=e.backend,a=e.attrs.axis;if(1===t.length)return jL({inputs:{input:t[0]},backend:n,attrs:{dim:a}});var i=t[0].shape,o=t[0].dtype;t.forEach((function(e){r.assertShapesMatch(i,e.shape,"All tensors passed to stack must have matching shapes"),r.assert(o===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var s=[],u=iL({inputs:t.map((function(e){var t=jL({inputs:{input:e},backend:n,attrs:{dim:a}});return s.push(t),t})),backend:n,attrs:{axis:a}});return s.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),u}var KB={kernelName:ev,backendName:"cpu",kernelFunc:qB},XB={kernelName:tv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.paddings,s=a.constantValue;IM(i,"pad");var u=o.map((function(e,t){return e[0]+i.shape[t]+e[1]})),c=o.map((function(e){return e[0]})),l=n.data.get(i.dataId).values,h=r.sizeFromShape(i.shape),p=i.shape.length,d=r.computeStrides(i.shape),f=r.sizeFromShape(u),m=u.length,v=r.computeStrides(u),g=r.getTypedArrayFromDType(i.dtype,f);0!==s&&g.fill(s);for(var y=0;y<h;y++){var b=r.indexToLoc(y,p,d).map((function(e,t){return e+c[t]}));g[r.locToIndex(b,m,v)]=l[y]}return{dataId:n.write(g,u,i.dtype),shape:u,dtype:i.dtype}}},YB=LM((function(e,t){return Math.pow(e,t)})),ZB=$M(rv,YB),QB={kernelName:rv,backendName:"cpu",kernelFunc:ZB};function JB(e,t,n,a){for(var i=_slicedToArray(v.computeOutAndReduceShapes(e,a),2),o=i[0],s=i[1],u=Fg(t,"int32"),c=r.makeZerosTypedArray(r.sizeFromShape(o),u),l=r.sizeFromShape(s),h=0;h<c.length;++h){for(var p=h*l,d=1,f=0;f<l;++f)d*=n[p+f];c[h]=d}return{outVals:c,outShape:o,outDtype:u}}var $B={kernelName:iv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.axis,s=a.keepDims;IM(i,"prod");var u=i.shape.length,c=r.parseAxisParam(o,i.shape),l=v.getAxesPermutation(c,u),h=c,p=i,d=[];null!=l&&(p=yP({inputs:{x:i},backend:n,attrs:{perm:l}}),d.push(p),h=v.getInnerMostAxes(h.length,u));var f=n.data.get(p.dataId).values,m=JB(p.shape,p.dtype,f,h),g=m.outVals,y=m.outShape,b=m.outDtype,k=y;return s&&(k=v.expandShapeToKeepDim(y,c)),d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(k,b,g)}};function eV(e,t,n,a){if(e===t||e<t&&n<0||t<e&&n>1)return r.makeZerosTypedArray(0,a);var i=Math.abs(Math.ceil((t-e)/n)),o=r.makeZerosTypedArray(i,a);t<e&&1===n&&(n=-1),o[0]=e;for(var s=1;s<o.length;s++)o[s]=o[s-1]+n;return o}var tV={kernelName:ov,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.dtype,o=eV(r,a,n.step,i);return t.makeTensorInfo([o.length],i,o)}},nV=AM(uv,(function(e){return 1/e})),rV={kernelName:uv,backendName:"cpu",kernelFunc:nV},aV={kernelName:dv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.images,o=a.alignCorners,s=a.halfPixelCenters,u=a.size;IM(i,"resizeBilinear");for(var c=r.computeStrides(i.shape),l=_slicedToArray(u,2),h=l[0],p=l[1],d=_slicedToArray(i.shape,4),f=d[0],m=d[1],v=d[2],g=d[3],y=n.data.get(i.dataId).values,b=new Float32Array(r.sizeFromShape([f,h,p,g])),k=[o&&h>1?m-1:m,o&&p>1?v-1:v],x=[o&&h>1?h-1:h,o&&p>1?p-1:p],w=0,C=k[0]/x[0],_=k[1]/x[1],S=0;S<f;S++)for(var I=0;I<h;I++){var T;T=s?C*(I+.5)-.5:C*I;for(var N=Math.max(0,Math.floor(T)),A=T-N,E=Math.min(m-1,Math.ceil(T)),R=S*c[0]+N*c[1],F=S*c[0]+E*c[1],D=0;D<p;D++){var O;O=s?_*(D+.5)-.5:_*D;for(var M=Math.max(0,Math.floor(O)),P=O-M,L=Math.min(v-1,Math.ceil(O)),z=R+M*c[2],B=F+M*c[2],V=R+L*c[2],U=F+L*c[2],W=0;W<g;W++){var G=y[z+W],H=y[B+W],j=G+(y[V+W]-G)*P;b[w++]=j+(H+(y[U+W]-H)*P-j)*A}}}return n.makeTensorInfo([f,h,p,g],"float32",b)}},iV={kernelName:fv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.images,o=t.dy,s=a.alignCorners;IM([o,i],"resizeBilinearGrad");for(var u=r.computeStrides(i.shape),c=_slicedToArray(i.shape,4),l=c[0],h=c[1],p=c[2],d=c[3],f=_slicedToArray(o.shape,3),m=f[1],v=f[2],g=new Float32Array(l*h*p*d),y=[s&&m>1?h-1:h,s&&v>1?p-1:p],b=[s&&m>1?m-1:m,s&&v>1?v-1:v],k=y[0]/b[0],x=y[1]/b[1],w=n.data.get(o.dataId).values,C=0,_=0;_<l;_++)for(var S=_*u[0],I=0;I<m;I++)for(var T=I*k,N=Math.floor(T),A=Math.min(Math.ceil(T),h-1),E=S+N*u[1],R=S+A*u[1],F=T-N,D=1-F,O=0;O<v;O++)for(var M=O*x,P=Math.floor(M),L=Math.min(Math.ceil(M),p-1),z=M-P,B=1-z,V=E+P*u[2],U=E+L*u[2],W=R+P*u[2],G=R+L*u[2],H=D*B,j=D*z,q=F*B,K=F*z,X=0;X<d;X++){var Y=w[C++];g[V+X]+=Y*H,g[U+X]+=Y*j,g[W+X]+=Y*q,g[G+X]+=Y*K}return n.makeTensorInfo([l,p,h,d],"float32",g)}},oV={kernelName:hv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.images,o=a.alignCorners,s=a.halfPixelCenters,u=a.size;IM(i,"resizeNearestNeighbor");for(var c=r.computeStrides(i.shape),l=_slicedToArray(u,2),h=l[0],p=l[1],d=_slicedToArray(i.shape,4),f=d[0],m=d[1],v=d[2],g=d[3],y=n.data.get(i.dataId).values,b=new Float32Array(f*h*p*g),k=[o&&h>1?m-1:m,o&&p>1?v-1:v],x=[o&&h>1?h-1:h,o&&p>1?p-1:p],w=k[0]/x[0],C=k[1]/x[1],_=0,S=0;S<f;S++)for(var I=S*c[0],T=0;T<h;T++){var N=s?w*(T+.5):w*T,A=Math.min(m-1,o?Math.round(N):Math.floor(N));s&&(A=Math.max(0,A));for(var E=I+A*c[1],R=0;R<p;R++){var F=s?C*(R+.5):C*R,D=Math.min(v-1,o?Math.round(F):Math.floor(F));s&&(D=Math.max(0,D));for(var O=E+D*c[2],M=0;M<g;M++)b[_++]=y[O+M]}}return n.makeTensorInfo([f,h,p,g],i.dtype,b)}},sV={kernelName:pv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.images,o=t.dy,s=a.alignCorners;IM([o,i],"resizeNearestNeighborGrad");for(var u=r.computeStrides(i.shape),c=r.computeStrides(o.shape),l=_slicedToArray(i.shape,4),h=l[0],p=l[1],d=l[2],f=l[3],m=_slicedToArray(o.shape,3),v=m[1],g=m[2],y=new Float32Array(h*p*d*f),b=n.data.get(o.dataId).values,k=[s&&v>1?p-1:p,s&&g>1?d-1:d],x=[s&&v>1?v-1:v,s&&g>1?g-1:g],w=k[0]/x[0],C=k[1]/x[1],_=1/w,S=1/C,I=2*Math.ceil(_)+2,T=2*Math.ceil(S)+2,N=0;N<h;N++)for(var A=N*u[0],E=0;E<p;E++)for(var R=A+E*u[1],F=Math.floor(E*_),D=Math.floor(F-I/2),O=0;O<d;O++)for(var M=R+O*u[2],P=Math.floor(O*S),L=Math.floor(P-T/2),z=0;z<f;z++){for(var B=0,V=0;V<I;V++){var U=V+D;if(!(U<0||U>=v)){var W=A+U*c[1],G=U*w;if(E===Math.min(p-1,s?Math.round(G):Math.floor(G)))for(var H=0;H<T;H++){var j=H+L;if(!(j<0||j>=g)){var q=W+j*c[2],K=j*C;O===Math.min(d-1,s?Math.round(K):Math.floor(K))&&(B+=b[q+z])}}}}y[M+z]=B}return n.makeTensorInfo(i.shape,i.dtype,y)}},uV={kernelName:vv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.dims;IM(i,"reverse");var s=i.shape.length,u=r.parseAxisParam(o,i.shape);if(0===s)return DM({inputs:{x:i},backend:n});for(var c=new xg(i.shape,i.dtype),l=n.bufferSync(i),h=function(e){var t=c.indexToLoc(e),n=t.slice();u.forEach((function(e){return n[e]=i.shape[e]-1-n[e]})),c.set.apply(c,[l.get.apply(l,_toConsumableArray(n))].concat(_toConsumableArray(t)))},p=0;p<c.size;p++)h(p);return n.makeTensorInfo(c.shape,c.dtype,c.values)}},cV={kernelName:Yv,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.attrs,a=e.backend,i=t.image,o=n.radians,s=n.fillValue,u=n.center,c=a,l=r.getTypedArrayFromDType(i.dtype,r.sizeFromShape(i.shape)),h=_slicedToArray(i.shape,4),p=h[0],d=h[1],f=h[2],m=h[3],g=_slicedToArray(v.getImageCenter(u,d,f),2),y=g[0],b=g[1],k=Math.sin(o),x=Math.cos(o),w=c.data.get(i.dataId).values,C=0;C<p;C++)for(var _=C*f*d*m,S=0;S<d;S++)for(var I=S*(f*m),T=0;T<f;T++)for(var N=T*m,A=0;A<m;A++){var E=[p,S,T,A],R=E[2],F=E[1],D=(R-y)*x-(F-b)*k,O=(R-y)*k+(F-b)*x;D=Math.round(D+y),O=Math.round(O+b);var M=s;"number"!=typeof s&&(M=3===A?255:s[A]),D>=0&&D<f&&O>=0&&O<d&&(M=w[_+O*(f*m)+D*m+A]),l[_+I+N+A]=M}return{dataId:c.write(l,i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},lV=AM(gv,(function(e){var t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2==0?t:t+1})),hV={kernelName:gv,backendName:"cpu",kernelFunc:lV},pV=ZP((function(e){return 1/Math.sqrt(e)})),dV=EM(yv,pV),fV={kernelName:yv,backendName:"cpu",kernelFunc:dV};function mV(e,t,n,r,a,i,o,s,u,c){var l=[r/a,a],h=e.values,p=t.values;if(0===r)return Ky(n,t.dtype);var d=Ky(l,t.dtype);d.values.fill(u);for(var f=0;f<i;f++){for(var m=[],v=0,g=0;g<o;g++){var y=h[f*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=r/a)throw new Error("Invalid indices: ".concat(m," does not index into ").concat(n));for(var b=0;b<a;b++)c?d.values[v*a+b]+=p[f*a+b]:d.values[v*a+b]=0===t.rank?p[0]:p[f*a+b]}return d}var vV={kernelName:bv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=v.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,h=s.strides,p=s.outputSize,d=mV(n.bufferSync(a),n.bufferSync(i),o,p,l,c,u,h,0,!0);return n.makeTensorInfo(o,d.dtype,d.values)}},gV={kernelName:kv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=t.condition,i=t.t,o=t.e;IM([a,i,o],"select");for(var s=a.shape.length,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values,h=Fg(i.dtype,o.dtype),p=r.makeZerosTypedArray(r.sizeFromShape(i.shape),h),d=0,f=0===s||s>1||1===i.shape.length?1:r.sizeFromShape(i.shape.slice(1)),m=0;m<u.length;m++)for(var v=0;v<f;v++)p[d++]=1===u[m]?c[m]:l[m];return n.makeTensorInfo(i.shape,h,p)}},yV=v.SELU_SCALEALPHA,bV=v.SELU_SCALE,kV=AM(xv,(function(e){return e>=0?bV*e:yV*(Math.exp(e)-1)})),xV={kernelName:xv,backendName:"cpu",kernelFunc:kV},wV=AM(Iv,(function(e){return 1/(1+Math.exp(-e))})),CV={kernelName:Iv,backendName:"cpu",kernelFunc:wV},_V=AM(Sv,(function(e){return e<0?-1:e>0?1:0})),SV={kernelName:Sv,backendName:"cpu",kernelFunc:_V},IV=AM(Cv,(function(e){return Math.sin(e)})),TV={kernelName:Cv,backendName:"cpu",kernelFunc:IV},NV=AM(_v,(function(e){return Math.sinh(e)})),AV={kernelName:_v,backendName:"cpu",kernelFunc:NV},EV=Math.log(1.1920928955078125e-7)+2,RV=AM(Tv,(function(e){var t=e>-EV,n=e<EV,r=Math.exp(e);return n?r:t?e:Math.log(1+r)})),FV={kernelName:Tv,backendName:"cpu",kernelFunc:RV},DV={kernelName:Ev,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.blockShape,s=a.paddings;IM([i],"spaceToBatchND");var u=r.sizeFromShape(o),c=[[0,0]];c.push.apply(c,_toConsumableArray(s));for(var l=1+o.length;l<i.shape.length;++l)c.push([0,0]);var h=XB.kernelFunc({inputs:{x:i},backend:n,attrs:{paddings:c,constantValue:0}}),p=v.getReshaped(h.shape,o,u,!1),d=v.getPermuted(p.length,o.length,!1),f=v.getReshapedPermuted(h.shape,o,u,!1),m=iP({inputs:{x:h},backend:n,attrs:{shape:p}}),g=yP({inputs:{x:m},backend:n,attrs:{perm:d}}),y=iP({inputs:{x:g},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),y}},OV={kernelName:Pv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,i=t.sparseValues,o=t.defaultValue,s=r.outputShape,u=v.calculateShapes(i,a,s),c=u.sliceRank,l=u.numUpdates,h=u.sliceSize,p=u.strides,d=u.outputSize,f=mV(n.bufferSync(a),n.bufferSync(i),s,d,h,l,c,p,n.data.get(o.dataId).values[0],!1);return n.makeTensorInfo(s,f.dtype,f.values)}},MV={kernelName:Rv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.numOrSizeSplits,s=a.axis,u=r.parseAxisParam(s,i.shape)[0],c=v.prepareSplitSize(i,o,u),l=new Array(i.shape.length).fill(0),h=i.shape.slice();return c.map((function(e){var t=_toConsumableArray(h);t[u]=e;var r=HP({inputs:{x:i},backend:n,attrs:{begin:l,size:t}});return l[u]+=e,r}))}},PV=AM(Nv,(function(e){return Math.sqrt(e)})),LV={kernelName:Nv,backendName:"cpu",kernelFunc:PV},zV={kernelName:Ov,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n;IM(r,"square");for(var i=a.data.get(r.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},BV=LM((function(e,t){var n=e-t;return n*n})),VV=$M(Dv,BV),UV={kernelName:Dv,backendName:"cpu",kernelFunc:VV},WV=AM(Kv,(function(e,t){var n=t;return isNaN(e)?NaN:e>0?1:n.alpha})),GV={kernelName:Kv,backendName:"cpu",kernelFunc:WV};function HV(e,t,n,r){for(var a=Ky(e,t.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*n[u]+r[u];a.set.apply(a,[t.get.apply(t,s)].concat(_toConsumableArray(o)))}return a}var jV={kernelName:Lv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.end,s=r.strides,u=r.beginMask,c=r.endMask,l=r.ellipsisMask,p=r.newAxisMask,d=r.shrinkAxisMask;IM(a,"stridedSlice");var f,m=h.sliceInfo(a.shape,i,o,s,u,c,l,p,d),v=m.nonStrided,g=m.$begin,y=m.$strides,b=m.size,k=m.newShape,x=m.outShape,w=iP({inputs:{x:a},backend:n,attrs:{shape:k}});if(v){var C=HP({inputs:{x:w},backend:n,attrs:{begin:g,size:b}});f=iP({inputs:{x:C},backend:n,attrs:{shape:x}}),n.disposeIntermediateTensorInfo(C)}else if(x.some((function(e){return 0===e})))f=n.makeTensorInfo(x,a.dtype,[]);else{var _=HV(x,n.bufferSync(w),y,g);f=n.makeTensorInfo(_.shape,_.dtype,_.values)}var S=iP({inputs:{x:f},backend:n,attrs:{shape:x}});return n.disposeIntermediateTensorInfo(w),n.disposeIntermediateTensorInfo(f),S}},qV=AM(zv,(function(e){return Math.tan(e)})),KV={kernelName:zv,backendName:"cpu",kernelFunc:qV},XV=AM(Bv,(function(e){return Math.tanh(e)}));function YV(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];for(var a=Ky(n,e.dtype),i=0;i<a.values.length;++i){for(var o=a.indexToLoc(i),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=o[u]%e.shape[u];var c=e.locToIndex(s);a.values[i]=e.values[c]}return a}function ZV(e,t,n,a,i){for(var o=t[t.length-1],s=e.length/o,u=o,c=r.getTypedArrayFromDType(n,s*a),l=r.getTypedArrayFromDType("int32",s*a),h=0;h<s;h++){for(var p=h*u,d=e.subarray(p,p+u),f=[],m=0;m<d.length;m++)f.push({value:d[m],index:m});f.sort((function(e,t){return t.value-e.value}));for(var v=h*a,g=c.subarray(v,v+a),y=l.subarray(v,v+a),b=0;b<a;b++)g[b]=f[b].value,y[b]=f[b].index}var k=t.slice();return k[k.length-1]=a,[Ky(k,n,c),Ky(k,"int32",l)]}function QV(e,t,n,a){for(var i=r.parseAxisParam(t,n)[0],o=[1,n[0],1],s=0;s<i;s++)o[0]*=n[s];o[1]=n[i];for(var u=i+1;u<n.length;u++)o[2]*=n[u];for(var c={},l=new Int32Array(n[i]),h=new xg(o,a,e),p=[],d=1===o[0]&&1===o[2],f=0;f<n[i];f++){var m=void 0;if(d)m=e[f].toString();else{for(var v=[],g=0;g<o[0];g++)for(var y=0;y<o[2];y++)v.push(h.get(g,f,y));m=v.join(",")}if(void 0!==c[m])l[f]=c[m];else{var b=Object.keys(c).length;c[m]=b,l[f]=b,p.push(f)}}var k=o.slice();k[1]=Object.keys(c).length;var x=new xg(k,a);p.forEach((function(e,t){for(var n=0;n<o[0];n++)for(var r=0;r<o[2];r++)x.set(h.get(n,e,r),n,t,r)}));var w=n.slice();return w[i]=k[1],{outputValues:x.values,outputShape:w,indices:l}}for(var JV=0,$V=[cP,hP,dP,mP,aP,vP,kP,xP,wP,CP,SP,TP,AP,FP,OP,zP,BP,VP,UP,uP,WP,qP,YP,JM,$P,tL,KM,nL,oL,cL,lL,uL,pL,dL,hL,mL,gL,yL,bL,kL,xL,CL,_L,SL,IL,TL,AL,NL,nz,FM,EL,DL,UL,HL,qL,YL,cz,hz,pz,mz,yz,bz,kz,xz,Cz,Iz,Az,OM,Ez,aL,Fz,Oz,Pz,PM,Bz,Wz,Hz,Kz,Yz,Jz,eB,rB,aB,iB,hB,pB,dB,fB,mB,vB,uB,bB,kB,CB,_B,TB,EB,$L,FB,OB,PB,zB,UB,WB,jB,KB,XB,QB,VM,$B,tV,ZM,rV,WM,HM,oP,aV,iV,oV,sV,uV,cV,hV,fV,vV,gV,xV,CV,SV,TV,AV,jP,AB,FV,DV,OV,MV,LV,zV,UV,GV,jV,oz,yB,KV,{kernelName:Bv,backendName:"cpu",kernelFunc:XV},{kernelName:Vv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;IM(a,"tile");var o=YV(n.bufferSync(a),i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}},{kernelName:Uv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k;IM(a,"topk");var o=_slicedToArray(ZV(n.data.get(a.dataId).values,a.shape,a.dtype,i),2),s=o[0],u=o[1];return[n.makeTensorInfo(s.shape,s.dtype,s.values),n.makeTensorInfo(u.shape,u.dtype,u.values)]}},bP,{kernelName:Gv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;IM(i,"unique");var o=QV(r.data.get(i.dataId).values,a,i.shape,i.dtype),s=o.outputValues,u=o.outputShape,c=o.indices;return[r.makeTensorInfo(u,i.dtype,s),r.makeTensorInfo([c.length],"int32",c)]}},{kernelName:Hv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),c=0,l=0;l<o;l++)l!==i&&(u[c++]=a.shape[l]);var h=new Array(o).fill(0),p=a.shape.slice();p[i]=1;for(var d=new Array(s),f=0;f<d.length;f++){h[i]=f;var m=HP({inputs:{x:a},backend:n,attrs:{begin:h,size:p}});d[f]=iP({inputs:{x:m},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(m)}return d}},{kernelName:jv,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.segmentIds,s=a.numSegments;IM(i,"unsortedSegmentSum");for(var u=[],c=[],l=i.shape.length-o.shape.length,h=o,p=0;p<l;++p){var d=jL({inputs:{input:h},backend:n,attrs:{dim:p+1}});h=d,c.push(d)}for(var f=0;f<s;++f){var m=r.createScalarValue(f,"int32"),v=n.makeTensorInfo([],"int32",m),g=FL({inputs:{a:v,b:h},backend:n}),y=QM({inputs:{x:g},backend:n,attrs:{dtype:"float32"}}),b=JL({inputs:{a:y,b:i},backend:n}),k=gB({inputs:{x:b},backend:n,attrs:{axis:0,keepDims:!1}});u.push(k),c.push(v),c.push(g),c.push(y),c.push(b),c.push(k)}var x=qB({inputs:u,backend:n,attrs:{axis:0}});return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),x}},HB];JV<$V.length;JV++){ag($V[JV])}var eU,tU,nU,rU={},aU={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function iU(e){if(!(e in rU)){var t=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete rU[e]}),!1),1===e?t.getContext("webgl",aU)||t.getContext("experimental-webgl",aU):t.getContext("webgl2",aU)}(e);if(null===t)return console.log("Could not get context for WebGL version",e),null;rU[e]=t}var n=rU[e];return n.isContextLost()?(delete rU[e],iU(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),rU[e])}function oU(e,t){return[t,e]}function sU(e){var t=r.sizeFromShape(e),n=Math.ceil(t/4);return r.sizeToSquarishShape(n)}function uU(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function cU(e,t){var n,r,a,i,o,s,u,c,l,h=e;return 2===Jd().getNumber("WEBGL_VERSION")?(n=h.R32F,r=h.R16F,a=h.RGBA16F,i=h.RGBA32F,o=h.RED,s=4,u=1,c=h.HALF_FLOAT,l=h.FLOAT):(n=e.RGBA,r=e.RGBA,a=e.RGBA,i=h.RGBA,o=e.RGBA,s=4,u=4,c=null!=t?t.HALF_FLOAT_OES:null,l=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function lU(e,t){var n=t();return Jd().getBool("DEBUG")&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}(e,t))}(e),n}function hU(e){return!!(Jd().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function pU(e,t){return xU(e,(function(){return e.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(eU||(eU={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(tU||(tU={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(nU||(nU={}));var dU,fU,mU=/ERROR: [0-9]+:([0-9]+):/g;function vU(e,t){if(lU(e,(function(){return e.validateProgram(t)})),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function gU(e,t,n,r,a,i,o){var s=e.getAttribLocation(t,n);return-1!==s&&(lU(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),lU(e,(function(){return e.vertexAttribPointer(s,a,e.FLOAT,!1,i,o)})),lU(e,(function(){return e.enableVertexAttribArray(s)})),!0)}function yU(e,t,n){lU(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),lU(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}))}function bU(e,t){lU(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),lU(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function kU(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}(e,t))}function xU(e,t,n){var r=lU(e,(function(){return t()}));if(null==r)throw new Error(n);return r}function wU(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return r.sizeFromShape(e.slice(0,e.length-t))}function CU(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function _U(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[wU(e)].concat(_toConsumableArray(CU(e)))),t}function SU(e){return e%2==0}function IU(e,t){if(e=e.slice(-2),t=t.slice(-2),r.arraysEqual(e,t))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],a=t.slice(-1)[0];if(n===a)return!0;if(SU(n)&&SU(a)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&SU(e[0])&&SU(t[0])}function TU(e,t){return null!=e.getExtension(t)}function NU(e){try{if(null!=iU(e))return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function AU(e){var t=cU(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function EU(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&r.assert("complex64"!==e.dtype,(function(){return t+" does not support complex64 tensors in the WebGL backend."}))}))}var RU=Jd();function FU(){var e,t,n,r,a,i,o,s,u,c;return 2===Jd().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function DU(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",a=r.computeStrides(t);return a.map((function(t,r){return"int ".concat(e[r]," = ").concat(n," / ").concat(t,"; ").concat(r===a.length-1?"int ".concat(e[r+1]," = ").concat(n," - ").concat(e[r]," * ").concat(t):"index -= ".concat(e[r]," * ").concat(t),";")})).join("")}function OU(e){var t=r.computeStrides(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}RU.registerFlag("HAS_WEBGL",(function(){return RU.getNumber("WEBGL_VERSION")>0})),RU.registerFlag("WEBGL_VERSION",(function(){return NU(2)?2:NU(1)?1:0})),RU.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(function(){return!1})),RU.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===RU.get("WEBGL_VERSION")})),RU.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),RU.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),RU.registerFlag("WEBGL_PACK",(function(){return RU.getBool("HAS_WEBGL")})),RU.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return RU.getBool("WEBGL_PACK")})),RU.registerFlag("WEBGL_PACK_CLIP",(function(){return RU.getBool("WEBGL_PACK")})),RU.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),RU.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return RU.getBool("WEBGL_PACK")})),RU.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return RU.getBool("WEBGL_PACK")})),RU.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return RU.getBool("WEBGL_PACK")})),RU.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return RU.getBool("WEBGL_PACK")})),RU.registerFlag("WEBGL_PACK_REDUCE",(function(){return RU.getBool("WEBGL_PACK")})),RU.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return RU.getBool("WEBGL_PACK")})),RU.registerFlag("WEBGL_CONV_IM2COL",(function(){return RU.getBool("WEBGL_PACK")})),RU.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return function(e){if(null==dU){var t=iU(e);dU=t.getParameter(t.MAX_TEXTURE_SIZE)}return dU}(RU.getNumber("WEBGL_VERSION"))})),RU.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return function(e){if(null==fU){var t=iU(e);fU=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,fU)}(RU.getNumber("WEBGL_VERSION"))})),RU.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=RU.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;var t=iU(e);return TU(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:TU(t,"EXT_disjoint_timer_query")?1:0}(e)})),RU.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return RU.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!i.isMobile()})),RU.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return function(e){if(0===e)return!1;var t=iU(e);if(1===e){if(!TU(t,"OES_texture_float"))return!1}else if(!TU(t,"EXT_color_buffer_float"))return!1;return AU(t)}(RU.getNumber("WEBGL_VERSION"))})),RU.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!RU.getBool("WEBGL_FORCE_F16_TEXTURES")&&RU.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),RU.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return function(e){if(0===e)return!1;var t=iU(e);if(1!==e){if(TU(t,"EXT_color_buffer_float"))return AU(t);if(TU(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(e,t){var n=cU(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(a),i}(t,n)}return!1}return!!TU(t,"OES_texture_float")&&!!TU(t,"WEBGL_color_buffer_float")&&AU(t)}(RU.getNumber("WEBGL_VERSION"))})),RU.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return 2===(e=RU.getNumber("WEBGL_VERSION"))&&null!=iU(e).fenceSync;var e})),RU.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return RU.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),RU.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(function(){return-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ".concat(e,"."))}));var MU="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",PU=function e(t){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=eU.DENSE;var n=sU(t),r=FU();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(DU(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(").concat(n[0],", ").concat(n[1],"));\n        int index = 4 * (resTexRC.x * ").concat(n[1]," + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(r.output," = result;\n      }\n    ")},LU=function e(t){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=eU.DENSE;var n=sU(t),r=FU();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(DU(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(").concat(n[0],", ").concat(n[1],"));\n        int index = 4 * (resTexRC.x * ").concat(n[1]," + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(r.output," = result;\n      }\n    ")},zU=function e(t){_classCallCheck(this,e),this.variableNames=["A"],this.outTexUsage=tU.DOWNLOAD;var n=FU();this.outputShape=t,this.userCode="\n      ".concat(MU,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(n.output," = encode_float(x);\n      }\n    ")},BU=function e(t){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=tU.DOWNLOAD;var n=FU();this.outputShape=t,this.userCode="\n      ".concat(MU,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(n.output," = encode_float(x);\n      }\n    ")},VU=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck(this,e),this.variableNames=["A"];var a=FU(),i=_slicedToArray(n,2),o=i[0],s=i[1];this.outputShape=t;var u="result";r&&(u="floor(result * 255. + 0.5)"),this.userCode="\n      ".concat(OU(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / ").concat(s,";\n        int c = imod(flatIndex, ").concat(s,");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n        vec4 values = ").concat(a.texture2D,"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ").concat(a.output," = vec4(").concat(u,", 0., 0., 0.);\n      }\n    ")},UU=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var a=FU(),i=_slicedToArray(n,2),o=i[0],s=i[1];this.outputShape=t;var u="",c="result";r&&(c="floor(result * 255. + 0.5)");for(var l=0;l<=1;l++)for(var h=0;h<=1;h++){var p=2*l+h;u+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(h," < ").concat(t[2],") {\n            localCoords[2] += ").concat(h,";\n            if(localCoords[1] + ").concat(l," < ").concat(t[1],") {\n              localCoords[1] += ").concat(l,";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / ").concat(s,";\n              c = imod(flatIndex, ").concat(s,");\n              uv = (vec2(c, r) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n              values = ").concat(a.texture2D,"(A, uv);\n\n              if(offset == 0) {\n                result[").concat(p,"] = values[0];\n              } else if(offset == 1) {\n                result[").concat(p,"] = values[1];\n              } else if(offset == 2) {\n                result[").concat(p,"] = values[2];\n              } else {\n                result[").concat(p,"] = values[3];\n              }\n            }\n          }\n        ")}this.userCode="\n      ".concat(OU(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        ").concat(u,"\n\n        ").concat(a.output," = ").concat(c,";\n      }\n    ")};function WU(e,t,n,r,a,i){!function(e,t){var n=Jd().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0)throw new Error("Requested texture size [".concat(e,"x").concat(t,"] is invalid."));if(e>n||t>n)throw new Error("Requested texture size [".concat(e,"x").concat(t,"] greater than WebGL maximum on this browser / GPU [").concat(n,"x").concat(n,"]."))}(t,n);var o=function(e){return xU(e,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}(e),s=e.TEXTURE_2D;return lU(e,(function(){return e.bindTexture(s,o)})),lU(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),lU(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),lU(e,(function(){return e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST)})),lU(e,(function(){return e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST)})),lU(e,(function(){return e.texImage2D(s,0,r,t,n,0,a,i,null)})),lU(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),o}function GU(e){return e.internalFormatFloat}function HU(e){return e.internalFormatHalfFloat}function jU(e){return e.downloadTextureFormat}function qU(e){return e.internalFormatPackedFloat}function KU(e){return e.internalFormatPackedHalfFloat}var XU=function(){function e(t){_classCallCheck(this,e),this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var n=Jd().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,function(e,t){rU[e]=t}(n,t)):this.gl=iU(n);var r="WEBGL_color_buffer_float";if(1===Jd().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=pU(this.gl,"OES_texture_float"),TU(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=pU(this.gl,"OES_texture_half_float");else if(Jd().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),TU(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=pU(this.gl,"EXT_color_buffer_half_float");else if(Jd().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",TU(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!TU(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=function(e){return function(e,t){var n=xU(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return lU(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),lU(e,(function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}(this.gl),this.indexBuffer=function(e){return function(e,t){var n=xU(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return lU(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)})),lU(e,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Uint16Array([0,1,2,2,1,3]))}(this.gl),this.framebuffer=function(e){return xU(e,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=cU(this.gl,this.textureHalfFloatExtension)}var t;return _createClass(e,[{key:"dispose",value:function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;lU(t,(function(){return t.finish()})),lU(t,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),lU(t,(function(){return t.deleteFramebuffer(e.framebuffer)})),lU(t,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),lU(t,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),lU(t,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}}},{key:"createFloat32MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=_slicedToArray(oU(t,n),2);return WU(e,a[0],a[1],GU(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"createFloat16MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=_slicedToArray(oU(t,n),2);return WU(e,a[0],a[1],HU(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createUnsignedBytesMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=_slicedToArray(oU(t,n),2);return WU(e,a[0],a[1],jU(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}},{key:"uploadPixelDataToTexture",value:function(e,t){this.throwIfDisposed(),function(e,t,n){lU(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),n.data instanceof Uint8Array?lU(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)})):lU(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)})),lU(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t)}},{key:"uploadDenseMatrixToTexture",value:function(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,a,i){var o,s,u;lU(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),a instanceof Uint8Array?(o=new Uint8Array(n*r*4),s=e.UNSIGNED_BYTE,u=e.RGBA):(o=new Float32Array(n*r*4),s=e.FLOAT,u=i.internalFormatPackedFloat),o.set(a),lU(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,s,o)})),lU(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t,n,r,this.textureConfig)}},{key:"createFloat16PackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=_slicedToArray(uU(t,n),2);return WU(e,a[0],a[1],KU(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createPackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=_slicedToArray(uU(t,n),2);return WU(e,a[0],a[1],qU(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"deleteMatrixTexture",value:function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(bU(this.gl,this.framebuffer),this.outputTexture=null),lU(this.gl,(function(){return t.gl.deleteTexture(e)}))}},{key:"downloadByteEncodedFloatMatrixFromOutputTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n,r){var a=_slicedToArray(oU(t,n),2),i=a[0],o=a[1],s=new Uint8Array(t*n*4);return lU(e,(function(){return e.readPixels(0,0,i,o,r.downloadTextureFormat,e.UNSIGNED_BYTE,s)})),new Float32Array(s.buffer)}(r.gl,t,n,r.textureConfig)}))}},{key:"downloadPackedMatrixFromBuffer",value:function(e,t,n,r,a,i){return function(e,t,n,r,a,i,o,s){var u=e,c=new Float32Array(function(e,t){var n=_slicedToArray(uU(e,t),2);return n[0]*n[1]*4}(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}(this.gl,e,0,0,0,a,i)}},{key:"downloadFloat32MatrixFromBuffer",value:function(e,t){return function(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}(this.gl,e,t)}},{key:"createBufferFromTexture",value:function(e,t,n){this.bindTextureToFrameBuffer(e);var r=function(e,t,n,r){var a=e.createBuffer();lU(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var i=16*t*n;return lU(e,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)})),lU(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)})),lU(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}(this.gl,t,n);return this.unbindTextureToFrameBuffer(),r}},{key:"createAndWaitForFence",value:function(){var e=this.createFence(this.gl);return this.pollFence(e)}},{key:"createFence",value:function(e){var t,n,r=this;if(Jd().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=a.clientWaitSync(i,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=i}else Jd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,Jd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}}},{key:"downloadMatrixFromPackedTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n){var r=new Float32Array(t*n*4);return lU(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)})),r}(r.gl,t,n)}))}},{key:"createProgram",value:function(e){this.throwIfDisposed();var t=this.gl,n=function(e,t){var n=xU(e,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(lU(e,(function(){return e.shaderSource(n,t)})),lU(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw function(e,t){var n=mU.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var a=+n[1],i=e.split("\n"),o=i.length.toString().length+2,s=i.map((function(e,t){return r.rightPad((t+1).toString(),o)+e})),u=0,c=0;c<s.length;c++)u=Math.max(s[c].length,u);var l=s.slice(0,a-1),h=s.slice(a-1,a),p=s.slice(a);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+r.rightPad(h[0],u),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(p.join("\n"))}(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(t,e),a=function(e){var t=FU();return function(e,t){var n=xU(e,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(lU(e,(function(){return e.shaderSource(n,t)})),lU(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}(t),i=function(e){return xU(e,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}(t);return lU(t,(function(){return t.attachShader(i,a)})),lU(t,(function(){return t.attachShader(i,n)})),function(e,t){if(lU(e,(function(){return e.linkProgram(t)})),!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(t,i),this.debug&&vU(t,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=function(e,t,n){return lU(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),gU(e,t,"clipSpacePos",n,3,20,0)&&gU(e,t,"uv",n,2,20,12)}(t,this.program,this.vertexBuffer)),i}},{key:"deleteProgram",value:function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&lU(this.gl,(function(){return t.gl.deleteProgram(e)}))}},{key:"setProgram",value:function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&vU(this.gl,this.program),lU(this.gl,(function(){return t.gl.useProgram(e)}))}},{key:"getUniformLocation",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?function(e,t,n){return xU(e,(function(){return e.getUniformLocation(t,n)}),'uniform "'+n+'" not present in program.')}(this.gl,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}},{key:"getAttributeLocation",value:function(e,t){var n=this;return this.throwIfDisposed(),lU(this.gl,(function(){return n.gl.getAttribLocation(e,t)}))}},{key:"getUniformLocationNoThrow",value:function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}},{key:"setInputMatrixTexture",value:function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),function(e,t,n,r){lU(e,(function(){return function(e,t,n){(function(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE".concat(n,"]."))})(e,n),lU(e,(function(){return e.activeTexture(e.TEXTURE0+n)})),lU(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)}))}(e,t,r)})),lU(e,(function(){return e.uniform1i(n,r)}))}(this.gl,e,t,n)}},{key:"setOutputMatrixTexture",value:function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}},{key:"setOutputPackedMatrixTexture",value:function(e,t,n){this.throwIfDisposed();var r=_slicedToArray(uU(t,n),2),a=r[0],i=r[1];this.setOutputMatrixTextureDriver(e,a,i)}},{key:"setOutputMatrixWriteRegion",value:function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}},{key:"setOutputPackedMatrixWriteRegion",value:function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}},{key:"debugValidate",value:function(){null!=this.program&&vU(this.gl,this.program),kU(this.gl)}},{key:"executeProgram",value:function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),lU(e,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))}},{key:"blockUntilAllProgramsCompleted",value:function(){var e=this;this.throwIfDisposed(),lU(this.gl,(function(){return e.gl.finish()}))}},{key:"getQueryTimerExtension",value:function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=pU(this.gl,2===Jd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}},{key:"getQueryTimerExtensionWebGL2",value:function(){return this.getQueryTimerExtension()}},{key:"getQueryTimerExtensionWebGL1",value:function(){return this.getQueryTimerExtension()}},{key:"beginQuery",value:function(){if(2===Jd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),a=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,a),a}},{key:"endQuery",value:function(){if(2!==Jd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}}},{key:"waitForQueryAndGetTime",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.repeatedTry((function(){return n.disposed||n.isQueryAvailable(t,Jd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}));case 2:return e.abrupt("return",this.getQueryTime(t,Jd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getQueryTime",value:function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}},{key:"isQueryAvailable",value:function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}var i=this.getQueryTimerExtensionWebGL1(),o=i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}},{key:"pollFence",value:function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))}},{key:"pollItems",value:function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}},{key:"addItemToPoll",value:function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||r.repeatedTry((function(){return n.pollItems(),0===n.itemsToPoll.length}))}},{key:"bindTextureToFrameBuffer",value:function(e){this.throwIfDisposed(),yU(this.gl,e,this.framebuffer),this.debug&&kU(this.gl)}},{key:"unbindTextureToFrameBuffer",value:function(){null!=this.outputTexture?(yU(this.gl,this.outputTexture,this.framebuffer),this.debug&&kU(this.gl)):bU(this.gl,this.framebuffer)}},{key:"downloadMatrixDriver",value:function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n}},{key:"setOutputMatrixTextureDriver",value:function(e,t,n){this.throwIfDisposed();var r=this.gl;yU(r,e,this.framebuffer),this.debug&&kU(r),this.outputTexture=e,lU(r,(function(){return r.viewport(0,0,t,n)})),lU(r,(function(){return r.scissor(0,0,t,n)}))}},{key:"setOutputMatrixWriteRegionDriver",value:function(e,t,n,r){var a=this;this.throwIfDisposed(),lU(this.gl,(function(){return a.gl.scissor(e,t,n,r)}))}},{key:"throwIfDisposed",value:function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}},{key:"throwIfNoProgram",value:function(){if(null==this.program)throw new Error("No GPU program is currently set.")}},{key:"debug",get:function(){return Jd().getBool("DEBUG")}}]),e}(),YU=v.getBroadcastDims,ZU="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",QU="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",JU="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",$U="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function eW(e){return"offset"+e}function tW(e){var t=e.name,n=r.sizeFromShape(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function nW(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function rW(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function aW(e,t){return t.map((function(t){return e[t]})).join(", ")}function iW(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but was executed with ").concat(t.length," inputs"));e.forEach((function(e,n){var a=e.logicalShape,i=t[n],o=i.shape;if(!r.arraysEqual(a,o))throw Error("Binary was compiled with different shapes than the current args. Shapes ".concat(a," and ").concat(o," must match"));if(!e.isUniform||!i.isUniform){var s=e.texShape,u=i.isUniform?null:i.texData.texShape;if(!r.arraysEqual(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape ".concat(s," and ").concat(u," must match"))}}))}var oW=L.addImpl,sW=L.bincountImpl,uW=L.bincountReduceImpl,cW=L.ceilImpl,lW=L.expImpl,hW=L.expm1Impl,pW=L.floorImpl,dW=L.gatherV2Impl,fW=L.greaterImpl,mW=L.lessImpl,vW=L.linSpaceImpl,gW=L.logImpl,yW=L.maxImpl,bW=L.maximumImpl,kW=L.minimumImpl,xW=L.multiplyImpl,wW=L.negImpl,CW=L.prodImpl,_W=L.rangeImpl,SW=L.rsqrtImpl,IW=L.simpleAbsImpl,TW=L.sliceImpl,NW=L.stridedSliceImpl,AW=L.subImpl,EW=L.tileImpl,RW=L.topKImpl,FW=L.transposeImpl,DW=L.uniqueImpl;function OW(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return"".concat(e,".").concat(t)}))}function MW(e,t){return 1===t?[e]:OW(e,t)}var PW=function e(t){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;var n=t.length;if(0===n)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var r=MW("rc",n),a=nW(n),i=function(e,t,n){if(1===e)return"rc > "+t[0];for(var r="",a=e-2;a<e;a++)r+="".concat(n[a]," >= ").concat(t[a]),a<e-1&&(r+="||");return r}(n,t,r),o=function(e,t,n,r){if(1===e)return"";var a=r.slice(-2);return"\n    int r = ".concat(a[0],";\n    int c = ").concat(a[1],";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= ").concat(t,";\n    bool rEdge = rp1 >= ").concat(n,";\n  ")}(n,t[t.length-1],t[t.length-2],r),s=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var a=0;a<=1;a++){for(var i="".concat(0===r?"r":"rp1",", ").concat(0===a?"c":"cp1"),o=2;o<e;o++)i=t[t.length-1-o]+","+i;n.push(i)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= ".concat(e[0]," ? 0. : getA(rc + 1),\n            0, 0"):"getA(".concat(r[0],"),\n          cEdge ? 0. : getA(").concat(r[1],"),\n          rEdge ? 0. : getA(").concat(r[2],"),\n          rEdge || cEdge ? 0. : getA(").concat(r[3],")")}(t,r);this.userCode="\n        void main() {\n          ".concat(a," rc = getOutputCoords();\n\n          if(").concat(i,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(o,"\n\n            setOutput(vec4(").concat(s,"));\n          }\n        }\n      ")}},LW=function e(t,n){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var r,a="",i=0;i<4;i++){var o="thisRC = rc;";i%2==1&&(o+="thisRC.z += 1;"),i>1&&(o+="thisRC.y += 1;"),a+="\n        ".concat(o,"\n        ").concat(i>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(i,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(i>0?"}":"","\n      ")}this.userCode="\n      ".concat((r=n,"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(DU(["r","c","d"],r),"\n      return ivec3(r, c, d);\n    }\n  ")),"\n      ").concat(OU(t),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(t[1],";\n        int cols = ").concat(t[2],";\n\n        ").concat(a,"\n\n        setOutput(result);\n      }\n    ")},zW=function(){function e(t){_classCallCheck(this,e),this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return _createClass(e,[{key:"acquireTexture",value:function(e,t,n){var r=VW(t,n),a=UW(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);var i,o=BW(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return r===nU.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===nU.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===nU.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===nU.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===nU.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),i}},{key:"releaseTexture",value:function(e,t,n,r){if(null!=this.freeTextures){var a=VW(n,r),i=UW(t,a,r);i in this.freeTextures||(this.freeTextures[i]=[]);var o=BW(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),s=Jd().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==s&&this._numBytesAllocated>s?(this.gpgpu.deleteMatrixTexture(e),this._numBytesAllocated-=o):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;var u=this.usedTextures[i],c=u.indexOf(e);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u.splice(c,1),this.log()}}},{key:"log",value:function(){if(this.logEnabled){console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(this.numFreeTextures+this.numUsedTextures,")"));var e=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: "+this._numBytesAllocated),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*e),"%)"))}}},{key:"getNumUsedTextures",value:function(){return this.numUsedTextures}},{key:"getNumFreeTextures",value:function(){return this.numFreeTextures}},{key:"dispose",value:function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));for(var n in this.usedTextures)this.usedTextures[n].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}},{key:"numBytesAllocated",get:function(){return this._numBytesAllocated}},{key:"numBytesFree",get:function(){return this._numBytesFree}}]),e}();function BW(e,t,n,r,a){var i,o=function(e,t){switch(e){case nU.PACKED_2X2_FLOAT32:return qU(t);case nU.PACKED_2X2_FLOAT16:return KU(t);case nU.UNPACKED_FLOAT32:return GU(t);case nU.UNPACKED_FLOAT16:return HU(t);case nU.PACKED_4X1_UNSIGNED_BYTE:return jU(t);default:throw new Error("Unknown physical texture type "+e)}}(t,r);if(a){var s=_slicedToArray(uU(e[0],e[1]),2);i=s[0]*s[1]}else{var u=_slicedToArray(oU(e[0],e[1]),2);i=u[0]*u[1]}return i*function(e,t){if(t===e.R32F)return 4;if(t===e.R16F)return 2;if(t===e.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===e.RGBA16F)return 8;throw new Error("Unknown internal format "+t)}(n,o)}function VW(e,t){if(e===tU.UPLOAD)return nU.PACKED_2X2_FLOAT32;if(e===tU.RENDER||null==e)return function(e){return Jd().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?nU.PACKED_2X2_FLOAT32:nU.UNPACKED_FLOAT32:e?nU.PACKED_2X2_FLOAT16:nU.UNPACKED_FLOAT16}(t);if(e===tU.DOWNLOAD||e===tU.PIXELS)return nU.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function UW(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}var WW=function e(t,n){_classCallCheck(this,e),this.variableNames=["A"],this.outputShape=t,this.userCode="\n      float unaryOperation(float x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")},GW="return abs(x);",HW="return x;",jW=function e(t,n){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")},qW=function e(t){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;var n=t.length,r=MW("rc",n),a=nW(n),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(n,r),o=r.slice(-2),s=n<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode="\n      void main() {\n        ".concat(a," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(i,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")},KW=g.whereImpl,XW={},YW=function(e){_inherits(o,e);var t,n,a,i=_createSuper(o);function o(e){var t,n;if(_classCallCheck(this,o),(t=i.call(this)).pendingRead=new WeakMap,t.pendingDisposal=new WeakSet,t.dataRefCount=new WeakMap,t.numBytesInGPU=0,t.uploadWaitMs=0,t.downloadWaitMs=0,t.warnedAboutMemory=!1,t.warnedAboutCPUBackend=!1,t.pendingDeletes=0,t.disposed=!1,!Jd().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var r=iU(Jd().getNumber("WEBGL_VERSION"));t.binaryCache=((n=Jd().getNumber("WEBGL_VERSION"))in XW||(XW[n]={}),XW[n]),t.gpgpu=new XU(r),t.canvas=r.canvas,t.gpgpuCreatedLocally=!0}else t.gpgpu=e,t.binaryCache={},t.gpgpuCreatedLocally=!1,t.canvas=e.gl.canvas;return t.textureManager=new zW(t.gpgpu),t.numMBBeforeWarning=null==Jd().global.screen?1024:Jd().global.screen.height*Jd().global.screen.width*window.devicePixelRatio*600/1024/1024,t.texData=new rd(_assertThisInitialized(t),hk()),_possibleConstructorReturn(t)}return _createClass(o,[{key:"numDataIds",value:function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes}},{key:"write",value:function(e,t,n){if((Jd().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Jd().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:tU.UPLOAD,refCount:1,complexParentRefCount:0}),r}},{key:"incRef",value:function(e){this.texData.get(e).refCount++}},{key:"decRef",value:function(e){this.texData.has(e)&&this.texData.get(e).refCount--}},{key:"move",value:function(e,t,n,r){if(Jd().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:tU.UPLOAD,refCount:1,complexParentRefCount:0})}},{key:"disposeIntermediateTensorInfo",value:function(e){var t=e.dataId;if(this.texData.has(t)){var n=this.texData.get(t);n.refCount--,n.refCount<1&&this.disposeData(t)}}},{key:"readSync",value:function(e){var t=this.texData.get(e),n=t.values,a=t.dtype,i=t.complexTensorInfos,o=t.slice,s=t.shape,u=t.isPacked;if(null!=o){var c;c=u?new jW(s,HW):new WW(s,HW);var l=this.runWebGLProgram(c,[{dataId:e,shape:s,dtype:a}],a),h=this.readSync(l.dataId);return this.disposeIntermediateTensorInfo(l),h}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===a)return n;var p,d,f=null!=this.activeTimers;if(f&&(p=r.now()),"complex64"===a){var m=this.readSync(i.real.dataId),g=this.readSync(i.imag.dataId);d=v.mergeRealAndImagArrays(m,g)}else d=this.getValuesFromTexture(e);return f&&(this.downloadWaitMs+=r.now()-p),this.convertAndCacheOnCPU(e,d)}},{key:"read",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,a,i,o,s,u,c,l,h,p,d,f,m,g,y,b,k,x,w,C;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pendingRead.has(t)){e.next=3;break}return n=this.pendingRead.get(t),e.abrupt("return",new Promise((function(e){return n.push(e)})));case 3:if(a=this.texData.get(t),i=a.values,o=a.shape,s=a.slice,u=a.dtype,c=a.complexTensorInfos,l=a.isPacked,null==s){e.next=8;break}return h=l?new jW(o,HW):new WW(o,HW),p=this.runWebGLProgram(h,[{dataId:t,shape:o,dtype:u}],u),d=this.read(p.dataId),e.abrupt("return",(this.disposeIntermediateTensorInfo(p),d));case 8:if(null==i){e.next=10;break}return e.abrupt("return",this.convertAndCacheOnCPU(t));case 10:if(Jd().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")||2!==Jd().getNumber("WEBGL_VERSION")){e.next=12;break}throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");case 12:if(g=null,"complex64"!==u&&Jd().get("WEBGL_BUFFER_SUPPORTED")&&(f=this.decode(t),b=this.texData.get(f.dataId),g=(y=this.gpgpu).createBufferFromTexture.apply(y,[b.texture].concat(_toConsumableArray(sU(o))))),this.pendingRead.set(t,[]),e.t0="complex64"!==u,!e.t0){e.next=19;break}return e.next=19,this.gpgpu.createAndWaitForFence();case 19:if("complex64"!==u){e.next=26;break}return e.next=22,Promise.all([this.read(c.real.dataId),this.read(c.imag.dataId)]);case 22:k=e.sent,m=v.mergeRealAndImagArrays(k[0],k[1]),e.next=27;break;case 26:null==g?m=this.getValuesFromTexture(t):(x=r.sizeFromShape(o),m=this.gpgpu.downloadFloat32MatrixFromBuffer(g,x));case 27:return null!=f&&this.disposeIntermediateTensorInfo(f),w=this.convertAndCacheOnCPU(t,m),C=this.pendingRead.get(t),e.abrupt("return",(this.pendingRead.delete(t),C.forEach((function(e){return e(w)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),w));case 30:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map((function(e){return r.decodeString(e)}))}catch(a){throw new Error("Failed to decode encoded string bytes into utf-8")}return Ky(e.shape,e.dtype,n)}},{key:"checkNumericalProblems",value:function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!hU(n)){if(Jd().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value ".concat(n," cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"));throw Error("The value ".concat(n," cannot be represented on this device."))}}}},{key:"getValuesFromTexture",value:function(e){var t=this.texData.get(e),n=t.shape,a=t.dtype,i=t.isPacked,o=r.sizeFromShape(n);if(Jd().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s,u=this.decode(e),c=this.texData.get(u.dataId),l=(s=this.gpgpu).downloadMatrixFromPackedTexture.apply(s,[c.texture].concat(_toConsumableArray(sU(n)))).subarray(0,o);return this.disposeIntermediateTensorInfo(u),l}var h=Jd().getBool("WEBGL_PACK")&&!0===i,p=h?_U(n):n,d=h?new BU(p):new zU(p),f=this.runWebGLProgram(d,[{shape:p,dtype:a,dataId:e}],"float32"),m=this.texData.get(f.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture,m.texShape[0],m.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(f),v}},{key:"time",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,a,i,o,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.activeTimers,a=[],i=!1,null==this.programTimersStack?(this.programTimersStack=a,i=!0):this.activeTimers.push(a),this.activeTimers=a,t(),o=r.flatten(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),s=r.flatten(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e})),this.activeTimers=n,i&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},!(Jd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=13;break}return e.next=9,Promise.all(o);case 9:c=e.sent,u.kernelMs=r.sum(c),u.getExtraProfileInfo=function(){return c.map((function(e,t){return{name:s[t],ms:e}})).map((function(e){return"".concat(e.name,": ").concat(e.ms)})).join(", ")},e.next=14;break;case 13:u.kernelMs={error:"WebGL query timers are not supported in this environment."};case 14:return e.abrupt("return",(this.uploadWaitMs=0,this.downloadWaitMs=0,u));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"memory",value:function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}},{key:"startTimer",value:function(){return Jd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:r.now(),endMs:null}}},{key:"endTimer",value:function(e){return Jd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=r.now(),e)}},{key:"getQueryTime",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Jd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.waitForQueryAndGetTime(t):t.endMs-t.startMs);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"disposeData",value:function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e))if(this.texData.get(e).complexParentRefCount>0)this.texData.get(e).refCount--;else{this.releaseGPUData(e);var t=this.texData.get(e).complexTensorInfos;null!=t&&(this.texData.get(t.real.dataId).complexParentRefCount--,this.disposeIntermediateTensorInfo(t.real),this.texData.get(t.imag.dataId).complexParentRefCount--,this.disposeIntermediateTensorInfo(t.imag)),this.texData.delete(e)}}}},{key:"releaseGPUData",value:function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,i=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,i,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}},{key:"getTexture",value:function(e){return this.uploadToGPU(e),this.texData.get(e).texture}},{key:"getDataInfo",value:function(e){return this.texData.get(e)}},{key:"getCPUBackend",value:function(){return Jd().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=hk().findBackend("cpu")),this.cpuBackend):null}},{key:"shouldExecuteOnCPU",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:128,a=this.getCPUBackend();return Jd().getBool("IS_TEST")||this.warnedAboutCPUBackend||null!=a||(console.warn("Your application contains ops that are small enough to be executed on the CPU backend, however the CPU backend cannot be found. Consider importing the CPU backend (@tensorflow/tfjs-backend-cpu) for better performance."),this.warnedAboutCPUBackend=!0),null!=a&&e.every((function(e){return null==t.texData.get(e.dataId).texture&&r.sizeFromShape(e.shape)<n}))}},{key:"getGPGPUContext",value:function(){return this.gpgpu}},{key:"where",value:function(e){v.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return KW(e.shape,t)}},{key:"packedUnaryOp",value:function(e,t,n){var r=new jW(e.shape,t);return this.compileAndRun(r,[e],n)}},{key:"abs",value:function(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){var t=IW(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(Jd().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,GW,e.dtype);var n=new WW(e.shape,GW);return this.compileAndRun(n,[e])}},{key:"makeTensorInfo",value:function(e,t,n){var a;if("string"===t&&null!=n&&n.length>0&&r.isString(n[0])){var i=n.map((function(e){return r.encodeString(e)}));a=this.write(i,e,t)}else a=this.write(n,e,t);return this.texData.get(a).usage=null,{dataId:a,shape:e,dtype:t}}},{key:"makeOutput",value:function(e,t,n){var r=this.makeTensorInfo(e,t,n).dataId;return hk().makeTensorFromDataId(r,e,t,this)}},{key:"unpackTensor",value:function(e){var t=new qW(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}},{key:"packTensor",value:function(e){var t=new PW(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}},{key:"packedReshape",value:function(e,t){var n=[wU(e.shape)].concat(_toConsumableArray(CU(e.shape))),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[wU(t)].concat(_toConsumableArray(CU(t))),i=new LW(a,n),o=this.runWebGLProgram(i,[r],e.dtype,null,!0);return{dataId:o.dataId,shape:t,dtype:o.dtype}}},{key:"decode",value:function(e){var t,n=this.texData.get(e),r=n.isPacked,a=n.shape,i=n.dtype,o=_U(a);return t=r?new LU(o):new PU(o),{dtype:i,shape:a,dataId:this.runWebGLProgram(t,[{shape:o,dtype:i,dataId:e}],i,null,!0).dataId}}},{key:"runWebGLProgram",value:function(e,t,n,a){var i=this,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=this.makeTensorInfo(e.outputShape,n),u=this.texData.get(s.dataId);if(e.packedOutput&&(u.isPacked=!0),e.outPackingScheme===eU.DENSE){var c=sU(e.outputShape);u.texShape=c.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(u.usage=e.outTexUsage),0===r.sizeFromShape(s.shape))return u.values=r.getTypedArrayFromDType(s.dtype,0),s;var l=[],h=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=i.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&r.sizeFromShape(t.shape)<=Jd().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?i.unpackTensor(t):i.packTensor(t),l.push(t),n=i.texData.get(t.dataId);else if(n.isPacked&&!IU(n.shape,t.shape)){var a=t,o=t.shape;t.shape=n.shape,t=i.packedReshape(t,o),l.push(t),n=i.texData.get(t.dataId),a.shape=o}return i.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(s.dataId);var p,d={shape:s.shape,texData:u,isUniform:!1},f=function(e,t,n){var r="";t.concat(n).forEach((function(e){r+="".concat(e.shape,"_").concat(e.isUniform?"uniform":e.texData.texShape,"_").concat(null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0)}));var a=e.constructor.name;return a+="_"+r+"_"+e.userCode}(e,h,d),m=this.getAndSaveBinary(f,(function(){return function(e,t,n,a){var i=t.userCode,o=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),s=o.map((function(e){return e.shapeInfo})),u={logicalShape:a.shape,texShape:a.texData.texShape,isUniform:!1,isPacked:a.texData.isPacked,flatOffset:null},c=function(e,t,n,a){var i=[];e.forEach((function(e){var t=r.sizeFromShape(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?i.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(i.push("uniform sampler2D ".concat(e.name,";")),i.push("uniform int offset".concat(e.name,";")))}));var o,s,u=i.join("\n"),c=e.map((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a="";return a+=n?function e(t){switch(t.shapeInfo.logicalShape.length){case 0:return n=t.name,"\n    vec4 ".concat("get"+n.charAt(0).toUpperCase()+n.slice(1),"() {\n      return ").concat(FU().texture2D,"(").concat(n,", halfCR);\n    }\n  ");case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,a=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=FU();return"\n    vec4 ".concat(n,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(a[0],", ").concat(a[1],", index);\n      return ").concat(i.texture2D,"(").concat(t,", uv);\n    }\n  ")}(t);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape,o=i[0],s=i[1],u=FU();if(null!=i&&r.arraysEqual(t,i))return"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n\n        return ").concat(u.texture2D,"(").concat(n,", uv);\n      }\n    ");var c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return"\n    vec4 ".concat(a,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(Math.ceil(t[1]/2),", ").concat(c[0],", ").concat(c[1],", row, col);\n      return ").concat(u.texture2D,"(").concat(n,", uv);\n    }\n  ")}(t);case 3:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){var s=rW(t,n.slice(1));return"\n        ".concat(e(s),"\n        vec4 ").concat(a,"(int b, int row, int col) {\n          return ").concat(a,"(").concat(aW(["b","row","col"],[1,2]),");\n        }\n      ")}var u=o[0],c=o[1],l=Math.ceil(n[2]/2);return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(u,", ").concat(c,", ").concat(l*Math.ceil(n[1]/2),", ").concat(l,", b, row, col);\n      return ").concat(FU().texture2D,"(").concat(r,", uv);\n    }\n  ")}(t);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],s=o[0],u=o[1],c=Math.ceil(t[n-1]/2),l=c*Math.ceil(t[n-2]/2),h="int b, int row, int col",p="b * ".concat(l," + (row / 2) * ").concat(c," + (col / 2)"),d=2;d<n-1;d++)h="int b".concat(d,", ")+h,l*=t[n-d-1],p="b".concat(d," * ").concat(l," + ")+p;return"\n    vec4 ".concat(a,"(").concat(h,") {\n      int index = ").concat(p,";\n      int texR = index / ").concat(u,";\n      int texC = index - texR * ").concat(u,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(u,", ").concat(s,");\n      return ").concat(FU().texture2D,"(").concat(r,", uv);\n    }\n  ")}(t)}var n}(e):function e(t){var n=t.shapeInfo.logicalShape;switch(n.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(n,"() {return ").concat(t,";}");var r=_slicedToArray(e.shapeInfo.texShape,2),a=r[0],i=r[1];if(1===a&&1===i)return"\n      float ".concat(n,"() {\n        return sampleTexture(").concat(t,", halfCR);\n      }\n    ");var o=_slicedToArray(e.shapeInfo.texShape,2),s=o[0],u=o[1];return"\n    float ".concat(n,"() {\n      vec2 uv = uvFromFlat(").concat(s,", ").concat(u,", ").concat(eW(t),");\n      return sampleTexture(").concat(t,", uv);\n    }\n  ")}(t);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(n,"(int index) {\n        ").concat(tW(e),"\n      }\n    ");var r=e.shapeInfo.texShape,a=r[0],i=r[1];if(1===i&&1===a)return"\n      float ".concat(n,"(int index) {\n        return sampleTexture(").concat(t,", halfCR);\n      }\n    ");var o=eW(t);return 1===i?"\n      float ".concat(n,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(o,") + 0.5) / ").concat(a,".0);\n        return sampleTexture(").concat(t,", uv);\n      }\n    "):1===a?"\n      float ".concat(n,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(o,") + 0.5) / ").concat(i,".0, 0.5);\n        return sampleTexture(").concat(t,", uv);\n      }\n    "):"\n    float ".concat(n,"(int index) {\n      vec2 uv = uvFromFlat(").concat(a,", ").concat(i,", index + ").concat(o,");\n      return sampleTexture(").concat(t,", uv);\n    }\n  ")}(t);case 2:return function(t){var n=t.shapeInfo.logicalShape,a=t.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=t.shapeInfo.texShape;if(null!=o&&r.arraysEqual(n,o))return"\n    float ".concat(i,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(o[1],".0, ").concat(o[0],".0);\n      return sampleTexture(").concat(a,", uv);\n    }\n  ");var s=r.squeezeShape(n),u=s.newShape,c=s.keptDims;if(u.length<n.length){var l=rW(t,u);return"\n      ".concat(e(l),"\n      float ").concat(i,"(int row, int col) {\n        return ").concat(i,"(").concat(aW(["row","col"],c),");\n      }\n    ")}if(t.shapeInfo.isUniform)return"\n      float ".concat(i,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(n[1],", 1)));\n        ").concat(tW(t),"\n      }\n    ");var h=o[0],p=o[1],d=eW(a);return 1===p?"\n    float ".concat(i,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(d,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(h,".0);\n      return sampleTexture(").concat(a,", uv);\n    }\n  "):1===h?"\n    float ".concat(i,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(d,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(p,".0, 0.5);\n      return sampleTexture(").concat(a,", uv);\n    }\n  "):"\n  float ".concat(i,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(n[1]," + col + ").concat(d,";\n    vec2 uv = uvFromFlat(").concat(h,", ").concat(p,", index);\n    return sampleTexture(").concat(a,", uv);\n  }\n")}(t);case 3:return function(t){var n=t.shapeInfo.logicalShape,a=t.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=n[1]*n[2],s=n[2],u=r.squeezeShape(n),c=u.newShape,l=u.keptDims;if(c.length<n.length){var h=rW(t,c);return"\n        ".concat(e(h),"\n        float ").concat(i,"(int row, int col, int depth) {\n          return ").concat(i,"(").concat(aW(["row","col","depth"],l),");\n        }\n      ")}if(t.shapeInfo.isUniform)return"\n      float ".concat(i,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(o,", ").concat(s,", 1)));\n        ").concat(tW(t),"\n      }\n    ");var p=t.shapeInfo.texShape,d=p[0],f=p[1],m=t.shapeInfo.flatOffset;return f===o&&null==m?"\n        float ".concat(i,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(s,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(f,".0, ").concat(d,".0);\n          return sampleTexture(").concat(a,", uv);\n        }\n      "):f===s&&null==m?"\n    float ".concat(i,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(n[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(f,".0, ").concat(d,".0);\n      return sampleTexture(").concat(a,", uv);\n    }\n  "):"\n      float ".concat(i,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(o," + col * ").concat(s," + depth + ").concat(eW(a),";\n        vec2 uv = uvFromFlat(").concat(d,", ").concat(f,", index);\n        return sampleTexture(").concat(a,", uv);\n      }\n  ")}(t);case 4:return function(t){var n=t.shapeInfo.logicalShape,a=t.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=n[3],s=n[2]*o,u=n[1]*s,c=r.squeezeShape(n),l=c.newShape,h=c.keptDims;if(l.length<n.length){var p=rW(t,l);return"\n      ".concat(e(p),"\n      float ").concat(i,"(int row, int col, int depth, int depth2) {\n        return ").concat(i,"(").concat(aW(["row","col","depth","depth2"],h),");\n      }\n    ")}if(t.shapeInfo.isUniform)return"\n      float ".concat(i,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(u,", ").concat(s,", ").concat(o,", 1)));\n        ").concat(tW(t),"\n      }\n    ");var d=t.shapeInfo.flatOffset,f=t.shapeInfo.texShape,m=f[0],v=f[1];return v===u&&null==d?"\n      float ".concat(i,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(s,", ").concat(o,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):v===o&&null==d?"\n      float ".concat(i,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(n[1]*n[2],", ").concat(n[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):"\n    float ".concat(i,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(u," + col * ").concat(s," +\n          depth * ").concat(o," + depth2;\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(v,", index + ").concat(eW(a),");\n      return sampleTexture(").concat(a,", uv);\n    }\n  ")}(t);case 5:return function(t){var n=t.shapeInfo.logicalShape,a=t.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=n[4],s=n[3]*o,u=n[2]*s,c=n[1]*u,l=r.squeezeShape(n),h=l.newShape,p=l.keptDims;if(h.length<n.length){var d=rW(t,h);return"\n      ".concat(e(d),"\n      float ").concat(i,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(i,"(").concat(aW(["row","col","depth","depth2","depth3"],p),");\n      }\n    ")}if(t.shapeInfo.isUniform)return"\n      float ".concat(i,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(c,", ").concat(u,", ").concat(s,", ").concat(o,")) +\n          depth3;\n        ").concat(tW(t),"\n      }\n    ");var f=t.shapeInfo.flatOffset,m=t.shapeInfo.texShape,v=m[0],g=m[1];return g===c&&null==f?"\n      float ".concat(i,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(u,", ").concat(s,", ").concat(o,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(g,".0, ").concat(v,".0);\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):g===o&&null==f?"\n      float ".concat(i,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(n[1]*n[2]*n[3],",\n               ").concat(n[2]*n[3],", ").concat(n[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(g,".0, ").concat(v,".0);\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):"\n    float ".concat(i,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(c," + col * ").concat(u," + depth * ").concat(s," +\n          depth2 * ").concat(o," + depth3 + ").concat(eW(a),";\n      vec2 uv = uvFromFlat(").concat(v,", ").concat(g,", index);\n      return sampleTexture(").concat(a,", uv);\n    }\n  ")}(t);case 6:return function(t){var n=t.shapeInfo.logicalShape,a=t.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=r.squeezeShape(n),s=o.newShape,u=o.keptDims;if(s.length<n.length){var c=rW(t,s);return"\n      ".concat(e(c),"\n      float ").concat(i,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(i,"(").concat(aW(["row","col","depth","depth2","depth3","depth4"],u),");\n      }\n    ")}var l=n[5],h=n[4]*l,p=n[3]*h,d=n[2]*p,f=n[1]*d;if(t.shapeInfo.isUniform)return"\n      float ".concat(i,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(f,", ").concat(d,", ").concat(p,", ").concat(h,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(l,", 1)));\n        ").concat(tW(t),"\n      }\n    ");var m=t.shapeInfo.flatOffset,v=t.shapeInfo.texShape,g=v[0],y=v[1];return y===f&&null==m?"\n      float ".concat(i,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(d,", ").concat(p,", ").concat(h,", ").concat(l,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(y,".0, ").concat(g,".0);\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):y===l&&null==m?"\n      float ".concat(i,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(n[1]*n[2]*n[3]*n[4],",\n               ").concat(n[2]*n[3]*n[4],",\n               ").concat(n[3]*n[4],",\n               ").concat(n[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(y,".0, ").concat(g,".0);\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):"\n    float ".concat(i,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(f," + col * ").concat(d," + depth * ").concat(p," +\n          depth2 * ").concat(h," + depth3 * ").concat(l," + depth4 + ").concat(eW(a),";\n      vec2 uv = uvFromFlat(").concat(g,", ").concat(y,", index);\n      return sampleTexture(").concat(a,", uv);\n    }\n  ")}(t);default:throw new Error(n.length+"-D input sampling is not yet supported")}}(e),e.shapeInfo.logicalShape.length<=t.logicalShape.length&&(a+=n?function(e,t){var n,a=e.name,i=a.charAt(0).toUpperCase()+a.slice(1),o="get"+i+"AtOutCoords",s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length,c=YU(e.shapeInfo.logicalShape,t.logicalShape),l=nW(u),h=u-s,p=["x","y","z","w","u","v"];n=0===s?"":u<2&&c.length>=1?"coords = 0;":c.map((function(e){return"coords.".concat(p[e+h]," = 0;")})).join("\n");var d;d=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+p[t+h]})).join(", ");var f="return outputValue;",m=1===r.sizeFromShape(e.shapeInfo.logicalShape),v=1===r.sizeFromShape(t.logicalShape);if(1!==s||m||v){if(m&&!v)f=1===u?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(c.length){var g=s-2,y=s-1;c.indexOf(g)>-1&&c.indexOf(y)>-1?f="return vec4(outputValue.x);":c.indexOf(g)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":c.indexOf(y)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}}else f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(o,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(n,"\n      vec4 outputValue = get").concat(i,"(").concat(d,");\n      ").concat(f,"\n    }\n  ")}(e,t):function(e,t){var n=e.name,a=n.charAt(0).toUpperCase()+n.slice(1),i="get"+a+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length;if(!e.shapeInfo.isUniform&&o===s&&null==e.shapeInfo.flatOffset&&r.arraysEqual(e.shapeInfo.texShape,t.texShape))return"\n      float ".concat(i,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");var u,c=nW(s),l=YU(e.shapeInfo.logicalShape,t.logicalShape),h=s-o,p=["x","y","z","w","u","v"];u=0===o?"":s<2&&l.length>=1?"coords = 0;":l.map((function(e){return"coords.".concat(p[e+h]," = 0;")})).join("\n");var d;return d=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+p[t+h]})).join(", "),"\n    float ".concat(i,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(u,"\n      return get").concat(a,"(").concat(d,");\n    }\n  ")}(e,t)),a}(e,t,a)})).join("\n"),l=t.texShape,h=FU(),p=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(h),d=function(e){return"".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(ZU,"\n    ").concat(QU,"\n    ").concat(JU,"\n  ")}(h);return t.isPacked?(o=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return n=t,1===(a=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)])[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(a[1],".0);\n      }\n    "):1===a[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(a[0],".0);\n      }\n    "):"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(a[0],", ").concat(a[1],"));\n      return 2 * (resTexRC.x * ").concat(a[1]," + resTexRC.y);\n    }\n  ");case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(r.arraysEqual(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(n[0],", ").concat(n[1],"));\n      }\n    ");var a=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[2]/2),a=r*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n\n      int b = index / ").concat(a,";\n      index -= b * ").concat(a,";\n\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t);default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),a=r*Math.ceil(e[e.length-2]/2),i=a,o="",s="b, r, c",u=2;u<e.length-1;u++)i*=e[e.length-u-1],o="\n      int b".concat(u," = index / ").concat(i,";\n      index -= b").concat(u," * ").concat(i,";\n    ")+o,s="b".concat(u,", ")+s;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(n[0],", ").concat(n[1],"));\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n\n      ").concat(o,"\n\n      int b = index / ").concat(a,";\n      index -= b * ").concat(a,";\n\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec").concat(e.length,"(").concat(s,");\n    }\n  ")}(e,t)}var n,a}(t.logicalShape,l),s=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(h)):(o=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return 1===(n=t)[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(n[1],".0);\n      }\n    "):1===n[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(n[0],".0);\n      }\n    "):"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n      return resTexRC.x * ").concat(n[1]," + resTexRC.y;\n    }\n  ");case 2:return function(e,t){return r.arraysEqual(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    "):1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    "):1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    "):"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=DU(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(n,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t);case 4:return function(e,t){var n=DU(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(n,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t);case 5:return function(e,t){var n=DU(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){var n=DU(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}var n}(t.logicalShape,l),s=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(h)),a&&(d+=$U),[d,p,s,u,o,c,n].join("\n")}(o,u,i,t.packedInputs),l=e.createProgram(c),h=null,p=e.getUniformLocation(l,"NAN",!1);1===Jd().getNumber("WEBGL_VERSION")&&(h=e.getUniformLocation(l,"INFINITY",!1));for(var d={},f=0;f<t.variableNames.length;f++){var m=t.variableNames[f];d[m]=e.getUniformLocation(l,m,!1),d["offset"+m]=e.getUniformLocation(l,"offset"+m,!1)}return{program:t,source:c,webGLProgram:l,uniformLocations:d,inShapeInfos:s,outShapeInfo:u,infLoc:h,nanLoc:p}}(i.gpgpu,e,h,d)})),v=null!=this.activeTimers;if(v&&(p=this.startTimer()),function(e,t,n,a,i){iW(t.inShapeInfos,n),iW([t.outShapeInfo],[a]);var o=a.texData.texture,s=a.texData.texShape;a.texData.isPacked?e.setOutputPackedMatrixTexture(o,s[0],s[1]):e.setOutputMatrixTexture(o,s[0],s[1]),e.setProgram(t.webGLProgram),1===Jd().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,a){var i=t.program.variableNames[a],o=t.uniformLocations[i],s=t.uniformLocations["offset"+i];if(null!=o)if(n.isUniform)if(r.sizeFromShape(n.shape)<2)e.gl.uniform1f(o,n.uniformValues[0]);else{var u=n.uniformValues;u instanceof Float32Array||(u=new Float32Array(u)),e.gl.uniform1fv(o,u)}else null!=n.texData.slice&&null!=s&&e.gl.uniform1i(s,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,o,a)})),null!=i&&i(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,m,h,d,a),l.forEach((function(e){return i.disposeIntermediateTensorInfo(e)})),v&&(p=this.endTimer(p),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(p)})),!Jd().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&!1===o){var g=this.unpackTensor(s);return this.disposeIntermediateTensorInfo(s),g}return s}},{key:"compileAndRun",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=this.runWebGLProgram(e,t,n=n||t[0].dtype,r,a);return hk().makeTensorFromDataId(i.dataId,i.shape,i.dtype)}},{key:"getAndSaveBinary",value:function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}},{key:"getTextureManager",value:function(){return this.textureManager}},{key:"dispose",value:function(){var e=this;this.disposed||(Jd().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}},{key:"floatPrecision",value:function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=fk((function(){if(!Jd().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=Jd().getBool("DEBUG");Jd().set("DEBUG",!1);var n=e.abs(Uk(1e-8)).dataSync()[0];if(Jd().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"uploadToGPU",value:function(e){var t=this.texData.get(e),n=t.shape,a=t.dtype,i=t.values,o=t.texture,s=t.usage,u=t.isPacked;if(null==o){var c,l=null!=this.activeTimers;l&&(c=r.now());var h=t.texShape;if(null==h&&(h=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Jd().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(n*=2,1===(e=e.map((function(t,n){return n>=e.length-2?r.nearestLargerEven(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length){var a=r.squeezeShape(e);e=a.newShape}var i=r.sizeFromShape(e);if(e.length<=1&&i<=n)return[1,i];if(2===e.length&&e[0]<=n&&e[1]<=n)return e;if(3===e.length&&e[0]*e[1]<=n&&e[2]<=n)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=n&&e[1]*e[2]<=n)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n)return[e[0],e[1]*e[2]*e[3]];if(t){var o,s=wU(e),u=2,c=2;return e.length&&(u=(o=_slicedToArray(CU(e),2))[0],c=o[1]),i=s*(u/2)*(c/2),r.sizeToSquarishShape(i).map((function(e){return 2*e}))}return r.sizeToSquarishShape(i)}(n,u),t.texShape=h),null!=i){var p,d,f=_U(n),m=h[1],v=h[0],g=i instanceof Uint8Array;u?(m=(p=_slicedToArray(uU(h[0],h[1]),2))[0],v=p[1],d=new UU(f,[v,m],g)):d=new VU(f,[v,m],g);var y=this.makeTensorInfo([v,m],a);this.texData.get(y.dataId).usage=g?tU.PIXELS:tU.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),m,v,i);var b=this.runWebGLProgram(d,[y],a,null,!0),k=this.texData.get(b.dataId);t.texture=k.texture,t.texShape=k.texShape,t.isPacked=k.isPacked,t.usage=k.usage,this.disposeIntermediateTensorInfo(y),this.texData.delete(b.dataId),t.values=null,l&&(this.uploadWaitMs+=r.now()-c)}else{var x=this.acquireTexture(h,s,a,u);t.texture=x}}}},{key:"convertAndCacheOnCPU",value:function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,r)),n.values}},{key:"acquireTexture",value:function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(a," MB, most likely due to a memory leak"))}return this.textureManager.acquireTexture(e,t,r)}},{key:"computeBytes",value:function(e,t){return e[0]*e[1]*r.bytesPerElement(t)}}]),o}(ad);i.isBrowser()&&_k("webgl",(function(){return new YW}),2);var ZW=function e(t,n,r){_classCallCheck(this,e),this.variableNames=["A","B"],this.outputShape=v.assertAndGetBroadcastShape(n,r),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")},QW=function e(t,n,a){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];_classCallCheck(this,e),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=v.assertAndGetBroadcastShape(n,a);var o=this.outputShape.length,s="";if(i)if(0===o||1===r.sizeFromShape(this.outputShape))s="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(s="\n          ".concat(nW(o)," coords = getOutputCoords();\n        "),1===o)s+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{var u=MW("coords",o);s+="\n            bool nextRowOutOfBounds =\n              (".concat(u[o-2]," + 1) >= ").concat(this.outputShape[o-2],";\n            bool nextColOutOfBounds =\n              (").concat(u[o-1]," + 1) >= ").concat(this.outputShape[o-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(s,"\n\n        setOutput(result);\n      }\n    ")};function JW(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var $W={kernelName:mm,backendName:"webgl",kernelFunc:JW};function eG(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(i.dataId),s=JW({inputs:{x:r},backend:n});n.texData.get(s.dataId).complexParentRefCount++;var u=JW({inputs:{x:a},backend:n});return n.texData.get(u.dataId).complexParentRefCount++,o.complexTensorInfos={real:s,imag:u},i}var tG={kernelName:Af,backendName:"webgl",kernelFunc:eG},nG="return (a < 0.) ? b * a : a;",rG="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",aG={kernelName:xm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.alpha,s=n.makeTensorInfo([],"float32",r.createScalarValue(o,"float32")),u=Jd().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new QW(rG,i.shape,s.shape):new ZW(nG,i.shape,s.shape),c=n.runWebGLProgram(u,[i,s],i.dtype);return n.disposeIntermediateTensorInfo(s),c}},iG="return (a < 0.) ? b * a : a;",oG="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",sG={kernelName:av,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,i=Jd().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new QW(oG,r.shape,a.shape):new ZW(iG,r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)}};function uG(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.cpuKernelImpl,a=e.dtype;return function(e){var i,o=e.inputs,s=e.backend,u=o.x,c=s,l=a||u.dtype;if(c.shouldExecuteOnCPU([u])&&null!=r){var h=c.texData.get(u.dataId),p=r(h.values,l);return c.makeTensorInfo(u.shape,l,p)}return i=Jd().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new jW(u.shape,n):new WW(u.shape,t),c.runWebGLProgram(i,[u],l)}}function cG(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.checkOutOfBounds,a=void 0!==r&&r,i=e.supportsComplex,o=void 0!==i&&i,s=e.cpuKernelImpl,u=e.dtype;return function(e){var r=e.inputs,i=e.backend,c=r.a,l=r.b,h=i;if(o&&"complex64"===c.dtype){var p=h.texData.get(c.dataId),d=h.texData.get(l.dataId),f=[[p.complexTensorInfos.real,d.complexTensorInfos.real],[p.complexTensorInfos.imag,d.complexTensorInfos.imag]].map((function(e){var n=_slicedToArray(e,2),r=n[0],a=n[1],i={dataId:r.dataId,dtype:r.dtype,shape:c.shape},o={dataId:a.dataId,dtype:a.dtype,shape:l.shape},s=new ZW(t,c.shape,l.shape);return h.runWebGLProgram(s,[i,o],Fg(r.dtype,a.dtype))})),m=_slicedToArray(f,2),v=m[0],g=m[1],y=eG({inputs:{real:v,imag:g},backend:h});return h.disposeIntermediateTensorInfo(v),h.disposeIntermediateTensorInfo(g),y}var b,k=u||Fg(c.dtype,l.dtype);if(h.shouldExecuteOnCPU([c,l])&&null!=s){var x=h.texData.get(c.dataId),w=h.texData.get(l.dataId),C=_slicedToArray(s(c.shape,l.shape,x.values,w.values,k),2),_=C[0],S=C[1],I=h.makeTensorInfo(S,k);return h.texData.get(I.dataId).values=_,I}return b=Jd().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new QW(n,c.shape,l.shape,a):new ZW(t,c.shape,l.shape),h.runWebGLProgram(b,[c,l],k)}}function lG(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return"return x;";if("relu"===e)return t?"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n";if("elu"===e)return t?"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n":"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===e)return t?"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n";if("prelu"===e)return t?oG:iG;if("leakyrelu"===e)return t?rG:nG;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}var hG=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];_classCallCheck(this,e),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;var l=Math.ceil((a?t[1]:t[2])/2),h=a?"i * 2, rc.y":"rc.y, i * 2",p=i?"rc.z, i * 2":"i * 2, rc.z",d=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],m="",v="";s&&(m=u?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):c?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),v="result = activation(result);");var g=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");var y="rc.x",b="rc.x";t[0]<n[0]?y="int(min(float(rc.x), ".concat(t[0]-1,".))"):n[0]<t[0]&&(b="int(min(float(rc.x), ".concat(n[0]-1,".))")),this.userCode="\n      ".concat(m,"\n\n      const float sharedDimension = ").concat(l,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ").concat(l,"; i++) {\n          int batchA = ").concat(y,";\n          int batchB = ").concat(b,";\n          vec4 a = getMatrixA(batchA, ").concat(h,");\n          vec4 b = getMatrixB(batchB, ").concat(p,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(d[0]," * ").concat(f[0],");\n          result += (").concat(d[1]," * ").concat(f[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(g,"\n\n        ").concat(v,"\n\n        setOutput(result);\n      }\n    ")},pG=function e(t,n,r){_classCallCheck(this,e),this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=v.assertAndGetBroadcastShape(n,r),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")},dG="return a * b;";function fG(e){var t,n=e.inputs,r=e.backend,a=n.a,i=n.b,o=v.upcastType(a.dtype,i.dtype);if("complex64"===a.dtype){var s=r.texData.get(a.dataId),u=r.texData.get(i.dataId),c=new pG("return areal * breal - aimag * bimag;",a.shape,i.shape),l=new pG("return areal * bimag + aimag * breal;",a.shape,i.shape),h=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:a.shape},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:a.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:i.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:i.shape}],p=r.runWebGLProgram(c,h,"float32"),d=r.runWebGLProgram(l,h,"float32"),f=eG({inputs:{real:p,imag:d},backend:r});return r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(d),f}if(r.shouldExecuteOnCPU([a,i])){var m=r.texData.get(a.dataId),g=r.texData.get(i.dataId),y=_slicedToArray(xW(a.shape,i.shape,m.values,g.values,o),2),b=y[0],k=y[1],x=r.makeTensorInfo(k,o);return r.texData.get(x.dataId).values=b,x}return t=Jd().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new QW(dG,a.shape,i.shape):new ZW(dG,a.shape,i.shape),r.runWebGLProgram(t,[a,i],o)}var mG={kernelName:qm,backendName:"webgl",kernelFunc:fG};function vG(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.shape,s=n,u=r.sizeFromShape(i.shape),c=r.inferFromImplicitShape(o,u),l=r.sizeFromShape(c);r.assert(u===l,(function(){return"The new shape (".concat(c,") has ").concat(l," elements and the old shape (").concat(i.shape,") has ").concat(u," elements. The new shape and old shape must have the same number of elements.")}));var h=s.texData.get(i.dataId);return!h.isPacked||IU(i.shape,c)||null!==h.texture&&IU(h.shape,c)?(s.incRef(i.dataId),{dataId:i.dataId,shape:c,dtype:i.dtype}):function(e,t,n){var r=[wU(e.shape)].concat(_toConsumableArray(CU(e.shape))),a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[wU(t)].concat(_toConsumableArray(CU(t))),o=new LW(i,r),s=n.runWebGLProgram(o,[a],e.dtype,null,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}(i,c,s)}var gG={kernelName:lv,backendName:"webgl",kernelFunc:vG},yG=function e(t,n){_classCallCheck(this,e),this.variableNames=["x"];var a=t.windowSize,i=t.batchSize,o=t.inSize,s=t.outSize;this.outputShape=[i,s];var u=4*Math.floor(a/4),c=a%4,l="sumValue += dot(values, ones);";if(null!=n){var h=1/n;l="sumValue += dot(values * ".concat(r.isInt(h)?h.toPrecision(2):h,", ones);")}var p="";o%a>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(o,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(p,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(a,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(l,"\n        }\n        setOutput(sumValue);\n      }\n    ")},bG=function e(t,n){_classCallCheck(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s="0.0",u="";"prod"===n?s="1.0":"min"===n?(s="1.0 / 1e-20",u="min"):"max"===n&&(s="-1.0 / 1e-20",u="max");var c="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"sum"===n?c="sumValue":"prod"===n?c="prodValue":"all"===n?c="allValue":"any"===n&&(c="anyValue");var l=4*Math.floor(r/4),h=r%4,p="\n      if (".concat("sum"===n,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===n,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(u,"(values, minMaxValue);\n      }\n    "),d="vec4";"all"===n?(s="1.0",p="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===n&&(s="0.0",p="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var f="";i%r>0&&(f="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(f,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(l,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(p,"\n        }\n\n        int inIdx = inOffset + ").concat(l,";\n        if (").concat(1===h,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(p,"\n        } else if (").concat(2===h,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(p,"\n        } else if (").concat(3===h,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(p,"\n        }\n        setOutput(").concat(c,");\n      }\n    ")};function kG(e,t,n,r){for(var a=function(e){for(var t=[];0===t.length||1!==t[t.length-1].outSize;){var n=t.length?t[t.length-1].outSize:e[1],r=v.computeOptimalWindowSize(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape),i=e,o=0;o<a.length;o++){var s,u,c=a[o],l=c.inSize,h=c.windowSize,p=c.outSize;s="mean"===n?0===o?new yG({windowSize:h,inSize:l,batchSize:e.shape[0],outSize:p},l):new yG({windowSize:h,inSize:l,batchSize:e.shape[0],outSize:p}):new bG({windowSize:h,inSize:l,batchSize:e.shape[0],outSize:p},n),u=i,i=r.runWebGLProgram(s,[i],t),u.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(u)}return i}var xG=function e(t,n){_classCallCheck(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];this.outputShape=r,this.rank=r.length;var i=nW(this.rank),o=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(n);this.userCode="\n    void main() {\n      ".concat(i," resRC = getOutputCoords();\n      setOutput(getA(").concat(o,"));\n    }\n    ")},wG=function e(t,n){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=nW(this.rank),o=OW("rc",this.rank),s=new Array(this.rank),u=0;u<n.length;u++)s[n[u]]=o[u];var c="vec2(".concat(s.slice(-2).join(),")"),l="++".concat(o[this.rank-1]," < ").concat(r[this.rank-1]),h="getChannel(getA(".concat(s.join(),"), ").concat(c,")");this.userCode="\n    void main() {\n      ".concat(i," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(h,";\n      if(").concat(l,") {\n        result[1] = ").concat(h,";\n      }\n      --").concat(o[this.rank-1],";\n      if(++").concat(o[this.rank-2]," < ").concat(r[this.rank-2],") {\n        result[2] = ").concat(h,";\n        if(").concat(l,") {\n          result[3] = ").concat(h,";\n        }\n      }\n      setOutput(result);\n    }\n    ")};function CG(e,t,n){var r=Jd().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new wG(e.shape,t):new xG(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function _G(e){var t=e.inputs,n=e.backend,a=e.attrs;return function(e,t,n,a){var i=e.shape.length,o=r.parseAxisParam(t,e.shape),s=o,u=v.getAxesPermutation(s,i),c=null!=u,l=e;c&&(l=CG(e,u,a),s=v.getInnerMostAxes(s.length,i)),v.assertAxesAreInnerMostDims("sum",s,i);var h=_slicedToArray(v.computeOutAndReduceShapes(l.shape,s),2),p=h[0],d=h[1],f=p;n&&(f=v.expandShapeToKeepDim(p,o));var m=r.sizeFromShape(d),g=vG({inputs:{x:l},attrs:{shape:[r.sizeFromShape(e.shape)/m,m]},backend:a}),y=kG(g,Dg(e.dtype),"sum",a),b=vG({inputs:{x:y},attrs:{shape:f},backend:a});return a.disposeIntermediateTensorInfo(g),a.disposeIntermediateTensorInfo(y),c&&a.disposeIntermediateTensorInfo(l),b}(t.x,a.axis,a.keepDims,n)}var SG={kernelName:Av,backendName:"webgl",kernelFunc:_G};function IG(e){for(var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.perm,s=r,u=new Array(i.shape.length),c=0;c<u.length;c++)u[c]=i.shape[o[c]];if(s.shouldExecuteOnCPU([i])){var l=s.texData.get(i.dataId),h=FW(l.values,i.shape,i.dtype,o,u);t=s.makeTensorInfo(u,i.dtype),s.texData.get(t.dataId).values=h}else t=CG(i,o,s);return t}var TG={kernelName:Wv,backendName:"webgl",kernelFunc:IG};function NG(e){var t=e.a,n=e.b,a=e.transposeA,i=e.transposeB,o=e.backend,s=e.bias,u=void 0===s?null:s,c=e.preluActivationWeights,l=void 0===c?null:c,h=e.leakyreluAlpha,p=void 0===h?0:h,d=e.activation,f=void 0===d?null:d,m=t.shape.length,v=n.shape.length,g=a?t.shape[m-2]:t.shape[m-1],y=i?n.shape[v-1]:n.shape[v-2],b=a?t.shape[m-1]:t.shape[m-2],k=i?n.shape[v-2]:n.shape[v-1],x=t.shape.slice(0,-2),w=n.shape.slice(0,-2),C=r.sizeFromShape(x),_=r.sizeFromShape(w);r.assert(m>=2&&v>=2&&(C===_||1===C||1===_),(function(){return"Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (".concat(x,") and (").concat(w,").")}));var S=(C>_?t.shape.slice(0,-2):n.shape.slice(0,-2)).concat([b,k]);r.assert(g===y,(function(){return"Error in matMul: inner shapes (".concat(g,") and (").concat(y,") of Tensors with shapes ").concat(t.shape," and ").concat(n.shape," and transposeA=").concat(a," and transposeB=").concat(i," must match.")}));var I,T=a?[C,g,b]:[C,b,g],N=i?[_,k,y]:[_,y,k],A=vG({inputs:{x:t},backend:o,attrs:{shape:T}}),E=vG({inputs:{x:n},backend:o,attrs:{shape:N}}),R=[A,E],F=Math.max(C,_),D=a?A.shape[1]:A.shape[2],O=null!=u,M=null!=l,P="leakyrelu"===f,L=null!=f?lG(f,!0):null;if((1===b||1===k)&&D>1e3&&!1===(O||M||P||null!=L)){var z=A,B=E;a&&(z=IG({inputs:{x:A},backend:o,attrs:{perm:[0,2,1]}}),R.push(z)),i&&(B=IG({inputs:{x:E},backend:o,attrs:{perm:[0,2,1]}}),R.push(B));var V=1===k,U=z;1!==k&&(U=vG({inputs:{x:z},backend:o,attrs:{shape:[F,D,1]}}),R.push(U));var W=1===k?2:1,G=B;V&&(G=vG({inputs:{x:B},backend:o,attrs:{shape:[F,1,D]}}),R.push(G));var H=fG({inputs:{a:U,b:G},backend:o});I=_G({inputs:{x:H},backend:o,attrs:{axis:W,keepDims:!0}}),R.push(H)}else{var j=Fg(t.dtype,n.dtype),q=new hG(T,N,[F,b,k],a,i,O,L,M,P),K=[A,E];if(null!=u&&K.push(u),M&&K.push(l),P){var X=o.makeTensorInfo([],"float32",r.createScalarValue(p,"float32"));K.push(X),R.push(X)}I=o.runWebGLProgram(q,K,j)}var Y=vG({inputs:{x:I},backend:o,attrs:{shape:S}});R.push(I);for(var Z=0,Q=R;Z<Q.length;Z++){var J=Q[Z];o.disposeIntermediateTensorInfo(J)}return Y}var AG={kernelName:Zv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=t.bias,s=t.preluActivationWeights,u=r.transposeA,c=r.transposeB,l=r.activation;return NG({a:a,b:i,transposeA:u,transposeB:c,backend:n,bias:o,preluActivationWeights:s,leakyreluAlpha:r.leakyreluAlpha,activation:l})}},EG={kernelName:rf,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])&&"complex64"!==a.dtype){var i=r.texData.get(a.dataId),o=IW(i.values);return r.makeTensorInfo(a.shape,a.dtype,o)}return t=Jd().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new jW(a.shape,"return abs(x);"):new WW(a.shape,"return abs(x);"),r.runWebGLProgram(t,[a],a.dtype)}},RG=uG({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),FG={kernelName:af,backendName:"webgl",kernelFunc:RG},DG=uG({opSnippet:"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),OG={kernelName:of,backendName:"webgl",kernelFunc:DG},MG="return a + b;",PG=cG({opSnippet:MG,packedOpSnippet:MG,supportsComplex:!0,cpuKernelImpl:oW}),LG={kernelName:sf,backendName:"webgl",kernelFunc:PG},zG=function e(t,n){_classCallCheck(this,e),this.outputShape=[],this.outputShape=t,this.variableNames=n.map((function(e,t){return"T"+t}));var r=[];this.variableNames.forEach((function(e){r.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        float result = ").concat(a,";\n        setOutput(result);\n      }\n    ")},BG=function e(t,n){_classCallCheck(this,e),this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((function(e,t){return"T"+t}));var r=[];this.variableNames.forEach((function(e){r.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        vec4 result = ").concat(a,";\n        setOutput(result);\n      }\n    ")},VG={kernelName:uf,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n;if(1===a.length)return JW({inputs:{x:a[0]},backend:r});if(a.length>Jd().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(a.length/2),o=e({inputs:a.slice(0,i),backend:r}),s=e({inputs:a.slice(i),backend:r});return e({inputs:[o,s],backend:r})}var u=a.map((function(e){return e.dtype})).reduce((function(e,t){return Fg(e,t)})),c=a.map((function(e){return e.shape})),l=Jd().getBool("WEBGL_PACK")?new BG(a[0].shape,c):new zG(a[0].shape,c);return r.runWebGLProgram(l,a,u)}},UG={kernelName:cf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.axis,s=a.keepDims,u=i.shape.length,c=r.parseAxisParam(o,i.shape),l=c,h=v.getAxesPermutation(l,u),p=i;null!=h&&(p=IG({inputs:{x:i},backend:n,attrs:{perm:h}}),l=v.getInnerMostAxes(l.length,u)),v.assertAxesAreInnerMostDims("all",l,u);var d,f=_slicedToArray(v.computeOutAndReduceShapes(p.shape,l),2),m=f[0],g=f[1],y=vG({inputs:{x:p},backend:n,attrs:{shape:[-1,r.sizeFromShape(g)]}}),b=kG(y,y.dtype,"all",n);return d=vG(s?{inputs:{x:b},backend:n,attrs:{shape:v.expandShapeToKeepDim(m,c)}}:{inputs:{x:b},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),null!=h&&n.disposeIntermediateTensorInfo(p),d}},WG={kernelName:lf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.axis,s=a.keepDims,u=i.shape.length,c=r.parseAxisParam(o,i.shape),l=c,h=v.getAxesPermutation(l,u),p=i;null!=h&&(p=IG({inputs:{x:i},backend:n,attrs:{perm:h}}),l=v.getInnerMostAxes(l.length,u)),v.assertAxesAreInnerMostDims("any",l,u);var d,f=_slicedToArray(v.computeOutAndReduceShapes(p.shape,l),2),m=f[0],g=f[1],y=vG({inputs:{x:p},backend:n,attrs:{shape:[-1,r.sizeFromShape(g)]}}),b=kG(y,y.dtype,"any",n);return d=vG(s?{inputs:{x:b},backend:n,attrs:{shape:v.expandShapeToKeepDim(m,c)}}:{inputs:{x:b},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),null!=h&&n.disposeIntermediateTensorInfo(p),d}},GG=function e(t,n,r){_classCallCheck(this,e),this.variableNames=["A"];var a=t.windowSize,i=t.batchSize,o=t.outSize;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(a,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          int inIdx = ").concat(r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));",";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat("max"===n?">":"<"," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")},HG=function e(t,n,a,i){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,r.assert(t.length>2,(function(){return"Packed arg".concat(a.charAt(0).toUpperCase()+a.slice(1)," supports only inputs with rank above 2.")}));var o=Math.ceil(t[t.length-1]/n);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),i||this.variableNames.push("bestIndicesA");var s,u,c=this.outputShape,l=c.length,h=nW(l),p=MW("coords",l);if(1===o){var d=nW(u=l+1);s="\n        ".concat(d," sourceLocR = ").concat(d,"(").concat(p.join(),", 0);\n        ++").concat(p[l-1],";\n        ").concat(d," sourceLocG = ").concat(d,"(").concat(p.join(),", 0);\n        ++").concat(p[l-2],";\n        ").concat(d," sourceLocA = ").concat(d,"(").concat(p.join(),", 0);\n        --").concat(p[l-1],";\n        ").concat(d," sourceLocB = ").concat(d,"(").concat(p.join(),", 0);\n        --").concat(p[l-2],";")}else u=l,s="\n        ".concat(h," sourceLocR = coords;\n        ++").concat(p[l-1],";\n        ").concat(h," sourceLocG = coords;\n        ++").concat(p[l-2],";\n        ").concat(h," sourceLocA = coords;\n        --").concat(p[l-1],";\n        ").concat(h," sourceLocB = coords;\n        --").concat(p[l-2],";");var f=["x","y","z","w","u","v"].slice(0,u),m="."+f[u-1],v=f.map((function(e){return"int "+e})),g=MW("sourceLocR",u-1).concat("inIdx.r"),y=MW("sourceLocG",u-1).concat("inIdx.g"),b=MW("sourceLocB",u-1).concat("inIdx.b"),k=MW("sourceLocA",u-1).concat("inIdx.a"),x="max"===a?"greaterThan":"lessThan",w=i?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(g.join(),"),\n                             getBestIndicesAChannel(").concat(y.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),"),\n                             getBestIndicesAChannel(").concat(k.join(),")));"),C="vec4(\n            getAChannel(".concat(g.join(),"),\n            hasNextCol ? getAChannel(").concat(y.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(b.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(k.join(),") : 0.)"),_=i?"":"\n      float getBestIndicesAChannel(".concat(v.join(),") {\n        return getChannel(getBestIndicesA(").concat(f.join(),"),\n                                          vec2(").concat(f.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(v.join(),") {\n        return getChannel(getA(").concat(f.join(),"),\n                               vec2(").concat(f.slice(-2).join(),"));\n      }\n      ").concat(_,"\n      void main() {\n        ").concat(h," coords = getOutputCoords();\n        bool hasNextCol = ").concat(p[l-1]," < ").concat(c[l-1]-1,";\n        bool hasNextRow = ").concat(p[l-2]," < ").concat(c[l-2]-1,";\n        ").concat(s,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(m,", sourceLocG").concat(m,",\n          sourceLocB").concat(m,", sourceLocA").concat(m,") * ").concat(n,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(C,";\n\n        for (int i = 0; i < ").concat(n,"; i++) {\n          inIdx = srcIdx;\n          ").concat(w,"\n          vec4 candidate = ").concat(C,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(x,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")};function jG(e,t,n,a){var i=[n];if(v.assertAxesAreInnerMostDims("arg"+a.charAt(0).toUpperCase()+a.slice(1),i,t.shape.length),!Jd().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){var o=[],s=_slicedToArray(v.computeOutAndReduceShapes(t.shape,i),2),u=s[0],c=s[1],l=r.sizeFromShape(c),h=vG({inputs:{x:t},backend:e,attrs:{shape:[-1,l]}});o.push(h);var p=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=n.shape[0],o=n.shape[1];null!=a&&(i=a.shape[0],o=a.shape[1]);var s=v.computeOptimalWindowSize(o),u={windowSize:s,inSize:o,batchSize:i,outSize:Math.ceil(o/s)},c=new GG(u,r,null==a),l=[n];null!=a&&l.push(a);var h=t.runWebGLProgram(c,l,"int32");if(1===h.shape[1])return h;var p=e(t,n,r,h);return t.disposeIntermediateTensorInfo(h),p}(e,h,a);o.push(p);var d=vG({inputs:{x:p},backend:e,attrs:{shape:u}});return o.forEach((function(t){return e.disposeIntermediateTensorInfo(t)})),d}return function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=null!=a?a.shape:n.shape,o=v.computeOptimalWindowSize(i[i.length-1]),s=new HG(i,o,r,null==a),u=t.runWebGLProgram(s,null==a?[n]:[n,a],"int32");if(u.shape.length===n.shape.length){var c=e(t,n,r,u);return t.disposeIntermediateTensorInfo(u),c}return u}(e,t,a)}var qG={kernelName:hf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.axis,s=r.parseAxisParam(o,i.shape),u=v.getAxesPermutation(s,i.shape.length),c=i,l=[];null!=u&&(c=IG({inputs:{x:i},backend:n,attrs:{perm:u}}),l.push(c),s=v.getInnerMostAxes(s.length,c.shape.length)),v.assertAxesAreInnerMostDims("argMax",[s[0]],c.shape.length);var h=jG(n,c,s[0],"max");return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),h}},KG={kernelName:pf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.axis,s=r.parseAxisParam(o,i.shape),u=v.getAxesPermutation(s,i.shape.length),c=i,l=[];null!=u&&(c=IG({inputs:{x:i},backend:n,attrs:{perm:u}}),l.push(c),s=v.getInnerMostAxes(s.length,c.shape.length)),v.assertAxesAreInnerMostDims("argMin",[s[0]],c.shape.length);var h=jG(n,c,s[0],"min");return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),h}},XG=uG({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),YG={kernelName:df,backendName:"webgl",kernelFunc:XG},ZG=uG({opSnippet:"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));"}),QG={kernelName:ff,backendName:"webgl",kernelFunc:ZG},JG=uG({opSnippet:"if (isnan(x)) return x;\n  return atan(x);\n"}),$G={kernelName:mf,backendName:"webgl",kernelFunc:JG},eH=cG({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),tH={kernelName:gf,backendName:"webgl",kernelFunc:eH},nH=uG({opSnippet:"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),rH={kernelName:vf,backendName:"webgl",kernelFunc:nH},aH=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(_classCallCheck(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,h=t.effectiveFilterHeight,p=t.effectiveFilterWidth,d=t.padInfo.top,f=t.padInfo.left;this.outputShape=t.outShape;var m="avg"===n,v="0.0";if(m||(v="-1.0 / 1e-20"),r)this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n        const ivec2 pads = ivec2(").concat(d,", ").concat(f,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(h,";\n              wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(p,";\n                wC += ").concat(l,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(a?i?"((batch  * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"):"(xR * ".concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"):"wR * ".concat(p," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ");else{var g="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===n&&(g="avgValue / count");var y=4*Math.floor(o/4),b=o%4,k="\n      if (".concat(m,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(d,", ").concat(f,");\n      const float initializationValue = ").concat(v,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(v,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(h,";\n            wR += ").concat(c,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(y,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              getValue(batch, xR, xC + 3 * ").concat(l,", d)\n            );\n\n            ").concat(k,"\n          }\n\n          int xC = xCCorner + ").concat(y,";\n          if (").concat(1===b,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(k,"\n          } else if (").concat(2===b,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(k,"\n          } else if (").concat(3===b,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              initializationValue\n            );\n\n            ").concat(k,"\n          }\n        }\n        setOutput(").concat(g,");\n      }\n    ")}},iH=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(_classCallCheck(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideDepth,u=t.strideHeight,c=t.strideWidth,l=t.dilationDepth,h=t.dilationHeight,p=t.dilationWidth,d=t.effectiveFilterDepth,f=t.effectiveFilterHeight,m=t.effectiveFilterWidth,v=t.padInfo.front,g=t.padInfo.top,y=t.padInfo.left;this.outputShape=t.outShape;var b="avg"===n,k="0.0";if(b||(k="-1.0 / 1e-20"),r)this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n        const ivec3 pads = ivec3(").concat(v,", ").concat(g,", ").concat(y,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(d,";\n              wD += ").concat(l,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(f,";\n                wR += ").concat(h,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(m,";\n                  wC += ").concat(p,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(a?i?"(((batch * ".concat(t.inDepth," + xD) * ").concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"((xD * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"wD * ".concat(f," * ").concat(m," +\n                      wR * ").concat(m," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ");else{var x="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===n&&(x="avgValue / count");var w=4*Math.floor(o/4),C=o%4,_="\n      if (".concat(b,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n      const ivec3 pads = ivec3(").concat(v,", ").concat(g,", ").concat(y,");\n      const float initializationValue = ").concat(k,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(k,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(d,";\n            wD += ").concat(l,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(f,";\n            wR += ").concat(h,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(w,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(p,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(p,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(p,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(p,", ch)\n              );\n\n              ").concat(_,"\n            }\n\n            int xC = xCCorner + ").concat(w,";\n            if (").concat(1===C,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(_,"\n            } else if (").concat(2===C,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(p,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(_,"\n            } else if (").concat(3===C,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(p,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(p,", ch),\n                initializationValue\n              );\n\n              ").concat(_,"\n            }\n          }\n          setOutput(").concat(x,");\n        }\n      }\n    ")}},oH={kernelName:yf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x;EU(i,"avgPool");var o=a.filterSize,s=a.strides,u=a.pad,c=a.dimRoundingMode;r.assert(v.eitherStridesOrDilationsAreOne(s,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '1'")}));var l=v.computePool2DInfo(i.shape,o,s,1,u,c);if(1===l.filterWidth&&1===l.filterHeight&&r.arraysEqual(l.inShape,l.outShape))return JW({inputs:{x:i},backend:n});var h=new aH(l,"avg",!1);return n.runWebGLProgram(h,[i],"float32")}},sH={kernelName:kf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,l=v.computePool3DInfo(a.shape,i,o,[1,1,1],s,u,c),h=new iH(l,"avg",!1);return n.runWebGLProgram(h,[a],"float32")}},uH=function e(t){_classCallCheck(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.effectiveFilterHeight,r=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2(".concat(n-1-t.padInfo.top,", ").concat(r-1-t.padInfo.left,");\n      const float avgMultiplier = float(").concat(1/(t.filterHeight*t.filterWidth),");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,";\n            wR += ").concat(t.dilationHeight,") {\n          float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(r,";\n            wC+= ").concat(t.dilationWidth,") {\n            float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},cH=function e(t){_classCallCheck(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.effectiveFilterDepth,r=t.effectiveFilterHeight,a=t.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3(".concat(n-1-t.padInfo.front,", ").concat(r-1-t.padInfo.top,", ").concat(a-1-t.padInfo.left,");\n      const float avgMultiplier = float(").concat(1/(t.filterDepth*t.filterHeight*t.filterWidth),");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(n,";\n            wD += ").concat(t.dilationDepth,") {\n          float dyD = float(dyDCorner + wD) / ").concat(t.strideDepth,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(r,";\n              wR += ").concat(t.dilationHeight,") {\n            float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(a,";\n                wC += ").concat(t.dilationWidth,") {\n              float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},lH={kernelName:xf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=v.computePool3DInfo(i.shape,o,s,[1,1,1],u,c),h=new cH(l);return n.runWebGLProgram(h,[a],i.dtype)}},hH={kernelName:bf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;EU([a,i],"avgPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=v.computePool2DInfo(o.shape,s,u,1,c),h=new uH(l);return n.runWebGLProgram(h,[a],o.dtype)}},pH={kernelName:wf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;return NG({a:t.a,b:t.b,transposeA:r.transposeA,transposeB:r.transposeB,backend:n})}},dH=function e(t,n,r,a,i,o){_classCallCheck(this,e),this.outputShape=[],this.variableNames=["x","mean","variance"],v.assertAndGetBroadcastShape(t,n),v.assertAndGetBroadcastShape(t,r);var s="0.0";null!=a&&(v.assertAndGetBroadcastShape(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";null!=i&&(v.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(s,";\n        float scale = ").concat(u,";\n        float inv = scale * inversesqrt(variance + float(").concat(o,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")},fH=function e(t,n,r,a,i,o){_classCallCheck(this,e),this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],v.assertAndGetBroadcastShape(t,n),v.assertAndGetBroadcastShape(t,r);var s="vec4(0.0)";null!=a&&(v.assertAndGetBroadcastShape(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";null!=i&&(v.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = ".concat(s,";\n        vec4 scale = ").concat(u,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(o,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")},mH={kernelName:lm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.mean,s=t.variance,u=t.offset,c=t.scale;r.assert(o.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),r.assert(null==u||o.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),r.assert(null==c||o.shape.length===c.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var l=a.varianceEpsilon;null==l&&(l=.001);var h=[i,o,s],p=null;null!=u&&(p=u.shape,h.push(u));var d=null;null!=c&&(d=c.shape,h.push(c));var f=Jd().getBool("WEBGL_PACK_NORMALIZATION")?new fH(i.shape,o.shape,s.shape,p,d,l):new dH(i.shape,o.shape,s.shape,p,d,l);return n.runWebGLProgram(f,h,h[0].dtype)}},vH=function(){function e(t){_classCallCheck(this,e),this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n,r=nW(this.rank),a="uniform int start[".concat(this.rank,"];"),i=function(e){if(1===e)return"sourceLoc";if(e<=6)return gH.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank);n="\n        ".concat(r," sourceLoc;\n        ").concat(r," coords = getOutputCoords();\n        ").concat(t.map((function(e,t){return"sourceLoc.".concat(gH[t]," = start[").concat(t,"] + coords.").concat(gH[t],";")})).join("\n"),"\n      "),this.userCode="\n      ".concat(a,"\n      void main() {\n        ").concat(n,"\n        setOutput(getSource(").concat(i,"));\n      }\n    ")}return _createClass(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;if(e.length!==this.rank)throw Error("The rank (".concat(this.rank,") of the program must match the length of start (").concat(e.length,")"));return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}}}]),e}(),gH=["x","y","z","w","u","v"],yH=function(){function e(t){_classCallCheck(this,e),this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var n=nW(this.rank),r=MW("coords",this.rank),a=MW("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s="\n      result.x = ".concat(o,";\n      if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n        ++").concat(a[this.rank-1],";\n        result.y = ").concat(o,";\n        --").concat(a[this.rank-1],";\n      }\n    "),u=1===this.rank?"":"\n      --".concat(r[this.rank-1],";\n      if (++").concat(r[this.rank-2]," < ").concat(t[this.rank-2],") {\n        ++").concat(a[this.rank-2],";\n        result.z = ").concat(o,";\n        if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n          ++").concat(a[this.rank-1],";\n          result.w = ").concat(o,";\n        }\n      }\n    "),c=this.rank<=4?"sourceLoc = coords +\n            ".concat(n,"(").concat(t.map((function(e,t){return"start[".concat(t,"]")})).join(),");"):t.map((function(e,t){return"".concat(a[t]," = ").concat(r[t]," + start[").concat(t,"];")})).join("\n");this.userCode="\n      uniform int start[".concat(this.rank,"];\n      void main() {\n        ").concat(n," coords = getOutputCoords();\n        ").concat(n," sourceLoc;\n        ").concat(c,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(u,"\n        setOutput(result);\n      }\n    ")}return _createClass(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;if(e.length!==this.rank)throw Error("The rank (".concat(this.rank,") of the program must match the length of start (").concat(e.length,")"));return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}}}]),e}();function bH(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.begin,s=a.size,u=_slicedToArray(h.parseSliceParams(i,o,s),2),c=u[0],l=u[1];if(h.assertParamsValid(i,c,l),0===r.sizeFromShape(l))return n.makeTensorInfo(l,i.dtype,[]);if(n.shouldExecuteOnCPU([i])||"string"===i.dtype){var p=n.texData.get(i.dataId),d=TW(p.values,c,l,i.shape,i.dtype);return n.makeTensorInfo(l,i.dtype,d)}var f=n.texData.get(i.dataId).isPacked,m=h.isSliceContinous(i.shape,c,l);if(f||!m){var v=Jd().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new yH(l):new vH(l),g=v.getCustomSetupFunc(c);return n.runWebGLProgram(v,[i],i.dtype,g)}return n.uploadToGPU(i.dataId),function(e,t,n,a){var i=a.texData.get(e.dataId),o=a.makeTensorInfo(n,e.dtype),s=a.texData.get(o.dataId);Object.assign(s,i),s.shape=n,s.dtype=e.dtype;var u=h.computeFlatOffset(t,r.computeStrides(e.shape));i.slice&&(u+=i.slice.flatOffset),s.slice={flatOffset:u,origDataId:i.slice&&i.slice.origDataId||e.dataId};var c=a.dataRefCount.get(s.slice.origDataId)||1;return a.dataRefCount.set(s.slice.origDataId,c+1),o}(i,c,l,n)}var kH={kernelName:wv,backendName:"webgl",kernelFunc:bH},xH={kernelName:Cf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.blockShape,s=a.crops;r.assert(i.shape.length<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var u=o.reduce((function(e,t){return e*t})),c=v.getReshaped(i.shape,o,u),l=v.getPermuted(c.length,o.length),h=v.getReshapedPermuted(i.shape,o,u),p=v.getSliceBeginCoords(s,o.length),d=v.getSliceSize(h,s,o.length),f=[],m=vG({inputs:{x:i},backend:n,attrs:{shape:c}}),g=IG({inputs:{x:m},backend:n,attrs:{perm:l}}),y=vG({inputs:{x:g},backend:n,attrs:{shape:h}}),b=bH({inputs:{x:y},backend:n,attrs:{begin:p,size:d}});return f.push(m),f.push(g),f.push(y),f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),b}},wH={kernelName:_f,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=n.texData.get(a.dataId).values,u=n.texData.get(i.dataId).values,c=sW(s,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}},CH=cG({opSnippet:"return float(a != b);",dtype:"bool"}),_H={kernelName:Xm,backendName:"webgl",kernelFunc:CH};function SH(e){var t=e.inputs,n=e.backend,r=t.input;return JW({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}var IH={kernelName:sv,backendName:"webgl",kernelFunc:SH},TH={kernelName:If,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,a=t.backend,i=t.attrs,o=n.x,s=i.dtype;if("complex64"===s){if("complex64"===o.dtype)return JW({inputs:{x:o},backend:a});var u=fC(o.shape),c=e({inputs:{x:o},backend:a,attrs:{dtype:"float32"}}),l=eG({inputs:{real:c,imag:u},backend:a});return u.dispose(),a.disposeIntermediateTensorInfo(c),l}if("complex64"===o.dtype){var h=SH({inputs:{input:o},backend:a}),p=e({inputs:{x:h},backend:a,attrs:{dtype:s}});return a.disposeIntermediateTensorInfo(h),p}if(!r.hasEncodingLoss(o.dtype,s)){var d=JW({inputs:{x:o},backend:a});return{dataId:d.dataId,shape:d.shape,dtype:s}}if("int32"===s)return function(e,t){var n=new WW(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(o,a);if("bool"===s){var f=a.makeTensorInfo([],"bool",r.getTypedArrayFromDType("bool",1)),m=CH({inputs:{a:o,b:f},backend:a});return a.disposeIntermediateTensorInfo(f),m}throw new Error("Error in Cast: failed to cast ".concat(o.dtype," to ").concat(s))}},NH="return ceil(x);",AH=uG({opSnippet:NH,packedOpSnippet:NH,cpuKernelImpl:cW}),EH={kernelName:Tf,backendName:"webgl",kernelFunc:AH},RH=function(){function e(t){_classCallCheck(this,e),this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return _createClass(e,[{key:"getCustomSetupFunc",value:function(e,t){var n=this;return function(r,a){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(a,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}}}]),e}(),FH=function(){function e(t){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return _createClass(e,[{key:"getCustomSetupFunc",value:function(e,t){var n=this;return function(r,a){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(a,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}}}]),e}(),DH={kernelName:Nf,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.clipValueMin,s=a.clipValueMax,u=(t=Jd().getBool("WEBGL_PACK_CLIP")?new FH(i.shape):new RH(i.shape)).getCustomSetupFunc(o,s);return r.runWebGLProgram(t,[i],i.dtype,u)}},OH=function e(t){_classCallCheck(this,e),this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "};function MH(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}var PH={kernelName:Ef,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n.texData.get(r.dataId),i=new OH(r.shape),o=[MH(r,a.complexTensorInfos.real),MH(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}},LH=function e(t){_classCallCheck(this,e),this.outputShape=[],this.outputShape=v.computeOutShape(t,1),this.variableNames=t.map((function(e,t){return"T"+t}));var n=new Array(t.length-1);n[0]=t[0][1];for(var r=1;r<n.length;r++)n[r]=n[r-1]+t[r][1];for(var a=["if (yC < ".concat(n[0],") setOutput(getT0(yR, yC));")],i=1;i<n.length;i++)a.push("else if (yC < ".concat(n[i],") setOutput(getT").concat(i,"(yR, yC-").concat(n[i-1],"));"));a.push("else setOutput(getT".concat(n.length,"(yR, yC-").concat(n[n.length-1],"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(a.join("\n        "),"\n      }\n    ")},zH=function e(t,n){_classCallCheck(this,e),this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=v.computeOutShape(t,n);var r=this.outputShape,a=r.length,i=nW(a),o=MW("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=t.map((function(e,t){return"T"+t}));var u=new Array(t.length-1);u[0]=t[0][n];for(var c=1;c<u.length;c++)u[c]=u[c-1]+t[c][n];for(var l=s[n],h=s.slice(-2),p=s.join(),d="if (".concat(l," < ").concat(u[0],") {\n        return getChannel(\n            getT0(").concat(p,"), vec2(").concat(h.join(),"));\n        }"),f=1;f<u.length;f++){var m=u[f-1];d+="\n        if (".concat(l," < ").concat(u[f],"  && ").concat(l," >= ").concat(u[f-1],") {\n          return getChannel(\n            getT").concat(f,"(").concat(BH(s,l,m),"),\n            vec2(").concat(BH(h,l,m),"));\n        }")}var g=u[u.length-1];d+="\n        return getChannel(\n          getT".concat(u.length,"(").concat(BH(s,l,g),"),\n          vec2(").concat(BH(h,l,g),"));"),this.userCode="\n      float getValue(".concat(s.map((function(e){return"int "+e})),") {\n        ").concat(d,"\n      }\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(o,"), 0., 0., 0.);\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," + 1;\n        if (").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.g = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-2]," = ").concat(o[a-2]," + 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2],") {\n          result.a = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," - 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2]," &&\n            ").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.b = getValue(").concat(o,");\n        }\n        setOutput(result);\n      }\n    ")};function BH(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?"".concat(e," - ").concat(n):e})).join()}function VH(e){var t=e.inputs,n=e.backend,r=t.input;return JW({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}var UH={kernelName:gm,backendName:"webgl",kernelFunc:VH};function WH(e){var t=e.inputs,n=e.backend,a=e.attrs.axis,i=r.parseAxisParam(a,t[0].shape)[0],o=v.computeOutShape(t.map((function(e){return e.shape})),i);if(0===r.sizeFromShape(o))return n.makeTensorInfo(o,t[0].dtype,[]);var s=t.filter((function(e){return r.sizeFromShape(e.shape)>0}));if(1===s.length)return JW({inputs:{x:s[0]},backend:n});var u=s.map((function(e){return e.shape}));return v.assertParamsConsistent(u,i),function e(t,n,a){var i=t[0].dtype;if("complex64"===i){var o=t.map((function(e){return SH({inputs:{input:e},backend:a})})),s=t.map((function(e){return VH({inputs:{input:e},backend:a})})),u=e(o,n,a),c=e(s,n,a),l=eG({inputs:{real:u,imag:c},backend:a});return o.forEach((function(e){return a.disposeIntermediateTensorInfo(e)})),s.forEach((function(e){return a.disposeIntermediateTensorInfo(e)})),a.disposeIntermediateTensorInfo(u),a.disposeIntermediateTensorInfo(c),l}if(t.length>Jd().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var h=Math.floor(t.length/2),p=e(t.slice(0,h),n,a),d=e(t.slice(h),n,a),f=e([p,d],n,a);return a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(d),f}if(Jd().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].shape.length>1){var m=new zH(t.map((function(e){return e.shape})),n);return a.runWebGLProgram(m,t,i)}var g=v.computeOutShape(t.map((function(e){return e.shape})),n),y=t.map((function(e){return vG({inputs:{x:e},attrs:{shape:[-1,r.sizeFromShape(e.shape.slice(n))]},backend:a})})),b=new LH(y.map((function(e){return e.shape}))),k=a.runWebGLProgram(b,y,i);y.forEach((function(e){return a.disposeIntermediateTensorInfo(e)}));var x=vG({inputs:{x:k},attrs:{shape:g},backend:a});return a.disposeIntermediateTensorInfo(k),x}(s,i,n)}var GH={kernelName:Rf,backendName:"webgl",kernelFunc:WH},HH=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];_classCallCheck(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,h=t.dilationWidth,p=t.filterHeight,d=t.filterWidth,f=4*Math.floor(t.inChannels/4),m=t.inChannels%4,v="channelsLast"===t.dataFormat,g=v?1:2,y=v?2:3,b=v?3:1,k="",x="";r&&(k=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),x="result = activation(result);");var w=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(k,"\n\n      const ivec2 strides = ivec2(").concat(u,", ").concat(c,");\n      const ivec2 pads = ivec2(").concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(b,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(g,"], coords[").concat(y,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(p,"; wR++) {\n          int xR = xRCorner + wR * ").concat(l,";\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(d,"; wC++) {\n            int xC = xCCorner + wC * ").concat(h,";\n\n            if (xC < 0 || xC >= ").concat(t.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(f,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(v,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===m,") {\n\n              if (").concat(v,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(f,") *\n                    getW(wR, wC, ").concat(f,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(f,", xR, xC) *\n                    getW(wR, wC, ").concat(f,", d2);\n              }\n\n            } else if (").concat(2===m,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(f,", d2),\n                getW(wR, wC, ").concat(f," + 1, d2)\n              );\n\n              if (").concat(v,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(f,"),\n                  getX(batch, xR, xC, ").concat(f," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(f,", xR, xC),\n                  getX(batch, ").concat(f," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===m,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(f,", d2),\n                getW(wR, wC, ").concat(f," + 1, d2),\n                getW(wR, wC, ").concat(f," + 2, d2)\n              );\n\n              if (").concat(v,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(f,"),\n                  getX(batch, xR, xC, ").concat(f," + 1),\n                  getX(batch, xR, xC, ").concat(f," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(f,", xR, xC),\n                  getX(batch, ").concat(f," + 1, xR, xC),\n                  getX(batch, ").concat(f," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(w,"\n        ").concat(x,"\n        setOutput(result);\n      }\n    ")},jH=function e(t){_classCallCheck(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,r=t.padInfo.top,a=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,h=t.filterDepth,p=t.filterHeight,d=t.filterWidth,f=4*Math.floor(t.inChannels/4),m=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(i,", ").concat(o,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(n,", ").concat(r,", ").concat(a,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(h,"; wF++) {\n          int xF = xFCorner + wF * ").concat(u,";\n\n          if (xF < 0 || xF >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(p,"; wR++) {\n            int xR = xRCorner + wR * ").concat(c,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(d,"; wC++) {\n              int xC = xCCorner + wC * ").concat(l,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(f,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===m,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(f,") *\n                  getW(wF, wR, wC, ").concat(f,", d2);\n              } else if (").concat(2===m,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(f,"),\n                  getX(batch, xF, xR, xC, ").concat(f," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(f,", d2),\n                  getW(wF, wR, wC, ").concat(f," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===m,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(f,"),\n                  getX(batch, xF, xR, xC, ").concat(f," + 1),\n                  getX(batch, xF, xR, xC, ").concat(f," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(f,", d2),\n                  getW(wF, wR, wC, ").concat(f," + 1, d2),\n                  getW(wF, wR, wC, ").concat(f," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},qH=function e(t,n,r){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var a=r.filterWidth,i=r.inChannels,o=r.strideWidth,s=r.strideHeight,u=r.padInfo,c=r.outWidth,l=r.dilationWidth,h=r.dilationHeight,p=r.dataFormat,d=u.left,f=u.top,m=i*a,v=FU(),g="channelsLast"===p,y=g?0:1,b=g?1:2,k="",x=0;x<=1;x++)for(var w=0;w<=1;w++)k+="\n          blockIndex = rc.y + ".concat(w,";\n          pos = rc.x + ").concat(x,";\n\n          if(blockIndex < ").concat(t[1]," && pos < ").concat(t[0],") {\n            offsetY = int(blockIndex / (").concat(c,")) * ").concat(s," - ").concat(f,";\n            d0 = offsetY + ").concat(h," * (pos / ").concat(m,");\n\n            if(d0 < ").concat(n[y]," && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), ").concat(c,".) * ").concat(o,". - ").concat(d,".);\n              d1 = offsetX + ").concat(l," * (int(mod(float(pos), ").concat(m,".) / ").concat(i,".));\n\n              if(d1 < ").concat(n[b]," && d1 >= 0) {\n\n                ch = int(mod(float(pos), ").concat(i,".));\n\n                if (").concat(g,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*x+w,"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*x+w,"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(k,"\n\n        ").concat(v.output," = result;\n      }\n    ")};function KH(e){var t,n=e.x,a=e.filter,i=e.convInfo,o=e.backend,s=e.bias,u=void 0===s?null:s,c=e.preluActivationWeights,l=void 0===c?null:c,h=e.leakyreluAlpha,p=void 0===h?0:h,d=e.activation,f=void 0===d?null:d,m=n.shape,v=o.texData.get(n.dataId),g="channelsLast"===i.dataFormat,y=[],b=m[2]%2!=0&&!!v.isPacked;if((1!=m[0]*m[1]*m[2]&&1!==i.outChannels||!(i.inChannels>1e3))&&Jd().getBool("WEBGL_LAZILY_UNPACK")&&Jd().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&b){var k={dataId:n.dataId,shape:[1,g?m[0]*m[1]*(m[2]+1):m[0]*m[2]*(m[3]+1),i.inChannels],dtype:n.dtype},x=v.shape;v.shape=v.shape.slice(),v.shape[v.shape.length-2]++,r.assert(IU(v.shape,k.shape),(function(){return"packed reshape ".concat(v.shape," to ").concat(k.shape," isn't free")}));var w=vG({inputs:{x:a},backend:o,attrs:{shape:[1,i.inChannels,i.outChannels]}});y.push(w);var C=NG({a:k,b:w,backend:o,transposeA:!1,transposeB:!1,bias:u,activation:f,preluActivationWeights:l,leakyreluAlpha:p}),_=o.texData.get(C.dataId);r.assert(_.isPacked,(function(){return"batchMatMul result is expected to be packed"})),v.shape=x,_.shape=i.outShape,(t=JW({inputs:{x:C},backend:o})).shape=i.outShape,y.push(C)}else{var S=vG({inputs:{x:n},backend:o,attrs:{shape:[1,g?m[0]*m[1]*m[2]:m[0]*m[2]*m[3],i.inChannels]}}),I=vG({inputs:{x:a},backend:o,attrs:{shape:[1,i.inChannels,i.outChannels]}}),T=NG({a:S,b:I,transposeA:!1,transposeB:!1,backend:o,bias:u,activation:f,preluActivationWeights:l,leakyreluAlpha:p});t=vG({inputs:{x:T},backend:o,attrs:{shape:i.outShape}}),y.push(S),y.push(I),y.push(T)}for(var N=0,A=y;N<A.length;N++){var E=A[N];o.disposeIntermediateTensorInfo(E)}return t}function XH(e){var t=e.x,n=e.filter,a=e.convInfo,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,h=void 0===l?0:l,p=e.activation,d=void 0===p?null:p,f=a.filterWidth,m=a.filterHeight,v=a.inChannels,g=a.outWidth,y=a.outHeight,b="channelsLast"===a.dataFormat,k=f*m*v,x=y*g,w=[k,x],C=[],_=vG({inputs:{x:t},backend:i,attrs:{shape:t.shape.slice(1)}}),S=vG({inputs:{x:n},backend:i,attrs:{shape:[1,k,r.sizeFromShape(n.shape)/k]}});C.push(_),C.push(S);var I=new qH(w,_.shape,a),T=i.runWebGLProgram(I,[_],"float32"),N=vG({inputs:{x:T},backend:i,attrs:{shape:[1,w[0],w[1]]}});C.push(T),C.push(N);var A=null!=s,E=null!=c,R="leakyrelu"===d,F=d?lG(d,!0):null,D=new hG(N.shape,S.shape,[1,x,a.outChannels],!0,!1,A,F,E,R),O=[N,S];if(s&&O.push(s),E&&O.push(c),R){var M=i.makeTensorInfo([],"float32",r.createScalarValue(h,"float32"));O.push(M),C.push(M)}var P=i.runWebGLProgram(D,O,"float32"),L=vG({inputs:{x:P},backend:i,attrs:{shape:b?[1,y,g,a.outChannels]:[1,a.outChannels,y,g]}});C.push(P);for(var z=0,B=C;z<B.length;z++){var V=B[z];i.disposeIntermediateTensorInfo(V)}return L}var YH={kernelName:Ff,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dataFormat,l=a.dilations,h=a.dimRoundingMode,p=v.convertConv2DDataFormat(c),d=v.computeConv2DInfo(i.shape,o.shape,s,l,u,h,!1,p);if(1!==d.filterHeight||1!==d.filterWidth||1!==d.dilationHeight||1!==d.dilationWidth||1!==d.strideHeight||1!==d.strideWidth||"SAME"!==d.padInfo.type&&"VALID"!==d.padInfo.type)if(Jd().getBool("WEBGL_CONV_IM2COL")&&1===i.shape[0])t=XH({x:i,filter:o,convInfo:d,backend:r});else{var f=new HH(d);t=r.runWebGLProgram(f,[i,o],"float32")}else t=KH({x:i,filter:o,convInfo:d,backend:r});var m=vG({inputs:{x:t},backend:r,attrs:{shape:d.outShape}});return r.disposeIntermediateTensorInfo(t),m}},ZH=function e(t){_classCallCheck(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t.strideHeight," - ").concat(t.padInfo.top,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(t.strideWidth," - ").concat(t.padInfo.left,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              if (").concat("channelsLast"===t.dataFormat,") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},QH=function e(t){_classCallCheck(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a="channelsLast"===t.dataFormat;this.userCode="\n      const ivec2 pads = ivec2(".concat(n-1-t.padInfo.top,", ").concat(r-1-t.padInfo.left,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(a?3:1,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(a?1:2,"], coords[").concat(a?2:3,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n\n              if (").concat(a,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},JH=function e(t){_classCallCheck(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(t.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(t.strideDepth," - ").concat(t.padInfo.front,";\n\n            if (xF < 0 || xF >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(t.strideHeight," - ").concat(t.padInfo.top,";\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(t.strideWidth," - ").concat(t.padInfo.left,";\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},$H=function e(t){_classCallCheck(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth;this.userCode="\n      const ivec3 pads = ivec3(".concat(n-1-t.padInfo.front,", ").concat(r-1-t.padInfo.top,", ").concat(a-1-t.padInfo.left,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(n,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(t.strideDepth,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(t.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(n," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(r,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(r," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(a,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(a," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},ej={kernelName:Df,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape,h=v.convertConv2DDataFormat(u),p=v.computeConv2DInfo(a.shape,l,o,1,s,c,!1,h),d=new ZH(p);return n.runWebGLProgram(d,[a,i],"float32")}},tj={kernelName:Of,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode,h=v.convertConv2DDataFormat(c),p=v.computeConv2DInfo(o,i.shape,s,1,u,l,!1,h),d=new QH(p);return n.runWebGLProgram(d,[a,i],"float32")}},nj={kernelName:Mf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=v.computeConv3DInfo(a.shape,i.shape,o,u,s),l=new jH(c);return n.runWebGLProgram(l,[a,i],"float32")}},rj={kernelName:Pf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape,c=v.computeConv3DInfo(a.shape,u,o,1,s),l=new JH(c);return n.runWebGLProgram(l,[a,i],"float32")}},aj={kernelName:Lf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=r.inputShape,c=v.computeConv3DInfo(u,i.shape,s,1,o),l=new $H(c);return n.runWebGLProgram(l,[a,i],"float32")}},ij=uG({opSnippet:"if (isnan(x)) return x;\n  return cos(x);\n"}),oj={kernelName:zf,backendName:"webgl",kernelFunc:ij},sj=uG({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),uj={kernelName:Bf,backendName:"webgl",kernelFunc:sj},cj=function e(t,n,r,a,i){_classCallCheck(this,e),this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=_slicedToArray(t,4),s=o[0],u=o[1],c=o[2],l=o[3],h=_slicedToArray(n,1)[0],p=_slicedToArray(r,2),d=p[0],f=p[1];this.outputShape=[h,d,f,l];var m="bilinear"===a?1:0,v=u-1+".0",g=c-1+".0",y=_slicedToArray(d>1?[""+(u-1)/(d-1),"(y2-y1) * height_ratio","y1*".concat(v," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * "+v],3),b=y[0],k=y[1],x=y[2],w=_slicedToArray(f>1?[""+(c-1)/(f-1),"(x2-x1) * width_ratio","x1*".concat(g," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * "+g],3),C=w[0],_=w[1],S=w[2];this.userCode="\n      const float height_ratio = float(".concat(b,");\n      const float width_ratio = float(").concat(C,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(s,") {\n          return;\n        }\n\n        float height_scale = ").concat(k,";\n        float width_scale = ").concat(_,";\n\n        float in_y = ").concat(x,";\n        if( in_y < 0.0 || in_y > ").concat(v," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n        float in_x = ").concat(S,";\n        if( in_x < 0.0 || in_x > ").concat(g," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(m," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")},lj={kernelName:Uf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=new cj(a.shape,i.shape,s,u,c);return n.runWebGLProgram(l,[a,i,o],"float32")}},hj=function(){function e(t,n,r){_classCallCheck(this,e),this.variableNames=["x"],this.outputShape=t;var a=t.length,i=n?"0.0":"getX(".concat(pj(a,"coords"),")"),o=t[t.length-1],s="",u="";n?(s=r?"end != "+(o-1):"end != 0",u=r?"end + 1":"end - 1"):(s=r?"end + pow2 < "+o:"end >= pow2",u=r?"end + pow2":"end - pow2"),this.userCode="\n      uniform float index;\n      void main() {\n        ".concat(nW(a)," coords = getOutputCoords();\n        int end = ").concat(dj(a,"coords"),";\n        float val = ").concat(i,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(s,") {\n          int idx = ").concat(u,";\n          ").concat(dj(a,"coords")," = idx;\n          val += getX(").concat(pj(a,"coords"),");\n        }\n        setOutput(val);\n      }\n    ")}return _createClass(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;return function(n,r){null==t.index&&(t.index=n.getUniformLocation(r,"index")),n.gl.uniform1f(t.index,e)}}}]),e}();function pj(e,t){if(1===e)return""+t;if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw Error("Cumulative sum for rank ".concat(e," is not yet supported"))}function dj(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank ".concat(e," is not yet supported"))}var fj={kernelName:Vf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse,u=a.shape.length,c=v.getAxesPermutation([i],u),l=a;null!=c&&(l=IG({inputs:{x:a},backend:n,attrs:{perm:c}}));var h=v.getInnerMostAxes(1,u)[0];if(h!==u-1)throw new Error("WebGL cumsum shader expects an inner-most axis=".concat(a.shape.length-1," but got axis=")+i);for(var p=a.shape[h],d=JW({inputs:{x:l},backend:n}),f=0;f<=Math.ceil(Math.log2(p))-1;f++){var m=new hj(l.shape,!1,s),g=m.getCustomSetupFunc(f),y=d;d=n.runWebGLProgram(m,[d],d.dtype,g),n.disposeIntermediateTensorInfo(y)}if(o){var b=new hj(l.shape,o,s),k=d;d=n.runWebGLProgram(b,[d],d.dtype),n.disposeIntermediateTensorInfo(k)}if(null!=c){var x=IG({inputs:{x:d},backend:n,attrs:{perm:v.getUndoAxesPermutation(c)}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(l),x}return d}},mj={kernelName:Wf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=n.texData.get(a.dataId).values,c=n.texData.get(i.dataId).values,l=sW(u,c,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,l)}if(2===a.shape.length){var h=n.bufferSync(a),p=n.bufferSync(i),d=uW(h,p,o,s);return n.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+a.shape.length+".")}},vj=function(){function e(t,n,r){_classCallCheck(this,e),this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(n,";\n      int offset_h = imod(h, ").concat(n,");\n      int in_w = w / ").concat(n,";\n      int offset_w = imod(w, ").concat(n,");\n      int offset_d = (offset_h * ").concat(n," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}return _createClass(e,[{key:"getHeightCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}},{key:"getWidthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}},{key:"getDepthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}},{key:"getOutputDepthSize",value:function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}},{key:"getInputSamplingString",value:function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}]),e}(),gj={kernelName:Gf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.blockSize,s=a.dataFormat;r.assert(o>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+o}));var u=i.shape[0],c=("NHWC"===s?i.shape[1]:i.shape[2])*o,l=("NHWC"===s?i.shape[2]:i.shape[3])*o,h=("NHWC"===s?i.shape[3]:i.shape[1])/(o*o),p=new vj("NHWC"===s?[u,c,l,h]:[u,h,c,l],o,s);return n.runWebGLProgram(p,[i],i.dtype)}},yj=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];_classCallCheck(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.inHeight,s=t.inWidth,u=t.padInfo.top,c=t.padInfo.left,l=t.strideHeight,h=t.strideWidth,p=t.dilationHeight,d=t.dilationWidth,f=t.filterHeight,m=t.filterWidth,v=t.outChannels/t.inChannels,g="",y="";r&&(g=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),y="result = activation(result);");var b=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(g,"\n\n      const ivec2 strides = ivec2(").concat(l,", ").concat(h,");\n      const ivec2 pads = ivec2(").concat(u,", ").concat(c,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(v,";\n        int q = d2 - d1 * ").concat(v,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(f,"; wR++) {\n          int xR = xRCorner + wR * ").concat(p,";\n\n          if (xR < 0 || xR >= ").concat(o,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(m,"; wC++) {\n            int xC = xCCorner + wC * ").concat(d,";\n\n            if (xC < 0 || xC >= ").concat(s,") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(b,"\n        ").concat(y,"\n        setOutput(result);\n      }\n    ")},bj=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];_classCallCheck(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;for(var s=t.inHeight,u=t.inWidth,c=t.padInfo.top,l=t.padInfo.left,h=t.strideHeight,p=t.strideWidth,d=t.dilationHeight,f=t.dilationWidth,m=t.filterHeight,v=t.filterWidth,g=v,y="int xR; int xC; int xCOffset;",b=0;b<m;b++)for(var k=0;k<v;k++)y+="\n          vec4 xTexelR".concat(b,"C").concat(2*k," = vec4(0.);\n          vec4 wR").concat(b,"C").concat(k," = vec4(0.);\n          vec4 xR").concat(b,"C").concat(k," = vec4(0.);");for(var x=0;x<m;x++)for(var w=0;w<g;w++){var C=2*w;if(y+="\n          xR = xRCorner + ".concat(x*d,";\n          xC = xCCorner + ").concat(C*f,";\n        "),1===p){if(C<v&&(y+=l%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < ".concat(s," && xCOffset >= 0 && xCOffset < ").concat(u,") {\n                  xTexelR").concat(x,"C").concat(C," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ").concat(u,") {\n                    xTexelR").concat(x,"C").concat(C,".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR").concat(x,"C").concat(C," = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < ").concat(s," && xCOffset >= 0 && xCOffset < ").concat(u,") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ").concat(u,") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR").concat(x,"C").concat(C," = vec4(previous.zw, xTexelR").concat(x,"C").concat(C,".xy);\n                } else {\n                  xR").concat(x,"C").concat(C," = vec4(0, 0, xTexelR").concat(x,"C").concat(C,".xy);\n                }\n              "):"\n                if(xR >= 0 && xR < ".concat(s," && xC >= 0 && xC < ").concat(u,") {\n                  xTexelR").concat(x,"C").concat(C," = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR").concat(x,"C").concat(C," = vec4(0.);\n                }\n\n                xR").concat(x,"C").concat(C," = xTexelR").concat(x,"C").concat(C,";\n              "),C+1<v)){var _=l%2==0?r.nearestLargerEven(f):f;f%2==0&&l%2==1||f%2!=0&&l%2!=1?(y+="\n                  xCOffset = xC + ".concat(l%2," + ").concat(_,";\n\n                  if(xR >= 0 && xR < ").concat(s," &&\n                    xCOffset >= 0 && xCOffset < ").concat(u,") {\n                    xTexelR").concat(x,"C").concat(C+2," = getX(batch, xR, xCOffset, d1);\n                  }\n                "),f>1&&(y+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < ".concat(s," &&\n                      xCOffset >= 0 && xCOffset < ").concat(u,") {\n                      xTexelR").concat(x,"C").concat(C," = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR").concat(x,"C").concat(C," = vec4(0.);\n                    }\n                  ")),y+="\n                  xR".concat(x,"C").concat(C+1," = vec4(\n                    xTexelR").concat(x,"C").concat(C,".zw, xTexelR").concat(x,"C").concat(C+2,".xy);\n                ")):y+="\n                  xCOffset = xC + ".concat(_,";\n\n                  if(xR >= 0 && xR < ").concat(s," &&\n                    xCOffset >= 0 && xCOffset < ").concat(u,") {\n                    xTexelR").concat(x,"C").concat(C+2," = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR").concat(x,"C").concat(C+1," = xTexelR").concat(x,"C").concat(C+2,";\n                ")}}else C<v&&(y+="\n              if(xR >= 0 && xR < ".concat(s,") {\n            "),l%2==1?(y+="\n                xCOffset = xC + 1 - ".concat(p,";\n                if(xCOffset >= 0 && xCOffset < ").concat(u,") {\n                  xTexelR").concat(x,"C").concat(C," = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR").concat(x,"C").concat(C," = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < ").concat(u,") {\n                  xTexelR").concat(x,"C").concat(C+2," = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR").concat(x,"C").concat(C+2," = vec4(0.);\n                }\n\n                xR").concat(x,"C").concat(C," = vec4(\n                  xTexelR").concat(x,"C").concat(C,".zw, xTexelR").concat(x,"C").concat(C+2,".zw);\n              "),C+1<v&&(y+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + ".concat(p,";\n                  if(xCOffset >= 0 && xCOffset < ").concat(u,") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR").concat(x,"C").concat(C+1," = vec4(xTexelR").concat(x,"C").concat(C+2,".xy, final.xy);\n                "))):(y+="\n                if(xC >= 0 && xC < ".concat(u,") {\n                  xTexelR").concat(x,"C").concat(C," = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR").concat(x,"C").concat(C," = vec4(0.);\n                }\n\n                xCOffset = xC + ").concat(p,";\n                if(xCOffset >= 0 && xCOffset < ").concat(u,") {\n                  xTexelR").concat(x,"C").concat(C+2," = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR").concat(x,"C").concat(C+2," = vec4(0.);\n                }\n\n                xR").concat(x,"C").concat(C," = vec4(\n                  xTexelR").concat(x,"C").concat(C,".xy, xTexelR").concat(x,"C").concat(C+2,".xy);\n              "),C+1<v&&(y+="\n                  xR".concat(x,"C").concat(C+1," = vec4(\n                    xTexelR").concat(x,"C").concat(C,".zw, xTexelR").concat(x,"C").concat(C+2,".zw);\n                "))),y+="}");C<v&&(y+="\n            vec4 wTexelR".concat(x,"C").concat(C," = getW(").concat(x,", ").concat(C,", d1, q);\n            wR").concat(x,"C").concat(C," = vec4(wTexelR").concat(x,"C").concat(C,".xz, wTexelR").concat(x,"C").concat(C,".xz);\n          "),C+1<v&&(y+="\n              vec4 wTexelR".concat(x,"C").concat(C+1," = getW(").concat(x,", ").concat(C+1,", d1, q);\n              wR").concat(x,"C").concat(C+1," =\n                vec4(wTexelR").concat(x,"C").concat(C+1,".xz, wTexelR").concat(x,"C").concat(C+1,".xz);")))}for(var S=0;S<m;S++)for(var I=0;I<v;I++)y+="dotProd += xR".concat(S,"C").concat(I," * wR").concat(S,"C").concat(I,";");var T="",N="";a&&(T=i?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(a,"\n        }"):o?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(a,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(a,"\n        }"),N="result = activation(result);");var A=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(T,"\n\n      const ivec2 strides = ivec2(").concat(h,", ").concat(p,");\n      const ivec2 pads = ivec2(").concat(c,", ").concat(l,");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        ").concat(y,"\n\n        vec4 result = dotProd;\n        ").concat(A,"\n        ").concat(N,"\n        setOutput(result);\n      }\n    ")},kj={kernelName:Hf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.filter,s=a.strides,u=a.pad,c=a.dilations,l=a.dimRoundingMode,h=c;null==h&&(h=[1,1]),r.assert(v.eitherStridesOrDilationsAreOne(s,h),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '").concat(h,"'")}));var p,d=v.computeConv2DInfo(i.shape,o.shape,s,h,u,l,!0);return p=Jd().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels==1?new bj(d):new yj(d),n.runWebGLProgram(p,[i,o],"float32")}},xj=function e(t){_classCallCheck(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(t.outChannels/t.inChannels," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t.strideHeight," - ").concat(t.padInfo.top,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(t.strideWidth," - ").concat(t.padInfo.left,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},wj=function e(t){_classCallCheck(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(n-1-t.padInfo.top,", ").concat(r-1-t.padInfo.left,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(a,"; dm++) {\n              int d2 = d1 * ").concat(a," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},Cj={kernelName:jf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape,h=v.computeConv2DInfo(a.shape,l,o,s,u,c,!0),p=new xj(h);return n.runWebGLProgram(p,[a,i],"float32")}},_j={kernelName:qf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.inputShape,h=v.computeConv2DInfo(l,i.shape,o,s,u,c,!0),p=new wj(h);return n.runWebGLProgram(p,[a,i],"float32")}},Sj=function e(t){_classCallCheck(this,e),this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},Ij={kernelName:Kf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=t.x,i=[].concat(_toConsumableArray(a.shape),_toConsumableArray(a.shape)),o=r.sizeFromShape(a.shape),s=vG({inputs:{x:a},backend:n,attrs:{shape:[o]}}),u=new Sj(o),c=n.runWebGLProgram(u,[s],s.dtype),l=vG({inputs:{x:c},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(c),l}},Tj=function e(t){_classCallCheck(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.inHeight,r=t.inWidth,a=t.padInfo,i=t.strideHeight,o=t.strideWidth,s=t.filterHeight,u=t.filterWidth,c=t.dilationHeight,l=t.dilationWidth,h=a.top,p=a.left;this.userCode="\n      const ivec2 strides = ivec2(".concat(i,", ").concat(o,");\n      const ivec2 pads = ivec2(").concat(h,", ").concat(p,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(s,"; h++) {\n          int hIn = hBeg + h * ").concat(c,";\n\n          if (hIn >= 0 && hIn < ").concat(n,") {\n            for (int w = 0; w < ").concat(u,"; w++) {\n              int wIn = wBeg + w * ").concat(l,";\n\n              if (wIn >= 0 && wIn < ").concat(r,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")},Nj={kernelName:Xf,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dilations,l=v.computeDilation2DInfo(i.shape,o.shape,s,u,"NHWC",c),h=new Tj(l),p=vG({inputs:{x:t=r.runWebGLProgram(h,[i,o],"float32")},backend:r,attrs:{shape:l.outShape}});return r.disposeIntermediateTensorInfo(t),p}},Aj=uG({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),Ej={kernelName:Jf,backendName:"webgl",kernelFunc:Aj},Rj={kernelName:$f,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y,i=Jd().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new QW("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,a.shape):new ZW("return (b >= 1.0) ? a : a * (b + 1.0);",r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)}},Fj=cG({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool"}),Dj={kernelName:tm,backendName:"webgl",kernelFunc:Fj},Oj=uG({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(v.ERF_P,";\n  float a1 = ").concat(v.ERF_A1,";\n  float a2 = ").concat(v.ERF_A2,";\n  float a3 = ").concat(v.ERF_A3,";\n  float a4 = ").concat(v.ERF_A4,";\n  float a5 = ").concat(v.ERF_A5,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")}),Mj={kernelName:em,backendName:"webgl",kernelFunc:Oj},Pj="return exp(x);",Lj=uG({opSnippet:Pj,packedOpSnippet:Pj,cpuKernelImpl:lW}),zj={kernelName:nm,backendName:"webgl",kernelFunc:Lj};function Bj(e){var t=e.inputs,n=e.attrs,a=e.backend,i=n.dim,o=t.input,s=o.shape.length,u=o.shape.slice(),c=i;return i<0&&(r.assert(-(s+1)<=i,(function(){return"Axis must be in the interval [".concat(-(s+1),", ").concat(s,"]")})),c=s+i+1),u.splice(c,0,1),vG({inputs:{x:o},backend:a,attrs:{shape:u}})}var Vj={kernelName:rm,backendName:"webgl",kernelFunc:Bj},Uj="return exp(x) - 1.0;",Wj=uG({opSnippet:Uj,packedOpSnippet:Uj,cpuKernelImpl:hW}),Gj={kernelName:am,backendName:"webgl",kernelFunc:Wj},Hj=function e(t,n,r){_classCallCheck(this,e),this.variableNames=["real","imag"];var a=n[1];this.outputShape=n;var i,o=r?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,s=r?a+".0":"1.0";if("real"===t)i="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error('FFT component must be either "real" or "imag", got '.concat(t,"."));i="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(o,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(i,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(a,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(s,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")};function jj(e,t,n){var a=n.texData.get(e.dataId),i=r.sizeFromShape(e.shape),o=e.shape[e.shape.length-1],s=vG({inputs:{x:e},backend:n,attrs:{shape:[i/o,o]}}).shape,u=new Hj("real",s,t),c=new Hj("imag",s,t),l=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s}],h=n.runWebGLProgram(u,l,"float32"),p=n.runWebGLProgram(c,l,"float32"),d=eG({inputs:{real:h,imag:p},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p);var f=vG({inputs:{x:d},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(f),f}var qj={kernelName:im,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return jj(t.input,!1,n)}},Kj=function(){function e(t,n){_classCallCheck(this,e),this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return _createClass(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}}}]),e}();function Xj(e){var t=e.backend,n=e.attrs,a=n.shape,i=n.value,o=n.dtype;if("string"===(o=o||r.inferDtype(i))){var s=r.getArrayFromDType(o,r.sizeFromShape(a));return s.fill(i),t.makeTensorInfo(a,o,s)}var u=new Kj(a,i),c=u.getCustomSetupFunc(i);return t.runWebGLProgram(u,[],o,c)}var Yj,Zj={kernelName:om,backendName:"webgl",kernelFunc:Xj},Qj=function e(t){_classCallCheck(this,e),this.variableNames=["Image"],this.outputShape=[];var n=t[2];this.outputShape=t,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(n," - x;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(n,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")},Jj={kernelName:sm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n,i=new Qj(r.shape);return a.runWebGLProgram(i,[r],r.dtype)}},$j="return floor(x);",eq=uG({opSnippet:$j,packedOpSnippet:$j,cpuKernelImpl:pW}),tq={kernelName:um,backendName:"webgl",kernelFunc:eq},nq=cG({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),rq={kernelName:cm,backendName:"webgl",kernelFunc:nq},aq=function e(t){_classCallCheck(this,e),this.variableNames=["A"];var n=FU(),r=_slicedToArray(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(i,".0, ").concat(a,".0);\n\n        vec4 values = ").concat(n.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")},iq=function e(t){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=FU(),r=_slicedToArray(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(i,".0, ").concat(a,".0);\n            vec4 values = ").concat(n.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")},oq={kernelName:Xv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,i=r.numChannels,o="undefined"!=typeof HTMLVideoElement&&a instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement,u=_slicedToArray(o?[a.videoWidth,a.videoHeight]:[a.width,a.height],2),c=u[0],l=u[1],h=[l,c],p=[l,c,i];(s||o)&&(null==Yj&&(Yj=document.createElement("canvas").getContext("2d")),Yj.canvas.width=c,Yj.canvas.height=l,Yj.drawImage(a,0,0,c,l),a=Yj.canvas);var d=n.makeTensorInfo(h,"int32");n.texData.get(d.dataId).usage=tU.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),a);var f=Jd().getBool("WEBGL_PACK")?new iq(p):new aq(p),m=n.runWebGLProgram(f,[d],"int32");return n.disposeData(d.dataId),m}},sq={kernelName:Qv,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,a=e.backend,i=e.attrs,o=n.x,s=n.filter,u=n.bias,c=n.preluActivationWeights,l=i.strides,h=i.pad,p=i.dataFormat,d=i.dilations,f=i.dimRoundingMode,m=i.activation,g=i.leakyreluAlpha,y=v.convertConv2DDataFormat(p),b=v.computeConv2DInfo(o.shape,s.shape,l,d,h,f,!1,y),k=[];if(1!==b.filterHeight||1!==b.filterWidth||1!==b.dilationHeight||1!==b.dilationWidth||1!==b.strideHeight||1!==b.strideWidth||"SAME"!==b.padInfo.type&&"VALID"!==b.padInfo.type)if(Jd().getBool("WEBGL_CONV_IM2COL")&&1===o.shape[0])t=XH({x:o,filter:s,convInfo:b,backend:a,bias:u,activation:m,preluActivationWeights:c,leakyreluAlpha:g});else{var x=null!=u,w=null!=c,C="leakyrelu"===m,_=m?lG(m,!1):null,S=new HH(b,x,_,w,C),I=[o,s];if(u&&I.push(u),c&&I.push(c),C){var T=a.makeTensorInfo([],"float32",r.createScalarValue(g,"float32"));I.push(T),k.push(T)}t=a.runWebGLProgram(S,I,"float32")}else t=KH({x:o,filter:s,convInfo:b,backend:a,bias:u,activation:m,preluActivationWeights:c,leakyreluAlpha:g});var N=vG({inputs:{x:t},backend:a,attrs:{shape:b.outShape}});return k.push(t),k.forEach((function(e){return a.disposeIntermediateTensorInfo(e)})),N}},uq={kernelName:Jv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.filter,s=t.bias,u=t.preluActivationWeights,c=a.strides,l=a.pad,h=a.dilations,p=a.dimRoundingMode,d=a.activation,f=a.leakyreluAlpha,m=[],g=h;null==g&&(g=[1,1]),r.assert(v.eitherStridesOrDilationsAreOne(c,g),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(c," and dilations '").concat(g,"'")}));var y,b=v.computeConv2DInfo(i.shape,o.shape,c,g,l,p,!0),k=Jd().getBool("WEBGL_PACK_DEPTHWISECONV")&&b.strideWidth<=2&&b.outChannels/b.inChannels==1,x=d?lG(d,k):null,w=[i,o],C=null!=s,_=null!=u,S="leakyrelu"===d;if(C&&w.push(s),_&&w.push(u),S){var I=n.makeTensorInfo([],"float32",r.createScalarValue(f,"float32"));w.push(I),m.push(I)}y=k?new bj(b,C,x,_,S):new yj(b,C,x,_,S);var T=n.runWebGLProgram(y,w,"float32");return m.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),T}},cq=function e(t,n,r){_classCallCheck(this,e),this.sliceDim=t,this.strides=n,this.variableNames=["x","indices"],this.outputShape=r;var a=nW(n.length),i=nW(r.length);this.userCode="\n        ".concat(a," strides = ").concat(a,"(").concat(this.strides,");\n         void main() {\n          ").concat(i," coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < ").concat(this.sliceDim,"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * ").concat(this.sliceDim>1?"strides[j]":"strides",";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      ")},lq={kernelName:pm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=t.params,i=t.indices,o=i.shape,s=o[o.length-1],u=_slicedToArray(v.prepareAndValidate(a,i),4),c=u[0],l=u[1],h=u[2],p=u[3],d=vG({inputs:{x:i},backend:n,attrs:{shape:[l,s]}}),f=vG({inputs:{x:a},backend:n,attrs:{shape:[r.sizeFromShape(a.shape)/h,h]}}),m=new cq(s,p,[l,h]),g=n.runWebGLProgram(m,[f,d],f.dtype),y=vG({inputs:{x:g},backend:n,attrs:{shape:c}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),y}},hq=function e(t,n){_classCallCheck(this,e),this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;var r=nW(this.rank),a=function(e,t){for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],a=0;a<e.length;a++)r.push(2===a?"int(getIndices(resRC.x, resRC.z))":""+n[a]);return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        setOutput(getA(").concat(a,"));\n      }\n    ")},pq={kernelName:hm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.indices,s=a.axis,u=a.batchDims,c=r.parseAxisParam(s,i.shape)[0],l=v.segment_util.collectGatherOpShapeInfo(i,o,c,u),h=r.sizeFromShape(o.shape),p=[],d=vG({inputs:{x:i},backend:n,attrs:{shape:[l.batchSize,l.outerSize,l.dimSize,l.sliceSize]}}),f=vG({inputs:{x:o},backend:n,attrs:{shape:[l.batchSize,h/l.batchSize]}});p.push(d),p.push(f);var m=[l.batchSize,l.outerSize,h/l.batchSize,l.sliceSize];if(n.shouldExecuteOnCPU([i,o])||"string"===i.dtype){var g=n.bufferSync(f),y=n.bufferSync(d),b=dW(y,g,m);return p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(l.outputShape,b.dtype,b.values)}var k=new hq(d.shape,m),x=n.runWebGLProgram(k,[d,f],d.dtype);p.push(x);var w=vG({inputs:{x:x},backend:n,attrs:{shape:l.outputShape}});return p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),w}},dq=cG({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:fW,dtype:"bool"}),fq={kernelName:dm,backendName:"webgl",kernelFunc:dq},mq=cG({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool"}),vq={kernelName:fm,backendName:"webgl",kernelFunc:mq},gq={kernelName:vm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return jj(t.input,!0,n)}},yq=uG({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),bq={kernelName:ym,backendName:"webgl",kernelFunc:yq},kq=uG({opSnippet:"return float(isinf(x));",dtype:"bool"}),xq={kernelName:bm,backendName:"webgl",kernelFunc:kq},wq=uG({opSnippet:"return float(isnan(x));",dtype:"bool"}),Cq={kernelName:km,backendName:"webgl",kernelFunc:wq},_q=cG({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:mW,dtype:"bool"}),Sq={kernelName:wm,backendName:"webgl",kernelFunc:_q},Iq=cG({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",dtype:"bool"}),Tq={kernelName:Cm,backendName:"webgl",kernelFunc:Iq},Nq={kernelName:_m,backendName:"webgl",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.num,o=vW(r,a,i);return t.makeTensorInfo([o.length],"float32",o)}},Aq=uG({opSnippet:"if (x < 0.0) return NAN;\n  return log(x);",packedOpSnippet:"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:gW}),Eq={kernelName:Sm,backendName:"webgl",kernelFunc:Aq},Rq=uG({opSnippet:"return log(1.0 + x);"}),Fq={kernelName:Im,backendName:"webgl",kernelFunc:Rq},Dq=cG({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),Oq={kernelName:Tm,backendName:"webgl",kernelFunc:Dq},Mq=uG({opSnippet:"return float(!(x >= 1.0));"}),Pq={kernelName:Nm,backendName:"webgl",kernelFunc:Mq},Lq=cG({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),zq={kernelName:Am,backendName:"webgl",kernelFunc:Lq},Bq=function e(t,n,r,a,i){_classCallCheck(this,e),this.variableNames=["x"],this.outputShape=[];var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(s,"; j <= ").concat(s,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(u,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(o,";\n        setOutput(val);\n      }\n    ")},Vq=function e(t,n,r,a,i){_classCallCheck(this,e),this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(s,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(s,"; j <= ").concat(s,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(u,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(o,";\n        setOutput(result);\n      }\n    ")},Uq={kernelName:Rm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta,c=Jd().getBool("WEBGL_PACK_NORMALIZATION")?new Vq(a.shape,i,o,s,u):new Bq(a.shape,i,o,s,u);return n.runWebGLProgram(c,[a],a.dtype)}},Wq=function e(t,n,r,a,i){_classCallCheck(this,e),this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=r,this.alpha=a,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(n,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(n," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(a,") * norm + float(").concat(r,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(a,")\n                * float(").concat(i,")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(i,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")},Gq={kernelName:Fm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta,h=new Wq(a.shape,s,u,c,l);return n.runWebGLProgram(h,[a,i,o],a.dtype)}};function Hq(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.reductionIndices,s=a.keepDims,u=i.shape.length,c=r.parseAxisParam(o,i.shape),l=c,h=v.getAxesPermutation(l,u),p=null!=h,d=n.shouldExecuteOnCPU([i]),f=i;if(p){if(d){for(var m=n.texData.get(f.dataId).values,g=new Array(u),y=0;y<g.length;y++)g[y]=i.shape[h[y]];var b=FW(m,i.shape,i.dtype,h,g);f=n.makeTensorInfo(g,i.dtype),n.texData.get(f.dataId).values=b}else f=CG(i,h,n);l=v.getInnerMostAxes(l.length,u)}v.assertAxesAreInnerMostDims("max",l,u);var k,x=_slicedToArray(v.computeOutAndReduceShapes(f.shape,l),2),w=x[0],C=x[1],_=w;if(s&&(_=v.expandShapeToKeepDim(w,c)),d){var S=n.texData.get(f.dataId),I=yW(S.values,r.sizeFromShape(C),_,i.dtype);k=n.makeTensorInfo(_,i.dtype),n.texData.get(k.dataId).values=I}else k=function(e,t,n,a){var i=r.sizeFromShape(t),o=vG({inputs:{x:e},attrs:{shape:[r.sizeFromShape(e.shape)/i,i]},backend:a}),s=kG(o,e.dtype,"max",a),u=vG({inputs:{x:s},attrs:{shape:n},backend:a});return a.disposeIntermediateTensorInfo(o),a.disposeIntermediateTensorInfo(s),u}(f,C,_,n);return p&&n.disposeIntermediateTensorInfo(f),k}var jq={kernelName:Dm,backendName:"webgl",kernelFunc:Hq},qq=cG({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:bW}),Kq={kernelName:Om,backendName:"webgl",kernelFunc:qq},Xq={kernelName:Mm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x;EU(i,"maxPool");var o=a.filterSize,s=a.strides,u=a.pad,c=a.dimRoundingMode;r.assert(v.eitherStridesOrDilationsAreOne(s,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '1'")}));var l=v.computePool2DInfo(i.shape,o,s,1,u,c);if(1===l.filterWidth&&1===l.filterHeight&&r.arraysEqual(l.inShape,l.outShape))return JW({inputs:{x:i},backend:n});var h=new aH(l,"max",!1);return n.runWebGLProgram(h,[i],i.dtype)}},Yq={kernelName:Lm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=v.computePool3DInfo(a.shape,i,o,[1,1,1],s,c,u),h=new iH(l,"max",!1);return n.runWebGLProgram(h,[a],a.dtype)}},Zq=function e(t){_classCallCheck(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.effectiveFilterHeight,r=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2(".concat(n-1-t.padInfo.top,", ").concat(r-1-t.padInfo.left,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,";\n          wR += ").concat(t.dilationHeight,") {\n          float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(n*r-1," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(r," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},Qq=function e(t){_classCallCheck(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.effectiveFilterDepth,r=t.effectiveFilterHeight,a=t.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3(".concat(n-1-t.padInfo.front,", ").concat(r-1-t.padInfo.top,", ").concat(a-1-t.padInfo.left,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(n,";\n           wD += ").concat(t.dilationDepth,") {\n          float dyD = float(dyDCorner + wD) / ").concat(t.strideDepth,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(r,";\n              wR += ").concat(t.dilationHeight,") {\n            float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(a,";\n                wC += ").concat(t.dilationWidth,") {\n              float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(n*r*a-1," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(r," * ").concat(a," +\n                  wR * ").concat(a," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},Jq={kernelName:zm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=v.computePool3DInfo(i.shape,o,s,[1,1,1],u,c),h=new iH(l,"max",!0),p=n.runWebGLProgram(h,[i],i.dtype),d=new Qq(l),f=n.runWebGLProgram(d,[a,p],i.dtype);return n.disposeIntermediateTensorInfo(p),f}},$q={kernelName:Pm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;EU([i,t.output],"maxPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,h=v.computePool2DInfo(o.shape,s,u,1,c,l),p=new aH(h,"max",!0),d=n.runWebGLProgram(p,[o],o.dtype),f=new Zq(h),m=n.runWebGLProgram(f,[a,d],o.dtype);return n.disposeIntermediateTensorInfo(d),m}},eK={kernelName:Bm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,a=e.backend,i=t.x,o=n.filterSize,s=n.strides,u=n.pad,c=n.includeBatchInIndex,l=a;r.assert(4===i.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(i.shape.length,".")}));var h=[1,1];r.assert(v.eitherStridesOrDilationsAreOne(s,h),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '").concat(h,"'")}));var p=v.computePool2DInfo(i.shape,o,s,h,u),d=_slicedToArray(function(e,t,n,r){var a=new aH(n,"max",!1),i=r.runWebGLProgram(a,[e],"float32");return a=new aH(n,"max",!0,!0,t),[i,r.runWebGLProgram(a,[e],"float32")]}(i,c,p,l),2);return[d[0],d[1]]}},tK={kernelName:Vm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,a=e.backend,i=t.x,o=n.keepDims,s=n.axis,u=a,c=i.shape.length,l=r.parseAxisParam(s,i.shape),h=l,p=v.getAxesPermutation(h,c),d=null!=p,f=u.shouldExecuteOnCPU([i]),m=[],g=i;if(d){if(f){for(var y=u.texData.get(g.dataId).values,b=new Array(c),k=0;k<b.length;k++)b[k]=i.shape[p[k]];var x=FW(y,i.shape,i.dtype,p,b);g=u.makeTensorInfo(b,i.dtype),u.texData.get(g.dataId).values=x}else g=CG(i,p,u);m.push(g),h=v.getInnerMostAxes(h.length,c)}v.assertAxesAreInnerMostDims("sum",h,c);var w=_slicedToArray(v.computeOutAndReduceShapes(g.shape,h),2),C=w[0],_=w[1],S=C;o&&(S=v.expandShapeToKeepDim(C,l));for(var I=function(e,t,n,a){var i=r.sizeFromShape(t),o=vG({inputs:{x:e},attrs:{shape:[r.sizeFromShape(e.shape)/i,i]},backend:a}),s=kG(o,"float32","mean",a),u=vG({inputs:{x:s},attrs:{shape:n},backend:a});return a.disposeIntermediateTensorInfo(o),a.disposeIntermediateTensorInfo(s),u}(g,_,S,u),T=0,N=m;T<N.length;T++){var A=N[T];u.disposeIntermediateTensorInfo(A)}return I}},nK={kernelName:Um,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.axis,s=a.keepDims,u=i.shape.length,c=r.parseAxisParam(o,i.shape),l=c,h=v.getAxesPermutation(l,u),p=i;null!=h&&(p=IG({inputs:{x:i},backend:n,attrs:{perm:h}}),l=v.getInnerMostAxes(l.length,i.shape.length)),v.assertAxesAreInnerMostDims("min",l,u);var d,f=_slicedToArray(v.computeOutAndReduceShapes(p.shape,l),2),m=f[0],g=f[1],y=vG({inputs:{x:p},backend:n,attrs:{shape:[-1,r.sizeFromShape(g)]}}),b=kG(y,y.dtype,"min",n);return d=vG(s?{inputs:{x:b},backend:n,attrs:{shape:v.expandShapeToKeepDim(m,c)}}:{inputs:{x:b},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),null!=h&&n.disposeIntermediateTensorInfo(p),d}},rK=cG({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:kW}),aK={kernelName:Wm,backendName:"webgl",kernelFunc:rK},iK=function e(t,n,r){_classCallCheck(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=nW(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c="reflect"===r?0:1;this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(a,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(c,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(c,";\n          }\n        }\n        ").concat(i," coords = outC - start;\n        setOutput(getX(").concat(u,"));\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(c,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(c,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")},oK=function e(t,n,r){_classCallCheck(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=nW(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=MW("rc",a),c=MW("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),h=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),p="reflect"===r?0:1,d="";if(1===a){var f="\n        ".concat(i," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(p,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(p,";\n        }\n        source -= start;\n      ");d="\n        ".concat(i," rc = outputLoc;\n        ").concat(f,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(f,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n      ")}else{var m="\n        ".concat(i," source = rc;\n        ").concat(i," lt = ").concat(i,"(lessThan(source, start));\n        ").concat(i," gte = ").concat(i,"(greaterThanEqual(source, end));\n        ").concat(i," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(p,") +\n                gte * ((end - 1) * 2 - source + ").concat(p,");\n        source -= start;\n      ");d="\n        ".concat(i," rc = outputLoc;\n        ").concat(m,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(m,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n        rc = outputLoc;\n        ").concat(u[a-2]," += 1;\n        if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {\n          ").concat(m,"\n          result[2] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n          ").concat(u[a-1]," += 1;\n          if(").concat(l,") {\n            ").concat(m,"\n            result[3] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(d,"\n        setOutput(result);\n      }\n    ")},sK={kernelName:Gm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode,s=Jd().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new oK(a.shape,i,o):new iK(a.shape,i,o);return n.runWebGLProgram(s,[a],a.dtype)}},uK=cG({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),cK={kernelName:Hm,backendName:"webgl",kernelFunc:uK},lK=function(){function e(t,n,r){_classCallCheck(this,e),this.variableNames=["probs"],this.outputShape=[t,r],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(n-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(n-1,"));\n      }\n    ")}return _createClass(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}}}]),e}(),hK=cG({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),pK={kernelName:Qf,backendName:"webgl",kernelFunc:hK},dK="return a - b;",fK=cG({opSnippet:dK,packedOpSnippet:dK,supportsComplex:!0,cpuKernelImpl:AW}),mK={kernelName:Mv,backendName:"webgl",kernelFunc:fK};function vK(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.logits,o=a.dim,s=r.parseAxisParam([o],i.shape),u=Hq({inputs:{x:i},backend:n,attrs:{reductionIndices:s,keepDims:!1}}),c=v.expandShapeToKeepDim(u.shape,s),l=vG({inputs:{x:u},backend:n,attrs:{shape:c}}),h=fK({inputs:{a:i,b:l},backend:n}),p=Lj({inputs:{x:h},backend:n}),d=_G({inputs:{x:p},backend:n,attrs:{axis:s,keepDims:!1}}),f=vG({inputs:{x:d},backend:n,attrs:{shape:c}}),m=hK({inputs:{a:p,b:f},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),m}var gK={kernelName:Fv,backendName:"webgl",kernelFunc:vK},yK={kernelName:jm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized,u=s?a:vK({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),c=new lK(u.shape[0],u.shape[1],i),l=c.getCustomSetupFunc(o),h=n.runWebGLProgram(c,[u],"int32",l);return s||n.disposeIntermediateTensorInfo(u),h}},bK="return -x;",kK={kernelName:Km,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])){var i=r.texData.get(a.dataId),o=_slicedToArray(wW(i.values,a.shape,a.dtype),2),s=o[0],u=o[1];return r.makeTensorInfo(u,a.dtype,s)}return t=Jd().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new jW(a.shape,bK):new WW(a.shape,bK),r.runWebGLProgram(t,[a],a.dtype)}},xK=g.nonMaxSuppressionV3Impl,wK={kernelName:Ym,backendName:"webgl",kernelFunc:function(e){v.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=n.readSync(a.dataId),l=n.readSync(i.dataId),h=xK(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},CK=g.nonMaxSuppressionV4Impl,_K={kernelName:Zm,backendName:"webgl",kernelFunc:function(e){v.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize,l=n.readSync(a.dataId),h=n.readSync(i.dataId),p=CK(l,h,o,s,u,c),d=p.selectedIndices,f=p.validOutputs;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}},SK=g.nonMaxSuppressionV5Impl,IK={kernelName:Qm,backendName:"webgl",kernelFunc:function(e){v.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma,l=n.readSync(a.dataId),h=n.readSync(i.dataId),p=SK(l,h,o,s,u,c),d=p.selectedIndices,f=p.selectedScores;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([f.length],"float32",new Float32Array(f))]}},TK=function e(t,n,r,a){_classCallCheck(this,e),this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(a,"), float(").concat(r,"),\n                      float(index == coords.y)));\n      }\n    ")},NK={kernelName:$m,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.indices,o=a.depth,s=a.onValue,u=a.offValue,c=r.sizeFromShape(i.shape),l=new TK(c,o,s,u),h=vG({inputs:{x:i},backend:n,attrs:{shape:[c]}}),p=n.runWebGLProgram(l,[h],i.dtype);n.disposeIntermediateTensorInfo(h);var d=vG({inputs:{x:p},backend:n,attrs:{shape:[].concat(_toConsumableArray(i.shape),[o])}});return n.disposeIntermediateTensorInfo(p),d}};function AK(e){var t=e.inputs,n=e.backend,r=t.x;if("complex64"===r.dtype){var a=SH({inputs:{input:r},backend:n}),i=AK({inputs:{x:a},backend:n}),o=VH({inputs:{input:r},backend:n}),s=AK({inputs:{x:o},backend:n}),u=eG({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return Xj({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}var EK={kernelName:qv,backendName:"webgl",kernelFunc:AK},RK={kernelName:Jm,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){var i=SH({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=VH({inputs:{input:a},backend:r}),u=AK({inputs:{x:s},backend:r}),c=eG({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return Xj({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}},FK={kernelName:ev,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs.axis;if(1===t.length)return Bj({inputs:{input:t[0]},backend:n,attrs:{dim:a}});var i=t[0].shape,o=t[0].dtype;t.forEach((function(e){r.assertShapesMatch(i,e.shape,"All tensors passed to stack must have matching shapes"),r.assert(o===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var s=[],u=WH({inputs:t.map((function(e){var t=Bj({inputs:{input:e},backend:n,attrs:{dim:a}});return s.push(t),t})),backend:n,attrs:{axis:a}});return s.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),u}},DK=function e(t,n,r){_classCallCheck(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=nW(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float(").concat(r,"));\n        } else {\n          ").concat(i," coords = outC - start;\n          setOutput(getX(").concat(u,"));\n        }\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float(").concat(r,"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")},OK=function e(t,n,r){_classCallCheck(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));for(var a=t.length,i=nW(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=MW("rc",a),c=MW("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),h=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),p=[i+" rc = outputLoc;","".concat(u[a-1]," += 1;\n       if(").concat(l,") {\n      "),1===a?"":"}\n       rc = outputLoc;\n       ".concat(u[a-2]," += 1;\n       if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),1===a?"":"  ".concat(u[a-1]," += 1;\n         if(").concat(l,") {")],d=1===a?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",m=0,v=1===a?2:4;m<v;m++)f+="\n        ".concat(p[m],"\n        if (").concat(d,") {\n          result[").concat(m,"] = float(").concat(r,");\n        } else {\n          ").concat(i," source = rc - start;\n          result[").concat(m,"] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n      ");f+=1===a?"} ":"}}",this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(f,"\n        setOutput(result);\n      }\n    ")},MK=function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue,s=Jd().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new OK(a.shape,i,o):new DK(a.shape,i,o);return n.runWebGLProgram(s,[a],a.dtype)},PK={kernelName:tv,backendName:"webgl",kernelFunc:MK},LK=cG({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),zK={kernelName:rv,backendName:"webgl",kernelFunc:LK},BK={kernelName:iv,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,a=e.backend,i=e.attrs,o=n.x,s=i.axis,u=i.keepDims,c=o.shape.length,l=[],h=r.parseAxisParam(s,o.shape),p=h,d=v.getAxesPermutation(p,c),f=o;if(null!=d&&(f=IG({inputs:{x:o},backend:a,attrs:{perm:d}}),p=v.getInnerMostAxes(p.length,c),l.push(f)),v.assertAxesAreInnerMostDims("prod",p,c),a.shouldExecuteOnCPU([f])){var m=a.texData.get(f.dataId).values,g=CW(f.shape,f.dtype,m,p),y=g.outVals,b=g.outShape,k=g.outDtype;t=a.makeTensorInfo(b,k,y)}else{var x=_slicedToArray(v.computeOutAndReduceShapes(f.shape,p),2),w=x[0],C=x[1],_=r.sizeFromShape(C),S=vG({inputs:{x:f},backend:a,attrs:{shape:[-1,_]}}),I=kG(S,Dg(o.dtype),"prod",a);t=vG({inputs:{x:I},backend:a,attrs:{shape:w}}),l.push(S),l.push(I)}if(u){l.push(t);var T=v.expandShapeToKeepDim(t.shape,h);t=vG({inputs:{x:t},backend:a,attrs:{shape:T}})}return l.forEach((function(e){return a.disposeIntermediateTensorInfo(e)})),t}},VK=function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.step,o=n.dtype,s=_W(r,a,i,o);return t.makeTensorInfo([s.length],o,s)},UK={kernelName:ov,backendName:"webgl",kernelFunc:VK},WK=uG({opSnippet:"return 1.0 / x;"}),GK={kernelName:uv,backendName:"webgl",kernelFunc:WK},HK=uG({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),jK={kernelName:cv,backendName:"webgl",kernelFunc:HK},qK=uG({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),KK={kernelName:mv,backendName:"webgl",kernelFunc:qK},XK=function e(t,n,r,a,i){_classCallCheck(this,e),this.variableNames=["A"],this.outputShape=[];var o=_slicedToArray(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var h,p=[a&&n>1?u-1:u,a&&r>1?c-1:c],d=[a&&n>1?n-1:n,a&&r>1?r-1:r];h=i?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(p[0]/d[0],",\n          ").concat(p[1]/d[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(c,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")},YK=function e(t,n,r,a,i){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=_slicedToArray(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var h,p=[a&&n>1?u-1:u,a&&r>1?c-1:c],d=[a&&n>1?n-1:n,a&&r>1?r-1:r];h=i?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(p[0]/d[0],",\n          ").concat(p[1]/d[1],",\n          ").concat(p[1]/d[1],");\n      const vec3 inputShapeRC = vec3(").concat(u,".0, ").concat(c,".0,\n                                     ").concat(c,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")},ZK={kernelName:dv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=_slicedToArray(r.size,2),u=s[0],c=s[1],l=Jd().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new YK(a.shape,u,c,i,o):new XK(a.shape,u,c,i,o);return n.runWebGLProgram(l,[a],"float32")}},QK=function e(t,n,r){_classCallCheck(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=_slicedToArray(n,3),i=a[1],o=a[2],s=_slicedToArray(t,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],h=[r&&u>1?u-1:u,r&&c>1?c-1:c],p=l[0]/h[0],d=l[1]/h[1],f=1/p,m=1/d,v=2*Math.ceil(f)+2,g=2*Math.ceil(m)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(p,");\n        const float widthScale = float(").concat(d,");\n\n        const float invHeightScale = float(").concat(f,");\n        const float invWidthScale = float(").concat(m,");\n\n        const int winHeight = int(").concat(v,");\n        const int winWidth = int(").concat(g,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(i-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(o-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")},JK={kernelName:fv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new QK(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},$K=function e(t,n,r,a,i){_classCallCheck(this,e),this.variableNames=["A"],this.outputShape=[];var o=_slicedToArray(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var h,p=[a&&n>1?u-1:u,a&&r>1?c-1:c],d=[a&&n>1?n-1:n,a&&r>1?r-1:r];h=i?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(p[0]/d[0],",\n          ").concat(p[1]/d[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(c,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(a?"0.5":"0.0",")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")},eX={kernelName:hv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=_slicedToArray(r.size,2),u=s[0],c=s[1],l=new $K(a.shape,u,c,i,o);return n.runWebGLProgram(l,[a],a.dtype)}},tX=function e(t,n,r){_classCallCheck(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=_slicedToArray(n,3),i=a[1],o=a[2],s=_slicedToArray(t,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],h=[r&&u>1?u-1:u,r&&c>1?c-1:c],p=l[0]/h[0],d=l[1]/h[1],f=1/p,m=1/d,v=2*Math.ceil(f)+2,g=2*Math.ceil(m)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(p,");\n        const float widthScale = float(").concat(d,");\n\n        const float invHeightScale = float(").concat(f,");\n        const float invWidthScale = float(").concat(m,");\n\n        const int winHeight = int(").concat(v,");\n        const int winWidth = int(").concat(g,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(l[0],") *\n                (float(dyR) / float(").concat(h[0],"));\n\n            float sourceFracCol =\n                float(").concat(l[1],") *\n                  (float(dyC) / float(").concat(h[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(i,") - 1),\n                ").concat(r," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(o,") - 1),\n                ").concat(r," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")},nX={kernelName:pv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new tX(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},rX=function e(t,n){_classCallCheck(this,e),this.variableNames=["x"];var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));if(this.outputShape=t,1!==r){var a=t.map((function(e,r){return function(e){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - coords[").concat(e,"] - 1"):"coords[".concat(e,"]")}(r)})).join(","),i=nW(r);this.userCode="\n      void main() {\n        ".concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(a,"));\n      }\n    ")}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(t[0]," - coord - 1));\n        }\n      ")},aX=function e(t,n){_classCallCheck(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));this.outputShape=t;var a=MW("rc",r),i="".concat(a[r-1]," + 1 < ").concat(this.outputShape[r-1]),o="".concat(a[r-2]," + 1 < ").concat(this.outputShape[r-2]),s=nW(r);function u(e){var r=t.map((function(r,a){return function(e,r){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - ").concat(r[e]," - 1"):""+r[e]}(a,e)}));return"getChannel(getX(".concat(r.join(","),"), vec2(").concat(r.slice(-2).join(","),"))")}this.userCode=1===r?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(t[0]," - rc - 1),\n            ").concat(t[0]," - rc - 1);\n          if(").concat(i,"){\n              result.g = getChannel(getX(").concat(t[0]," - (rc  + 1) - 1),\n                ").concat(t[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(s," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return u(e)}(a.slice()),";\n          if(").concat(i,"){\n            result.g = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",u(e)}(a.slice()),";\n          }\n          if(").concat(o,") {\n            result.b = ").concat(function(e){return e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            if(").concat(i,") {\n              result.a = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")},iX={kernelName:vv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.dims,s=i.shape.length,u=r.parseAxisParam(o,i.shape);if(0===s)return JW({inputs:{x:i},backend:n});var c=Jd().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new aX(i.shape,u):new rX(i.shape,u);return n.runWebGLProgram(c,[i],i.dtype)}},oX=function e(t,n,r,a){_classCallCheck(this,e),this.variableNames=["Image"],this.outputShape=[];var i=t[1],o=t[2],s=Math.sin(n).toFixed(3),u=Math.cos(n).toFixed(3);this.outputShape=t;var c,l=_slicedToArray(v.getImageCenter(a,i,o),2),h=l[0],p=l[1],d=h.toFixed(3),f=p.toFixed(3);c="number"==typeof r?"float outputValue = ".concat(r.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(r.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - ".concat(d,") * ").concat(u," - (float(y) - ").concat(f,") * ").concat(s,";\n          float coordYFloat = (float(x) - ").concat(d,") * ").concat(s," + (float(y) - ").concat(f,") * ").concat(u,";\n          int coordX = int(round(coordXFloat + ").concat(d,"));\n          int coordY = int(round(coordYFloat + ").concat(f,"));\n          ").concat(c,"\n          if(coordX >= 0 && coordX < ").concat(o," && coordY >= 0 && coordY < ").concat(i,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")},sX={kernelName:Yv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=new oX(a.shape,i,o,s);return u.runWebGLProgram(c,[a],a.dtype)}},uX=uG({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),cX={kernelName:gv,backendName:"webgl",kernelFunc:uX},lX=uG({opSnippet:"return inversesqrt(x);",cpuKernelImpl:SW}),hX={kernelName:yv,backendName:"webgl",kernelFunc:lX},pX=function e(t,n,r,a,i,o){!(arguments.length>6&&void 0!==arguments[6])||arguments[6];_classCallCheck(this,e),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=nW(i.length),u=nW(o.length),c="";1===r?c="i":2===r&&(c="i, j");var l="";1===a?l="i":2===a&&(l="i, coords[1]"),this.userCode="\n        ".concat(s," strides = ").concat(s,"(").concat(i,");\n\n        void main() {\n          ").concat(u," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(t,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(n,"; j++) {\n              int index = round(getIndices(").concat(c,"));\n              flattenedIndex += index * ").concat(n>1?"strides[j]":"strides",";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates(").concat(l,");\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      ")},dX={kernelName:bv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=v.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,h=s.strides,p=s.outputSize,d=[p/l,l];if(0===p)return n.makeTensorInfo(o,a.dtype);var f=vG({inputs:{x:a},backend:n,attrs:{shape:[c,u]}}),m=vG({inputs:{x:i},backend:n,attrs:{shape:[c,l]}}),g=n.makeTensorInfo([],"float32",new Float32Array([0])),y=new pX(c,u,f.shape.length,m.shape.length,h,d),b=n.runWebGLProgram(y,[m,f,g],m.dtype),k=vG({inputs:{x:b},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(g),k}},fX=function e(t,n,r){var a,i;if(_classCallCheck(this,e),this.variableNames=["c","a","b"],this.outputShape=n,r>4)throw Error("Where for rank ".concat(r," is not yet supported"));if(1===r)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<n.length;c++)u.push(""+o[c]),c<t&&s.push(""+o[c]);a=s.join(),i=u.join()}var l=nW(r);this.userCode="\n      void main() {\n        ".concat(l," resRC = getOutputCoords();\n        float cVal = getC(").concat(a,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(i,"));\n        } else {\n          setOutput(getB(").concat(i,"));\n        }\n      }\n    ")},mX={kernelName:kv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e,o=new fX(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(o,[r,a,i],Fg(a.dtype,i.dtype))}},vX=uG({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(v.SELU_SCALEALPHA,";\n  float scale = ").concat(v.SELU_SCALE,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")}),gX={kernelName:xv,backendName:"webgl",kernelFunc:vX},yX=uG({opSnippet:"return 1.0 / (1.0 + exp(-1.0 * x));"}),bX={kernelName:Iv,backendName:"webgl",kernelFunc:yX},kX=uG({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),xX={kernelName:Sv,backendName:"webgl",kernelFunc:kX},wX=uG({opSnippet:"if (isnan(x)) return x;\n  return sin(x);\n"}),CX={kernelName:Cv,backendName:"webgl",kernelFunc:wX},_X=uG({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),SX={kernelName:_v,backendName:"webgl",kernelFunc:_X},IX=uG({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),TX={kernelName:Tv,backendName:"webgl",kernelFunc:IX},NX={kernelName:Ev,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.blockShape,s=a.paddings;r.assert(i.shape.length<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var u=o.reduce((function(e,t){return e*t})),c=[[0,0]];c.push.apply(c,_toConsumableArray(s));for(var l=1+o.length;l<i.shape.length;++l)c.push([0,0]);var h=[],p=MK({inputs:{x:i},backend:n,attrs:{paddings:c,constantValue:0}}),d=v.getReshaped(p.shape,o,u,!1),f=v.getPermuted(d.length,o.length,!1),m=v.getReshapedPermuted(p.shape,o,u,!1),g=vG({inputs:{x:p},backend:n,attrs:{shape:d}}),y=IG({inputs:{x:g},backend:n,attrs:{perm:f}}),b=vG({inputs:{x:y},backend:n,attrs:{shape:m}});return h.push(p),h.push(g),h.push(y),h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),b}},AX={kernelName:Pv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,i=t.sparseValues,o=t.defaultValue,s=r.outputShape,u=v.calculateShapes(i,a,s),c=u.sliceRank,l=u.numUpdates,h=u.strides,p=u.outputSize,d=new pX(l,c,a.shape.length,i.shape.length,h,[p,1],!1),f=n.runWebGLProgram(d,[i,a,o],i.dtype),m=vG({inputs:{x:f},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(f),m}},EX={kernelName:Rv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.numOrSizeSplits,s=a.axis,u=r.parseAxisParam(s,i.shape)[0],c=v.prepareSplitSize(i,o,u),l=new Array(i.shape.length).fill(0),h=i.shape.slice();return c.map((function(e){var t=_toConsumableArray(h);t[s]=e;var r=bH({inputs:{x:i},backend:n,attrs:{begin:l,size:t}});return l[s]+=e,r}))}},RX=uG({opSnippet:"return sqrt(x);"}),FX={kernelName:Nv,backendName:"webgl",kernelFunc:RX},DX=uG({opSnippet:"return x * x;"}),OX={kernelName:Ov,backendName:"webgl",kernelFunc:DX},MX=cG({opSnippet:"return (a - b) * (a - b);",packedOpSnippet:"return (a - b) * (a - b);"}),PX={kernelName:Dv,backendName:"webgl",kernelFunc:MX},LX={kernelName:Kv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=new WW(a.shape,"if (isnan(x)) return x;\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "));return r.runWebGLProgram(i,[a],a.dtype)}},zX=function e(t,n,r){_classCallCheck(this,e),this.variableNames=["x"],this.outputShape=r;var a=r.length,i=nW(r.length),o=nW(r.length),s="";if(1===a)s="coords * strides + begin";else{var u=0;s=r.map((function(e,t){return u++,1===r.length?"coords * strides[".concat(t,"] + begin[").concat(t,"]"):"coords[".concat(u-1,"] * strides[").concat(t,"] + begin[").concat(t,"]")})).join(",")}this.userCode="\n      ".concat(i," begin = ").concat(i,"(").concat(t,");\n      ").concat(i," strides = ").concat(i,"(").concat(n,");\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")},BX={kernelName:Lv,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.begin,s=a.end,u=a.strides,c=a.beginMask,l=a.endMask,p=a.ellipsisMask,d=a.newAxisMask,f=a.shrinkAxisMask,m=h.sliceInfo(i.shape,o,s,u,c,l,p,d,f),v=m.nonStrided,g=m.$begin,y=m.$strides,b=m.size,k=m.newShape,x=m.outShape,w=vG({inputs:{x:i},backend:r,attrs:{shape:k}});if(v){var C=bH({inputs:{x:w},backend:r,attrs:{begin:g,size:b}});t=vG({inputs:{x:C},backend:r,attrs:{shape:x}}),r.disposeIntermediateTensorInfo(C)}else if(x.some((function(e){return 0===e})))t=r.makeTensorInfo(x,i.dtype,[]);else if(r.shouldExecuteOnCPU([w])){var _=r.texData.get(w.dataId),S=Ky(w.shape,w.dtype,_.values),I=NW(x,S,y,g);t=r.makeTensorInfo(x,w.dtype,I.values)}else{var T=new zX(g,y,x);t=r.runWebGLProgram(T,[w],w.dtype)}var N=vG({inputs:{x:t},backend:r,attrs:{shape:x}});return r.disposeIntermediateTensorInfo(w),r.disposeIntermediateTensorInfo(t),N}},VX=uG({opSnippet:"return tan(x);"}),UX={kernelName:zv,backendName:"webgl",kernelFunc:VX},WX=uG({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),GX=function e(t,n){_classCallCheck(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[a]*n[a];this.outputShape=r,this.rank=r.length;var i=nW(this.rank),o=function(e){var t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod(".concat(n[a],", ").concat(e[a],")"));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")};function HX(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.reps;if("string"===i.dtype){var s=n.texData.get(i.dataId).values.map((function(e){return r.decodeString(e)})),u=Ky(i.shape,i.dtype,s),c=EW(u,o);return n.makeTensorInfo(c.shape,c.dtype,c.values)}var l=new GX(i.shape,o);return n.runWebGLProgram(l,[i],i.dtype)}for(var jX=function e(t,n){_classCallCheck(this,e),this.variableNames=["x","segmentIds"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.numSegments,s=o*Math.ceil(i/r);this.outputShape=[a,s];var u=4*Math.floor(r/4),c=r%4,l="\n        sumValue += dot(values, segFilter);\n    ",h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      "));var p="";i%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        ".concat(h,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(p,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(o,")) * float(").concat(r,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(o,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(l,"\n        }\n        setOutput(sumValue);\n      }\n    ")},qX=0,KX=[Uq,Gq,AG,EG,FG,OG,LG,VG,UG,WG,qG,KG,YG,QG,tH,$G,rH,sH,oH,lH,hH,pH,mH,xH,wH,TH,EH,DH,PH,tG,GH,ej,tj,YH,rj,aj,nj,oj,uj,lj,fj,mj,gj,Cj,_j,kj,Ij,Nj,Ej,Rj,Dj,Mj,zj,Vj,Gj,qj,Zj,Jj,tq,rq,oq,sq,uq,lq,pq,fq,vq,$W,gq,UH,bq,xq,Cq,aG,Sq,Tq,Nq,Fq,Eq,Oq,Pq,zq,jq,Yq,Xq,Jq,$q,eK,Kq,tK,nK,aK,sK,cK,yK,mG,kK,wK,_K,IK,_H,NK,RK,FK,PK,zK,sG,BK,UK,IH,pK,GK,KK,jK,gG,ZK,JK,eX,nX,iX,sX,cX,hX,dX,mX,gX,bX,xX,CX,SX,kH,gK,TX,NX,AX,EX,FX,OX,PX,LX,BX,mK,SG,UX,{kernelName:Bv,backendName:"webgl",kernelFunc:WX},{kernelName:Vv,backendName:"webgl",kernelFunc:HX},{kernelName:Uv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted,s=n.texData.get(a.dataId).values,u=_slicedToArray(RW(s,a.shape,a.dtype,i,o),2),c=u[0],l=u[1];return[n.makeTensorInfo(c.shape,c.dtype,c.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}},TG,{kernelName:Gv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;EU(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=r.readSync(i.dataId),s=DW(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}},{kernelName:Hv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],c=new Array(s-1),l=0,h=0;h<s;h++)h!==i&&(c[l++]=o.shape[h]);var p=[],d=new Array(s).fill(0),f=o.shape.slice();f[i]=1;for(var m=new Array(u),v=0;v<m.length;v++){d[i]=v;var g=bH({inputs:{x:o},backend:n,attrs:{begin:d,size:f}}),y=vG({inputs:{x:g},backend:n,attrs:{shape:c}});m[v]=y,p.push(g)}return p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),m}},{kernelName:jv,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.segmentIds,s=a.numSegments,u=i.shape.length,c=[],l=0,h=v.getAxesPermutation([l],u),p=i;null!=h&&(p=IG({inputs:{x:i},backend:n,attrs:{perm:h}}),c.push(p),l=v.getInnerMostAxes(1,u)[0]);var d=v.segment_util.computeOutShape(p.shape,l,s),f=r.sizeFromShape([p.shape[l]]),m=vG({inputs:{x:p},backend:n,attrs:{shape:[-1,f]}});c.push(m);var g=vG({inputs:{x:function e(t,r,a,i,o){var s=t.shape[0],u=t.shape[1],l=v.segment_util.segOpComputeOptimalWindowSize(u,o),h=new jX({windowSize:l,inSize:u,batchSize:s,numSegments:o},r),p=n.compileAndRun(h,[t,a],i);if(c.push(p),p.shape[1]===o)return p;var d=VK({backend:n,attrs:{start:0,stop:o,step:1,dtype:"float32"}}),f=HX({inputs:{x:d},backend:n,attrs:{reps:[u/l]}});return c.push(d),c.push(f),e(p,r,f,i,o)}(m,"unsortedSegmentSum",o,Dg(i.dtype),s)},backend:n,attrs:{shape:d}}),y=g;if(null!=h){c.push(g);var b=v.getUndoAxesPermutation(h);y=IG({inputs:{x:y},backend:n,attrs:{perm:b}})}return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),y}},EK];qX<KX.length;qX++){ag(KX[qX])}function XX(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function YX(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var ZX={0:"tench, Tinca tinca",1:"goldfish, Carassius auratus",2:"great white shark, white shark, man-eater, man-eating shark, Carcharodon carcharias",3:"tiger shark, Galeocerdo cuvieri",4:"hammerhead, hammerhead shark",5:"electric ray, crampfish, numbfish, torpedo",6:"stingray",7:"cock",8:"hen",9:"ostrich, Struthio camelus",10:"brambling, Fringilla montifringilla",11:"goldfinch, Carduelis carduelis",12:"house finch, linnet, Carpodacus mexicanus",13:"junco, snowbird",14:"indigo bunting, indigo finch, indigo bird, Passerina cyanea",15:"robin, American robin, Turdus migratorius",16:"bulbul",17:"jay",18:"magpie",19:"chickadee",20:"water ouzel, dipper",21:"kite",22:"bald eagle, American eagle, Haliaeetus leucocephalus",23:"vulture",24:"great grey owl, great gray owl, Strix nebulosa",25:"European fire salamander, Salamandra salamandra",26:"common newt, Triturus vulgaris",27:"eft",28:"spotted salamander, Ambystoma maculatum",29:"axolotl, mud puppy, Ambystoma mexicanum",30:"bullfrog, Rana catesbeiana",31:"tree frog, tree-frog",32:"tailed frog, bell toad, ribbed toad, tailed toad, Ascaphus trui",33:"loggerhead, loggerhead turtle, Caretta caretta",34:"leatherback turtle, leatherback, leathery turtle, Dermochelys coriacea",35:"mud turtle",36:"terrapin",37:"box turtle, box tortoise",38:"banded gecko",39:"common iguana, iguana, Iguana iguana",40:"American chameleon, anole, Anolis carolinensis",41:"whiptail, whiptail lizard",42:"agama",43:"frilled lizard, Chlamydosaurus kingi",44:"alligator lizard",45:"Gila monster, Heloderma suspectum",46:"green lizard, Lacerta viridis",47:"African chameleon, Chamaeleo chamaeleon",48:"Komodo dragon, Komodo lizard, dragon lizard, giant lizard, Varanus komodoensis",49:"African crocodile, Nile crocodile, Crocodylus niloticus",50:"American alligator, Alligator mississipiensis",51:"triceratops",52:"thunder snake, worm snake, Carphophis amoenus",53:"ringneck snake, ring-necked snake, ring snake",54:"hognose snake, puff adder, sand viper",55:"green snake, grass snake",56:"king snake, kingsnake",57:"garter snake, grass snake",58:"water snake",59:"vine snake",60:"night snake, Hypsiglena torquata",61:"boa constrictor, Constrictor constrictor",62:"rock python, rock snake, Python sebae",63:"Indian cobra, Naja naja",64:"green mamba",65:"sea snake",66:"horned viper, cerastes, sand viper, horned asp, Cerastes cornutus",67:"diamondback, diamondback rattlesnake, Crotalus adamanteus",68:"sidewinder, horned rattlesnake, Crotalus cerastes",69:"trilobite",70:"harvestman, daddy longlegs, Phalangium opilio",71:"scorpion",72:"black and gold garden spider, Argiope aurantia",73:"barn spider, Araneus cavaticus",74:"garden spider, Aranea diademata",75:"black widow, Latrodectus mactans",76:"tarantula",77:"wolf spider, hunting spider",78:"tick",79:"centipede",80:"black grouse",81:"ptarmigan",82:"ruffed grouse, partridge, Bonasa umbellus",83:"prairie chicken, prairie grouse, prairie fowl",84:"peacock",85:"quail",86:"partridge",87:"African grey, African gray, Psittacus erithacus",88:"macaw",89:"sulphur-crested cockatoo, Kakatoe galerita, Cacatua galerita",90:"lorikeet",91:"coucal",92:"bee eater",93:"hornbill",94:"hummingbird",95:"jacamar",96:"toucan",97:"drake",98:"red-breasted merganser, Mergus serrator",99:"goose",100:"black swan, Cygnus atratus",101:"tusker",102:"echidna, spiny anteater, anteater",103:"platypus, duckbill, duckbilled platypus, duck-billed platypus, Ornithorhynchus anatinus",104:"wallaby, brush kangaroo",105:"koala, koala bear, kangaroo bear, native bear, Phascolarctos cinereus",106:"wombat",107:"jelly fish",108:"sea anemone, anemone",109:"brain coral",110:"flatworm, platyhelminth",111:"nematode, nematode worm, roundworm",112:"conch",113:"snail",114:"slug",115:"sea slug, nudibranch",116:"chiton, coat-of-mail shell, sea cradle, polyplacophore",117:"chambered nautilus, pearly nautilus, nautilus",118:"Dungeness crab, Cancer magister",119:"rock crab, Cancer irroratus",120:"fiddler crab",121:"king crab, Alaska crab, Alaskan king crab, Alaska king crab, Paralithodes camtschatica",122:"American lobster, Northern lobster, Maine lobster, Homarus americanus",123:"spiny lobster, langouste, rock lobster, crawfish, crayfish, sea crawfish",124:"crayfish, crawfish, crawdad, crawdaddy",125:"hermit crab",126:"isopod",127:"white stork, Ciconia ciconia",128:"black stork, Ciconia nigra",129:"spoonbill",130:"flamingo",131:"little blue heron, Egretta caerulea",132:"American egret, great white heron, Egretta albus",133:"bittern",134:"crane",135:"limpkin, Aramus pictus",136:"European gallinule, Porphyrio porphyrio",137:"American coot, marsh hen, mud hen, water hen, Fulica americana",138:"bustard",139:"ruddy turnstone, Arenaria interpres",140:"red-backed sandpiper, dunlin, Erolia alpina",141:"redshank, Tringa totanus",142:"dowitcher",143:"oystercatcher, oyster catcher",144:"pelican",145:"king penguin, Aptenodytes patagonica",146:"albatross, mollymawk",147:"grey whale, gray whale, devilfish, Eschrichtius gibbosus, Eschrichtius robustus",148:"killer whale, killer, orca, grampus, sea wolf, Orcinus orca",149:"dugong, Dugong dugon",150:"sea lion",151:"Chihuahua",152:"Japanese spaniel",153:"Maltese dog, Maltese terrier, Maltese",154:"Pekinese, Pekingese, Peke",155:"Shih-Tzu",156:"Blenheim spaniel",157:"papillon",158:"toy terrier",159:"Rhodesian ridgeback",160:"Afghan hound, Afghan",161:"basset, basset hound",162:"beagle",163:"bloodhound, sleuthhound",164:"bluetick",165:"black-and-tan coonhound",166:"Walker hound, Walker foxhound",167:"English foxhound",168:"redbone",169:"borzoi, Russian wolfhound",170:"Irish wolfhound",171:"Italian greyhound",172:"whippet",173:"Ibizan hound, Ibizan Podenco",174:"Norwegian elkhound, elkhound",175:"otterhound, otter hound",176:"Saluki, gazelle hound",177:"Scottish deerhound, deerhound",178:"Weimaraner",179:"Staffordshire bullterrier, Staffordshire bull terrier",180:"American Staffordshire terrier, Staffordshire terrier, American pit bull terrier, pit bull terrier",181:"Bedlington terrier",182:"Border terrier",183:"Kerry blue terrier",184:"Irish terrier",185:"Norfolk terrier",186:"Norwich terrier",187:"Yorkshire terrier",188:"wire-haired fox terrier",189:"Lakeland terrier",190:"Sealyham terrier, Sealyham",191:"Airedale, Airedale terrier",192:"cairn, cairn terrier",193:"Australian terrier",194:"Dandie Dinmont, Dandie Dinmont terrier",195:"Boston bull, Boston terrier",196:"miniature schnauzer",197:"giant schnauzer",198:"standard schnauzer",199:"Scotch terrier, Scottish terrier, Scottie",200:"Tibetan terrier, chrysanthemum dog",201:"silky terrier, Sydney silky",202:"soft-coated wheaten terrier",203:"West Highland white terrier",204:"Lhasa, Lhasa apso",205:"flat-coated retriever",206:"curly-coated retriever",207:"golden retriever",208:"Labrador retriever",209:"Chesapeake Bay retriever",210:"German short-haired pointer",211:"vizsla, Hungarian pointer",212:"English setter",213:"Irish setter, red setter",214:"Gordon setter",215:"Brittany spaniel",216:"clumber, clumber spaniel",217:"English springer, English springer spaniel",218:"Welsh springer spaniel",219:"cocker spaniel, English cocker spaniel, cocker",220:"Sussex spaniel",221:"Irish water spaniel",222:"kuvasz",223:"schipperke",224:"groenendael",225:"malinois",226:"briard",227:"kelpie",228:"komondor",229:"Old English sheepdog, bobtail",230:"Shetland sheepdog, Shetland sheep dog, Shetland",231:"collie",232:"Border collie",233:"Bouvier des Flandres, Bouviers des Flandres",234:"Rottweiler",235:"German shepherd, German shepherd dog, German police dog, alsatian",236:"Doberman, Doberman pinscher",237:"miniature pinscher",238:"Greater Swiss Mountain dog",239:"Bernese mountain dog",240:"Appenzeller",241:"EntleBucher",242:"boxer",243:"bull mastiff",244:"Tibetan mastiff",245:"French bulldog",246:"Great Dane",247:"Saint Bernard, St Bernard",248:"Eskimo dog, husky",249:"malamute, malemute, Alaskan malamute",250:"Siberian husky",251:"dalmatian, coach dog, carriage dog",252:"affenpinscher, monkey pinscher, monkey dog",253:"basenji",254:"pug, pug-dog",255:"Leonberg",256:"Newfoundland, Newfoundland dog",257:"Great Pyrenees",258:"Samoyed, Samoyede",259:"Pomeranian",260:"chow, chow chow",261:"keeshond",262:"Brabancon griffon",263:"Pembroke, Pembroke Welsh corgi",264:"Cardigan, Cardigan Welsh corgi",265:"toy poodle",266:"miniature poodle",267:"standard poodle",268:"Mexican hairless",269:"timber wolf, grey wolf, gray wolf, Canis lupus",270:"white wolf, Arctic wolf, Canis lupus tundrarum",271:"red wolf, maned wolf, Canis rufus, Canis niger",272:"coyote, prairie wolf, brush wolf, Canis latrans",273:"dingo, warrigal, warragal, Canis dingo",274:"dhole, Cuon alpinus",275:"African hunting dog, hyena dog, Cape hunting dog, Lycaon pictus",276:"hyena, hyaena",277:"red fox, Vulpes vulpes",278:"kit fox, Vulpes macrotis",279:"Arctic fox, white fox, Alopex lagopus",280:"grey fox, gray fox, Urocyon cinereoargenteus",281:"tabby, tabby cat",282:"tiger cat",283:"Persian cat",284:"Siamese cat, Siamese",285:"Egyptian cat",286:"cougar, puma, catamount, mountain lion, painter, panther, Felis concolor",287:"lynx, catamount",288:"leopard, Panthera pardus",289:"snow leopard, ounce, Panthera uncia",290:"jaguar, panther, Panthera onca, Felis onca",291:"lion, king of beasts, Panthera leo",292:"tiger, Panthera tigris",293:"cheetah, chetah, Acinonyx jubatus",294:"brown bear, bruin, Ursus arctos",295:"American black bear, black bear, Ursus americanus, Euarctos americanus",296:"ice bear, polar bear, Ursus Maritimus, Thalarctos maritimus",297:"sloth bear, Melursus ursinus, Ursus ursinus",298:"mongoose",299:"meerkat, mierkat",300:"tiger beetle",301:"ladybug, ladybeetle, lady beetle, ladybird, ladybird beetle",302:"ground beetle, carabid beetle",303:"long-horned beetle, longicorn, longicorn beetle",304:"leaf beetle, chrysomelid",305:"dung beetle",306:"rhinoceros beetle",307:"weevil",308:"fly",309:"bee",310:"ant, emmet, pismire",311:"grasshopper, hopper",312:"cricket",313:"walking stick, walkingstick, stick insect",314:"cockroach, roach",315:"mantis, mantid",316:"cicada, cicala",317:"leafhopper",318:"lacewing, lacewing fly",319:"dragonfly, darning needle, devil's darning needle, sewing needle, snake feeder, snake doctor, mosquito hawk, skeeter hawk",320:"damselfly",321:"admiral",322:"ringlet, ringlet butterfly",323:"monarch, monarch butterfly, milkweed butterfly, Danaus plexippus",324:"cabbage butterfly",325:"sulphur butterfly, sulfur butterfly",326:"lycaenid, lycaenid butterfly",327:"starfish, sea star",328:"sea urchin",329:"sea cucumber, holothurian",330:"wood rabbit, cottontail, cottontail rabbit",331:"hare",332:"Angora, Angora rabbit",333:"hamster",334:"porcupine, hedgehog",335:"fox squirrel, eastern fox squirrel, Sciurus niger",336:"marmot",337:"beaver",338:"guinea pig, Cavia cobaya",339:"sorrel",340:"zebra",341:"hog, pig, grunter, squealer, Sus scrofa",342:"wild boar, boar, Sus scrofa",343:"warthog",344:"hippopotamus, hippo, river horse, Hippopotamus amphibius",345:"ox",346:"water buffalo, water ox, Asiatic buffalo, Bubalus bubalis",347:"bison",348:"ram, tup",349:"bighorn, bighorn sheep, cimarron, Rocky Mountain bighorn, Rocky Mountain sheep, Ovis canadensis",350:"ibex, Capra ibex",351:"hartebeest",352:"impala, Aepyceros melampus",353:"gazelle",354:"Arabian camel, dromedary, Camelus dromedarius",355:"llama",356:"weasel",357:"mink",358:"polecat, fitch, foulmart, foumart, Mustela putorius",359:"black-footed ferret, ferret, Mustela nigripes",360:"otter",361:"skunk, polecat, wood pussy",362:"badger",363:"armadillo",364:"three-toed sloth, ai, Bradypus tridactylus",365:"orangutan, orang, orangutang, Pongo pygmaeus",366:"gorilla, Gorilla gorilla",367:"chimpanzee, chimp, Pan troglodytes",368:"gibbon, Hylobates lar",369:"siamang, Hylobates syndactylus, Symphalangus syndactylus",370:"guenon, guenon monkey",371:"patas, hussar monkey, Erythrocebus patas",372:"baboon",373:"macaque",374:"langur",375:"colobus, colobus monkey",376:"proboscis monkey, Nasalis larvatus",377:"marmoset",378:"capuchin, ringtail, Cebus capucinus",379:"howler monkey, howler",380:"titi, titi monkey",381:"spider monkey, Ateles geoffroyi",382:"squirrel monkey, Saimiri sciureus",383:"Madagascar cat, ring-tailed lemur, Lemur catta",384:"indri, indris, Indri indri, Indri brevicaudatus",385:"Indian elephant, Elephas maximus",386:"African elephant, Loxodonta africana",387:"lesser panda, red panda, panda, bear cat, cat bear, Ailurus fulgens",388:"giant panda, panda, panda bear, coon bear, Ailuropoda melanoleuca",389:"barracouta, snoek",390:"eel",391:"coho, cohoe, coho salmon, blue jack, silver salmon, Oncorhynchus kisutch",392:"rock beauty, Holocanthus tricolor",393:"anemone fish",394:"sturgeon",395:"gar, garfish, garpike, billfish, Lepisosteus osseus",396:"lionfish",397:"puffer, pufferfish, blowfish, globefish",398:"abacus",399:"abaya",400:"academic gown, academic robe, judge's robe",401:"accordion, piano accordion, squeeze box",402:"acoustic guitar",403:"aircraft carrier, carrier, flattop, attack aircraft carrier",404:"airliner",405:"airship, dirigible",406:"altar",407:"ambulance",408:"amphibian, amphibious vehicle",409:"analog clock",410:"apiary, bee house",411:"apron",412:"ashcan, trash can, garbage can, wastebin, ash bin, ash-bin, ashbin, dustbin, trash barrel, trash bin",413:"assault rifle, assault gun",414:"backpack, back pack, knapsack, packsack, rucksack, haversack",415:"bakery, bakeshop, bakehouse",416:"balance beam, beam",417:"balloon",418:"ballpoint, ballpoint pen, ballpen, Biro",419:"Band Aid",420:"banjo",421:"bannister, banister, balustrade, balusters, handrail",422:"barbell",423:"barber chair",424:"barbershop",425:"barn",426:"barometer",427:"barrel, cask",428:"barrow, garden cart, lawn cart, wheelbarrow",429:"baseball",430:"basketball",431:"bassinet",432:"bassoon",433:"bathing cap, swimming cap",434:"bath towel",435:"bathtub, bathing tub, bath, tub",436:"beach wagon, station wagon, wagon, estate car, beach waggon, station waggon, waggon",437:"beacon, lighthouse, beacon light, pharos",438:"beaker",439:"bearskin, busby, shako",440:"beer bottle",441:"beer glass",442:"bell cote, bell cot",443:"bib",444:"bicycle-built-for-two, tandem bicycle, tandem",445:"bikini, two-piece",446:"binder, ring-binder",447:"binoculars, field glasses, opera glasses",448:"birdhouse",449:"boathouse",450:"bobsled, bobsleigh, bob",451:"bolo tie, bolo, bola tie, bola",452:"bonnet, poke bonnet",453:"bookcase",454:"bookshop, bookstore, bookstall",455:"bottlecap",456:"bow",457:"bow tie, bow-tie, bowtie",458:"brass, memorial tablet, plaque",459:"brassiere, bra, bandeau",460:"breakwater, groin, groyne, mole, bulwark, seawall, jetty",461:"breastplate, aegis, egis",462:"broom",463:"bucket, pail",464:"buckle",465:"bulletproof vest",466:"bullet train, bullet",467:"butcher shop, meat market",468:"cab, hack, taxi, taxicab",469:"caldron, cauldron",470:"candle, taper, wax light",471:"cannon",472:"canoe",473:"can opener, tin opener",474:"cardigan",475:"car mirror",476:"carousel, carrousel, merry-go-round, roundabout, whirligig",477:"carpenter's kit, tool kit",478:"carton",479:"car wheel",480:"cash machine, cash dispenser, automated teller machine, automatic teller machine, automated teller, automatic teller, ATM",481:"cassette",482:"cassette player",483:"castle",484:"catamaran",485:"CD player",486:"cello, violoncello",487:"cellular telephone, cellular phone, cellphone, cell, mobile phone",488:"chain",489:"chainlink fence",490:"chain mail, ring mail, mail, chain armor, chain armour, ring armor, ring armour",491:"chain saw, chainsaw",492:"chest",493:"chiffonier, commode",494:"chime, bell, gong",495:"china cabinet, china closet",496:"Christmas stocking",497:"church, church building",498:"cinema, movie theater, movie theatre, movie house, picture palace",499:"cleaver, meat cleaver, chopper",500:"cliff dwelling",501:"cloak",502:"clog, geta, patten, sabot",503:"cocktail shaker",504:"coffee mug",505:"coffeepot",506:"coil, spiral, volute, whorl, helix",507:"combination lock",508:"computer keyboard, keypad",509:"confectionery, confectionary, candy store",510:"container ship, containership, container vessel",511:"convertible",512:"corkscrew, bottle screw",513:"cornet, horn, trumpet, trump",514:"cowboy boot",515:"cowboy hat, ten-gallon hat",516:"cradle",517:"crane",518:"crash helmet",519:"crate",520:"crib, cot",521:"Crock Pot",522:"croquet ball",523:"crutch",524:"cuirass",525:"dam, dike, dyke",526:"desk",527:"desktop computer",528:"dial telephone, dial phone",529:"diaper, nappy, napkin",530:"digital clock",531:"digital watch",532:"dining table, board",533:"dishrag, dishcloth",534:"dishwasher, dish washer, dishwashing machine",535:"disk brake, disc brake",536:"dock, dockage, docking facility",537:"dogsled, dog sled, dog sleigh",538:"dome",539:"doormat, welcome mat",540:"drilling platform, offshore rig",541:"drum, membranophone, tympan",542:"drumstick",543:"dumbbell",544:"Dutch oven",545:"electric fan, blower",546:"electric guitar",547:"electric locomotive",548:"entertainment center",549:"envelope",550:"espresso maker",551:"face powder",552:"feather boa, boa",553:"file, file cabinet, filing cabinet",554:"fireboat",555:"fire engine, fire truck",556:"fire screen, fireguard",557:"flagpole, flagstaff",558:"flute, transverse flute",559:"folding chair",560:"football helmet",561:"forklift",562:"fountain",563:"fountain pen",564:"four-poster",565:"freight car",566:"French horn, horn",567:"frying pan, frypan, skillet",568:"fur coat",569:"garbage truck, dustcart",570:"gasmask, respirator, gas helmet",571:"gas pump, gasoline pump, petrol pump, island dispenser",572:"goblet",573:"go-kart",574:"golf ball",575:"golfcart, golf cart",576:"gondola",577:"gong, tam-tam",578:"gown",579:"grand piano, grand",580:"greenhouse, nursery, glasshouse",581:"grille, radiator grille",582:"grocery store, grocery, food market, market",583:"guillotine",584:"hair slide",585:"hair spray",586:"half track",587:"hammer",588:"hamper",589:"hand blower, blow dryer, blow drier, hair dryer, hair drier",590:"hand-held computer, hand-held microcomputer",591:"handkerchief, hankie, hanky, hankey",592:"hard disc, hard disk, fixed disk",593:"harmonica, mouth organ, harp, mouth harp",594:"harp",595:"harvester, reaper",596:"hatchet",597:"holster",598:"home theater, home theatre",599:"honeycomb",600:"hook, claw",601:"hoopskirt, crinoline",602:"horizontal bar, high bar",603:"horse cart, horse-cart",604:"hourglass",605:"iPod",606:"iron, smoothing iron",607:"jack-o'-lantern",608:"jean, blue jean, denim",609:"jeep, landrover",610:"jersey, T-shirt, tee shirt",611:"jigsaw puzzle",612:"jinrikisha, ricksha, rickshaw",613:"joystick",614:"kimono",615:"knee pad",616:"knot",617:"lab coat, laboratory coat",618:"ladle",619:"lampshade, lamp shade",620:"laptop, laptop computer",621:"lawn mower, mower",622:"lens cap, lens cover",623:"letter opener, paper knife, paperknife",624:"library",625:"lifeboat",626:"lighter, light, igniter, ignitor",627:"limousine, limo",628:"liner, ocean liner",629:"lipstick, lip rouge",630:"Loafer",631:"lotion",632:"loudspeaker, speaker, speaker unit, loudspeaker system, speaker system",633:"loupe, jeweler's loupe",634:"lumbermill, sawmill",635:"magnetic compass",636:"mailbag, postbag",637:"mailbox, letter box",638:"maillot",639:"maillot, tank suit",640:"manhole cover",641:"maraca",642:"marimba, xylophone",643:"mask",644:"matchstick",645:"maypole",646:"maze, labyrinth",647:"measuring cup",648:"medicine chest, medicine cabinet",649:"megalith, megalithic structure",650:"microphone, mike",651:"microwave, microwave oven",652:"military uniform",653:"milk can",654:"minibus",655:"miniskirt, mini",656:"minivan",657:"missile",658:"mitten",659:"mixing bowl",660:"mobile home, manufactured home",661:"Model T",662:"modem",663:"monastery",664:"monitor",665:"moped",666:"mortar",667:"mortarboard",668:"mosque",669:"mosquito net",670:"motor scooter, scooter",671:"mountain bike, all-terrain bike, off-roader",672:"mountain tent",673:"mouse, computer mouse",674:"mousetrap",675:"moving van",676:"muzzle",677:"nail",678:"neck brace",679:"necklace",680:"nipple",681:"notebook, notebook computer",682:"obelisk",683:"oboe, hautboy, hautbois",684:"ocarina, sweet potato",685:"odometer, hodometer, mileometer, milometer",686:"oil filter",687:"organ, pipe organ",688:"oscilloscope, scope, cathode-ray oscilloscope, CRO",689:"overskirt",690:"oxcart",691:"oxygen mask",692:"packet",693:"paddle, boat paddle",694:"paddlewheel, paddle wheel",695:"padlock",696:"paintbrush",697:"pajama, pyjama, pj's, jammies",698:"palace",699:"panpipe, pandean pipe, syrinx",700:"paper towel",701:"parachute, chute",702:"parallel bars, bars",703:"park bench",704:"parking meter",705:"passenger car, coach, carriage",706:"patio, terrace",707:"pay-phone, pay-station",708:"pedestal, plinth, footstall",709:"pencil box, pencil case",710:"pencil sharpener",711:"perfume, essence",712:"Petri dish",713:"photocopier",714:"pick, plectrum, plectron",715:"pickelhaube",716:"picket fence, paling",717:"pickup, pickup truck",718:"pier",719:"piggy bank, penny bank",720:"pill bottle",721:"pillow",722:"ping-pong ball",723:"pinwheel",724:"pirate, pirate ship",725:"pitcher, ewer",726:"plane, carpenter's plane, woodworking plane",727:"planetarium",728:"plastic bag",729:"plate rack",730:"plow, plough",731:"plunger, plumber's helper",732:"Polaroid camera, Polaroid Land camera",733:"pole",734:"police van, police wagon, paddy wagon, patrol wagon, wagon, black Maria",735:"poncho",736:"pool table, billiard table, snooker table",737:"pop bottle, soda bottle",738:"pot, flowerpot",739:"potter's wheel",740:"power drill",741:"prayer rug, prayer mat",742:"printer",743:"prison, prison house",744:"projectile, missile",745:"projector",746:"puck, hockey puck",747:"punching bag, punch bag, punching ball, punchball",748:"purse",749:"quill, quill pen",750:"quilt, comforter, comfort, puff",751:"racer, race car, racing car",752:"racket, racquet",753:"radiator",754:"radio, wireless",755:"radio telescope, radio reflector",756:"rain barrel",757:"recreational vehicle, RV, R.V.",758:"reel",759:"reflex camera",760:"refrigerator, icebox",761:"remote control, remote",762:"restaurant, eating house, eating place, eatery",763:"revolver, six-gun, six-shooter",764:"rifle",765:"rocking chair, rocker",766:"rotisserie",767:"rubber eraser, rubber, pencil eraser",768:"rugby ball",769:"rule, ruler",770:"running shoe",771:"safe",772:"safety pin",773:"saltshaker, salt shaker",774:"sandal",775:"sarong",776:"sax, saxophone",777:"scabbard",778:"scale, weighing machine",779:"school bus",780:"schooner",781:"scoreboard",782:"screen, CRT screen",783:"screw",784:"screwdriver",785:"seat belt, seatbelt",786:"sewing machine",787:"shield, buckler",788:"shoe shop, shoe-shop, shoe store",789:"shoji",790:"shopping basket",791:"shopping cart",792:"shovel",793:"shower cap",794:"shower curtain",795:"ski",796:"ski mask",797:"sleeping bag",798:"slide rule, slipstick",799:"sliding door",800:"slot, one-armed bandit",801:"snorkel",802:"snowmobile",803:"snowplow, snowplough",804:"soap dispenser",805:"soccer ball",806:"sock",807:"solar dish, solar collector, solar furnace",808:"sombrero",809:"soup bowl",810:"space bar",811:"space heater",812:"space shuttle",813:"spatula",814:"speedboat",815:"spider web, spider's web",816:"spindle",817:"sports car, sport car",818:"spotlight, spot",819:"stage",820:"steam locomotive",821:"steel arch bridge",822:"steel drum",823:"stethoscope",824:"stole",825:"stone wall",826:"stopwatch, stop watch",827:"stove",828:"strainer",829:"streetcar, tram, tramcar, trolley, trolley car",830:"stretcher",831:"studio couch, day bed",832:"stupa, tope",833:"submarine, pigboat, sub, U-boat",834:"suit, suit of clothes",835:"sundial",836:"sunglass",837:"sunglasses, dark glasses, shades",838:"sunscreen, sunblock, sun blocker",839:"suspension bridge",840:"swab, swob, mop",841:"sweatshirt",842:"swimming trunks, bathing trunks",843:"swing",844:"switch, electric switch, electrical switch",845:"syringe",846:"table lamp",847:"tank, army tank, armored combat vehicle, armoured combat vehicle",848:"tape player",849:"teapot",850:"teddy, teddy bear",851:"television, television system",852:"tennis ball",853:"thatch, thatched roof",854:"theater curtain, theatre curtain",855:"thimble",856:"thresher, thrasher, threshing machine",857:"throne",858:"tile roof",859:"toaster",860:"tobacco shop, tobacconist shop, tobacconist",861:"toilet seat",862:"torch",863:"totem pole",864:"tow truck, tow car, wrecker",865:"toyshop",866:"tractor",867:"trailer truck, tractor trailer, trucking rig, rig, articulated lorry, semi",868:"tray",869:"trench coat",870:"tricycle, trike, velocipede",871:"trimaran",872:"tripod",873:"triumphal arch",874:"trolleybus, trolley coach, trackless trolley",875:"trombone",876:"tub, vat",877:"turnstile",878:"typewriter keyboard",879:"umbrella",880:"unicycle, monocycle",881:"upright, upright piano",882:"vacuum, vacuum cleaner",883:"vase",884:"vault",885:"velvet",886:"vending machine",887:"vestment",888:"viaduct",889:"violin, fiddle",890:"volleyball",891:"waffle iron",892:"wall clock",893:"wallet, billfold, notecase, pocketbook",894:"wardrobe, closet, press",895:"warplane, military plane",896:"washbasin, handbasin, washbowl, lavabo, wash-hand basin",897:"washer, automatic washer, washing machine",898:"water bottle",899:"water jug",900:"water tower",901:"whiskey jug",902:"whistle",903:"wig",904:"window screen",905:"window shade",906:"Windsor tie",907:"wine bottle",908:"wing",909:"wok",910:"wooden spoon",911:"wool, woolen, woollen",912:"worm fence, snake fence, snake-rail fence, Virginia fence",913:"wreck",914:"yawl",915:"yurt",916:"web site, website, internet site, site",917:"comic book",918:"crossword puzzle, crossword",919:"street sign",920:"traffic light, traffic signal, stoplight",921:"book jacket, dust cover, dust jacket, dust wrapper",922:"menu",923:"plate",924:"guacamole",925:"consomme",926:"hot pot, hotpot",927:"trifle",928:"ice cream, icecream",929:"ice lolly, lolly, lollipop, popsicle",930:"French loaf",931:"bagel, beigel",932:"pretzel",933:"cheeseburger",934:"hotdog, hot dog, red hot",935:"mashed potato",936:"head cabbage",937:"broccoli",938:"cauliflower",939:"zucchini, courgette",940:"spaghetti squash",941:"acorn squash",942:"butternut squash",943:"cucumber, cuke",944:"artichoke, globe artichoke",945:"bell pepper",946:"cardoon",947:"mushroom",948:"Granny Smith",949:"strawberry",950:"orange",951:"lemon",952:"fig",953:"pineapple, ananas",954:"banana",955:"jackfruit, jak, jack",956:"custard apple",957:"pomegranate",958:"hay",959:"carbonara",960:"chocolate sauce, chocolate syrup",961:"dough",962:"meat loaf, meatloaf",963:"pizza, pizza pie",964:"potpie",965:"burrito",966:"red wine",967:"espresso",968:"cup",969:"eggnog",970:"alp",971:"bubble",972:"cliff, drop, drop-off",973:"coral reef",974:"geyser",975:"lakeside, lakeshore",976:"promontory, headland, head, foreland",977:"sandbar, sand bar",978:"seashore, coast, seacoast, sea-coast",979:"valley, vale",980:"volcano",981:"ballplayer, baseball player",982:"groom, bridegroom",983:"scuba diver",984:"rapeseed",985:"daisy",986:"yellow lady's slipper, yellow lady-slipper, Cypripedium calceolus, Cypripedium parviflorum",987:"corn",988:"acorn",989:"hip, rose hip, rosehip",990:"buckeye, horse chestnut, conker",991:"coral fungus",992:"agaric",993:"gyromitra",994:"stinkhorn, carrion fungus",995:"earthstar",996:"hen-of-the-woods, hen of the woods, Polyporus frondosus, Grifola frondosa",997:"bolete",998:"ear, spike, capitulum",999:"toilet tissue, toilet paper, bathroom tissue"},QX={"1.00":"module_apply_default/MobilenetV1/Logits/global_pool","2.00":"module_apply_default/MobilenetV2/Logits/AvgPool"},JX={"1.00":{.25:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_025_224/classification/1",inputRange:[0,1]},"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_050_224/classification/1",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_075_224/classification/1",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_100_224/classification/1",inputRange:[0,1]}},"2.00":{"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_050_224/classification/2",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_075_224/classification/2",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_100_224/classification/2",inputRange:[0,1]}}},$X=function(){function e(e,t,n,r,a){void 0===r&&(r=-1),void 0===a&&(a=1),this.version=e,this.alpha=t,this.modelUrl=n,this.inputMin=r,this.inputMax=a,this.normalizationConstant=(a-r)/255}return e.prototype.load=function(){return XX(this,void 0,void 0,(function(){var e,t,n,r=this;return YX(this,(function(a){switch(a.label){case 0:return this.modelUrl?(e=this,[4,gO(this.modelUrl)]):[3,2];case 1:return e.model=a.sent(),[3,4];case 2:return t=this,[4,gO(JX[this.version][this.alpha].url,{fromTFHub:!0})];case 3:t.model=a.sent(),a.label=4;case 4:return[4,(n=fk((function(){return r.model.predict(fC([1,224,224,3]))}))).data()];case 5:return a.sent(),n.dispose(),[2]}}))}))},e.prototype.infer=function(e,t){var n=this;return void 0===t&&(t=!1),fk((function(){e instanceof _g||(e=u.fromPixels(e));var r=e.toFloat().mul(n.normalizationConstant).add(n.inputMin),a=r;224===e.shape[0]&&224===e.shape[1]||(a=ZS.resizeBilinear(r,[224,224],!0));var i=a.reshape([-1,224,224,3]);return t?n.model.execute(i,QX[n.version]).squeeze([1,2]):n.model.predict(i).slice([0,1],[-1,1e3])}))},e.prototype.classify=function(e,t){return void 0===t&&(t=3),XX(this,void 0,void 0,(function(){var n,r;return YX(this,(function(a){switch(a.label){case 0:return[4,eY(n=this.infer(e),t)];case 1:return r=a.sent(),n.dispose(),[2,r]}}))}))},e}();function eY(e,t){return XX(this,void 0,void 0,(function(){var n,r,a,i,o,s,u;return YX(this,(function(c){switch(c.label){case 0:return[4,(n=e.softmax()).data()];case 1:for(r=c.sent(),n.dispose(),a=[],u=0;u<r.length;u++)a.push({value:r[u],index:u});for(a.sort((function(e,t){return t.value-e.value})),i=new Float32Array(t),o=new Int32Array(t),u=0;u<t;u++)i[u]=a[u].value,o[u]=a[u].index;for(s=[],u=0;u<o.length;u++)s.push({className:ZX[o[u]],probability:i[u]});return[2,s]}}))}))}function tY(e,t){return null==e&&null==t?null:null==e?t.clone():null===t?e.clone():e.concat(t,0)}function nY(e,t){for(var n=[],r=0;r<e.length;r++)n.push({value:e[r],index:r});n.sort((function(e,t){return t.value-e.value}));var a=new Float32Array(t),i=new Int32Array(t);for(r=0;r<t;r++)a[r]=n[r].value,i[r]=n[r].index;return{values:a,indices:i}}var rY,aY=function(){function e(){this.classDatasetMatrices={},this.classExampleCount={},this.labelToClassId={},this.nextClassId=0}return e.prototype.addExample=function(e,t){var n=this;if(null==this.exampleShape&&(this.exampleShape=e.shape),!r.arraysEqual(this.exampleShape,e.shape))throw new Error("Example shape provided, "+e.shape+" does not match previously provided example shapes "+this.exampleShape+".");this.clearTrainDatasetMatrix(),t in this.labelToClassId||(this.labelToClassId[t]=this.nextClassId++),fk((function(){var r=n.normalizeVectorToUnitLength(e.flatten()),a=r.shape[0];if(null==n.classDatasetMatrices[t])n.classDatasetMatrices[t]=r.as2D(1,a);else{var i=n.classDatasetMatrices[t].as2D(n.classExampleCount[t],a).concat(r.as2D(1,a),0);n.classDatasetMatrices[t].dispose(),n.classDatasetMatrices[t]=i}vk(n.classDatasetMatrices[t]),null==n.classExampleCount[t]&&(n.classExampleCount[t]=0),n.classExampleCount[t]++}))},e.prototype.similarities=function(e){var t=this;return fk((function(){var n=t.normalizeVectorToUnitLength(e.flatten()),r=n.shape[0];if(null==t.trainDatasetMatrix){var a=null;for(var i in t.classDatasetMatrices)a=tY(a,t.classDatasetMatrices[i]);t.trainDatasetMatrix=a}if(null==t.trainDatasetMatrix)return console.warn("Cannot predict without providing training examples."),null;vk(t.trainDatasetMatrix);var o=t.getNumExamples();return t.trainDatasetMatrix.as2D(o,r).matMul(n.as2D(r,1)).as1D()}))},e.prototype.predictClass=function(e,t){return void 0===t&&(t=3),function(e,t,n,r){return new(n||(n=Promise))((function(t,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function o(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?t(e.value):new n((function(t){t(e.value)})).then(i,o)}s((r=r.apply(e,[])).next())}))}(this,0,void 0,(function(){var n,r,a,i,o=this;return function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(s){switch(s.label){case 0:if(t<1)throw new Error("Please provide a positive integer k value to predictClass.");if(0===this.getNumExamples())throw new Error("You have not added any examples to the KNN classifier. Please add examples before calling predictClass.");return n=fk((function(){return o.similarities(e).asType("float32")})),r=Math.min(t,this.getNumExamples()),i=nY,[4,n.data()];case 1:return a=i.apply(void 0,[s.sent(),r]).indices,n.dispose(),[2,this.calculateTopClass(a,r)]}}))}))},e.prototype.clearClass=function(e){if(null==this.classDatasetMatrices[e])throw new Error("Cannot clear invalid class "+e);this.classDatasetMatrices[e].dispose(),delete this.classDatasetMatrices[e],delete this.classExampleCount[e],this.clearTrainDatasetMatrix()},e.prototype.clearAllClasses=function(){for(var e in this.classDatasetMatrices)this.clearClass(e)},e.prototype.getClassExampleCount=function(){return this.classExampleCount},e.prototype.getClassifierDataset=function(){return this.classDatasetMatrices},e.prototype.getNumClasses=function(){return Object.keys(this.classExampleCount).length},e.prototype.setClassifierDataset=function(e){for(var t in this.clearTrainDatasetMatrix(),this.classDatasetMatrices=e,e)this.classExampleCount[t]=e[t].shape[0]},e.prototype.calculateTopClass=function(e,t){var n,r={};if(null==e)return{classIndex:this.labelToClassId[n],label:n,confidences:r};var a={},i=0;for(var o in this.classDatasetMatrices)a[o]=i+=this.classExampleCount[o];var s={};for(var o in this.classDatasetMatrices)s[o]=0;for(var u=0;u<e.length;u++){var c=e[u];for(var o in this.classDatasetMatrices)if(c<a[o]){s[o]++;break}}var l=0;for(var o in this.classDatasetMatrices){var h=s[o]/t;h>l&&(l=h,n=o),r[o]=h}return{classIndex:this.labelToClassId[n],label:n,confidences:r}},e.prototype.clearTrainDatasetMatrix=function(){null!=this.trainDatasetMatrix&&(this.trainDatasetMatrix.dispose(),this.trainDatasetMatrix=null)},e.prototype.normalizeVectorToUnitLength=function(e){return fk((function(){var t=e.norm();return Ak(e,t)}))},e.prototype.getNumExamples=function(){var e=0;for(var t in this.classDatasetMatrices)e+=this.classExampleCount[t];return e},e.prototype.dispose=function(){for(var e in this.clearTrainDatasetMatrix(),this.classDatasetMatrices)this.classDatasetMatrices[e].dispose()},e}(),iY=function e(t,n){_classCallCheck(this,e),this.label=t,this.confidence=n},oY=((rY=function(){function e(){_classCallCheck(this,e),this.init()}return _createClass(e,[{key:"init",value:function(){return td(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Loading Mobilenet"),e.next=3,function(e){return void 0===e&&(e={version:1,alpha:1}),XX(this,void 0,void 0,(function(){var t,n,r,a,i,o,s;return YX(this,(function(u){switch(u.label){case 0:if(null==y)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");if(r=e.version.toFixed(2),a=e.alpha?e.alpha.toFixed(2):"",i=-1,o=1,null==e.modelUrl){if(!(r in JX))throw new Error("Invalid version of MobileNet. Valid versions are: "+Object.keys(JX));if(!(a in JX[r]))throw new Error("MobileNet constructed with invalid alpha "+e.alpha+". Valid multipliers for this version are: "+Object.keys(JX[r])+".");i=(t=JX[r][a].inputRange)[0],o=t[1]}return null!=e.inputRange&&(i=(n=e.inputRange)[0],o=n[1]),[4,(s=new $X(r,a,e.modelUrl,i,o)).load()];case 1:return u.sent(),[2,s]}}))}))}();case 3:this.mobilenet=e.sent,console.log("Creating classifier"),this.classifier=new aY;case 6:case"end":return e.stop()}}),e,this)})))}},{key:"addWebCam",value:function(e){return td(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Added Webcam"),t.next=3,P.webcam(e);case 3:this.webcam=t.sent;case 4:case"end":return t.stop()}}),t,this)})))}},{key:"addExample",value:function(e){return td(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.webcam){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.webcam.capture();case 4:n=t.sent,r=this.mobilenet.infer(n,!0),this.classifier.addExample(r,e),n.dispose();case 7:case"end":return t.stop()}}),t,this)})))}},{key:"predict",value:function(){return td(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=null,!this.isReady()){e.next=10;break}return e.next=4,this.webcam.capture();case 4:return n=e.sent,r=this.mobilenet.infer(n,"conv_preds"),e.next=8,this.classifier.predictClass(r);case 8:a=e.sent,t=new iY(parseInt(a.label),a.confidences[a.label]),n.dispose();case 10:return e.next=12,nI();case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e,this)})))}},{key:"isReady",value:function(){return!!(this.webcam&&this.classifier&&this.classifier.getNumClasses()>0)}}]),e}()).ngInjectableDef=He({factory:function(){return new rY},token:rY,providedIn:"root"}),rY),sY=vr({encapsulation:0,styles:[[""]],data:{}});function uY(e){return yo(0,[(e()(),ro(0,0,null,null,2,"div",[["style","width: 300px"]],null,null,null,null,null)),(e()(),ro(1,0,null,null,1,"app-progress-bar",[],null,null,null,ed,$p)),Ca(2,638976,null,0,Jp,[],{progress:[0,"progress"]},null)],(function(e,t){e(t,2,0,t.component.moveProgress)}),null)}function cY(e){return yo(0,[(e()(),ro(0,0,null,null,1,"div",[],null,null,null,null,null)),(e()(),mo(-1,null,["Hold your hand still and close to camera."]))],null,null)}function lY(e){return yo(0,[(e()(),ro(0,0,null,null,4,"div",[["class","row"]],null,null,null,null,null)),(e()(),ro(1,0,null,null,3,"div",[["class","col-12"]],null,null,null,null,null)),(e()(),ro(2,0,null,null,0,"video",[["autoplay",""],["height","300"],["id","webcam"],["width","300"]],null,null,null,null,null)),(e()(),no(16777216,null,null,1,null,uY)),Ca(4,16384,null,0,Hs,[er,Jn],{ngIf:[0,"ngIf"],ngIfElse:[1,"ngIfElse"]},null),(e()(),no(0,[["holdStill",2]],null,0,null,cY))],(function(e,t){var n=t.component;e(t,4,0,null!==n.currentMove||void 0!==n.currentMove,la(t,5))}),null)}var hY=function(){function e(t,n){_classCallCheck(this,e),this._socketService=t,this._router=n,this.gameStarted=!1,this.gameOver=!1,this.newGameTimer=5,this.moveOptionSelected=null,this.moveOptions=[{label:"Rock",value:0},{label:"Paper",value:1},{label:"Scissor",value:2}],this.playersMove=null,this.playerHasMoved=!1,this.opponentsMove=null,this.opponentHasMoved=!1,this.result="",this.subResult="",this.subscriptions=[]}return _createClass(e,[{key:"makeAMove",value:function(){if(null!==this.moveOptionSelected){var e=this.moveOptionSelected;this._socketService.sendMessage("make-a-move",{move:e,room:this._socketService.room}),this.playersMove=e,this.playerHasMoved=!0}this.calculateResult()}},{key:"selectOption",value:function(e){this.moveOptionSelected=e.value}},{key:"calculateResult",value:function(){var e=this;if(this.playerHasMoved&&this.opponentHasMoved){this.result=0===this.playersMove&&2===this.opponentsMove?"You have won.":0===this.opponentsMove&&2===this.playersMove?"Opponent has won.":this.playersMove>this.opponentsMove?"You have won.":this.playersMove<this.opponentsMove?"Opponent has won.":"Its a tie.",this.subResult="Opponent chose "+this.moveOptions[this.opponentsMove].label,this.gameOver=!0;var t=setInterval((function(){e.newGameTimer-=1,0===e.newGameTimer&&(e.initPlayground(),clearInterval(t))}),1e3)}}},{key:"initPlayground",value:function(){this.newGameTimer=5,this.gameOver=!1,this.moveOptionSelected=null,this.playersMove=null,this.playerHasMoved=!1,this.opponentsMove=null,this.opponentHasMoved=!1,this.result="",this.subResult=""}},{key:"initSubscriptions",value:function(){var e=this;this.subscriptions.push(this._socketService.startGame().subscribe((function(t){console.log(t),e.gameStarted=!0}))),this.subscriptions.push(this._socketService.opponentMove().subscribe((function(t){e.opponentsMove=t,e.opponentHasMoved=!0,e.calculateResult()}))),this.subscriptions.push(this._socketService.opponentLeft().subscribe((function(t){e._router.navigate(["/lobby"])})))}},{key:"ngOnInit",value:function(){this.initSubscriptions(),this.initPlayground(),this._socketService.sendMessage("player-in-game",this._socketService.room)}},{key:"ngOnDestroy",value:function(){this.subscriptions.forEach((function(e){e&&e.unsubscribe()}))}}]),e}(),pY=vr({encapsulation:0,styles:[[".selected[_ngcontent-%COMP%]{color:#f9a825;background-color:#fff;cursor:pointer;margin-top:.5rem;margin-bottom:.5rem;padding-top:.5rem;padding-bottom:.5rem}.unselected[_ngcontent-%COMP%]{color:#fff;background-color:#f9a825;cursor:pointer;margin-top:.5rem;margin-bottom:.5rem;padding-top:.5rem;padding-bottom:.5rem}.message[_ngcontent-%COMP%]{text-align:center;color:#fff}"]],data:{}});function dY(e){return yo(0,[(e()(),ro(0,0,null,null,1,"p",[["class","lead message"]],null,null,null,null,null)),(e()(),mo(-1,null,["Waiting for opponent to join."]))],null,null)}function fY(e){return yo(0,[(e()(),ro(0,0,null,null,1,"p",[["class","lead message"]],null,null,null,null,null)),(e()(),mo(-1,null,[" Waiting for opponent to play.\n"]))],null,null)}function mY(e){return yo(0,[(e()(),ro(0,0,null,null,1,"p",[["class","lead message"]],null,null,null,null,null)),(e()(),mo(-1,null,[" Opponent has made the move. Play fast.\n"]))],null,null)}function vY(e){return yo(0,[(e()(),ro(0,0,null,null,11,"div",[["class","row"]],null,[[null,"click"]],(function(e,t,n){var r=!0;return"click"===t&&(r=!1!==e.component.selectOption(e.context.$implicit)&&r),r}),null,null)),_a(512,null,zs,Bs,[Kn,Xn,En,On]),Ca(2,278528,null,0,Vs,[zs],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),(e()(),ro(3,0,null,null,5,"div",[["class","col-2 offset-1"]],null,null,null,null,null)),(e()(),ro(4,0,null,null,4,"span",[],null,null,null,null,null)),(e()(),ro(5,0,null,null,3,"i",[["aria-hidden","true"],["class","fa fa-2x"]],null,null,null,null,null)),_a(512,null,zs,Bs,[Kn,Xn,En,On]),Ca(7,278528,null,0,Vs,[zs],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),fo(8,{"fa-hand-rock-o":0,"fa-hand-paper-o":1,"fa-hand-scissors-o":2}),(e()(),ro(9,0,null,null,2,"div",[["class","col-8"]],null,null,null,null,null)),(e()(),ro(10,0,null,null,1,"h3",[],null,null,null,null,null)),(e()(),mo(11,null,["",""]))],(function(e,t){e(t,2,0,"row",t.context.$implicit.value===t.component.moveOptionSelected?"selected":"unselected");var n=e(t,8,0,0===t.context.$implicit.value,1===t.context.$implicit.value,2===t.context.$implicit.value);e(t,7,0,"fa fa-2x",n)}),(function(e,t){e(t,11,0,t.context.$implicit.label)}))}function gY(e){return yo(0,[(e()(),ro(0,0,null,null,12,"div",[["class","container"],["style","margin-top: 5rem"]],null,null,null,null,null)),(e()(),ro(1,0,null,null,11,"div",[["class","row"]],null,null,null,null,null)),(e()(),ro(2,0,null,null,2,"div",[["class","col-12 col-md-6"]],null,null,null,null,null)),(e()(),ro(3,0,null,null,1,"app-predict",[],null,[[null,"select"],[null,"play"]],(function(e,t,n){var r=!0,a=e.component;return"select"===t&&(r=!1!==a.selectOption({value:n})&&r),"play"===t&&(r=!1!==a.makeAMove()&&r),r}),lY,sY)),Ca(4,114688,null,0,nd,[oY],null,{play:"play",select:"select"}),(e()(),ro(5,0,null,null,7,"div",[["class","col-12 col-md-6"]],null,null,null,null,null)),(e()(),no(16777216,null,null,1,null,vY)),Ca(7,278528,null,0,Ws,[er,Jn,Kn],{ngForOf:[0,"ngForOf"]},null),(e()(),ro(8,0,null,null,0,"br",[],null,null,null,null,null)),(e()(),ro(9,0,null,null,3,"div",[["class","row"]],null,null,null,null,null)),(e()(),ro(10,0,null,null,2,"div",[["class","col"]],null,null,null,null,null)),(e()(),ro(11,0,null,null,1,"button",[["class","float-right btn btn-dark"],["type","button"]],null,[[null,"click"]],(function(e,t,n){var r=!0;return"click"===t&&(r=!1!==e.component.makeAMove()&&r),r}),null,null)),(e()(),mo(-1,null,[" Play "]))],(function(e,t){var n=t.component;e(t,4,0),e(t,7,0,n.moveOptions)}),null)}function yY(e){return yo(0,[(e()(),ro(0,0,null,null,1,"h5",[["class","message"]],null,null,null,null,null)),(e()(),mo(1,null,[" New game starts in "," seconds\n"]))],null,(function(e,t){e(t,1,0,t.component.newGameTimer)}))}function bY(e){return yo(0,[(e()(),ro(0,0,null,null,0,"br",[],null,null,null,null,null)),(e()(),no(16777216,null,null,1,null,dY)),Ca(2,16384,null,0,Hs,[er,Jn],{ngIf:[0,"ngIf"]},null),(e()(),no(16777216,null,null,1,null,fY)),Ca(4,16384,null,0,Hs,[er,Jn],{ngIf:[0,"ngIf"]},null),(e()(),no(16777216,null,null,1,null,mY)),Ca(6,16384,null,0,Hs,[er,Jn],{ngIf:[0,"ngIf"]},null),(e()(),no(16777216,null,null,1,null,gY)),Ca(8,16384,null,0,Hs,[er,Jn],{ngIf:[0,"ngIf"]},null),(e()(),ro(9,0,null,null,1,"h3",[["class","message"]],null,null,null,null,null)),(e()(),mo(10,null,["",""])),(e()(),ro(11,0,null,null,1,"h6",[["class","message"]],null,null,null,null,null)),(e()(),mo(12,null,["",""])),(e()(),no(16777216,null,null,1,null,yY)),Ca(14,16384,null,0,Hs,[er,Jn],{ngIf:[0,"ngIf"]},null)],(function(e,t){var n=t.component;e(t,2,0,!n.gameStarted),e(t,4,0,n.gameStarted&&!n.opponentHasMoved),e(t,6,0,n.gameStarted&&n.opponentHasMoved&&!n.playerHasMoved),e(t,8,0,n.gameStarted&&!n.playerHasMoved),e(t,14,0,n.gameOver)}),(function(e,t){var n=t.component;e(t,10,0,n.result?n.result:""),e(t,12,0,n.subResult?n.subResult:"")}))}var kY=$r("app-playground",hY,(function(e){return yo(0,[(e()(),ro(0,0,null,null,1,"app-playground",[],null,null,null,bY,pY)),Ca(1,245760,null,0,hY,[Xp,mp],null,null)],(function(e,t){e(t,1,0)}),null)}),{},{},[]),xY=function(e){return e[e.Rock=0]="Rock",e[e.Paper=1]="Paper",e[e.Scissor=2]="Scissor",e}({}),wY=function(){function e(t){_classCallCheck(this,e),this._knnService=t,this.rockProgress=0,this.paperProgress=0,this.scissorProgress=0}return _createClass(e,[{key:"addExample",value:function(e){this.rockProgress+=e===xY.Rock?20:0,this.paperProgress+=e===xY.Paper?20:0,this.scissorProgress+=e===xY.Scissor?20:0,this._knnService.addExample(e)}},{key:"ngOnInit",value:function(){var e=this,t=document.getElementById("webcam");navigator.mediaDevices.getUserMedia({video:!0}).then((function(n){t&&(t.srcObject=n,e.stream=n)})),t&&this._knnService.addWebCam(t)}},{key:"ngOnDestroy",value:function(){this.stream.getTracks().forEach((function(e){e.stop()}))}}]),e}(),CY=vr({encapsulation:0,styles:[["h5[_ngcontent-%COMP%], p[_ngcontent-%COMP%], span[_ngcontent-%COMP%]{color:#fff}.input[_ngcontent-%COMP%]{margin:1rem}"]],data:{}});function _Y(e){return yo(0,[(e()(),ro(0,0,null,null,1,"button",[["class","btn btn-dark"],["type","button"]],null,[[null,"click"]],(function(e,t,n){var r=!0;return"click"===t&&(r=!1!==e.component.addExample(0)&&r),r}),null,null)),(e()(),mo(-1,null,[" Add Rock "]))],null,null)}function SY(e){return yo(0,[(e()(),ro(0,0,null,null,1,"button",[["class","btn btn-dark"],["type","button"]],null,[[null,"click"]],(function(e,t,n){var r=!0;return"click"===t&&(r=!1!==e.component.addExample(1)&&r),r}),null,null)),(e()(),mo(-1,null,[" Add Paper "]))],null,null)}function IY(e){return yo(0,[(e()(),ro(0,0,null,null,1,"button",[["class","btn btn-dark"],["type","button"]],null,[[null,"click"]],(function(e,t,n){var r=!0;return"click"===t&&(r=!1!==e.component.addExample(2)&&r),r}),null,null)),(e()(),mo(-1,null,[" Add Scissor "]))],null,null)}function TY(e){return yo(0,[(e()(),ro(0,0,null,null,1,"p",[],null,null,null,null,null)),(e()(),mo(-1,null,["Done!"]))],null,null)}function NY(e){return yo(0,[(e()(),ro(0,0,null,null,45,"div",[["class","container"]],null,null,null,null,null)),(e()(),ro(1,0,null,null,44,"div",[["class","row"]],null,null,null,null,null)),(e()(),ro(2,0,null,null,6,"div",[["class","col-12 text-center"]],null,null,null,null,null)),(e()(),ro(3,0,null,null,0,"br",[],null,null,null,null,null)),(e()(),ro(4,0,null,null,0,"br",[],null,null,null,null,null)),(e()(),ro(5,0,null,null,1,"h5",[],null,null,null,null,null)),(e()(),mo(-1,null,["Training Phase"])),(e()(),ro(7,0,null,null,0,"br",[],null,null,null,null,null)),(e()(),ro(8,0,null,null,0,"br",[],null,null,null,null,null)),(e()(),ro(9,0,null,null,1,"div",[["class","col-12 col-md-6"]],null,null,null,null,null)),(e()(),ro(10,0,null,null,0,"video",[["autoplay",""],["height","300"],["id","webcam"],["width","300"]],null,null,null,null,null)),(e()(),ro(11,0,null,null,21,"div",[["class","col-12 col-md-6"]],null,null,null,null,null)),(e()(),ro(12,0,null,null,6,"div",[["class","row input"]],null,null,null,null,null)),(e()(),ro(13,0,null,null,2,"div",[["class","col-8"]],null,null,null,null,null)),(e()(),ro(14,0,null,null,1,"app-progress-bar",[],null,null,null,ed,$p)),Ca(15,638976,null,0,Jp,[],{progress:[0,"progress"]},null),(e()(),ro(16,0,null,null,2,"div",[["class","col-4"]],null,null,null,null,null)),(e()(),no(16777216,null,null,1,null,_Y)),Ca(18,16384,null,0,Hs,[er,Jn],{ngIf:[0,"ngIf"],ngIfElse:[1,"ngIfElse"]},null),(e()(),ro(19,0,null,null,6,"div",[["class","row input"]],null,null,null,null,null)),(e()(),ro(20,0,null,null,2,"div",[["class","col-8"]],null,null,null,null,null)),(e()(),ro(21,0,null,null,1,"app-progress-bar",[],null,null,null,ed,$p)),Ca(22,638976,null,0,Jp,[],{progress:[0,"progress"]},null),(e()(),ro(23,0,null,null,2,"div",[["class","col-4"]],null,null,null,null,null)),(e()(),no(16777216,null,null,1,null,SY)),Ca(25,16384,null,0,Hs,[er,Jn],{ngIf:[0,"ngIf"],ngIfElse:[1,"ngIfElse"]},null),(e()(),ro(26,0,null,null,6,"div",[["class","row input"]],null,null,null,null,null)),(e()(),ro(27,0,null,null,2,"div",[["class","col-8"]],null,null,null,null,null)),(e()(),ro(28,0,null,null,1,"app-progress-bar",[],null,null,null,ed,$p)),Ca(29,638976,null,0,Jp,[],{progress:[0,"progress"]},null),(e()(),ro(30,0,null,null,2,"div",[["class","col-4"]],null,null,null,null,null)),(e()(),no(16777216,null,null,1,null,IY)),Ca(32,16384,null,0,Hs,[er,Jn],{ngIf:[0,"ngIf"],ngIfElse:[1,"ngIfElse"]},null),(e()(),ro(33,0,null,null,5,"div",[["class","col-12 text-center"]],null,null,null,null,null)),(e()(),ro(34,0,null,null,0,"br",[],null,null,null,null,null)),(e()(),ro(35,0,null,null,0,"br",[],null,null,null,null,null)),(e()(),ro(36,0,null,null,2,"button",[["class","btn btn-dark"],["type","button"]],[[8,"disabled",0]],[[null,"click"]],(function(e,t,n){var r=!0;return"click"===t&&(r=!1!==la(e,37).onClick()&&r),r}),null,null)),Ca(37,16384,null,0,vp,[mp,oh,[8,null],On,En],{routerLink:[0,"routerLink"]},null),(e()(),mo(-1,null,[" Play Game "])),(e()(),ro(39,0,null,null,6,"div",[["class","col-12 text-left"]],null,null,null,null,null)),(e()(),ro(40,0,null,null,0,"br",[],null,null,null,null,null)),(e()(),ro(41,0,null,null,0,"br",[],null,null,null,null,null)),(e()(),ro(42,0,null,null,1,"p",[],null,null,null,null,null)),(e()(),mo(-1,null,[" You need to add few images as an example of your input gestures. Rest assured these images won't be sent to the server. "])),(e()(),ro(44,0,null,null,1,"p",[],null,null,null,null,null)),(e()(),mo(-1,null,[" Please ensure good lighting. Hold your hand still and close to camera. "])),(e()(),no(0,[["done",2]],null,0,null,TY))],(function(e,t){var n=t.component;e(t,15,0,n.rockProgress),e(t,18,0,n.rockProgress<100,la(t,46)),e(t,22,0,n.paperProgress),e(t,25,0,n.paperProgress<100,la(t,46)),e(t,29,0,n.scissorProgress),e(t,32,0,n.scissorProgress<100,la(t,46)),e(t,37,0,"/lobby")}),(function(e,t){var n=t.component;e(t,36,0,n.rockProgress<100||n.paperProgress<100||n.scissorProgress<100)}))}var AY=$r("app-train",wY,(function(e){return yo(0,[(e()(),ro(0,0,null,null,1,"app-train",[],null,null,null,NY,CY)),Ca(1,245760,null,0,wY,[oY],null,null)],(function(e,t){e(t,1,0)}),null)}),{},{},[]),EY=vr({encapsulation:2,styles:[],data:{}});function RY(e){return yo(0,[(e()(),ro(0,16777216,null,null,1,"router-outlet",[],null,null,null,null,null)),Ca(1,212992,null,0,kp,[bp,er,In,[8,null],Jt],null,null)],(function(e,t){e(t,1,0)}),null)}var FY=$r("app-root",Ss,(function(e){return yo(0,[(e()(),ro(0,0,null,null,1,"app-root",[],null,null,null,RY,EY)),Ca(1,49152,null,0,Ss,[],null,null)],null,null)}),{},{},[]),DY=function(){function e(){_classCallCheck(this,e),this._accessors=[]}return _createClass(e,[{key:"add",value:function(e,t){this._accessors.push([e,t])}},{key:"remove",value:function(e){for(var t=this._accessors.length-1;t>=0;--t)if(this._accessors[t][1]===e)return void this._accessors.splice(t,1)}},{key:"select",value:function(e){var t=this;this._accessors.forEach((function(n){t._isSameGroup(n,e)&&n[1]!==e&&n[1].fireUncheck(e.value)}))}},{key:"_isSameGroup",value:function(e,t){return!!e[0].control&&e[0]._parent===t._control._parent&&e[1].name===t.name}}]),e}(),OY=new nt("NgFormSelectorWarning"),MY=function e(){_classCallCheck(this,e)},PY=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"withConfig",value:function(t){return{ngModule:e,providers:[{provide:OY,useValue:t.warnOnDeprecatedNgFormSelector}]}}}]),e}(),LY=function(){function e(t,n){_classCallCheck(this,e),this.router=t,this._socketService=n}return _createClass(e,[{key:"canActivate",value:function(){return!!this._socketService.room||(this.router.navigate(["/lobby"]),!1)}}]),e}(),zY=function(){function e(t,n){_classCallCheck(this,e),this.router=t,this._knnService=n}return _createClass(e,[{key:"canActivate",value:function(){return!!this._knnService.isReady()||(this.router.navigate(["/train"]),!1)}}]),e}(),BY=function e(){_classCallCheck(this,e)},VY=new Cs(_s,[Ss],(function(e){return function(e){for(var t={},n=[],r=!1,a=0;a<e.length;a++){var i=e[a];i.token===en&&!0===i.value&&(r=!0),1073741824&i.flags&&n.push(i.token),i.index=a,t[mr(i.token)]=i}return{factory:null,providersByKey:t,providers:e,modules:n,isRoot:r}}([qr(512,In,Tn,[[8,[jp,Qp,kY,AY,FY]],[3,In],pt]),qr(5120,ni,$i,[[3,ni]]),qr(4608,Ps,Ls,[ni,[2,Ms]]),qr(5120,Ba,eo,[bi]),qr(5120,Ya,Za,[]),qr(5120,Kn,Qi,[]),qr(5120,Xn,Ji,[]),qr(4608,Gc,Hc,[Ys]),qr(6144,Kt,null,[Gc]),qr(4608,Pc,zc,[]),qr(5120,hc,(function(e,t,n,r,a,i,o,s){return[new Oc(e,t,n),new Wc(r),new Bc(a,i,o,s)]}),[Ys,bi,$a,Ys,Ys,Pc,ti,[2,Lc]]),qr(4608,pc,pc,[hc,bi]),qr(135680,mc,mc,[Ys]),qr(4608,kc,kc,[pc,mc,Ya]),qr(6144,Fn,null,[kc]),qr(6144,fc,null,[mc]),qr(4608,Ti,Ti,[bi]),qr(5120,oh,Lp,[mp]),qr(4608,_p,_p,[]),qr(6144,wp,null,[_p]),qr(135680,Sp,Sp,[mp,Bi,li,nn,wp]),qr(4608,Cp,Cp,[]),qr(5120,Ip,Fp,[mp,Zs,Tp]),qr(5120,Up,Vp,[zp]),qr(5120,ei,(function(e){return[e]}),[Up]),qr(4608,DY,DY,[]),qr(4608,LY,LY,[mp,Xp]),qr(4608,zY,zY,[mp,oY]),qr(1073742336,Xs,Xs,[]),qr(1024,xt,Jc,[]),qr(1024,Ri,(function(){return[Ep()]}),[]),qr(512,zp,zp,[nn]),qr(1024,Ka,(function(e,t){return[(n=e,uc("probe",lc),uc("coreTokens",Object.assign({},cc,(n||[]).reduce((function(e,t){return e[t.name]=t.token,e}),{}))),function(){return lc}),Bp(t)];var n}),[[2,Ri],zp]),qr(512,Xa,Xa,[[2,Ka]]),qr(131584,Li,Li,[bi,ti,nn,xt,In,Xa]),qr(1073742336,to,to,[Li]),qr(1073742336,$c,$c,[[3,$c]]),qr(1024,Np,Op,[[3,mp]]),qr(512,zl,Bl,[]),qr(512,bp,bp,[]),qr(256,Tp,{},[]),qr(1024,Ns,Dp,[Is,[2,As],Tp]),qr(512,Es,Es,[Ns,Is]),qr(512,li,li,[]),qr(512,Bi,Wi,[li,[2,Vi]]),qr(1024,up,(function(){return[[{path:"lobby",component:qp,canActivate:[zY]},{path:"playground",component:hY,canActivate:[LY]},{path:"train",component:wY},{path:"",redirectTo:"train",pathMatch:"prefix"},{path:"**",redirectTo:"train"}]]}),[]),qr(1024,mp,Pp,[Li,zl,bp,Es,nn,Bi,li,up,Tp,[2,lp],[2,op]]),qr(1073742336,Rp,Rp,[[2,Np],[2,mp]]),qr(1073742336,BY,BY,[]),qr(1073742336,MY,MY,[]),qr(1073742336,PY,PY,[]),qr(1073742336,_s,_s,[]),qr(256,en,!0,[])])}));(function(){if(Ct)throw new Error("Cannot enable prod mode after platform setup.");wt=!1})(),Qc().bootstrapModuleFactory(VY).catch((function(e){return console.error(e)}))},zn8P:function(e,t){function n(e){return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="zn8P"}},[[0,0]]]);